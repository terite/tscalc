{"version":3,"sources":["components/ErrorCatcher.tsx","util.ts","rational.ts","game.ts","stateutil.ts","state.tsx","serialization.ts","signal.ts","components/generic/Dropdown.tsx","components/generic/Tooltip.tsx","components/generic/IntegerInput.tsx","components/generic/RationalInput.tsx","components/Icon.tsx","components/IngredientCard.tsx","components/RecipeOutput.tsx","components/MachineCard.tsx","components/RecipeCard.tsx","components/MachinePicker.tsx","components/ModuleCard.tsx","components/ModulePicker.tsx","totals.ts","components/RecipeRow.tsx","components/RecipePicker.tsx","components/TotalCard.tsx","components/App.tsx","components/RecipeGroup.tsx","components/Settings.tsx","components/AppLoader.tsx","index.tsx","components/RecipePicker.module.css","components/ErrorCatcher.module.css","components/Icon.module.css","components/TotalCard.module.css","components/RecipeGroup.module.css","components/App.module.css"],"names":["ErrorCatcher","props","state","crashMsg","undefined","error","errorInfo","this","crash","componentStack","stack","join","Sentry","scope","Object","keys","forEach","key","setExtra","msg","setState","className","styles","crashed","children","React","assert","check","message","Error","mapValues","obj","fn","ret","values","push","clone","orig","assign","create","getPrototypeOf","round2","num","places","mag","Math","pow","round","format_magnitude","amount","suffixes","i","length","num_divmod","a","b","Number","isSafeInteger","quotient","floor","remainder","Rational","p","q","toString","div","num_gcd","divmod","result","less","zero","sub","one","other","fromFloat","min","max","mul","maxDigits","roundingFactor","sign","x","isNegative","negate","add","integerPart","decimalPart","fraction","ten","equal","slice","isZero","parts","toFraction","isInteger","r","lookups","value","str","sum","split","part","trim","index","indexOf","fromInts","oneThird","twoThirds","rounded","floored","BaseDisplayable","data","name","localised_name","icon_col","icon_row","en","BaseItem","d","raw","usedBy","madeBy","Module","type","limitedTo","effects","Set","limitation","speed","effect","bonus","productivity","consumption","pollution","recipe","size","has","GenericItem","Fluid","default_temperature","BaseIngredient","ItemIngredient","gd","item","itemMap","toDecimal","niceName","FluidIngredient","minimum_temperature","maximum_temperature","fluidMap","Infinity","range","BaseProduct","amount_min","amount_max","probability","ItemProduct","ingredient","FluidProduct","temperature","console","temp","Recipe","category","ingredients","products","crafting_time","madeIn","energy_required","map","results","AssemblingMachine","crafting_categories","createCategoryMap","entities","catMap","entity","hasOwnProperty","GameData","items","fluids","modules","moduleMap","recipes","recipeMap","entityMap","categoryMap","groupCollapsed","addOfType","ctor","edata","itemName","thing","fluid","recipeName","entityName","canBuildRecipe","some","isPositive","debug","warn","log","groupEnd","groupOrder","subgroupOrder","group","groups","order","subgroups","subgroup","collection","keyFn","sort","ordersA","getItemOrder","ordersB","valA","valB","getDefaultMachine","input","defaultMachine","game","settings","assemblerOverrides","gameData","defaultState","fakeGameData","rows","activeGroupIdx","recipeTarget","getActiveGroup","updateGroup","newGroup","oldGroup","createDakpan","replaceState","newState","addRow","row","updateRow","updates","Array","from","removeRow","splice","moveRow","oldIndex","newIndex","removed","updateDefaultMachine","newMachine","oldMachine","machine","setActiveGroup","groupIdx","addGroup","renameGroup","removeGroup","maxIndex","setRecipeTarget","StateProvider","useDakpan","withBoth","OldComponent","actions","withGame","groupv4to5","getLocalStorageState","statestr","localStorage","getItem","stateobj","JSON","parse","version","deserialize","serialize","machineName","numMachines","m","beaconModule","numBeacons","reStateUrl","getUrlState","matches","exec","document","location","hash","decodeURIComponent","inflate","atob","to","migrateSerializedState","state1to2","state2to3","state3to4","state4to5","unmigrated","migrated","deserializeSettings","fromString","n","serialized","Signal","handlers","dispatch","arg","handler","addIngredientFilter","addProductFilter","addRecipeRow","ESC_KEYCODE","Dropdown","buttonRef","isOpen","handleToggle","handleSelect","selected","onSelect","handleWantClose","floater","canToggle","options","option","disabled","classes","parentRef","renderOption","onWantClose","ref","onClick","renderSelected","DropdownMenu","popperInstance","menuRef","style","popperUpdate","handleBodyClick","event","current","target","contains","handleKeyEvent","keyCode","renderOptions","header","active","referenceEl","menuEl","Popper","modifiers","applyStyle","enabled","updateStateWithStyle","body","addEventListener","disableEventListeners","removeEventListener","Tooltip","selfRef","handleMouseEnter","showSelf","handleMouseLeave","zIndex","relativeTo","selfEl","placement","offset","preventOverflow","boundariesElement","_","prevState","initPopper","cleanupPopper","ReactDOM","IntegerInput","handleChange","txtValue","isNaN","onChange","oldProps","step","RationalInput","errmsg","parsed","stringToRational","err","positiveOnly","rationalToString","classNames","lastIndexOf","rational","dec","toFloat","toMixed","Icon","iconRef","createRef","y","divStyle","display","backgroundPosition","width","height","icon","title","tooltip","text","lineHeight","marginLeft","PureComponent","IngredientCard","extras","fuel_value","totalValue","Card","Body","extra","Header","RawRecipeOutput","handleClick","shiftKey","preventDefault","stopPropagation","signal","showName","includes","perSecond","RecipeOutput","MachineCard","crafting_speed","module_slots","RecipeCard","product","sprites","float","clear","MachinePicker","machines","ModuleCard","module","bonuses","bonusName","ModulePicker","slot_icon_module","nomod","rocket_launch_products","filter","isBeacon","canUseWith","unshift","Totals","addIngredient","newIng","oldIng","match","addProduct","newProd","oldProd","be","clamp","ingredientMult","invert","productMult","satisfies","RecipeRow","handleRemoveClick","handleMachineChange","applyChange","handleNumMachinesChange","handleNumBeaconsChange","handleSetAllModules","fill","handleSetModule","handleSetBeaconModule","handleInputGroupClick","output","find","newNum","change","t","numSlots","slots","getOutput","draggableId","provided","innerRef","draggableProps","dragHandleProps","Button","variant","renderMachines","renderModules","renderBeacons","minWidth","getFn","RE_ADVANCED","RecipePicker","inputRef","query","handleIngredientClick","term","setQuery","calculateMatches","scrollIntoView","handleProductClick","handleQueryInput","handleRecipeClick","onPickRecipe","callback","debCalculateMatches","cancel","debounce","bind","addHandler","removeHandler","toLowerCase","conditions","consumes","produces","replace","Fuse","shouldSort","weight","search","placeholder","renderMatches","RecipeMatch","handleClickAdd","ing","prod","ResultName","ActivePage","TotalCard","totals","reduce","sortByItem","RecipeGroup","handlePickRecipe","su","handleDragEnd","destination","source","renderRow","handleClickRename","prompt","handleClickClone","handleClickDelete","window","confirm","availableRecipes","ButtonGroup","onDragEnd","droppableId","droppableProps","RawSettings","categoryNames","entries","entry","localeCompare","CategoryRow","Settings","App","handleKeyDown","classList","handleKeyUp","remove","handleClickGroup","activePage","Factory","handleClickAddGroup","defaultName","handleClickSettings","renderFactory","renderSettings","activeKey","factoryPills","Nav","Item","Link","role","aria-label","assertNever","Container","Row","Col","xs","Sidebar","renderNavbar","RawAppLoader","load","catch","fetch","response","status","json","urlState","serialization","storageState","sheet","href","StateWriter","useEffect","stringify","btoa","deflate","history","setItem","Prefetch","rel","head","AppLoader","dsn","getElementById","exports"],"mappings":"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","file":"static/js/main.756722e8.chunk.js","sourcesContent":["import * as React from 'react';\nimport * as Sentry from '@sentry/browser';\n\nimport styles from './ErrorCatcher.module.css';\n\ninterface Props {}\n\ninterface State {\n  crashMsg?: string;\n}\n\nexport class ErrorCatcher extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      crashMsg: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    // Catch errors in any components below and re-render with error message\n    this.crash(\n      [\n        'Component Stack:',\n        errorInfo.componentStack,\n        '',\n        error && error.stack,\n      ].join('\\n')\n    );\n\n    Sentry.withScope((scope) => {\n      Object.keys(errorInfo).forEach((key) => {\n        scope.setExtra(key, errorInfo[key as keyof React.ErrorInfo]);\n      });\n      Sentry.captureException(error);\n    });\n  }\n\n  crash(msg: string) {\n    this.setState({\n      crashMsg: msg,\n    });\n  }\n\n  render() {\n    if (typeof this.state.crashMsg !== 'undefined') {\n      return (\n        <div className={styles.crashed}>\n          <h1>Crashed!</h1>\n          <pre>{this.state.crashMsg}</pre>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","export function assert(check: any, message?: string): void {\n  if (!check) {\n    throw new Error(message || 'Assertion failed');\n  }\n}\n\nexport function assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\nexport function mapValues<T, V>(\n  obj: { [s: string]: T },\n  fn: (v: T) => V\n): { [s: string]: V } {\n  let ret: { [key: string]: V } = {};\n  for (let key in obj) {\n    ret[key] = fn(obj[key]);\n  }\n  return ret;\n}\n\nexport function values<T>(obj: { [s: string]: T }): T[] {\n  const values = [];\n  for (let key in obj) {\n    values.push(obj[key]);\n  }\n  return values;\n}\n\nexport function clone<T>(orig: T): T {\n  return Object.assign(Object.create(Object.getPrototypeOf(orig)), orig);\n}\n\nexport function round2(num: number, places: number) {\n  const mag = Math.pow(10, places);\n  return Math.round(num * mag) / mag;\n}\n\nexport function format_magnitude(amount: number, suffixes: string[]): string {\n  let i = 0;\n  for (; i < suffixes.length; i++) {\n    if (amount >= 1000) {\n      amount = amount / 1000;\n    } else {\n      break;\n    }\n  }\n\n  return `${round2(amount, 2)} ${suffixes[i]}`;\n}\n\nexport function format_watts(watts: number): string {\n  return format_magnitude(watts, ['W', 'kW', 'MW', 'GW', 'TW', 'PW']);\n}\n\nexport function format_joules(joules: number): string {\n  return format_magnitude(joules, ['J', 'kJ', 'MJ', 'GJ', 'TJ', 'PJ']);\n}\n","import { assert } from './util';\n\nfunction num_gcd(a: number, b: number): number {\n  return !b ? a : num_gcd(b, a % b);\n}\n\nfunction num_divmod(a: number, b: number) {\n  assert(Number.isSafeInteger(a));\n  assert(Number.isSafeInteger(b));\n\n  return {\n    quotient: Math.floor(a / b),\n    remainder: a % b,\n  };\n}\n\nconst FLOAT_CONVERT_PRECISION = 10000;\n\nexport class Rational {\n  p: number;\n  q: number;\n\n  constructor(p: number, q: number) {\n    assert(\n      Number.isSafeInteger(p),\n      `Numerator must be a safe integer, got ${p}`\n    );\n    assert(\n      Number.isSafeInteger(q),\n      `Denominator must be a safe integer, got ${q}`\n    );\n    assert(q !== 0, 'Denominator must not be zero');\n\n    if (q < 0) {\n      p = -p;\n      q = -q;\n    }\n\n    if (p === 0) {\n      q = 1;\n    }\n\n    const div = num_gcd(p, q);\n    if (div > 1) {\n      p = p / div;\n      q = q / div;\n    }\n    this.p = p;\n    this.q = q;\n  }\n\n  //\n  // Operations returning Rational\n  //\n  floor() {\n    const divmod = num_divmod(this.p, this.q);\n    let result = new Rational(divmod.quotient, 1);\n    if (result.less(Rational.zero) && divmod.remainder !== 0) {\n      result = result.sub(Rational.one);\n    }\n    return result;\n  }\n\n  negate() {\n    return new Rational(-this.p, this.q);\n  }\n\n  invert() {\n    return new Rational(this.q, this.p);\n  }\n\n  add(other: Rational) {\n    return new Rational(this.p * other.q + this.q * other.p, this.q * other.q);\n  }\n\n  sub(other: Rational) {\n    return new Rational(this.p * other.q - this.q * other.p, this.q * other.q);\n  }\n\n  mul(other: Rational | number): Rational {\n    if (typeof other == 'number') {\n      other = Rational.fromFloat(other);\n    }\n    return new Rational(this.p * other.p, this.q * other.q);\n  }\n\n  div(other: Rational) {\n    return new Rational(this.p * other.q, this.q * other.p);\n  }\n\n  clamp(min: Rational | number, max: Rational | number) {\n    if (typeof min == 'number') {\n      min = Rational.fromFloat(min);\n    }\n    if (typeof max == 'number') {\n      max = Rational.fromFloat(max);\n    }\n\n    if (this.less(min)) return min;\n    if (max.less(this)) return max;\n    return this;\n  }\n\n  //\n  // Operations NOT returning Rational\n  //\n  divmod(other: Rational) {\n    var quotient = this.div(other);\n    var div = quotient.floor();\n    var mod = this.sub(other.mul(div));\n    return { quotient: div, remainder: mod };\n  }\n\n  equal(other: Rational) {\n    return this.p === other.p && this.q === other.q;\n  }\n\n  isNegative() {\n    return this.p < 0;\n  }\n  isPositive() {\n    return this.p > 0;\n  }\n\n  isOne() {\n    return this.p === 1;\n  }\n\n  isZero() {\n    return this.p === 0;\n  }\n\n  less(other: Rational) {\n    return this.p * other.q < this.q * other.p;\n  }\n\n  toFloat() {\n    return this.p / this.q;\n  }\n\n  // Disabled to force choice between toFraction and toDecimal\n  toString: null;\n\n  toFraction() {\n    if (this.q === 1) {\n      return this.p.toString();\n    }\n    return this.p.toString() + '/' + this.q.toString();\n  }\n\n  toDecimal(maxDigits?: number, roundingFactor?: Rational) {\n    if (maxDigits == null) {\n      maxDigits = 3;\n    }\n    if (roundingFactor == null) {\n      roundingFactor = new Rational(5, 10 ** (maxDigits + 1));\n    }\n\n    let sign = '';\n    let x: Rational = this;\n    if (x.isNegative()) {\n      sign = '-';\n      x = x.negate();\n    }\n    x = x.add(roundingFactor);\n    let divmod = num_divmod(x.p, x.q);\n    var integerPart = divmod.quotient.toString();\n    var decimalPart = '';\n    var fraction = new Rational(divmod.remainder, x.q);\n    let ten = new Rational(10, 1);\n    while (maxDigits > 0 && !fraction.equal(roundingFactor)) {\n      fraction = fraction.mul(ten);\n      roundingFactor = roundingFactor.mul(ten);\n      let divmod = num_divmod(fraction.p, fraction.q);\n      decimalPart += divmod.quotient.toString();\n      fraction = new Rational(divmod.remainder, fraction.q);\n      maxDigits--;\n    }\n    if (fraction.equal(roundingFactor)) {\n      while (decimalPart[decimalPart.length - 1] === '0') {\n        decimalPart = decimalPart.slice(0, decimalPart.length - 1);\n      }\n    }\n    if (decimalPart !== '') {\n      return sign + integerPart + '.' + decimalPart;\n    }\n    return sign + integerPart;\n  }\n\n  toMixed(): string {\n    if (this.isZero()) {\n      return '0';\n    }\n\n    const { quotient, remainder } = this.divmod(Rational.one);\n\n    let parts: string[] = [];\n    if (!quotient.isZero()) {\n      parts.push(quotient.toFraction());\n    }\n    if (!remainder.isZero()) {\n      parts.push(remainder.toFraction());\n    }\n\n    return parts.join(' + ');\n  }\n\n  //\n  // Statics\n  //\n  static fromFloat(num: number) {\n    if (Number.isInteger(num)) {\n      return new this(num, 1);\n    }\n\n    // Sufficient precision for our data?\n    const r = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n\n    const divmod = r.divmod(Rational.one);\n    for (const [key, value] of lookups) {\n      if (divmod.remainder.equal(key)) {\n        return divmod.quotient.add(value);\n      }\n    }\n\n    return r;\n  }\n  static fromInts(p: number, q: number): Rational {\n    return new this(p, q);\n  }\n\n  static fromString(str: string): Rational {\n    let sum = Rational.zero;\n\n    for (let part of str.split('+')) {\n      part = part.trim();\n      if (!part) continue;\n\n      const index = part.indexOf('/');\n      if (index === -1) {\n        sum = sum.add(Rational.fromFloat(Number(part)));\n      } else {\n        const p = Number(part.slice(0, index));\n        const q = Number(part.slice(index + 1));\n        sum = sum.add(Rational.fromInts(p, q));\n      }\n    }\n\n    return sum;\n  }\n\n  static zero = new Rational(0, 1);\n  static one = new Rational(1, 1);\n  static oneThird = new Rational(1, 3);\n  static twoThirds = new Rational(2, 3);\n}\n\nconst lookups: [Rational, Rational][] = [];\n\nfor (let q = 2; q < 100; q++) {\n  for (let p = 1; p < q; p++) {\n    const num = p / q;\n\n    // Is there a better way to quickly filter out non-repeating decimals?\n    if (num.toString().length < 10) {\n      continue;\n    }\n\n    // Support computer input, use proper rounding\n    const rounded = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([rounded, Rational.fromInts(p, q)]);\n\n    // Support human input, who just leave off the end after a while\n    const floored = new Rational(\n      Math.floor(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([floored, Rational.fromInts(p, q)]);\n  }\n}\n","import { Rational } from './rational';\nimport { assert, values } from './util';\n\nimport * as schema from './schema';\n\ntype LocalisedName = schema.LocalisedName;\n\ninterface IBaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n}\n\nexport class BaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n\n  constructor(data: IBaseDisplayable) {\n    this.name = data.name;\n    this.localised_name = data.localised_name;\n    this.icon_col = data.icon_col;\n    this.icon_row = data.icon_row;\n  }\n\n  niceName() {\n    return this.localised_name.en;\n  }\n}\n\nabstract class BaseItem<T extends schema.Item> extends BaseDisplayable {\n  raw: T;\n  usedBy: Recipe[] = [];\n  madeBy: Recipe[] = [];\n\n  constructor(d: T) {\n    super(d);\n    this.raw = d;\n    this.name = d.name;\n    this.localised_name = d.localised_name;\n    this.icon_col = d.icon_col;\n    this.icon_row = d.icon_row;\n  }\n}\n\nexport class Module extends BaseItem<schema.ModuleItem> {\n  type: 'module';\n  limitedTo: Set<string>;\n  effects: {\n    speed: Rational;\n    productivity: Rational;\n    consumption: Rational;\n    pollution: Rational;\n  };\n\n  constructor(d: schema.ModuleItem) {\n    super(d);\n    this.type = d.type;\n    this.limitedTo = new Set(d.limitation);\n\n    this.effects = {\n      speed: Rational.fromFloat((d.effect.speed || { bonus: 0 }).bonus),\n      productivity: Rational.fromFloat(\n        (d.effect.productivity || { bonus: 0 }).bonus\n      ),\n      consumption: Rational.fromFloat(\n        (d.effect.consumption || { bonus: 0 }).bonus\n      ),\n      pollution: Rational.fromFloat((d.effect.pollution || { bonus: 0 }).bonus),\n    };\n  }\n\n  canUseWith(recipe: Recipe) {\n    if (this.limitedTo.size === 0) {\n      return true;\n    }\n\n    return this.limitedTo.has(recipe.name);\n  }\n}\n\nclass GenericItem extends BaseItem<schema.Item> {\n  type: 'generic' = 'generic';\n}\n\nexport type Item = Module | GenericItem;\n\nexport class Fluid extends BaseItem<schema.FluidItem> {\n  default_temperature: number;\n  type: 'fluid' = 'fluid';\n\n  constructor(d: schema.FluidItem) {\n    super(d);\n    this.default_temperature = d.default_temperature;\n  }\n}\n\nexport abstract class BaseIngredient {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Ingredient) {\n    this.name = d.name;\n    this.amount = Rational.fromFloat(d.amount);\n  }\n}\n\nexport class ItemIngredient extends BaseIngredient {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}`;\n  }\n}\n\nexport class FluidIngredient extends BaseIngredient {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  minimum_temperature: number;\n  maximum_temperature: number;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n\n    this.minimum_temperature = d.minimum_temperature || -Infinity;\n    this.maximum_temperature = d.maximum_temperature || Infinity;\n\n    if (this.maximum_temperature >= 1.797e308) {\n      this.maximum_temperature = Infinity;\n    }\n    if (this.minimum_temperature <= -1.797e308) {\n      this.minimum_temperature = -Infinity;\n    }\n  }\n\n  niceName() {\n    const min = this.minimum_temperature;\n    const max = this.maximum_temperature;\n    let range = '';\n    if (min !== -Infinity && max !== Infinity) {\n      range = ` (${min}  ${max})`;\n    } else if (max !== Infinity) {\n      range = ` ( ${max})`;\n    } else if (min !== -Infinity) {\n      range = ` ( ${max})`;\n    }\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}${range}`;\n  }\n}\n\nexport type Ingredient = ItemIngredient | FluidIngredient;\n\nabstract class BaseProduct {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Product) {\n    this.name = d.name;\n\n    let amount;\n    if ('amount' in d) {\n      amount = Rational.fromFloat(d.amount);\n    } else {\n      amount = Rational.fromInts(d.amount_min + d.amount_max, 2);\n    }\n\n    if (typeof d.probability == 'number') {\n      if (d.probability === 0) {\n        amount = Rational.zero;\n      } else if (d.probability !== 1) {\n        assert(d.probability > 0);\n        assert(d.probability < 1);\n        amount = amount.mul(Rational.fromFloat(d.probability));\n      }\n    }\n    this.amount = amount;\n  }\n}\n\nexport class ItemProduct extends BaseProduct {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return ingredient.type === 'item' && ingredient.item === this.item;\n  }\n}\n\nexport class FluidProduct extends BaseProduct {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  temperature: number;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n    if (!this.item) {\n      console.error('could not find item', d);\n    }\n    this.temperature = d.temperature || this.item.default_temperature;\n  }\n\n  niceName() {\n    let temp = '';\n    if (this.temperature !== this.item.default_temperature) {\n      temp = ` (${this.temperature})`;\n    }\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}${temp}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return (\n      ingredient.type === 'fluid' &&\n      ingredient.item === this.item &&\n      ingredient.maximum_temperature >= this.temperature &&\n      ingredient.minimum_temperature <= this.temperature\n    );\n  }\n}\n\nexport type Product = ItemProduct | FluidProduct;\n\nexport class Recipe extends BaseDisplayable {\n  category: string;\n  ingredients: Ingredient[];\n  products: Product[];\n  crafting_time: Rational;\n\n  madeIn: AssemblingMachine[] = [];\n\n  constructor(d: schema.Recipe, gd: GameData) {\n    super(d);\n    this.name = d.name;\n    this.category = d.category;\n    this.crafting_time = Rational.fromFloat(d.energy_required);\n\n    this.ingredients = d.ingredients.map((ingredient) => {\n      if (ingredient.type === 'fluid') {\n        return new FluidIngredient(ingredient, gd);\n      } else {\n        return new ItemIngredient(ingredient, gd);\n      }\n    });\n\n    this.products = d.results.map((result) => {\n      if (result.type === 'fluid') {\n        return new FluidProduct(result, gd);\n      } else {\n        return new ItemProduct(result, gd);\n      }\n    });\n  }\n\n  niceName() {\n    if (this.products.length > 1) {\n      return super.niceName();\n    } else if (this.products[0].amount.equal(Rational.one)) {\n      return this.products[0].item.niceName();\n    } else {\n      return this.products[0].niceName();\n    }\n  }\n}\n\nexport abstract class BaseEntity<T extends schema.BaseEntity> {\n  data: T;\n  constructor(data: T) {\n    this.data = data;\n  }\n\n  niceName() {\n    return this.data.localised_name.en;\n  }\n}\n\nexport class AssemblingMachine extends BaseEntity<schema.AssemblingMachine> {\n  canBuildRecipe(recipe: Recipe) {\n    // TODO: this needs to account for entity fluid boxes\n    if (this.data.crafting_categories.indexOf(recipe.category) === -1) {\n      return false;\n    }\n\n    // ingredient_count seems to be item specific. this is disabled until\n    // I can figure out how many fluids a machine can support\n    // if (recipe.ingredients.length > this.data.ingredient_count) {\n    //     return false\n    // }\n    return true;\n  }\n}\n\nexport type Entity = AssemblingMachine;\n\ntype CategoryMap = { [category: string]: AssemblingMachine[] };\n\nconst createCategoryMap = (entities: Entity[]) => {\n  const catMap: CategoryMap = {};\n  for (let entity of entities) {\n    if (!(entity instanceof AssemblingMachine)) {\n    }\n    for (let category of entity.data.crafting_categories) {\n      if (!catMap.hasOwnProperty(category)) {\n        catMap[category] = [];\n      }\n      catMap[category].push(entity);\n    }\n  }\n  return catMap;\n};\n\nexport class GameData {\n  raw: schema.Root;\n\n  items: Item[] = [];\n  itemMap: { [name: string]: Item } = {};\n\n  fluids: Fluid[] = [];\n  fluidMap: { [name: string]: Fluid } = {};\n\n  modules: Module[] = [];\n  moduleMap: { [name: string]: Module } = {};\n\n  recipes: Recipe[] = [];\n  recipeMap: { [name: string]: Recipe } = {};\n\n  entities: Entity[] = [];\n  entityMap: { [name: string]: Entity } = {};\n\n  categoryMap: CategoryMap;\n\n  constructor(raw: schema.Root) {\n    console.groupCollapsed('Game data processing');\n    this.raw = raw;\n\n    type Thing<T> = {\n      new (d: T): Entity;\n    };\n\n    const addOfType = <S extends schema.BaseEntity, C extends Thing<S>>(\n      entities: S[],\n      ctor: C\n    ) => {\n      for (let edata of entities) {\n        const entity = new ctor(edata);\n        this.entityMap[edata.name] = entity;\n        this.entities.push(entity);\n      }\n    };\n\n    addOfType(values(raw['assembling-machine']), AssemblingMachine);\n    addOfType(values(raw['furnace']), AssemblingMachine);\n    addOfType(values(raw['rocket-silo']), AssemblingMachine);\n\n    for (let itemName in raw.items) {\n      const thing = raw.items[itemName];\n      if ('type' in thing && thing.type === 'fluid') {\n        const fluid = new Fluid(thing);\n        this.fluids.push(fluid);\n        this.fluidMap[fluid.name] = fluid;\n      } else if ('type' in thing && thing.type === 'module') {\n        const item = new Module(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n        this.modules.push(item);\n        this.moduleMap[item.name] = item;\n      } else {\n        const item = new GenericItem(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n      }\n    }\n\n    for (let recipeName in raw.recipes) {\n      const recipe = new Recipe(raw.recipes[recipeName], this);\n\n      for (let entityName in this.entityMap) {\n        const entity = this.entityMap[entityName];\n\n        if ('canBuildRecipe' in entity && entity.canBuildRecipe(recipe)) {\n          recipe.madeIn.push(entity);\n        }\n      }\n      if (!recipe.madeIn.length) {\n        // Filter to only recipes buildable by knonwn assembling machines\n        console.warn('Ignoring uncraftable recipe', recipe.name, recipe);\n        continue;\n      }\n\n      const hasProducts = recipe.products.some((p) => p.amount.isPositive());\n      if (!hasProducts) {\n        console.debug('Ignoring void recipe', recipe.name, recipe);\n        continue;\n      }\n\n      this.recipeMap[recipe.name] = recipe;\n      this.recipes.push(recipe);\n\n      for (let ingredient of recipe.ingredients) {\n        ingredient.item.usedBy.push(recipe);\n      }\n      for (let product of recipe.products) {\n        product.item.madeBy.push(recipe);\n      }\n    }\n\n    this.categoryMap = createCategoryMap(this.entities);\n    console.log(`Processed ${this.items.length} items`);\n    console.log(`Processed ${this.fluids.length} fluids`);\n    console.log(`Processed ${this.recipes.length} recipes`);\n    console.log(`Processed ${this.entities.length} entities`);\n    console.groupEnd();\n  }\n\n  getItemOrder(item: Item | Fluid) {\n    let groupOrder = '';\n    let subgroupOrder = '';\n    const group = this.raw.groups[item.raw.group];\n    if (group) {\n      groupOrder = group.order;\n      subgroupOrder = group.subgroups[item.raw.subgroup] || '';\n    }\n    return [groupOrder, subgroupOrder, item.raw.order, item.raw.name];\n  }\n\n  // Sort by\n  // 1. group\n  // 2. subgroup\n  // 3. item order string\n  // 4. item name\n  sortByItem<T>(collection: T[], keyFn: (obj: T) => Item | Fluid): void {\n    const sortFn = (a: T, b: T) => {\n      const ordersA = this.getItemOrder(keyFn(a));\n      const ordersB = this.getItemOrder(keyFn(b));\n\n      for (const i in ordersA) {\n        const valA = ordersA[i];\n        const valB = ordersB[i];\n        if (valA > valB) {\n          return 1;\n        } else if (valA < valB) {\n          return -1;\n        }\n      }\n\n      return 0;\n    };\n\n    collection.sort(sortFn);\n  }\n}\n","import * as game from './game';\nimport { AppState } from './state';\nimport { assert } from './util';\n\nexport function getDefaultMachine(\n  category: string,\n  state: AppState\n): game.AssemblingMachine;\nexport function getDefaultMachine(\n  recipe: game.Recipe,\n  state: AppState\n): game.AssemblingMachine;\n\nexport function getDefaultMachine(\n  input: game.Recipe | string,\n  state: AppState\n): game.AssemblingMachine {\n  const category = input instanceof game.Recipe ? input.category : input;\n\n  let defaultMachine: game.AssemblingMachine;\n  if (category in state.settings.assemblerOverrides) {\n    defaultMachine = state.settings.assemblerOverrides[category];\n  } else {\n    defaultMachine = state.gameData.categoryMap[category][0];\n  }\n\n  if (input instanceof game.Recipe) {\n    assert(input.madeIn.indexOf(defaultMachine) !== -1);\n  }\n\n  return defaultMachine;\n}\n","import React from 'react';\nimport { createDakpan } from 'dakpan';\n\nimport * as game from './game';\nimport { Rational } from './rational';\nimport { getDefaultMachine } from './stateutil';\n\nexport interface RecipeRowData {\n  recipe: game.Recipe;\n  machine: game.AssemblingMachine;\n  numMachines: Rational;\n  modules: (game.Module | null)[];\n  beaconModule: game.Module | null;\n  numBeacons: number;\n}\n\nexport interface RecipeGroupData {\n  name: string;\n  rows: RecipeRowData[];\n}\n\nexport interface AppSettingsData {\n  assemblerOverrides: {\n    [category: string]: game.AssemblingMachine;\n  };\n}\n\nexport interface RecipeTarget {\n  item: game.Item | game.Fluid;\n  amount: Rational;\n}\n\nexport interface AppState {\n  // Loaded automatically\n  gameData: game.GameData;\n\n  // Preserved via url/localstorage\n  groups: RecipeGroupData[];\n  settings: AppSettingsData;\n\n  // unsaved state\n  activeGroupIdx: number;\n  recipeTarget: RecipeTarget | undefined;\n}\n\nexport const defaultState: AppState = {\n  gameData: ({ fakeGameData: true } as any) as game.GameData, // set early by apploader\n  groups: [\n    {\n      name: 'Factory 1',\n      rows: [],\n    },\n  ],\n  settings: {\n    assemblerOverrides: {},\n  },\n\n  activeGroupIdx: 0,\n  recipeTarget: undefined,\n};\n\nfunction getActiveGroup(state: AppState) {\n  return state.groups[state.activeGroupIdx];\n}\n\nfunction updateGroup(state: AppState, newGroup: Partial<RecipeGroupData>) {\n  const groups = state.groups.map((oldGroup, index) => {\n    return index === state.activeGroupIdx\n      ? { ...oldGroup, ...newGroup }\n      : oldGroup;\n  });\n\n  return { ...state, groups };\n}\n\nexport const [StateProvider, useDakpan] = createDakpan(defaultState)({\n  replaceState: (newState: Partial<AppState>) => (state) => {\n    return { ...state, ...newState };\n  },\n\n  addRow: (row: RecipeRowData) => (state) => {\n    const group = getActiveGroup(state);\n    // ignore adding duplicate rows\n    if (group.rows.some((r) => r.recipe.name === row.recipe.name)) {\n      return;\n    }\n\n    return updateGroup(state, { rows: [...group.rows, row] });\n  },\n\n  updateRow: (i: number, updates: Partial<RecipeRowData>) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows[i] = { ...group.rows[i], ...updates };\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  removeRow: (i: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows.splice(i, 1);\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  moveRow: (oldIndex: number, newIndex: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n\n    const [removed] = rows.splice(oldIndex, 1);\n    rows.splice(newIndex, 0, removed);\n\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  updateDefaultMachine: (\n    category: string,\n    newMachine: game.AssemblingMachine\n  ) => (state) => {\n    const oldMachine = getDefaultMachine(category, state);\n\n    const groups = state.groups.map((group) => {\n      const rows = group.rows.map((row) => {\n        if (row.recipe.category !== category || row.machine !== oldMachine) {\n          return row;\n        }\n        return {\n          ...row,\n          machine: newMachine,\n        };\n      });\n\n      return { ...group, rows };\n    });\n\n    return {\n      ...state,\n      groups,\n      settings: {\n        ...state.settings,\n        assemblerOverrides: {\n          ...state.settings.assemblerOverrides,\n          [category]: newMachine,\n        },\n      },\n    };\n  },\n\n  setActiveGroup: (groupIdx: number) => (state) => {\n    return { ...state, activeGroupIdx: groupIdx };\n  },\n\n  addGroup: (name: string, rows: RecipeRowData[] = []) => (state) => {\n    const groups = [\n      ...state.groups,\n      {\n        name,\n        rows,\n      },\n    ];\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx: state.groups.length,\n    };\n  },\n\n  renameGroup: (index: number, name: string) => (state) => {\n    const groups = [...state.groups];\n    groups[index] = { ...groups[index], name };\n    return {\n      ...state,\n      groups,\n    };\n  },\n\n  removeGroup: (index: number) => (state) => {\n    // Remove group\n    const groups = [...state.groups];\n    groups.splice(index, 1);\n\n    // Add new group if necessary\n    if (!groups.length) {\n      groups.push({\n        name: 'Factory 1',\n        rows: [],\n      });\n    }\n\n    // Fix the index if it's outside of bounds\n    const maxIndex = groups.length - 1;\n    const activeGroupIdx = Math.min(state.activeGroupIdx, maxIndex);\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx,\n    };\n  },\n\n  setRecipeTarget: (recipeTarget: RecipeTarget) => (state) => {\n    return {\n      ...state,\n      recipeTarget,\n    };\n  },\n});\n\nexport type AppActions = NonNullable<ReturnType<typeof useDakpan>[1]>;\n\nexport const withBoth = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'state' | 'actions'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state, actions] = useDakpan();\n    return <OldComponent state={state} actions={actions} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n\ntype PropsOf<\n  T extends React.ComponentType<any>\n> = T extends React.ComponentType<infer P> ? P : never;\n\nexport const withGame = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'gameData'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state] = useDakpan();\n    return <OldComponent gameData={state.gameData} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n\nexport const withActions = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'actions'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [, actions] = useDakpan();\n    return <OldComponent actions={actions} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n","import * as game from './game';\nimport { Rational } from './rational';\nimport { AppState, AppSettingsData } from './state';\nimport { getDefaultMachine } from './stateutil';\nimport { mapValues } from './util';\n\nimport { inflate, deflate } from 'pako';\n\ntype SerializedRowV1 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  number, // num assembling machines\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedAppStateV1 {\n  version: 1;\n  data: SerializedRowV1[];\n}\n\nfunction state1to2(state: SerializedAppStateV1): SerializedAppStateV2 {\n  return {\n    version: 2,\n    data: {\n      rows: state.data,\n      settings: {\n        assemblerOverrides: {},\n      },\n    },\n  };\n}\n\ninterface SerializedAppStateV2 {\n  version: 2;\n  data: {\n    rows: SerializedRowV1[];\n    settings: SerializedSettings;\n  };\n}\n\n// V3 = v2 but compressed\nfunction state2to3(state: SerializedAppStateV2): SerializedAppStateV3 {\n  return {\n    version: 3,\n    data: state.data,\n  };\n}\n\ninterface SerializedAppStateV3 {\n  version: 3;\n  data: SerializedAppStateV2['data'];\n}\n\n// v4 is multiple groups of rows\nfunction state3to4(state: SerializedAppStateV3): SerializedAppStateV4 {\n  return {\n    version: 4,\n    data: {\n      settings: state.data.settings,\n      groups: [\n        {\n          name: 'Factory 1',\n          rows: state.data.rows,\n        },\n      ],\n    },\n  };\n}\n\n// v4 has multiple groups, each with multiple rows\ninterface SerializedGroupV4 {\n  name: string;\n  rows: SerializedRowV1[];\n}\ninterface SerializedAppStateV4 {\n  version: 4;\n  data: {\n    groups: SerializedGroupV4[];\n    settings: SerializedSettings;\n  };\n}\n\nfunction groupv4to5(group: SerializedGroupV4): SerializedGroupV5 {\n  return {\n    name: group.name,\n    rows: group.rows.map((r) => {\n      return [r[0], r[1], r[2].toString(), r[3], r[4], r[5]];\n    }),\n  };\n}\n\n// v5 has multiple groups, each with multiple rows\nfunction state4to5(state: SerializedAppStateV4): SerializedAppStateV5 {\n  return {\n    version: 5,\n    data: {\n      settings: state.data.settings,\n      groups: state.data.groups.map(groupv4to5),\n    },\n  };\n}\ntype SerializedRowV5 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  string, // num assembling machines as a rational\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedGroupV5 {\n  name: string;\n  rows: SerializedRowV5[];\n}\ninterface SerializedAppStateV5 {\n  version: 5;\n  data: {\n    groups: SerializedGroupV5[];\n    settings: SerializedSettings;\n  };\n}\n\ninterface SerializedAppStateOther {\n  version: 0;\n  data: unknown;\n}\n\ntype MultiSerializedAppState =\n  | SerializedAppStateOther\n  | SerializedAppStateV1\n  | SerializedAppStateV2\n  | SerializedAppStateV3\n  | SerializedAppStateV4\n  | SerializedAppStateV5;\n\n// Latest values\n// type SerializedGroup = SerializedGroupV5;\ntype SerializedRow = SerializedRowV5;\ntype SerializedAppState = SerializedAppStateV5;\n\ninterface SerializedSettings {\n  assemblerOverrides: {\n    [category: string]: string;\n  };\n}\n\nexport function setLocalStorageState(state: AppState) {\n  localStorage.setItem('appstate', JSON.stringify(serialize(state)));\n}\n\nexport function getLocalStorageState(gameData: game.GameData): AppState | null {\n  const statestr = localStorage.getItem('appstate');\n  if (!statestr) {\n    return null;\n  }\n  const stateobj: MultiSerializedAppState = JSON.parse(statestr);\n  if (stateobj.version === 1) {\n    (stateobj as any).version = 3;\n  }\n\n  return deserialize(gameData, stateobj);\n}\n\nexport function setUrlState(state: AppState) {\n  const serialized = serialize(state);\n  const version = serialized.version;\n  let str = JSON.stringify(serialized.data);\n  // compress\n  str = btoa(deflate(str, { to: 'string' }));\n\n  window.history.replaceState('', '', `#${version}-${str}`);\n}\n\nfunction serialize(state: AppState): SerializedAppState {\n  const groups = state.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map((row) => {\n        let machineName: string | null = row.machine.data.name;\n        const defaultMachine = getDefaultMachine(row.recipe, state);\n\n        if (defaultMachine.data.name === machineName) {\n          machineName = null;\n        }\n\n        const srow: SerializedRow = [\n          row.recipe.name,\n          machineName,\n          row.numMachines.toFraction(),\n          row.modules.map((m) => (m ? m.name : null)),\n          row.beaconModule ? row.beaconModule.name : undefined,\n          row.numBeacons,\n        ];\n        return srow;\n      }),\n    };\n  });\n\n  const settings = {\n    assemblerOverrides: mapValues(\n      state.settings.assemblerOverrides,\n      (a) => a.data.name\n    ),\n  };\n\n  return {\n    version: 5,\n    data: { groups, settings },\n  };\n}\n\nconst reStateUrl = /^#(\\d+)?(?:-)?(.+)$/;\n\nexport function getUrlState(gameData: game.GameData) {\n  const matches = reStateUrl.exec(document.location.hash);\n  if (!matches) {\n    return null;\n  }\n  const version = Number(matches[1] || 1);\n\n  let str = decodeURIComponent(matches[2]);\n  if (version > 2) {\n    str = inflate(atob(str), { to: 'string' });\n  }\n\n  let data = JSON.parse(str);\n\n  return deserialize(gameData, {\n    version: version as 0,\n    data,\n  });\n}\n\nfunction migrateSerializedState(\n  state: MultiSerializedAppState\n): SerializedAppState {\n  switch (state.version) {\n    case 1:\n      state = state1to2(state);\n    // fall through\n    case 2:\n      state = state2to3(state);\n    // fall through\n    case 3:\n      state = state3to4(state);\n    // fall through\n    case 4:\n      state = state4to5(state);\n    // fall through\n    case 5:\n      // the latest\n      break;\n    default:\n      throw new Error(`unknown state: ${state}`);\n  }\n\n  return state;\n}\n\nfunction deserialize(\n  gameData: game.GameData,\n  unmigrated: MultiSerializedAppState\n): AppState {\n  const migrated = migrateSerializedState(unmigrated).data;\n\n  const state: AppState = {\n    gameData: gameData,\n\n    settings: deserializeSettings(gameData, migrated.settings),\n    groups: [],\n\n    activeGroupIdx: 0,\n    recipeTarget: undefined,\n  };\n\n  state.groups = migrated.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map(\n        ([\n          recipeName,\n          machineName,\n          numMachines,\n          modules,\n          beaconModule,\n          numBeacons,\n        ]) => {\n          const recipe = gameData.recipeMap[recipeName];\n\n          const machine = machineName\n            ? gameData.entityMap[machineName]\n            : getDefaultMachine(recipe, state);\n\n          return {\n            recipe: recipe,\n            machine: machine,\n            numMachines: Rational.fromString(numMachines),\n            modules: modules.map((n) => (n ? gameData.moduleMap[n] : null)),\n            beaconModule: beaconModule\n              ? gameData.moduleMap[beaconModule]\n              : null,\n            numBeacons: numBeacons || 0,\n          };\n        }\n      ),\n    };\n  });\n\n  return state;\n}\n\nfunction deserializeSettings(\n  gameData: game.GameData,\n  serialized: SerializedSettings\n): AppSettingsData {\n  return {\n    assemblerOverrides: mapValues(\n      serialized.assemblerOverrides,\n      (name) => gameData.entityMap[name]\n    ),\n  };\n}\n","import * as game from './game';\n\ninterface SignalHandler<T> {\n  (arg: T): void;\n}\n\nexport class Signal<T> {\n  handlers: SignalHandler<T>[] = [];\n\n  addHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index === -1) {\n      this.handlers.push(handler);\n    }\n  }\n\n  removeHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index !== -1) {\n      this.handlers.splice(index, 1);\n    }\n  }\n\n  dispatch = (arg: T) => {\n    for (let handler of this.handlers) {\n      handler(arg);\n    }\n  };\n}\n\nexport const addIngredientFilter = new Signal<game.Ingredient>();\nexport const addProductFilter = new Signal<game.Product>();\nexport const addRecipeRow = new Signal<game.Recipe>();\n","import * as React from 'react';\nimport Popper from 'popper.js';\n\ninterface DropdownHeader {\n  header: React.ReactNode;\n}\n\ninterface DropdownDivider {\n  divider: true;\n}\n\ninterface DropdownEntry<T> {\n  key: React.Key;\n  disabled?: boolean;\n  active?: boolean;\n  option: T;\n}\n\ntype DropdownOption<T> = DropdownHeader | DropdownDivider | DropdownEntry<T>;\n\ninterface Props<T> {\n  options: DropdownOption<T>[];\n  selected: T;\n  onSelect(selected: T): void;\n\n  renderOption(option: T): React.ReactNode;\n  renderSelected(option: T): React.ReactNode;\n}\ninterface State {\n  isOpen: boolean;\n}\n\nconst ESC_KEYCODE = 27;\n\nexport class Dropdown<T> extends React.PureComponent<Props<T>, State> {\n  buttonRef: React.RefObject<HTMLButtonElement> = React.createRef();\n\n  state: State = {\n    isOpen: false,\n  };\n\n  handleToggle = () => {\n    this.setState((state) => ({\n      ...state,\n      isOpen: !state.isOpen,\n    }));\n  };\n\n  handleSelect = (selected: T) => {\n    this.props.onSelect(selected);\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  handleWantClose = () => {\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  render() {\n    const canToggle = this.props.options.some((option) => {\n      return 'option' in option && !option.disabled;\n    });\n\n    const classes = ['btn', 'btn-secondary'];\n    if (canToggle) {\n      classes.push('dropdown-toggle');\n    } else {\n      classes.push('disabled');\n    }\n\n    let floater: React.ReactNode | null;\n    if (this.state.isOpen) {\n      floater = (\n        <DropdownMenu\n          parentRef={this.buttonRef}\n          options={this.props.options}\n          renderOption={this.props.renderOption}\n          onSelect={this.handleSelect}\n          onWantClose={this.handleWantClose}\n        />\n      );\n    }\n\n    return (\n      <>\n        <button\n          ref={this.buttonRef}\n          className={classes.join(' ')}\n          type=\"button\"\n          onClick={() => {\n            canToggle && this.handleToggle();\n          }}\n        >\n          {this.props.renderSelected(this.props.selected)}\n        </button>\n        {floater}\n      </>\n    );\n  }\n}\n\ninterface DropdownMenuProps<T> {\n  parentRef: React.RefObject<any>;\n  options: DropdownOption<T>[];\n  renderOption(option: T): React.ReactNode;\n  onSelect(selected: T): void;\n  onWantClose(): void;\n}\n\ninterface DropdownMenuState {\n  style: React.CSSProperties;\n}\n\nclass DropdownMenu<T> extends React.PureComponent<\n  DropdownMenuProps<T>,\n  DropdownMenuState\n> {\n  popperInstance: Popper | null = null;\n  menuRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  state: DropdownMenuState = {\n    style: {},\n  };\n\n  popperUpdate = (data: Popper.Data) => {\n    this.setState({\n      style: data.styles as React.CSSProperties,\n    });\n    return data;\n  };\n\n  handleBodyClick = (event: MouseEvent) => {\n    if (!this.menuRef.current) {\n      throw new Error(\n        'Click event without menu rendered. This should not happen.'\n      );\n    }\n    if (!event.target) {\n      throw new Error(\n        'Click event without click target. This should not happen.'\n      );\n    }\n    // TODO: why doesnt EventTarget satisfy \"Node\"\n    const target = event.target as any;\n    if (!this.menuRef.current.contains(target)) {\n      // Click was outside menu\n      this.props.onWantClose();\n    }\n  };\n\n  handleKeyEvent = (event: KeyboardEvent) => {\n    if (event.keyCode === ESC_KEYCODE) {\n      this.props.onWantClose();\n    }\n  };\n\n  componentDidMount() {\n    if (this.popperInstance) {\n      throw new Error('Component mounted twice?');\n    }\n\n    const referenceEl = this.props.parentRef.current;\n    if (!referenceEl) {\n      throw new Error('Cannot mount DropdownMenu without parentRef');\n    }\n\n    const menuEl = this.menuRef.current;\n    if (!menuEl) {\n      throw new Error('Cannot mount DropdownMenu without menuRef');\n    }\n\n    this.popperInstance = new Popper(referenceEl, menuEl, {\n      modifiers: {\n        applyStyle: { enabled: false },\n        updateStateWithStyle: {\n          enabled: true,\n          fn: this.popperUpdate,\n        },\n      },\n    });\n\n    document.body.addEventListener('click', this.handleBodyClick);\n    document.body.addEventListener('keyup', this.handleKeyEvent);\n  }\n\n  componentWillUnmount() {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n    document.body.removeEventListener('click', this.handleBodyClick);\n    document.body.removeEventListener('keyup', this.handleKeyEvent);\n  }\n\n  renderOptions = () => {\n    return this.props.options.map((option, i) => {\n      if ('header' in option) {\n        return (\n          <h6 className=\"dropdown-header\" key={'ddkey' + i}>\n            {option.header}\n          </h6>\n        );\n      }\n      if ('divider' in option) {\n        return <div className=\"dropdown-divider\" key={'ddkey' + i} />;\n      }\n\n      const classes = ['dropdown-item'];\n      option.active && classes.push('active');\n      option.disabled && classes.push('disabled');\n\n      return (\n        <button\n          key={option.key}\n          className={classes.join(' ')}\n          onClick={() => this.props.onSelect(option.option)}\n          type=\"button\"\n        >\n          {this.props.renderOption(option.option)}\n        </button>\n      );\n    });\n  };\n\n  render() {\n    return (\n      <div\n        className=\"dropdown-menu show\"\n        style={this.state.style}\n        ref={this.menuRef}\n      >\n        {this.renderOptions()}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Popper from 'popper.js';\n\ninterface Props {\n  relativeTo: React.RefObject<HTMLElement>;\n}\n\ninterface State {\n  showSelf: boolean;\n  style: React.CSSProperties;\n}\n\nexport class Tooltip extends React.PureComponent<Props, State> {\n  selfRef: React.RefObject<any>;\n  popperInstance: Popper | null;\n\n  constructor(props: Props) {\n    super(props);\n    this.selfRef = React.createRef();\n    this.popperInstance = null;\n    this.state = {\n      showSelf: false,\n      style: { zIndex: 1001 },\n    };\n  }\n\n  initPopper() {\n    if (this.popperInstance) {\n      return;\n    }\n\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    const selfEl = this.selfRef.current;\n    if (!selfEl) {\n      throw new Error('No self reference yet?');\n    }\n\n    this.popperInstance = new Popper(referenceEl, selfEl, {\n      placement: 'right',\n      modifiers: {\n        offset: {\n          enabled: true,\n          offset: '0, 20',\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'window',\n        },\n      },\n    });\n  }\n\n  cleanupPopper() {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n  }\n\n  componentDidUpdate(_: Props, prevState: State) {\n    if (prevState.showSelf !== this.state.showSelf) {\n      if (this.state.showSelf) {\n        this.initPopper();\n      } else {\n        this.cleanupPopper();\n      }\n    }\n  }\n\n  componentDidMount() {\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    referenceEl.addEventListener('mouseenter', this.handleMouseEnter);\n    referenceEl.addEventListener('mouseleave', this.handleMouseLeave);\n  }\n\n  handleMouseEnter = () => {\n    this.setState({\n      showSelf: true,\n    });\n  };\n\n  handleMouseLeave = () => {\n    this.setState({\n      showSelf: false,\n    });\n  };\n\n  componentWillUnmount() {\n    const referenceEl = this.props.relativeTo.current;\n    if (referenceEl) {\n      referenceEl.removeEventListener('mouseenter', this.handleMouseEnter);\n      referenceEl.removeEventListener('mouseleave', this.handleMouseLeave);\n    }\n  }\n\n  render() {\n    if (!this.state.showSelf) {\n      return null;\n    }\n\n    return ReactDOM.createPortal(\n      <div style={this.state.style} ref={this.selfRef}>\n        {this.props.children}\n      </div>,\n      document.body\n    );\n  }\n}\n","import * as React from 'react';\n\ninterface Props {\n  value: number;\n  onChange: (value: number) => void;\n  min?: number;\n}\n\ninterface State {\n  txtValue: string;\n}\n\nexport class IntegerInput extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      txtValue: props.value.toString(),\n    };\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    if (oldProps.value !== this.props.value) {\n      this.setState((state) => ({\n        txtValue:\n          Number(state.txtValue) === this.props.value\n            ? state.txtValue\n            : this.props.value.toString(),\n      }));\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const value = event.target.value;\n    this.setState({ txtValue: value }, () => {\n      if (!value.trim()) {\n        return;\n      }\n      const num = Number(value);\n      if (isNaN(num)) {\n        return;\n      }\n      if (!Number.isInteger(num)) {\n        return;\n      }\n\n      if (typeof this.props.min === 'number' && num < this.props.min) {\n        // TODO: Error\n        return;\n      }\n\n      this.props.onChange(num);\n    });\n  };\n\n  render() {\n    return (\n      <input\n        className=\"form-control\"\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"number\"\n        min={this.props.min}\n        step=\"1\"\n      />\n    );\n  }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nimport { Rational } from '../../rational';\n\ninterface Props {\n  value: Rational;\n  onChange: (value: Rational) => void;\n  positiveOnly?: boolean;\n}\n\ninterface State {\n  error: string | undefined;\n  txtValue: string;\n}\n\nexport class RationalInput extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      error: '',\n      txtValue: rationalToString(props.value),\n    };\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    if (!this.props.value.equal(oldProps.value)) {\n      let parsed: Rational;\n      try {\n        parsed = stringToRational(this.state.txtValue);\n      } catch (err) {\n        return;\n      }\n\n      if (!parsed.equal(this.props.value)) {\n        this.setState({\n          txtValue: rationalToString(this.props.value),\n        });\n      }\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const str = event.target.value;\n\n    let errmsg: string | undefined;\n    let parsed: Rational | undefined;\n\n    try {\n      parsed = stringToRational(str);\n    } catch (err) {\n      errmsg = err.message;\n    }\n\n    if (parsed && this.props.positiveOnly && parsed.isNegative()) {\n      parsed = undefined;\n      errmsg = 'Number must be positive';\n    }\n    this.setState({ txtValue: str, error: errmsg }, () => {\n      if (parsed) {\n        this.props.onChange(parsed);\n      }\n    });\n  };\n\n  render() {\n    return (\n      <input\n        className={classNames('form-control', {\n          'is-invalid': !!this.state.error,\n        })}\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"text\"\n      />\n    );\n  }\n}\n\nfunction stringToRational(str: string): Rational {\n  if (!str.trim()) {\n    throw new Error('Empty!');\n  }\n\n  const index = str.indexOf('/');\n  const lastIndex = str.lastIndexOf('/');\n  if (index !== lastIndex) {\n    throw new Error('Too many slashes');\n  }\n\n  return Rational.fromString(str);\n}\n\nfunction rationalToString(rational: Rational): string {\n  const dec = rational.toFloat().toString();\n  if (dec.length < 10) {\n    return dec;\n  }\n\n  return rational.toMixed();\n}\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport { Tooltip } from './generic';\n\nimport styles from './Icon.module.css';\n\ninterface Props {\n  obj: { icon_row: number; icon_col: number };\n\n  title?: string;\n  onClick?(event: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\n  style?: React.CSSProperties;\n  tooltip?: React.ReactNode;\n  text?: React.ReactNode;\n}\n\ninterface State {}\n\nexport class Icon extends React.PureComponent<Props, State> {\n  iconRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.iconRef = React.createRef();\n  }\n\n  render() {\n    const x = -this.props.obj.icon_col * 32;\n    const y = -this.props.obj.icon_row * 32;\n\n    const divStyle = {\n      display: 'inline-block',\n      backgroundPosition: `${x}px ${y}px`,\n      width: '32px',\n      height: '32px',\n      ...this.props.style,\n    };\n\n    let icon = (\n      <div\n        ref={this.iconRef}\n        onClick={this.props.onClick}\n        title={this.props.title}\n        className={classNames(styles.Icon, 'game-icon')}\n        style={divStyle}\n      >\n        &nbsp;\n      </div>\n    );\n\n    if (this.props.tooltip) {\n      icon = (\n        <>\n          {icon}\n          <Tooltip children={this.props.tooltip} relativeTo={this.iconRef} />\n        </>\n      );\n    }\n\n    if (this.props.text) {\n      icon = (\n        <div style={{ lineHeight: '32px' }}>\n          {icon}\n          <span style={{ marginLeft: '9px' }}>{this.props.text}</span>\n        </div>\n      );\n    }\n\n    return icon;\n  }\n}\n","import * as React from 'react';\nimport Card from 'react-bootstrap/Card';\n\nimport { format_joules, format_watts } from '../util';\nimport * as game from '../game';\n\ninterface Props {\n  obj: game.Ingredient | game.Product;\n}\n\nexport const IngredientCard: React.FC<Props> = (props) => {\n  const { obj } = props;\n\n  let extras: JSX.Element[] = [];\n\n  let fuel_value: number = 0;\n\n  if (obj instanceof game.FluidIngredient || obj instanceof game.FluidProduct) {\n    const { item } = obj;\n    fuel_value = item.raw.fuel_value;\n  } else {\n    if ('fuel_value' in obj.item.raw) {\n      fuel_value = obj.item.raw.fuel_value;\n    }\n  }\n\n  if (fuel_value) {\n    extras.push(\n      <>\n        <b>Fuel value</b>: {format_joules(fuel_value)}\n      </>\n    );\n\n    let totalValue = format_watts(obj.amount.mul(fuel_value).toFloat());\n    extras.push(\n      <>\n        <b>Total fuel value</b>: {totalValue}\n      </>\n    );\n  }\n\n  let body: React.ReactNode = '';\n  if (extras.length) {\n    body = (\n      <Card.Body>\n        {extras.map((extra, i) => (\n          <div key={i} children={extra} />\n        ))}\n      </Card.Body>\n    );\n  }\n\n  return (\n    <Card>\n      <Card.Header>\n        {obj.item.niceName()} ({obj.item.name})\n      </Card.Header>\n      {body}\n    </Card>\n  );\n};\n","import * as React from 'react';\n\nimport { Rational } from '../rational';\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\nimport { AppActions, withActions } from '../state';\n\ninterface Props {\n  actions: AppActions;\n  obj: game.Ingredient | game.Product;\n  showName?: boolean;\n}\n\nclass RawRecipeOutput extends React.PureComponent<Props, never> {\n  handleClick = (event: React.MouseEvent) => {\n    const { obj } = this.props;\n\n    if (event.shiftKey) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.props.actions.setRecipeTarget({\n        item: obj.item,\n        amount: obj.amount,\n      });\n      return;\n    }\n\n    if (obj instanceof game.BaseIngredient) {\n      if (obj.item.madeBy.length === 1) {\n        signal.addRecipeRow.dispatch(obj.item.madeBy[0]);\n      } else {\n        signal.addIngredientFilter.dispatch(obj);\n      }\n    } else {\n      if (obj.item.usedBy.length === 1) {\n        signal.addRecipeRow.dispatch(obj.item.usedBy[0]);\n      } else {\n        signal.addProductFilter.dispatch(obj);\n      }\n    }\n  };\n\n  render() {\n    const { obj, showName } = this.props;\n\n    let text = perSecond(obj.amount);\n    if (showName) {\n      text = (\n        <>\n          {obj.item.niceName()} -- {text}\n        </>\n      );\n    }\n\n    return (\n      <Icon\n        onClick={this.handleClick}\n        tooltip={<IngredientCard obj={obj} />}\n        obj={obj.item}\n        text={text}\n      />\n    );\n  }\n}\n\nfunction perSecond(rational: Rational): React.ReactNode {\n  const dec = rational.toDecimal().toString();\n  let amount: React.ReactNode;\n  if (dec.includes('.') && dec.length > 4) {\n    amount = <abbr title={rational.toFraction()}>{rational.toDecimal()}</abbr>;\n  } else {\n    amount = dec;\n  }\n  return <>{amount} / sec</>;\n}\n\nexport const RecipeOutput = withActions(RawRecipeOutput);\n","import * as React from 'react';\nimport * as game from '../game';\n\ninterface Props {\n  machine: game.AssemblingMachine;\n}\n\nexport const MachineCard = (props: Props) => {\n  return (\n    <div className=\"machine-card card\">\n      <div className=\"card-body\">\n        <b>{props.machine.niceName()}</b>\n        <br />\n        <b>Crafting Speed:</b> {props.machine.data.crafting_speed}\n        <br />\n        <b>Module Slots:</b> {props.machine.data.module_slots}\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { withGame } from '../state';\n\ninterface Props {\n  gameData: game.GameData;\n  recipe: game.Recipe;\n  onClick?(r: game.Recipe): void;\n}\n\nconst GameRecipeCard = (props: Props) => {\n  const handleClick = () => {\n    props.onClick && props.onClick(props.recipe);\n  };\n  const recipe = props.recipe;\n\n  const ingredients = recipe.ingredients.map((ingredient, i) => (\n    <Icon key={i} obj={ingredient.item} text={ingredient.niceName()} />\n  ));\n  const products = recipe.products.map((product, i) => (\n    <Icon key={i} obj={product.item} text={product.niceName()} />\n  ));\n\n  const madeIn = recipe.madeIn.map((machine, i) => (\n    <Icon\n      key={i}\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n    />\n  ));\n\n  return (\n    <div className=\"recipe-tooltip card\" onClick={handleClick}>\n      <div className=\"card-header\">\n        <Icon obj={recipe} text={recipe.niceName()} />\n      </div>\n      <div className=\"card-body\">\n        <Icon\n          obj={props.gameData.raw.sprites.extra['clock']}\n          text={recipe.crafting_time.toDecimal()}\n        />\n        <div style={{ float: 'left' }}>\n          Ingredients:\n          {ingredients}\n        </div>\n        <div style={{ display: 'inline-block' }}>\n          Products:\n          {products}\n        </div>\n        <div style={{ clear: 'both' }} />\n        <div style={{ lineHeight: '32px' }}>\n          Made In:\n          {madeIn}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const RecipeCard = withGame(GameRecipeCard);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { Dropdown } from './generic';\n\ntype Machine = game.AssemblingMachine;\n\ninterface MachinePickerProps {\n  machines: Machine[];\n  selected: Machine;\n  onChange(m: Machine): void;\n}\n\nconst renderSelected = (machine: Machine) => {\n  return (\n    <Icon obj={machine.data} tooltip={<MachineCard machine={machine} />} />\n  );\n};\n\nconst renderOption = (machine: Machine) => {\n  return (\n    <Icon\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n      text={machine.niceName()}\n    />\n  );\n};\n\nexport const MachinePicker = (props: MachinePickerProps) => {\n  const options = props.machines.map((machine) => ({\n    key: machine.data.name,\n    option: machine,\n    active: machine === props.selected,\n  }));\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n","import * as React from 'react';\n\nimport { Module } from '../game';\nimport { round2 } from '../util';\n\nconst niceName = {\n  consumption: 'Energy Consumption',\n  productivity: 'Productivity',\n  speed: 'Speed',\n  pollution: 'Pollution',\n};\n\nexport const ModuleCard = ({ module }: { module: Module }) => {\n  const bonuses = [];\n  for (let bonusName in module.raw.effect) {\n    const bonus = module.raw.effect[\n      bonusName as keyof typeof module.raw.effect\n    ]!.bonus;\n    bonuses.push(\n      <div key={bonusName}>\n        <b>\n          {niceName[bonusName as keyof typeof niceName]}:{' '}\n          {round2(bonus * 100, 2)}%\n        </b>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"module-card card\">\n      <div className=\"card-header\">\n        <b>{module.niceName()}</b>\n      </div>\n      <div className=\"card-body\">{bonuses}</div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport { GameData, Module, Recipe } from '../game';\n\nimport { Icon } from './Icon';\nimport { ModuleCard } from './ModuleCard';\nimport { Dropdown } from './generic';\nimport { withGame } from '../state';\n\ninterface ModulePickerProps {\n  gameData: GameData;\n  recipe: Recipe;\n  isBeacon?: boolean;\n  selected: Module | null;\n  onChange(m: Module | null): void;\n}\n\nconst GameModulePicker = (props: ModulePickerProps) => {\n  const icon = props.gameData.raw.sprites.extra.slot_icon_module;\n  const nomod = new Module({\n    type: 'module',\n    name: 'no_module',\n    localised_name: { en: 'No Module' },\n    category: 'speed',\n    effect: {},\n    limitation: [],\n    rocket_launch_products: [],\n\n    icon_row: icon.icon_row,\n    icon_col: icon.icon_col,\n\n    group: '',\n    subgroup: '',\n    order: '',\n  });\n\n  const renderSelected = (module: Module | null) => {\n    if (module) {\n      return <Icon obj={module} tooltip={<ModuleCard module={module} />} />;\n    } else {\n      return <Icon obj={nomod} />;\n    }\n  };\n\n  const renderOption = (module: Module | null) => {\n    if (module) {\n      return (\n        <Icon\n          obj={module}\n          tooltip={<ModuleCard module={module} />}\n          text={module.niceName()}\n        />\n      );\n    } else {\n      return <Icon obj={nomod} text={nomod.niceName()} />;\n    }\n  };\n\n  const options = props.gameData.modules\n    .filter((m) => {\n      // TODO: what is the actual logic for which modules are allowed in beacons?\n      if (props.isBeacon && m.effects.productivity.isPositive()) {\n        return false;\n      }\n      return m.canUseWith(props.recipe);\n    })\n    .map((m) => ({\n      key: m.name,\n      option: m as Module | null,\n      active: m === props.selected,\n    }));\n\n  options.unshift({\n    key: 'no_module',\n    option: null,\n    active: !props.selected,\n  });\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n\nexport const ModulePicker = withGame(GameModulePicker);\n","import * as game from './game';\n\nimport { clone } from './util';\n\nimport { Rational } from './rational';\n\nimport { RecipeRowData } from './state';\n\nexport class Totals {\n  products: game.Product[] = [];\n  ingredients: game.Ingredient[] = [];\n\n  addIngredient = (newIng: game.Ingredient) => {\n    for (let oldIng of this.ingredients) {\n      let match = newIng.type === oldIng.type && newIng.item === oldIng.item;\n      if (newIng.type === 'fluid' && oldIng.type === 'fluid') {\n        match =\n          match &&\n          newIng.maximum_temperature === oldIng.maximum_temperature &&\n          newIng.minimum_temperature === oldIng.minimum_temperature;\n      }\n\n      if (match) {\n        oldIng.amount = oldIng.amount.add(newIng.amount);\n        return;\n      }\n    }\n    this.ingredients.push(newIng);\n  };\n\n  addProduct = (newProd: game.Product) => {\n    for (let oldProd of this.products) {\n      let match =\n        newProd.type === oldProd.type && newProd.item === oldProd.item;\n      if (newProd.type === 'fluid' && oldProd.type === 'fluid') {\n        match = match && newProd.temperature === oldProd.temperature;\n      }\n\n      if (match) {\n        oldProd.amount = oldProd.amount.add(newProd.amount);\n        return;\n      }\n    }\n    this.products.push(newProd);\n  };\n\n  addRow(row: RecipeRowData) {\n    const effects = {\n      consumption: Rational.one,\n      pollution: Rational.one,\n      productivity: Rational.one,\n      speed: Rational.one,\n    };\n\n    for (let module of row.modules) {\n      if (!module) continue;\n      effects.consumption = effects.consumption.add(module.effects.consumption);\n      effects.pollution = effects.pollution.add(module.effects.pollution);\n      effects.productivity = effects.productivity.add(\n        module.effects.productivity\n      );\n      effects.speed = effects.speed.add(module.effects.speed);\n    }\n\n    if (row.beaconModule && row.numBeacons > 0) {\n      // TODO: export and use \"distribution_effectivity\" from beacon entities\n      // assume the common value of 0.5 for now\n\n      const be = row.beaconModule.effects;\n      const num = Rational.fromInts(row.numBeacons, 2);\n      effects.consumption = effects.consumption.add(be.consumption.mul(num));\n      effects.pollution = effects.pollution.add(be.pollution.mul(num));\n      effects.productivity = effects.productivity.add(be.productivity.mul(num));\n      effects.speed = effects.speed.add(be.speed.mul(num));\n    }\n\n    // Allowed -80% to de facto max of signed short int\n    effects.consumption = effects.consumption.clamp(0.2, 32767);\n    effects.pollution = effects.pollution.clamp(0.2, 32767);\n    effects.speed = effects.speed.clamp(0.2, 32767);\n\n    // Special minimum: -0%\n    effects.productivity = effects.productivity.clamp(1, 32767);\n\n    const ingredientMult = Rational.one\n      .mul(row.recipe.crafting_time.invert())\n      .mul(row.numMachines)\n      .mul(row.machine.data.crafting_speed)\n      .mul(effects.speed);\n\n    const productMult = ingredientMult.mul(effects.productivity);\n\n    row.recipe.ingredients\n      .map((ingredient) => {\n        ingredient = clone(ingredient);\n        ingredient.amount = ingredient.amount.mul(ingredientMult);\n        return ingredient;\n      })\n      .forEach(this.addIngredient);\n\n    row.recipe.products\n      .map((product) => {\n        product = clone(product);\n        product.amount = product.amount.mul(productMult);\n        return product;\n      })\n      .forEach(this.addProduct);\n  }\n\n  reduce() {\n    let ingredients = this.ingredients.map(clone);\n    let products = this.products.map(clone);\n\n    for (let product of products) {\n      for (let ingredient of ingredients) {\n        if (product.amount.isZero() || ingredient.amount.isZero()) {\n          continue;\n        }\n        if (!product.satisfies(ingredient)) {\n          continue;\n        }\n        if (product.amount.less(ingredient.amount)) {\n          // More ingredient than product\n          ingredient.amount = ingredient.amount.sub(product.amount);\n          product.amount = Rational.zero;\n        } else if (ingredient.amount.less(product.amount)) {\n          // More product than ingredient\n          product.amount = product.amount.sub(ingredient.amount);\n          ingredient.amount = Rational.zero;\n        } else {\n          ingredient.amount = Rational.zero;\n          product.amount = Rational.zero;\n        }\n      }\n    }\n\n    ingredients = ingredients.filter((i) => !i.amount.isZero());\n    products = products.filter((p) => !p.amount.isZero());\n\n    return { ingredients, products };\n  }\n}\n","import * as React from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport Button from 'react-bootstrap/Button';\n\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { Icon } from './Icon';\nimport { RecipeOutput } from './RecipeOutput';\nimport { RecipeCard } from './RecipeCard';\nimport { MachinePicker } from './MachinePicker';\nimport { ModulePicker } from './ModulePicker';\nimport { IntegerInput, RationalInput } from './generic';\n\nimport { Totals } from '../totals';\nimport { withBoth, RecipeRowData, AppActions, AppState } from '../state';\n\ninterface Props extends RecipeRowData {\n  index: number;\n  actions: AppActions;\n  state: AppState;\n}\n\nclass RawRecipeRow extends React.PureComponent<Props, never> {\n  handleRemoveClick = () => {\n    this.props.actions.removeRow(this.props.index);\n  };\n\n  handleMachineChange = (machine: game.AssemblingMachine) => {\n    this.applyChange({\n      machine: machine,\n      modules: this.props.modules\n        .filter((module) => module !== null)\n        .slice(0, machine.data.module_slots),\n    });\n  };\n\n  handleNumMachinesChange = (num: Rational) => {\n    this.applyChange({ numMachines: num });\n  };\n\n  handleNumBeaconsChange = (num: number) => {\n    this.applyChange({ numBeacons: num });\n  };\n\n  handleSetAllModules = () => {\n    this.applyChange({\n      modules: new Array(this.props.machine.data.module_slots).fill(\n        this.props.modules[0]\n      ),\n    });\n  };\n\n  handleSetModule = (index: number, module: game.Module | null) => {\n    const modules = this.props.modules.slice();\n    modules[index] = module;\n    this.applyChange({ modules: modules });\n  };\n\n  handleSetBeaconModule = (module: game.Module | null) => {\n    this.applyChange({ beaconModule: module });\n  };\n\n  handleInputGroupClick: React.MouseEventHandler<any> = (event) => {\n    const { recipeTarget } = this.props.state;\n    if (!event.shiftKey || !recipeTarget) {\n      return;\n    }\n    event.preventDefault();\n    event.stopPropagation();\n\n    const output = new Totals();\n    output.addRow({\n      ...this.props,\n      numMachines: Rational.one,\n    });\n\n    let current: game.Ingredient | game.Product | undefined;\n    current = output.ingredients.find((x) => {\n      return x.item.name === recipeTarget.item.name;\n    });\n\n    current =\n      current ||\n      output.products.find((x) => {\n        return x.item.name === recipeTarget.item.name;\n      });\n\n    if (!current) {\n      console.error(\n        `Could not find ${recipeTarget.item.name} in totals`,\n        output\n      );\n      return;\n    }\n\n    const newNum = recipeTarget.amount.div(current.amount);\n\n    this.applyChange({\n      numMachines: newNum,\n    });\n  };\n\n  applyChange(change: Partial<RecipeRowData>) {\n    this.props.actions.updateRow(this.props.index, change);\n  }\n\n  getOutput() {\n    const t = new Totals();\n    t.addRow(this.props);\n    return {\n      ingredients: t.ingredients,\n      products: t.products,\n    };\n  }\n\n  renderModules() {\n    const numSlots = this.props.machine.data.module_slots;\n\n    const slots = [];\n    for (let i = 0; i < numSlots; i++) {\n      const module = this.props.modules[i];\n      slots.push(\n        <ModulePicker\n          key={i}\n          recipe={this.props.recipe}\n          selected={module}\n          onChange={(m) => this.handleSetModule(i, m)}\n        />\n      );\n    }\n\n    if (numSlots > 1) {\n      slots.splice(\n        1,\n        0,\n        <button\n          onClick={this.handleSetAllModules}\n          key=\"applicator\"\n          className=\"btn\"\n        >\n          \n        </button>\n      );\n    }\n\n    return slots;\n  }\n\n  renderBeacons() {\n    return (\n      <div className=\"btn-toolbar\">\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">Beacon Modules</span>\n          </div>\n          <IntegerInput\n            value={this.props.numBeacons}\n            onChange={this.handleNumBeaconsChange}\n            min={0}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <ModulePicker\n              isBeacon={true}\n              recipe={this.props.recipe}\n              selected={this.props.beaconModule}\n              onChange={this.handleSetBeaconModule}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderMachines() {\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\" onClick={this.handleInputGroupClick}>\n          <RationalInput\n            value={this.props.numMachines}\n            onChange={this.handleNumMachinesChange}\n            positiveOnly={true}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={this.props.recipe.madeIn}\n              selected={this.props.machine}\n              onChange={this.handleMachineChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const recipe = this.props.recipe;\n    const output = this.getOutput();\n\n    const ingredients = output.ingredients.map((ingredient, i) => (\n      <div className=\"mb-1\" key={i}>\n        <RecipeOutput obj={ingredient} />\n      </div>\n    ));\n    const products = output.products.map((product, i) => (\n      <div className=\"mb-1\" key={i}>\n        <RecipeOutput obj={product} />\n      </div>\n    ));\n    return (\n      <Draggable draggableId={recipe.name} index={this.props.index}>\n        {(provided) => (\n          <div\n            className=\"recipe-row card mb-3\"\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n          >\n            <div className=\"card-header clearfix\" {...provided.dragHandleProps}>\n              <div className=\"float-left\">\n                <Icon\n                  obj={recipe}\n                  text={recipe.niceName()}\n                  tooltip={<RecipeCard recipe={recipe} />}\n                />\n              </div>\n              <div className=\"float-right\">\n                <Button\n                  variant=\"danger\"\n                  onClick={this.handleRemoveClick}\n                  size=\"sm\"\n                >\n                  Remove\n                </Button>\n              </div>\n            </div>\n            <div className=\"card-body clearfix\">\n              <div className=\"float-left\">\n                {this.renderMachines()}\n                <div className=\"mb-3 btn-group btn-icon-wrapper\">\n                  {this.renderModules()}\n                </div>\n                {this.renderBeacons()}\n              </div>\n\n              <div className=\"float-right\">\n                <div\n                  className=\"mr-3\"\n                  style={{\n                    display: 'inline-block',\n                    float: 'left',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Ingredients:</b>\n                  {ingredients}\n                </div>\n\n                <div\n                  className=\"mr-2\"\n                  style={{\n                    display: 'inline-block',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Products:</b>\n                  {products}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </Draggable>\n    );\n  }\n}\n\nexport const RecipeRow = withBoth(RawRecipeRow);\n","import * as React from 'react';\nimport Fuse from 'fuse.js';\nimport debounce from 'lodash/debounce';\n\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\nimport { RecipeCard } from './RecipeCard';\n\nimport styles from './RecipePicker.module.css';\n\ntype KeyTypes = 'niceName' | 'name';\n\nfunction getFn(recipe: game.Recipe, key: string) {\n  switch (key as KeyTypes) {\n    case 'niceName':\n      return recipe.niceName();\n    case 'name':\n      return recipe.name;\n  }\n}\n\nconst RE_ADVANCED = /((?:produces)|(?:consumes)):([a-z0-9-]+)/g;\n\ninterface Props {\n  recipes: game.Recipe[];\n  onPickRecipe(r: game.Recipe): void;\n}\n\ninterface State {\n  query: string;\n  matches: game.Recipe[];\n}\n\nexport class RecipePicker extends React.PureComponent<Props, State> {\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    query: '',\n    matches: [],\n  };\n\n  componentDidMount() {\n    signal.addIngredientFilter.addHandler(this.handleIngredientClick);\n    signal.addProductFilter.addHandler(this.handleProductClick);\n  }\n\n  componentWillUnmount() {\n    this.debCalculateMatches.cancel();\n    signal.addIngredientFilter.removeHandler(this.handleIngredientClick);\n    signal.addProductFilter.removeHandler(this.handleProductClick);\n  }\n\n  handleIngredientClick = (ingredient: game.Ingredient) => {\n    const term = `produces:${ingredient.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleProductClick = (product: game.Product) => {\n    const term = `consumes:${product.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleQueryInput = (event: React.FormEvent<HTMLInputElement>) => {\n    const target = event.target as HTMLInputElement;\n    this.setQuery(target.value);\n  };\n\n  handleRecipeClick = (recipe: game.Recipe) => {\n    this.props.onPickRecipe(recipe);\n    this.setQuery('');\n  };\n\n  setQuery = (query: string, callback?: () => void) => {\n    if (!query.trim()) {\n      this.debCalculateMatches.cancel();\n      this.setState(\n        {\n          query: '',\n          matches: [],\n        },\n        callback\n      );\n    } else {\n      this.setState({ query: query }, callback);\n      this.debCalculateMatches();\n    }\n  };\n\n  calculateMatches() {\n    let query = this.state.query.trim().toLowerCase();\n    if (!query) {\n      this.setState({ matches: [] });\n      return;\n    }\n\n    const conditions = {\n      consumes: [] as string[],\n      produces: [] as string[],\n    };\n\n    type ckey = keyof typeof conditions;\n\n    query = query\n      .replace(RE_ADVANCED, (_, key, value) => {\n        conditions[key as ckey].push(value);\n        return '';\n      })\n      .trim();\n\n    let recipes = this.props.recipes;\n    if (conditions.consumes.length || conditions.produces.length) {\n      recipes = recipes.filter((recipe) => {\n        for (let name of conditions.consumes) {\n          if (!recipe.ingredients.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        for (let name of conditions.produces) {\n          if (!recipe.products.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n\n    if (query) {\n      const fuse = new Fuse(recipes, {\n        shouldSort: true,\n        getFn: getFn,\n        keys: [\n          {\n            name: 'niceName',\n            weight: 0.7,\n          },\n          {\n            name: 'name',\n            weight: 0.2,\n          },\n        ],\n      });\n      recipes = fuse.search(query);\n    }\n    this.setState({ matches: recipes });\n  }\n\n  debCalculateMatches = debounce(this.calculateMatches.bind(this), 200);\n\n  renderMatches() {\n    if (!this.state.matches.length) {\n      return '';\n    }\n    let matches = this.state.matches;\n    if (matches.length > 100) {\n      matches = matches.slice(0, 100);\n    }\n    return (\n      <table className=\"table table-hover\">\n        <thead>\n          <tr>\n            <th>Recipe</th>\n            <th>Time</th>\n            <th>Ingredients</th>\n            <th>Products</th>\n          </tr>\n        </thead>\n        <tbody>\n          {matches.map((r) => (\n            <RecipeMatch\n              recipe={r}\n              key={r.name}\n              onClick={this.handleRecipeClick}\n            />\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  render() {\n    return (\n      <div className={styles.RecipePicker}>\n        <div>\n          <input\n            type=\"search\"\n            ref={this.inputRef}\n            className=\"editable-display form-control\"\n            placeholder=\"What do you want to build?\"\n            value={this.state.query}\n            onChange={this.handleQueryInput}\n          />\n        </div>\n        {this.renderMatches()}\n      </div>\n    );\n  }\n}\n\ninterface RecipeMatchProps {\n  recipe: game.Recipe;\n  onClick(recipe: game.Recipe): void;\n}\n\nclass RecipeMatch extends React.PureComponent<RecipeMatchProps, never> {\n  handleClickAdd = () => {\n    this.props.onClick(this.props.recipe);\n  };\n\n  render() {\n    const recipe = this.props.recipe;\n    const ingredients = recipe.ingredients.map((ing, i) => (\n      <Icon key={i} obj={ing.item} tooltip={<IngredientCard obj={ing} />} />\n    ));\n    const products = recipe.products.map((prod, i) => (\n      <Icon key={i} obj={prod.item} tooltip={<IngredientCard obj={prod} />} />\n    ));\n    return (\n      <tr onClick={this.handleClickAdd}>\n        <td className={styles.ResultName}>\n          <Icon\n            obj={recipe}\n            text={recipe.niceName()}\n            tooltip={<RecipeCard recipe={recipe} />}\n          />\n        </td>\n        <td>{recipe.crafting_time.toDecimal()}</td>\n        <td>{ingredients}</td>\n        <td>{products}</td>\n      </tr>\n    );\n  }\n}\n","import * as React from 'react';\nimport { RecipeOutput } from './RecipeOutput';\nimport { withGame, RecipeRowData } from '../state';\nimport { Totals } from '../totals';\nimport * as game from '../game';\n\nimport styles from './TotalCard.module.css';\n\ninterface Props {\n  gameData: game.GameData;\n  rows: RecipeRowData[];\n}\n\nfunction RawTotalCard(props: Props) {\n  const totals = new Totals();\n  for (let row of props.rows) {\n    totals.addRow(row);\n  }\n\n  const { ingredients, products } = totals.reduce();\n  if (!ingredients.length && !products.length) {\n    return <div />;\n  }\n\n  props.gameData.sortByItem(products, (p) => p.item);\n\n  return (\n    <div className={`card ${styles.TotalCard}`}>\n      <div className=\"card-header\">Combined Totals</div>\n      <div className=\"card-body\">\n        <div className=\"row\">\n          <div className=\"col\">\n            Ingredients:\n            {ingredients.map((ing, i) => (\n              <RecipeOutput key={i} obj={ing} showName />\n            ))}\n          </div>\n          <div className=\"col\">\n            Products:\n            {products.map((prod, i) => (\n              <RecipeOutput key={i} obj={prod} showName />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport const TotalCard = withGame(RawTotalCard);\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Nav from 'react-bootstrap/Nav';\nimport Col from 'react-bootstrap/Col';\n\nimport { RecipeGroup } from './RecipeGroup';\nimport { Settings } from './Settings';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport { assertNever } from '../util';\n\nimport styles from './App.module.css';\n\ninterface Props {\n  state: AppState;\n  actions: AppActions;\n}\n\ninterface State {\n  activePage: ActivePage;\n}\n\nenum ActivePage {\n  Factory = 'FACTORY',\n  Settings = 'SETTINGS',\n}\n\nclass RawApp extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      activePage: ActivePage.Factory,\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n    document.addEventListener('keyup', this.handleKeyUp);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    document.removeEventListener('keyup', this.handleKeyUp);\n  }\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.add('shift-down');\n    }\n  };\n  handleKeyUp = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.remove('shift-down');\n    }\n  };\n\n  handleClickGroup = (i: number) => {\n    this.setState({\n      activePage: ActivePage.Factory,\n    });\n    this.props.actions.setActiveGroup(i);\n  };\n\n  handleClickAddGroup: React.MouseEventHandler<any> = (event) => {\n    event.preventDefault();\n    const defaultName = `Factory ${this.props.state.groups.length + 1}`;\n    const name = prompt('What do you want to name this group?', defaultName);\n    if (!name || !name.trim()) {\n      return;\n    }\n    this.props.actions.addGroup(name);\n  };\n\n  handleClickSettings = () => {\n    this.setState({\n      activePage: ActivePage.Settings,\n    });\n  };\n\n  renderNavbar() {\n    const settingsActive = this.state.activePage === ActivePage.Settings;\n\n    const activeKey = settingsActive\n      ? 'settings'\n      : this.props.state.activeGroupIdx;\n\n    const factoryPills = this.props.state.groups.map((group, i) => {\n      const active = activeKey === i;\n      return (\n        <Nav.Item onClick={() => this.handleClickGroup(i)} key={i}>\n          <Nav.Link active={active}>{group.name}</Nav.Link>\n        </Nav.Item>\n      );\n    });\n\n    return (\n      <>\n        <Nav className=\"flex-column\">\n          <Nav.Item>\n            <Nav.Link disabled>\n              <span role=\"img\" aria-label=\"Factory icon\">\n                \n              </span>{' '}\n              Factories\n            </Nav.Link>\n          </Nav.Item>\n          {factoryPills}\n          <Nav.Item>\n            <Nav.Link onClick={this.handleClickAddGroup}>\n              Add A Factory\n            </Nav.Link>\n          </Nav.Item>\n          <Nav.Item>\n            <Nav.Link\n              active={activeKey === 'settings'}\n              onClick={this.handleClickSettings}\n            >\n              <span role=\"img\" aria-label=\"Gear icon\">\n                \n              </span>{' '}\n              Settings\n            </Nav.Link>\n          </Nav.Item>\n        </Nav>\n      </>\n    );\n  }\n\n  renderFactory = () => {\n    const group = this.props.state.groups[this.props.state.activeGroupIdx];\n\n    return <RecipeGroup group={group} />;\n  };\n\n  renderSettings = () => {\n    return <Settings />;\n  };\n\n  render() {\n    if (!this.props.state.gameData.raw) {\n      return null;\n    }\n    let body: JSX.Element;\n    if (this.state.activePage === ActivePage.Factory) {\n      body = this.renderFactory();\n    } else if (this.state.activePage === ActivePage.Settings) {\n      body = this.renderSettings();\n    } else {\n      return assertNever(this.state.activePage);\n    }\n\n    return (\n      <Container fluid>\n        <Row>\n          <Col xs=\"2\" className={classNames('bg-primary', styles.Sidebar)}>\n            {this.renderNavbar()}\n          </Col>\n          <Col className=\"pt-3\">{body}</Col>\n        </Row>\n      </Container>\n    );\n  }\n}\n\nexport const App = withBoth(RawApp);\n","import * as React from 'react';\nimport Button from 'react-bootstrap/Button';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\n\nimport { DropResult, DragDropContext, Droppable } from 'react-beautiful-dnd';\n\nimport * as signal from '../signal';\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { RecipeRow } from './RecipeRow';\nimport { RecipePicker } from './RecipePicker';\nimport { TotalCard } from './TotalCard';\n\nimport { RecipeGroupData, RecipeRowData } from '../state';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport * as su from '../stateutil';\n\nimport styles from './RecipeGroup.module.css';\n\ninterface Props {\n  group: RecipeGroupData;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawRecipeGroup extends React.PureComponent<Props, never> {\n  componentDidMount() {\n    signal.addRecipeRow.addHandler(this.handlePickRecipe);\n  }\n\n  componentWillUnmount() {\n    signal.addRecipeRow.removeHandler(this.handlePickRecipe);\n  }\n\n  handlePickRecipe = (recipe: game.Recipe) => {\n    this.props.actions.addRow({\n      recipe: recipe,\n      machine: su.getDefaultMachine(recipe, this.props.state),\n      numMachines: Rational.one,\n      modules: [],\n      beaconModule: null,\n      numBeacons: 0,\n    });\n  };\n\n  handleDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    this.props.actions.moveRow(result.source.index, result.destination.index);\n  };\n\n  renderRow = (data: RecipeRowData, index: number) => {\n    return <RecipeRow key={data.recipe.name} index={index} {...data} />;\n  };\n\n  handleClickRename = () => {\n    const i = this.props.state.activeGroupIdx;\n    const name = prompt(\n      'Whatcha wanna call it now?',\n      this.props.state.groups[i].name\n    );\n    if (name) {\n      this.props.actions.renameGroup(i, name);\n    }\n  };\n\n  handleClickClone = () => {\n    const i = this.props.state.activeGroupIdx;\n    const group = this.props.state.groups[i];\n    const name = prompt('Whats this new thing called?', group.name);\n    if (name) {\n      this.props.actions.addGroup(name, group.rows);\n    }\n  };\n\n  handleClickDelete = () => {\n    const i = this.props.state.activeGroupIdx;\n    const group = this.props.state.groups[i];\n\n    if (group.rows.length) {\n      if (!window.confirm(`Are you sure you want to delete ${group.name}`)) {\n        return;\n      }\n    }\n    this.props.actions.removeGroup(i);\n  };\n\n  render() {\n    const gd = this.props.state.gameData;\n    const availableRecipes = gd.recipes.filter((recipe) => {\n      return !this.props.group.rows.some((row) => row.recipe === recipe);\n    });\n\n    return (\n      <div className={styles.RecipeGroup}>\n        <div className=\"clearfix\">\n          <h3 className=\"float-left\">{this.props.group.name}</h3>\n          <div className=\"float-right\">\n            <ButtonGroup>\n              <Button variant=\"info\" onClick={this.handleClickRename}>\n                Rename\n              </Button>\n              <Button variant=\"info\" onClick={this.handleClickClone}>\n                Clone\n              </Button>\n              <Button variant=\"danger\" onClick={this.handleClickDelete}>\n                Delete\n              </Button>\n            </ButtonGroup>\n          </div>\n        </div>\n        <RecipePicker\n          recipes={availableRecipes}\n          onPickRecipe={this.handlePickRecipe}\n        />\n        <hr />\n\n        <DragDropContext onDragEnd={this.handleDragEnd}>\n          <Droppable droppableId={'eyy'}>\n            {(provided) => (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {this.props.group.rows.map(this.renderRow)}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        <hr />\n        <TotalCard rows={this.props.group.rows} />\n      </div>\n    );\n  }\n}\n\nexport const RecipeGroup = withBoth(RawRecipeGroup);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { AppActions, AppState, withGame, withBoth } from '../state';\nimport { getDefaultMachine } from '../stateutil';\n\nimport { MachinePicker } from './MachinePicker';\n\ninterface RawSettingsProps {\n  gameData: game.GameData;\n}\n\nclass RawSettings extends React.PureComponent<RawSettingsProps, never> {\n  render() {\n    const categoryNames = Object.entries(this.props.gameData.categoryMap)\n      .filter((entry) => entry[1].length > 1)\n      .map((entry) => entry[0]);\n\n    categoryNames.sort((a, b) => a.localeCompare(b));\n\n    return (\n      <div>\n        <h3>Default Assemblers</h3>\n        {categoryNames.map((name) => (\n          <CategoryRow key={name} category={name} />\n        ))}\n      </div>\n    );\n  }\n}\n\ninterface CategoryRowProps {\n  category: string;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawCategoryRow extends React.PureComponent<CategoryRowProps, never> {\n  handleChange = (machine: game.AssemblingMachine) => {\n    this.props.actions.updateDefaultMachine(this.props.category, machine);\n  };\n\n  render() {\n    const machines = this.props.state.gameData.categoryMap[this.props.category];\n    const selected = getDefaultMachine(this.props.category, this.props.state);\n    return (\n      <div className=\"btn-toolbar mb-3\" key={this.props.category}>\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">{this.props.category}</span>\n          </div>\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={machines}\n              selected={selected}\n              onChange={this.handleChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst CategoryRow = withBoth(RawCategoryRow);\n\nexport const Settings = withGame(RawSettings);\n","import React, { useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport * as game from '../game';\nimport { AppActions, withBoth, useDakpan } from '../state';\nimport * as serialization from '../serialization';\n\nimport { App } from './App';\n\ninterface Props {\n  actions: AppActions;\n}\ninterface State {\n  gameData: game.GameData | null;\n}\n\nclass RawAppLoader extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      gameData: null,\n    };\n  }\n  componentDidMount() {\n    this.load().catch((err) => {\n      this.setState(() => {\n        throw err;\n      });\n    });\n  }\n\n  async load() {\n    const response = await fetch('assets/seablock-17.json');\n    if (response.status !== 200) {\n      throw new Error(\n        `Could not load game data, got HTTP status ${response.status}`\n      );\n    }\n\n    let parsed;\n    try {\n      parsed = await response.json();\n    } catch (err) {\n      throw new Error(`Could not parse game data: ${err}`);\n    }\n\n    const gameData = new game.GameData(parsed);\n\n    this.props.actions.replaceState({ gameData });\n\n    const urlState = serialization.getUrlState(gameData);\n    if (urlState) {\n      // everything comes from url state\n      this.props.actions.replaceState(urlState);\n    } else {\n      // Load just settings\n      try {\n        const storageState = serialization.getLocalStorageState(gameData);\n        if (storageState) {\n          // everything comes from url state\n          this.props.actions.replaceState(storageState);\n        }\n      } catch (err) {\n        console.error('Failed to load local storage state', err);\n      }\n    }\n\n    this.setState({ gameData });\n  }\n\n  render() {\n    if (!this.state.gameData) {\n      return <h1>Loading...</h1>;\n    }\n    const sheet = `assets/sprite-sheet-${this.state.gameData.raw.sprites.hash}.png`;\n    const style = `\n        .game-icon {\n            background-image: url(${sheet});\n        }\n        `;\n    return (\n      <>\n        <StateWriter />\n        <Prefetch href={sheet} />\n        <style>{style}</style>\n        <App />\n      </>\n    );\n  }\n}\n\nconst StateWriter: React.FC = () => {\n  const [state] = useDakpan();\n\n  useEffect(() => {\n    serialization.setUrlState(state);\n    serialization.setLocalStorageState(state);\n  }, [state]);\n\n  return null;\n};\n\nconst Prefetch: React.FC<{ href: string }> = (props) => {\n  return ReactDOM.createPortal(\n    <link rel=\"prefetch\" href={props.href} />,\n    document.head\n  );\n};\n\nexport const AppLoader = withBoth(RawAppLoader);\n","import * as Sentry from '@sentry/browser';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { ErrorCatcher } from './components/ErrorCatcher';\nimport { AppLoader } from './components/AppLoader';\nimport { StateProvider } from './state';\n\nimport './index.css';\n\nif (process.env.NODE_ENV === 'production') {\n  Sentry.init({\n    dsn: 'https://2ab99c1e02a448cbaa06595164416044@sentry.io/1385727',\n  });\n}\n\nReactDOM.render(\n  <ErrorCatcher>\n    <StateProvider>\n      <AppLoader />\n    </StateProvider>\n  </ErrorCatcher>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipePicker\":\"RecipePicker_RecipePicker__3sU3V\",\"ResultName\":\"RecipePicker_ResultName__jSE56\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"crashed\":\"ErrorCatcher_crashed__3tour\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Icon\":\"Icon_Icon__377W-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"TotalCard\":\"TotalCard_TotalCard__2ci0q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipeGroup\":\"RecipeGroup_RecipeGroup__3MC_F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sidebar\":\"App_Sidebar__3POeR\"};"],"sourceRoot":""}