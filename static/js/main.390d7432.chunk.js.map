{"version":3,"sources":["components/App.module.css","components/ErrorCatcher.tsx","util.ts","rational.ts","game.ts","stateutil.ts","state.tsx","serialization.ts","signal.ts","components/generic/Dropdown.tsx","components/generic/Tooltip.tsx","components/generic/IntegerInput.tsx","components/generic/RationalInput.tsx","components/Icon.tsx","components/MachineCard.tsx","components/RecipeCard.tsx","components/MachinePicker.tsx","components/ModuleCard.tsx","components/ModulePicker.tsx","totals.ts","components/RecipeRow.tsx","components/RecipePicker.tsx","components/TotalCard.tsx","components/App.tsx","components/RecipeGroup.tsx","components/Settings.tsx","components/AppLoader.tsx","index.tsx","components/RecipePicker.module.css","components/ErrorCatcher.module.css","components/Icon.module.css","components/TotalCard.module.css","components/RecipeGroup.module.css"],"names":["module","exports","ErrorCatcher","props","state","crashMsg","undefined","error","errorInfo","this","crash","componentStack","stack","join","Sentry","scope","Object","keys","forEach","key","setExtra","msg","setState","className","styles","crashed","children","React","assert","check","message","Error","mapValues","obj","fn","ret","values","push","clone","orig","assign","create","getPrototypeOf","round2","num","places","mag","Math","pow","round","num_divmod","a","b","Number","isSafeInteger","quotient","floor","remainder","Rational","p","q","toString","div","num_gcd","divmod","result","less","zero","sub","one","other","fromFloat","min","max","mul","maxDigits","roundingFactor","sign","x","isNegative","negate","add","integerPart","decimalPart","fraction","ten","equal","length","slice","isInteger","r","lookups","value","str","index","indexOf","fromInts","oneThird","twoThirds","rounded","floored","BaseDisplayable","data","name","localised_name","icon_col","icon_row","en","BaseItem","d","raw","usedBy","madeBy","Module","type","limitedTo","effects","Set","limitation","speed","effect","bonus","productivity","consumption","pollution","recipe","size","has","GenericItem","Fluid","default_temperature","BaseIngredient","amount","ItemIngredient","gd","item","itemMap","toDecimal","niceName","FluidIngredient","minimum_temperature","maximum_temperature","fluidMap","Infinity","range","BaseProduct","amount_min","amount_max","probability","ItemProduct","ingredient","FluidProduct","temperature","console","temp","Recipe","category","ingredients","products","crafting_time","madeIn","energy_required","map","results","AssemblingMachine","crafting_categories","createCategoryMap","entities","catMap","entity","hasOwnProperty","GameData","items","fluids","modules","moduleMap","recipes","recipeMap","entityMap","categoryMap","groupCollapsed","addOfType","ctor","edata","itemName","thing","fluid","recipeName","entityName","canBuildRecipe","some","isPositive","debug","warn","log","groupEnd","groupOrder","subgroupOrder","group","groups","order","subgroups","subgroup","collection","keyFn","sort","ordersA","getItemOrder","ordersB","i","valA","valB","getDefaultMachine","input","defaultMachine","game","settings","assemblerOverrides","gameData","defaultState","fakeGameData","rows","activeGroupIdx","recipeTarget","getActiveGroup","updateGroup","newGroup","oldGroup","createDakpan","replaceState","newState","addRow","row","updateRow","updates","Array","from","removeRow","splice","moveRow","oldIndex","newIndex","removed","updateDefaultMachine","newMachine","oldMachine","machine","setActiveGroup","groupIdx","addGroup","renameGroup","removeGroup","maxIndex","setRecipeTarget","StateProvider","useDakpan","withBoth","OldComponent","actions","withGame","groupv4to5","getLocalStorageState","statestr","localStorage","getItem","stateobj","JSON","parse","version","deserialize","serialize","machineName","numMachines","toFraction","m","beaconModule","numBeacons","reStateUrl","getUrlState","matches","exec","document","location","hash","decodeURIComponent","inflate","atob","to","migrateSerializedState","state1to2","state2to3","state3to4","state4to5","unmigrated","migrated","deserializeSettings","fromString","n","serialized","Signal","handlers","dispatch","arg","handler","addIngredientFilter","addProductFilter","addRecipeRow","ESC_KEYCODE","Dropdown","buttonRef","handleToggle","isOpen","handleSelect","selected","onSelect","handleWantClose","floater","canToggle","options","option","disabled","classes","parentRef","renderOption","onWantClose","ref","onClick","renderSelected","DropdownMenu","popperInstance","menuRef","popperUpdate","style","handleBodyClick","event","current","target","contains","handleKeyEvent","keyCode","renderOptions","header","active","referenceEl","menuEl","Popper","modifiers","applyStyle","enabled","updateStateWithStyle","body","addEventListener","disableEventListeners","removeEventListener","Tooltip","selfRef","handleMouseEnter","showSelf","handleMouseLeave","zIndex","relativeTo","selfEl","placement","offset","preventOverflow","boundariesElement","_","prevState","initPopper","cleanupPopper","ReactDOM","IntegerInput","handleChange","txtValue","trim","intOnly","positiveOnly","onChange","step","RationalInput","errmsg","parsed","stringToRational","err","rationalToString","oldProps","classNames","lastIndexOf","rational","dec","toFloat","Icon","iconRef","createRef","y","divStyle","display","backgroundPosition","width","height","icon","title","tooltip","text","lineHeight","marginLeft","PureComponent","MachineCard","crafting_speed","module_slots","RecipeCard","product","sprites","extra","float","clear","MachinePicker","machines","ModuleCard","bonuses","bonusName","ModulePicker","slot_icon_module","nomod","rocket_launch_products","filter","isBeacon","canUseWith","unshift","Totals","addIngredient","newIng","oldIng","match","addProduct","newProd","oldProd","be","clamp","ingredientMult","invert","productMult","isZero","satisfies","IngredientCard","perSecond","includes","RecipeRow","handleRemoveClick","handleMachineChange","applyChange","handleNumMachinesChange","handleNumBeaconsChange","handleSetAllModules","fill","handleSetModule","handleSetBeaconModule","handleIngredientClick","shiftKey","preventDefault","stopPropagation","signal","handleProductClick","handleInputGroupClick","output","getOutput","find","newNum","change","t","numSlots","slots","bind","draggableId","provided","innerRef","draggableProps","dragHandleProps","Button","variant","renderMachines","renderModules","renderBeacons","minWidth","getFn","RE_ADVANCED","RecipePicker","inputRef","query","term","setQuery","calculateMatches","scrollIntoView","handleQueryInput","handleRecipeClick","onPickRecipe","callback","debCalculateMatches","cancel","debounce","addHandler","removeHandler","toLowerCase","conditions","consumes","produces","replace","Fuse","shouldSort","weight","search","placeholder","renderMatches","card","RecipeMatch","handleClickAdd","ing","prod","ResultName","ActivePage","TotalCard","totals","reduce","sortByItem","RecipeGroup","handlePickRecipe","su","handleDragEnd","destination","source","renderRow","handleClickRename","prompt","handleClickDelete","window","confirm","availableRecipes","as","ButtonGroup","Toggle","split","id","Menu","Item","onDragEnd","droppableId","droppableProps","RawSettings","categoryNames","entries","entry","localeCompare","CategoryRow","Settings","App","handleKeyDown","classList","handleKeyUp","remove","handleClickGroup","activePage","Factory","handleClickAddGroup","defaultName","handleClickSettings","renderFactory","Container","renderSettings","activeKey","factoryPills","Nav","Link","role","aria-label","assertNever","Row","Col","xs","Sidebar","renderNavbar","Component","RawAppLoader","load","catch","fetch","response","status","json","urlState","serialization","storageState","sheet","href","StateWriter","useEffect","stringify","btoa","deflate","history","setItem","Prefetch","rel","head","AppLoader","dsn","getElementById"],"mappings":"qFACAA,EAAOC,QAAU,CAAC,QAAU,uB,qMCUfC,EAAb,YACE,WAAYC,GAAe,IAAD,8BACxB,4CAAMA,KACDC,MAAQ,CACXC,cAAUC,GAHY,EAD5B,+EAQoBC,EAAcC,GAE9BC,KAAKC,MACH,CACE,mBACAF,EAAUG,eACV,GACAJ,GAASA,EAAMK,OACfC,KAAK,OAGTC,KAAiB,SAACC,GAChBC,OAAOC,KAAKT,GAAWU,SAAQ,SAACC,GAC9BJ,EAAMK,SAASD,EAAKX,EAAUW,OAEhCL,IAAwBP,QAvB9B,4BA2BQc,GACJZ,KAAKa,SAAS,CACZjB,SAAUgB,MA7BhB,+BAkCI,MAAmC,qBAAxBZ,KAAKL,MAAMC,SAElB,uBAAKkB,UAAWC,IAAOC,SACrB,sCACA,2BAAMhB,KAAKL,MAAMC,WAKhBI,KAAKN,MAAMuB,aA3CtB,GAAkCC,a,kCCX3B,SAASC,EAAOC,EAAYC,GACjC,IAAKD,EACH,MAAM,IAAIE,MAAMD,GAAW,oBAQxB,SAASE,EACdC,EACAC,GAEA,IAAIC,EAA4B,GAChC,IAAK,IAAIhB,KAAOc,EACdE,EAAIhB,GAAOe,EAAGD,EAAId,IAEpB,OAAOgB,EAGF,SAASC,EAAUH,GACxB,IAAMG,EAAS,GACf,IAAK,IAAIjB,KAAOc,EACdG,EAAOC,KAAKJ,EAAId,IAElB,OAAOiB,EAGF,SAASE,EAASC,GACvB,OAAOvB,OAAOwB,OAAOxB,OAAOyB,OAAOzB,OAAO0B,eAAeH,IAAQA,GAG5D,SAASI,EAAOC,EAAaC,GAClC,IAAMC,EAAMC,KAAKC,IAAI,GAAIH,GACzB,OAAOE,KAAKE,MAAML,EAAME,GAAOA,EC7BjC,SAASI,EAAWC,EAAWC,GAI7B,OAHAxB,EAAOyB,OAAOC,cAAcH,IAC5BvB,EAAOyB,OAAOC,cAAcF,IAErB,CACLG,SAAUR,KAAKS,MAAML,EAAIC,GACzBK,UAAWN,EAAIC,GAInB,IAEaM,EAAb,WAIE,WAAYC,EAAWC,GAAY,yBAHnCD,OAGkC,OAFlCC,OAEkC,OAiHlCC,cAjHkC,EAChCjC,EAAOyB,OAAOC,cAAcK,GAAI,gCAChC/B,EAAOyB,OAAOC,cAAcM,GAAI,kCAChChC,EAAa,IAANgC,EAAS,gCAEZA,EAAI,IACND,GAAKA,EACLC,GAAKA,GAGG,IAAND,IACFC,EAAI,GAGN,IAAME,EAlCV,SAASC,EAAQZ,EAAWC,GAC1B,OAAQA,EAAQW,EAAQX,EAAGD,EAAIC,GAAnBD,EAiCEY,CAAQJ,EAAGC,GACnBE,EAAM,IACRH,GAAQG,EACRF,GAAQE,GAEVrD,KAAKkD,EAAIA,EACTlD,KAAKmD,EAAIA,EAxBb,oDA+BI,IAAMI,EAASd,EAAWzC,KAAKkD,EAAGlD,KAAKmD,GACnCK,EAAS,IAAIP,EAASM,EAAOT,SAAU,GAI3C,OAHIU,EAAOC,KAAKR,EAASS,OAA8B,IAArBH,EAAOP,YACvCQ,EAASA,EAAOG,IAAIV,EAASW,MAExBJ,IApCX,+BAwCI,OAAO,IAAIP,GAAUjD,KAAKkD,EAAGlD,KAAKmD,KAxCtC,+BA4CI,OAAO,IAAIF,EAASjD,KAAKmD,EAAGnD,KAAKkD,KA5CrC,0BA+CMW,GACF,OAAO,IAAIZ,EAASjD,KAAKkD,EAAIW,EAAMV,EAAInD,KAAKmD,EAAIU,EAAMX,EAAGlD,KAAKmD,EAAIU,EAAMV,KAhD5E,0BAmDMU,GACF,OAAO,IAAIZ,EAASjD,KAAKkD,EAAIW,EAAMV,EAAInD,KAAKmD,EAAIU,EAAMX,EAAGlD,KAAKmD,EAAIU,EAAMV,KApD5E,0BAuDMU,GAIF,MAHoB,iBAATA,IACTA,EAAQZ,EAASa,UAAUD,IAEtB,IAAIZ,EAASjD,KAAKkD,EAAIW,EAAMX,EAAGlD,KAAKmD,EAAIU,EAAMV,KA3DzD,0BA8DMU,GACF,OAAO,IAAIZ,EAASjD,KAAKkD,EAAIW,EAAMV,EAAGnD,KAAKmD,EAAIU,EAAMX,KA/DzD,4BAkEQa,EAAwBC,GAQ5B,MAPkB,iBAAPD,IACTA,EAAMd,EAASa,UAAUC,IAET,iBAAPC,IACTA,EAAMf,EAASa,UAAUE,IAGvBhE,KAAKyD,KAAKM,GAAaA,EACvBC,EAAIP,KAAKzD,MAAcgE,EACpBhE,OA5EX,6BAkFS6D,GACL,IACIR,EADWrD,KAAKqD,IAAIQ,GACLd,QAEnB,MAAO,CAAED,SAAUO,EAAKL,UADdhD,KAAK2D,IAAIE,EAAMI,IAAIZ,OArFjC,4BAyFQQ,GACJ,OAAO7D,KAAKkD,IAAMW,EAAMX,GAAKlD,KAAKmD,IAAMU,EAAMV,IA1FlD,mCA8FI,OAAOnD,KAAKkD,EAAI,IA9FpB,mCAiGI,OAAOlD,KAAKkD,EAAI,IAjGpB,8BAqGI,OAAkB,IAAXlD,KAAKkD,IArGhB,+BAyGI,OAAkB,IAAXlD,KAAKkD,IAzGhB,2BA4GOW,GACH,OAAO7D,KAAKkD,EAAIW,EAAMV,EAAInD,KAAKmD,EAAIU,EAAMX,IA7G7C,gCAiHI,OAAOlD,KAAKkD,EAAIlD,KAAKmD,IAjHzB,mCAwHI,OAAe,IAAXnD,KAAKmD,EACAnD,KAAKkD,EAAEE,WAETpD,KAAKkD,EAAEE,WAAa,IAAMpD,KAAKmD,EAAEC,aA3H5C,gCA8HYc,EAAoBC,GACX,MAAbD,IACFA,EAAY,GAEQ,MAAlBC,IACFA,EAAiB,IAAIlB,EAAS,EAAb,SAAgB,GAAOiB,EAAY,KAGtD,IAAIE,EAAO,GACPC,EAAcrE,KACdqE,EAAEC,eACJF,EAAO,IACPC,EAAIA,EAAEE,UAQR,IALA,IAAIhB,EAASd,GADb4B,EAAIA,EAAEG,IAAIL,IACgBjB,EAAGmB,EAAElB,GAC3BsB,EAAclB,EAAOT,SAASM,WAC9BsB,EAAc,GACdC,EAAW,IAAI1B,EAASM,EAAOP,UAAWqB,EAAElB,GAC5CyB,EAAM,IAAI3B,EAAS,GAAI,GACpBiB,EAAY,IAAMS,EAASE,MAAMV,IAAiB,CACvDQ,EAAWA,EAASV,IAAIW,GACxBT,EAAiBA,EAAeF,IAAIW,GACpC,IAAIrB,EAASd,EAAWkC,EAASzB,EAAGyB,EAASxB,GAC7CuB,GAAenB,EAAOT,SAASM,WAC/BuB,EAAW,IAAI1B,EAASM,EAAOP,UAAW2B,EAASxB,GACnDe,IAEF,GAAIS,EAASE,MAAMV,GACjB,KAA+C,MAAxCO,EAAYA,EAAYI,OAAS,IACtCJ,EAAcA,EAAYK,MAAM,EAAGL,EAAYI,OAAS,GAG5D,MAAoB,KAAhBJ,EACKN,EAAOK,EAAc,IAAMC,EAE7BN,EAAOK,KAlKlB,iCAwKmBtC,GACf,GAAIS,OAAOoC,UAAU7C,GACnB,OAAO,IAAInC,KAAKmC,EAAK,GAIvB,IAAM8C,EAAI,IAAIhC,EACZX,KAAKE,MAjLqB,IAiLfL,GAjLe,KAqLtBoB,EAAS0B,EAAE1B,OAAON,EAASW,KAXL,uBAY5B,YAA2BsB,EAA3B,+CAAoC,CAAC,IAAD,6BAAxBxE,EAAwB,KAAnByE,EAAmB,KAClC,GAAI5B,EAAOP,UAAU6B,MAAMnE,GACzB,OAAO6C,EAAOT,SAAS0B,IAAIW,IAdH,kFAkB5B,OAAOF,IA1LX,+BA4LkB/B,EAAWC,GACzB,OAAO,IAAInD,KAAKkD,EAAGC,KA7LvB,iCA+LoBiC,GAChB,IAAMC,EAAQD,EAAIE,QAAQ,KAC1B,IAAe,IAAXD,EACF,OAAOpC,EAASa,UAAUlB,OAAOwC,IAEjC,IAAMlC,EAAIN,OAAOwC,EAAIL,MAAM,EAAGM,IACxBlC,EAAIP,OAAOwC,EAAIL,MAAMM,EAAQ,IACnC,OAAOpC,EAASsC,SAASrC,EAAGC,OAtMlC,KAAaF,EA0MJS,KAAO,IAAIT,EAAS,EAAG,GA1MnBA,EA2MJW,IAAM,IAAIX,EAAS,EAAG,GA3MlBA,EA4MJuC,SAAW,IAAIvC,EAAS,EAAG,GA5MvBA,EA6MJwC,UAAY,IAAIxC,EAAS,EAAG,GAKrC,IAFA,IAAMiC,EAAkC,GAE/B/B,EAAI,EAAGA,EAAI,IAAKA,IACvB,IAAK,IAAID,EAAI,EAAGA,EAAIC,EAAGD,IAAK,CAC1B,IAAMf,EAAMe,EAAIC,EAGhB,KAAIhB,EAAIiB,WAAW0B,OAAS,IAA5B,CAKA,IAAMY,EAAU,IAAIzC,EAClBX,KAAKE,MA/NqB,IA+NfL,GA/Ne,KAkO5B+C,EAAQtD,KAAK,CAAC8D,EAASzC,EAASsC,SAASrC,EAAGC,KAG5C,IAAMwC,EAAU,IAAI1C,EAClBX,KAAKS,MAtOqB,IAsOfZ,GAtOe,KAyO5B+C,EAAQtD,KAAK,CAAC+D,EAAS1C,EAASsC,SAASrC,EAAGC,MC3OzC,IAAMyC,EAAb,WAME,WAAYC,GAAyB,yBALrCC,UAKoC,OAJpCC,oBAIoC,OAHpCC,cAGoC,OAFpCC,cAEoC,EAClCjG,KAAK8F,KAAOD,EAAKC,KACjB9F,KAAK+F,eAAiBF,EAAKE,eAC3B/F,KAAKgG,SAAWH,EAAKG,SACrBhG,KAAKiG,SAAWJ,EAAKI,SAVzB,uDAcI,OAAOjG,KAAK+F,eAAeG,OAd/B,KAkBeC,E,YAKb,WAAYC,GAAO,IAAD,8BAChB,4CAAMA,KALRC,SAIkB,IAHlBC,OAAmB,GAGD,EAFlBC,OAAmB,GAIjB,EAAKF,IAAMD,EACX,EAAKN,KAAOM,EAAEN,KACd,EAAKC,eAAiBK,EAAEL,eACxB,EAAKC,SAAWI,EAAEJ,SAClB,EAAKC,SAAWG,EAAEH,SANF,E,2BALmCL,GAe1CY,EAAb,YAUE,WAAYJ,GAAuB,IAAD,8BAChC,4CAAMA,KAVRK,UASkC,IARlCC,eAQkC,IAPlCC,aAOkC,EAEhC,EAAKF,KAAOL,EAAEK,KACd,EAAKC,UAAY,IAAIE,IAAIR,EAAES,YAE3B,EAAKF,QAAU,CACbG,MAAO7D,EAASa,WAAWsC,EAAEW,OAAOD,OAAS,CAAEE,MAAO,IAAKA,OAC3DC,aAAchE,EAASa,WACpBsC,EAAEW,OAAOE,cAAgB,CAAED,MAAO,IAAKA,OAE1CE,YAAajE,EAASa,WACnBsC,EAAEW,OAAOG,aAAe,CAAEF,MAAO,IAAKA,OAEzCG,UAAWlE,EAASa,WAAWsC,EAAEW,OAAOI,WAAa,CAAEH,MAAO,IAAKA,QAbrC,EAVpC,wEA2BaI,GACT,OAA4B,IAAxBpH,KAAK0G,UAAUW,MAIZrH,KAAK0G,UAAUY,IAAIF,EAAOtB,UAhCrC,GAA4BK,GAoCtBoB,E,2MACJd,KAAkB,U,6BADMN,GAMbqB,EAAb,YAIE,WAAYpB,GAAsB,IAAD,8BAC/B,4CAAMA,KAJRqB,yBAGiC,IAFjChB,KAAgB,QAId,EAAKgB,oBAAsBrB,EAAEqB,oBAFE,EAJnC,2BAA2BtB,GAUZuB,EAIb,WAAYtB,GAAuB,yBAHnCN,UAGkC,OAFlC6B,YAEkC,EAChC3H,KAAK8F,KAAOM,EAAEN,KACd9F,KAAK2H,OAAS1E,EAASa,UAAUsC,EAAEuB,SAI1BC,EAAb,YAIE,WAAYxB,EAAsByB,GAAe,IAAD,8BAC9C,4CAAMzB,KAJRK,KAAe,OAGiC,EAFhDqB,UAEgD,EAE9C,EAAKA,KAAOD,EAAGE,QAAQ3B,EAAEN,MAFqB,EAJlD,wEAUI,MAAM,GAAN,OAAU9F,KAAK2H,OAAOK,YAAtB,iBAAuChI,KAAK8H,KAAKG,gBAVrD,GAAoCP,GAcvBQ,EAAb,YAME,WAAY9B,EAAsByB,GAAe,IAAD,8BAC9C,4CAAMzB,KANRK,KAAgB,QAKgC,EAJhDqB,UAIgD,IAHhDK,yBAGgD,IAFhDC,yBAEgD,EAE9C,EAAKN,KAAOD,EAAGQ,SAASjC,EAAEN,MAE1B,EAAKqC,oBAAsB/B,EAAE+B,sBAAwBG,IACrD,EAAKF,oBAAsBhC,EAAEgC,qBAAuBE,IAEhD,EAAKF,qBAAuB,WAC9B,EAAKA,oBAAsBE,KAEzB,EAAKH,sBAAwB,WAC/B,EAAKA,qBAAuBG,KAXgB,EANlD,wEAsBI,IAAMvE,EAAM/D,KAAKmI,oBACXnE,EAAMhE,KAAKoI,oBACbG,EAAQ,GAQZ,OAPIxE,KAASuE,KAAYtE,IAAQsE,IAC/BC,EAAK,YAAQxE,EAAR,uBAAkBC,EAAlB,SACIA,IAAQsE,IACjBC,EAAK,mBAAUvE,EAAV,SACID,KAASuE,MAClBC,EAAK,mBAAUvE,EAAV,UAED,GAAN,OAAUhE,KAAK2H,OAAOK,YAAtB,iBAAuChI,KAAK8H,KAAKG,YAAjD,OAA8DM,OAhClE,GAAqCb,GAsCtBc,EAIb,WAAYpC,GAGV,IAAIuB,EAH0B,yBAHhC7B,UAG+B,OAF/B6B,YAE+B,EAC7B3H,KAAK8F,KAAOM,EAAEN,KAIZ6B,EADE,WAAYvB,EACLnD,EAASa,UAAUsC,EAAEuB,QAErB1E,EAASsC,SAASa,EAAEqC,WAAarC,EAAEsC,WAAY,GAG9B,iBAAjBtC,EAAEuC,cACW,IAAlBvC,EAAEuC,YACJhB,EAAS1E,EAASS,KACS,IAAlB0C,EAAEuC,cACXxH,EAAOiF,EAAEuC,YAAc,GACvBxH,EAAOiF,EAAEuC,YAAc,GACvBhB,EAASA,EAAO1D,IAAIhB,EAASa,UAAUsC,EAAEuC,gBAG7C3I,KAAK2H,OAASA,GAILiB,EAAb,YAIE,WAAYxC,EAAmByB,GAAe,IAAD,8BAC3C,4CAAMzB,KAJRK,KAAe,OAG8B,EAF7CqB,UAE6C,EAE3C,EAAKA,KAAOD,EAAGE,QAAQ3B,EAAEN,MAFkB,EAJ/C,wEAUI,MAAM,GAAN,OAAU9F,KAAK2H,OAAOK,YAAtB,iBAAuChI,KAAK8H,KAAKG,cAVrD,gCAaYY,GACR,MAA2B,SAApBA,EAAWpC,MAAmBoC,EAAWf,OAAS9H,KAAK8H,SAdlE,GAAiCU,GAkBpBM,EAAb,YAKE,WAAY1C,EAAmByB,GAAe,IAAD,8BAC3C,4CAAMzB,KALRK,KAAgB,QAI6B,EAH7CqB,UAG6C,IAF7CiB,iBAE6C,EAE3C,EAAKjB,KAAOD,EAAGQ,SAASjC,EAAEN,MACrB,EAAKgC,MACRkB,QAAQlJ,MAAM,sBAAuBsG,GAEvC,EAAK2C,YAAc3C,EAAE2C,aAAe,EAAKjB,KAAKL,oBANH,EAL/C,wEAeI,IAAIwB,EAAO,GAIX,OAHIjJ,KAAK+I,cAAgB/I,KAAK8H,KAAKL,sBACjCwB,EAAI,YAAQjJ,KAAK+I,YAAb,UAEA,GAAN,OAAU/I,KAAK2H,OAAOK,YAAtB,iBAAuChI,KAAK8H,KAAKG,YAAjD,OAA8DgB,KAnBlE,gCAsBYJ,GACR,MACsB,UAApBA,EAAWpC,MACXoC,EAAWf,OAAS9H,KAAK8H,MACzBe,EAAWT,qBAAuBpI,KAAK+I,aACvCF,EAAWV,qBAAuBnI,KAAK+I,gBA3B7C,GAAkCP,GAkCrBU,EAAb,YAQE,WAAY9C,EAAkByB,GAAe,IAAD,8BAC1C,4CAAMzB,KARR+C,cAO4C,IAN5CC,iBAM4C,IAL5CC,cAK4C,IAJ5CC,mBAI4C,IAF5CC,OAA8B,GAI5B,EAAKzD,KAAOM,EAAEN,KACd,EAAKqD,SAAW/C,EAAE+C,SAClB,EAAKG,cAAgBrG,EAASa,UAAUsC,EAAEoD,iBAE1C,EAAKJ,YAAchD,EAAEgD,YAAYK,KAAI,SAACZ,GACpC,MAAwB,UAApBA,EAAWpC,KACN,IAAIyB,EAAgBW,EAAYhB,GAEhC,IAAID,EAAeiB,EAAYhB,MAI1C,EAAKwB,SAAWjD,EAAEsD,QAAQD,KAAI,SAACjG,GAC7B,MAAoB,UAAhBA,EAAOiD,KACF,IAAIqC,EAAatF,EAAQqE,GAEzB,IAAIe,EAAYpF,EAAQqE,MAlBO,EAR9C,wEAgCI,OAAI7H,KAAKqJ,SAASvE,OAAS,EAClB,iEACE9E,KAAKqJ,SAAS,GAAG1B,OAAO9C,MAAM5B,EAASW,KACzC5D,KAAKqJ,SAAS,GAAGvB,KAAKG,WAEtBjI,KAAKqJ,SAAS,GAAGpB,eArC9B,GAA4BrC,GAqDf+D,EAAb,uLACiBvC,GAEb,OAAgE,IAA5DpH,KAAK6F,KAAK+D,oBAAoBtE,QAAQ8B,EAAO+B,cAHrD,GAXA,WAEE,WAAYtD,GAAU,yBADtBA,UACqB,EACnB7F,KAAK6F,KAAOA,EAHhB,uDAOI,OAAO7F,KAAK6F,KAAKE,eAAeG,OAPpC,MA+BM2D,EAAoB,SAACC,GACzB,IAAMC,EAAsB,GADoB,uBAEhD,YAAmBD,EAAnB,+CAA6B,CAAC,IAArBE,EAAoB,+BAG3B,YAAqBA,EAAOnE,KAAK+D,oBAAjC,+CAAsD,CAAC,IAA9CT,EAA6C,QAC/CY,EAAOE,eAAed,KACzBY,EAAOZ,GAAY,IAErBY,EAAOZ,GAAUvH,KAAKoI,IAPG,oFAFmB,kFAYhD,OAAOD,GAGIG,EAAb,WAoBE,WAAY7D,GAAmB,IAAD,gCAnB9BA,SAmB8B,OAjB9B8D,MAAgB,GAiBc,KAhB9BpC,QAAoC,GAgBN,KAd9BqC,OAAkB,GAcY,KAb9B/B,SAAsC,GAaR,KAX9BgC,QAAoB,GAWU,KAV9BC,UAAwC,GAUV,KAR9BC,QAAoB,GAQU,KAP9BC,UAAwC,GAOV,KAL9BV,SAAqB,GAKS,KAJ9BW,UAAwC,GAIV,KAF9BC,iBAE8B,EAC5B1B,QAAQ2B,eAAe,wBACvB3K,KAAKqG,IAAMA,EAMX,IAAMuE,EAAY,SAChBd,EACAe,GACI,IAAD,uBACH,YAAkBf,EAAlB,+CAA4B,CAAC,IAApBgB,EAAmB,QACpBd,EAAS,IAAIa,EAAKC,GACxB,EAAKL,UAAUK,EAAMhF,MAAQkE,EAC7B,EAAKF,SAASlI,KAAKoI,IAJlB,oFAYL,IAAK,IAAIe,KAJTH,EAAUjJ,EAAO0E,EAAI,uBAAwBsD,GAC7CiB,EAAUjJ,EAAO0E,EAAG,SAAcsD,GAClCiB,EAAUjJ,EAAO0E,EAAI,gBAAiBsD,GAEjBtD,EAAI8D,MAAO,CAC9B,IAAMa,EAAQ3E,EAAI8D,MAAMY,GACxB,GAAI,SAAUC,GAAwB,UAAfA,EAAMvE,KAAkB,CAC7C,IAAMwE,EAAQ,IAAIzD,EAAMwD,GACxBhL,KAAKoK,OAAOxI,KAAKqJ,GACjBjL,KAAKqI,SAAS4C,EAAMnF,MAAQmF,OACvB,GAAI,SAAUD,GAAwB,WAAfA,EAAMvE,KAAmB,CACrD,IAAMqB,EAAO,IAAItB,EAAOwE,GACxBhL,KAAKmK,MAAMvI,KAAKkG,GAChB9H,KAAK+H,QAAQD,EAAKhC,MAAQgC,EAC1B9H,KAAKqK,QAAQzI,KAAKkG,GAClB9H,KAAKsK,UAAUxC,EAAKhC,MAAQgC,MACvB,CACL,IAAMA,EAAO,IAAIP,EAAYyD,GAC7BhL,KAAKmK,MAAMvI,KAAKkG,GAChB9H,KAAK+H,QAAQD,EAAKhC,MAAQgC,GAI9B,IAAK,IAAIoD,KAAc7E,EAAIkE,QAAS,CAClC,IAAMnD,EAAS,IAAI8B,EAAO7C,EAAIkE,QAAQW,GAAalL,MAEnD,IAAK,IAAImL,KAAcnL,KAAKyK,UAAW,CACrC,IAAMT,EAAShK,KAAKyK,UAAUU,GAE1B,mBAAoBnB,GAAUA,EAAOoB,eAAehE,IACtDA,EAAOmC,OAAO3H,KAAKoI,GAGvB,GAAK5C,EAAOmC,OAAOzE,OAOnB,GADoBsC,EAAOiC,SAASgC,MAAK,SAACnI,GAAD,OAAOA,EAAEyE,OAAO2D,gBACzD,CAKAtL,KAAKwK,UAAUpD,EAAOtB,MAAQsB,EAC9BpH,KAAKuK,QAAQ3I,KAAKwF,GAvBgB,2BAyBlC,YAAuBA,EAAOgC,YAA9B,+CAA2C,SAC9BtB,KAAKxB,OAAO1E,KAAKwF,IA1BI,6GA4BlC,YAAoBA,EAAOiC,SAA3B,+CAAqC,SAC3BvB,KAAKvB,OAAO3E,KAAKwF,IA7BO,wFAkBhC4B,QAAQuC,MAAM,uBAAwBnE,EAAOtB,KAAMsB,QANnD4B,QAAQwC,KAAK,8BAA+BpE,EAAOtB,KAAMsB,GAqB7DpH,KAAK0K,YAAcb,EAAkB7J,KAAK8J,UAC1Cd,QAAQyC,IAAR,oBAAyBzL,KAAKmK,MAAMrF,OAApC,WACAkE,QAAQyC,IAAR,oBAAyBzL,KAAKoK,OAAOtF,OAArC,YACAkE,QAAQyC,IAAR,oBAAyBzL,KAAKuK,QAAQzF,OAAtC,aACAkE,QAAQyC,IAAR,oBAAyBzL,KAAK8J,SAAShF,OAAvC,cACAkE,QAAQ0C,WApGZ,yDAuGe5D,GACX,IAAI6D,EAAa,GACbC,EAAgB,GACdC,EAAQ7L,KAAKqG,IAAIyF,OAAOhE,EAAKzB,IAAIwF,OAKvC,OAJIA,IACFF,EAAaE,EAAME,MACnBH,EAAgBC,EAAMG,UAAUlE,EAAKzB,IAAI4F,WAAa,IAEjD,CAACN,EAAYC,EAAe9D,EAAKzB,IAAI0F,MAAOjE,EAAKzB,IAAIP,QA/GhE,iCAuHgBoG,EAAiBC,GAAwC,IAAD,OAkBpED,EAAWE,MAjBI,SAAC1J,EAAMC,GACpB,IAAM0J,EAAU,EAAKC,aAAaH,EAAMzJ,IAClC6J,EAAU,EAAKD,aAAaH,EAAMxJ,IAExC,IAAK,IAAM6J,KAAKH,EAAS,CACvB,IAAMI,EAAOJ,EAAQG,GACfE,EAAOH,EAAQC,GACrB,GAAIC,EAAOC,EACT,OAAO,EACF,GAAID,EAAOC,EAChB,OAAQ,EAIZ,OAAO,SAtIb,K,gCC3TO,SAASC,EACdC,EACAjN,GAEA,IAEIkN,EAFE1D,EAAWyD,aAAiBE,EAAcF,EAAMzD,SAAWyD,EAajE,OATEC,EADE1D,KAAYxJ,EAAMoN,SAASC,mBACZrN,EAAMoN,SAASC,mBAAmB7D,GAElCxJ,EAAMsN,SAASvC,YAAYvB,GAAU,GAGpDyD,aAAiBE,GACnB3L,GAAiD,IAA1CyL,EAAMrD,OAAOjE,QAAQuH,IAGvBA,ECeF,IAAMK,EAAyB,CACpCD,SAAW,CAAEE,cAAc,GAC3BrB,OAAQ,CACN,CACEhG,KAAM,YACNsH,KAAM,KAGVL,SAAU,CACRC,mBAAoB,IAGtBK,eAAgB,EAChBC,kBAAczN,GAGhB,SAAS0N,GAAe5N,GACtB,OAAOA,EAAMmM,OAAOnM,EAAM0N,gBAG5B,SAASG,GAAY7N,EAAiB8N,GACpC,IAAM3B,EAASnM,EAAMmM,OAAOrC,KAAI,SAACiE,EAAUrI,GACzC,OAAOA,IAAU1F,EAAM0N,eAAhB,eACEK,EADF,GACeD,GAClBC,KAGN,OAAO,eAAK/N,EAAZ,CAAmBmM,W,OAGqB6B,YAAaT,EAAbS,CAA2B,CACnEC,aAAc,SAACC,GAAD,OAAiC,SAAClO,GAC9C,OAAO,eAAKA,EAAZ,GAAsBkO,KAGxBC,OAAQ,SAACC,GAAD,OAAwB,SAACpO,GAC/B,IAAMkM,EAAQ0B,GAAe5N,GAE7B,IAAIkM,EAAMuB,KAAK/B,MAAK,SAACpG,GAAD,OAAOA,EAAEmC,OAAOtB,OAASiI,EAAI3G,OAAOtB,QAIxD,OAAO0H,GAAY7N,EAAO,CAAEyN,KAAK,GAAD,mBAAMvB,EAAMuB,MAAZ,CAAkBW,QAGpDC,UAAW,SAACxB,EAAWyB,GAAZ,OAAgD,SAACtO,GAC1D,IAAMkM,EAAQ0B,GAAe5N,GACvByN,EAAOc,MAAMC,KAAKtC,EAAMuB,MAE9B,OADAA,EAAKZ,GAAL,eAAeX,EAAMuB,KAAKZ,GAA1B,GAAiCyB,GAC1BT,GAAY7N,EAAO,CACxByN,KAAMA,MAIVgB,UAAW,SAAC5B,GAAD,OAAe,SAAC7M,GACzB,IAAMkM,EAAQ0B,GAAe5N,GACvByN,EAAOc,MAAMC,KAAKtC,EAAMuB,MAE9B,OADAA,EAAKiB,OAAO7B,EAAG,GACRgB,GAAY7N,EAAO,CACxByN,KAAMA,MAIVkB,QAAS,SAACC,EAAkBC,GAAnB,OAAwC,SAAC7O,GAChD,IAAMkM,EAAQ0B,GAAe5N,GACvByN,EAAOc,MAAMC,KAAKtC,EAAMuB,MAF4B,EAIxCA,EAAKiB,OAAOE,EAAU,GAAjCE,EAJmD,oBAO1D,OAFArB,EAAKiB,OAAOG,EAAU,EAAGC,GAElBjB,GAAY7N,EAAO,CACxByN,KAAMA,MAIVsB,qBAAsB,SAACvF,EAAUwF,GAAX,OAA0B,SAAChP,GAC/C,IAAMiP,EAAajC,EAAkBxD,EAAUxJ,GAEzCmM,EAASnM,EAAMmM,OAAOrC,KAAI,SAACoC,GAC/B,IAAMuB,EAAOvB,EAAMuB,KAAK3D,KAAI,SAACsE,GAC3B,OAAIA,EAAI3G,OAAO+B,WAAaA,GAAY4E,EAAIc,UAAYD,EAC/Cb,EAEF,eACFA,EADL,CAEEc,QAASF,OAIb,OAAO,eAAK9C,EAAZ,CAAmBuB,YAGrB,OAAO,eACFzN,EADL,CAEEmM,SACAiB,SAAS,eACJpN,EAAMoN,SADH,CAENC,mBAAmB,eACdrN,EAAMoN,SAASC,mBADF,eAEf7D,EAAWwF,UAMpBG,eAAgB,SAACC,GAAD,OAAsB,SAACpP,GACrC,OAAO,eAAKA,EAAZ,CAAmB0N,eAAgB0B,MAGrCC,SAAU,SAAClJ,GAAD,OAAU,SAACnG,GACnB,IAAMmM,EAAM,sBACPnM,EAAMmM,QADC,CAEV,CACEhG,OACAsH,KAAM,MAIV,OAAO,eACFzN,EADL,CAEEmM,SACAuB,eAAgB1N,EAAMmM,OAAOhH,WAIjCmK,YAAa,SAAC5J,EAAeS,GAAhB,OAAiC,SAACnG,GAC7C,IAAMmM,EAAM,YAAOnM,EAAMmM,QAEzB,OADAA,EAAOzG,GAAP,eAAqByG,EAAOzG,GAA5B,CAAoCS,SAC7B,eACFnG,EADL,CAEEmM,aAIJoD,YAAa,SAAC7J,GAAD,OAAmB,SAAC1F,GAE/B,IAAMmM,EAAM,YAAOnM,EAAMmM,QACzBA,EAAOuC,OAAOhJ,EAAO,GAGhByG,EAAOhH,QACVgH,EAAOlK,KAAK,CACVkE,KAAM,YACNsH,KAAM,KAKV,IAAM+B,EAAWrD,EAAOhH,OAAS,EAC3BuI,EAAiB/K,KAAKyB,IAAIpE,EAAM0N,eAAgB8B,GAEtD,OAAO,eACFxP,EADL,CAEEmM,SACAuB,qBAIJ+B,gBAAiB,SAAC9B,GAAD,OAAgC,SAAC3N,GAChD,OAAO,eACFA,EADL,CAEE2N,qB,qBAnIQ+B,G,MAAeC,G,MA0IhBC,GAAW,SACtBC,GASA,OAL6C,SAAC9P,GAAgB,IAAD,EAClC4P,KADkC,mBACpD3P,EADoD,KAC7C8P,EAD6C,KAE3D,OAAO,kBAACD,EAAD,eAAc7P,MAAOA,EAAO8P,QAASA,GAAa/P,MAUhDgQ,GAAW,SACtBF,GASA,OAL6C,SAAC9P,GAAgB,IAAD,EAC3C4P,KAAT3P,EADoD,oBAE3D,OAAO,kBAAC6P,EAAD,eAAcvC,SAAUtN,EAAMsN,UAAcvN,M,SCzJvD,SAASiQ,GAAW9D,GAClB,MAAO,CACL/F,KAAM+F,EAAM/F,KACZsH,KAAMvB,EAAMuB,KAAK3D,KAAI,SAACxE,GACpB,MAAO,CAACA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAG7B,WAAY6B,EAAE,GAAIA,EAAE,GAAIA,EAAE,QAgElD,SAAS2K,GAAqB3C,GACnC,IAAM4C,EAAWC,aAAaC,QAAQ,YACtC,IAAKF,EACH,OAAO,KAET,IAAMG,EAAoCC,KAAKC,MAAML,GAKrD,OAJyB,IAArBG,EAASG,UACVH,EAAiBG,QAAU,GAGvBC,GAAYnD,EAAU+C,GAa/B,SAASK,GAAU1Q,GAgCjB,MAAO,CACLwQ,QAAS,EACTtK,KAAM,CAAEiG,OAjCKnM,EAAMmM,OAAOrC,KAAI,SAACoC,GAC/B,MAAO,CACL/F,KAAM+F,EAAM/F,KACZsH,KAAMvB,EAAMuB,KAAK3D,KAAI,SAACsE,GACpB,IAAIuC,EAA6BvC,EAAIc,QAAQhJ,KAAKC,KAelD,OAduB6G,EAAkBoB,EAAI3G,OAAQzH,GAElCkG,KAAKC,OAASwK,IAC/BA,EAAc,MAGY,CAC1BvC,EAAI3G,OAAOtB,KACXwK,EACAvC,EAAIwC,YAAYC,aAChBzC,EAAI1D,QAAQZ,KAAI,SAACgH,GAAD,OAAQA,EAAIA,EAAE3K,KAAO,QACrCiI,EAAI2C,aAAe3C,EAAI2C,aAAa5K,UAAOjG,EAC3CkO,EAAI4C,mBAgBM5D,SATD,CACfC,mBAAoBzL,EAClB5B,EAAMoN,SAASC,oBACf,SAACtK,GAAD,OAAOA,EAAEmD,KAAKC,WAUpB,IAAM8K,GAAa,sBAEZ,SAASC,GAAY5D,GAC1B,IAAM6D,EAAUF,GAAWG,KAAKC,SAASC,SAASC,MAClD,IAAKJ,EACH,OAAO,KAET,IAAMX,EAAUvN,OAAOkO,EAAQ,IAAM,GAEjC1L,EAAM+L,mBAAmBL,EAAQ,IAOrC,OANIX,EAAU,IACZ/K,EAAMgM,mBAAQC,KAAKjM,GAAM,CAAEkM,GAAI,YAK1BlB,GAAYnD,EAAU,CAC3BkD,QAASA,EACTtK,KAJSoK,KAAKC,MAAM9K,KAQxB,SAASmM,GACP5R,GAEA,OAAQA,EAAMwQ,SACZ,KAAK,EACHxQ,EA1NN,SAAmBA,GACjB,MAAO,CACLwQ,QAAS,EACTtK,KAAM,CACJuH,KAAMzN,EAAMkG,KACZkH,SAAU,CACRC,mBAAoB,MAoNdwE,CAAU7R,GAEpB,KAAK,EACHA,EAxMN,SAAmBA,GACjB,MAAO,CACLwQ,QAAS,EACTtK,KAAMlG,EAAMkG,MAqMF4L,CAAU9R,GAEpB,KAAK,EACHA,EA9LN,SAAmBA,GACjB,MAAO,CACLwQ,QAAS,EACTtK,KAAM,CACJkH,SAAUpN,EAAMkG,KAAKkH,SACrBjB,OAAQ,CACN,CACEhG,KAAM,YACNsH,KAAMzN,EAAMkG,KAAKuH,SAsLbsE,CAAU/R,GAEpB,KAAK,EACHA,EA3JN,SAAmBA,GACjB,MAAO,CACLwQ,QAAS,EACTtK,KAAM,CACJkH,SAAUpN,EAAMkG,KAAKkH,SACrBjB,OAAQnM,EAAMkG,KAAKiG,OAAOrC,IAAIkG,MAsJtBgC,CAAUhS,GAEpB,KAAK,EAEH,MACF,QACE,MAAM,IAAI2B,MAAJ,yBAA4B3B,IAGtC,OAAOA,EAGT,SAASyQ,GACPnD,EACA2E,GAEA,IAAMC,EAAWN,GAAuBK,GAAY/L,KAE9ClG,EAAkB,CACtBsN,SAAUA,EAEVF,SAAU+E,GAAoB7E,EAAU4E,EAAS9E,UACjDjB,OAAQ,GAERuB,eAAgB,EAChBC,kBAAczN,GAoChB,OAjCAF,EAAMmM,OAAS+F,EAAS/F,OAAOrC,KAAI,SAACoC,GAClC,MAAO,CACL/F,KAAM+F,EAAM/F,KACZsH,KAAMvB,EAAMuB,KAAK3D,KACf,YAOO,IAAD,mBANJyB,EAMI,KALJoF,EAKI,KAJJC,EAII,KAHJlG,EAGI,KAFJqG,EAEI,KADJC,EACI,KACEvJ,EAAS6F,EAASzC,UAAUU,GAMlC,MAAO,CACL9D,OAAQA,EACRyH,QANcyB,EACZrD,EAASxC,UAAU6F,GACnB3D,EAAkBvF,EAAQzH,GAK5B4Q,YAAatN,EAAS8O,WAAWxB,GACjClG,QAASA,EAAQZ,KAAI,SAACuI,GAAD,OAAQA,EAAI/E,EAAS3C,UAAU0H,GAAK,QACzDtB,aAAcA,EACVzD,EAAS3C,UAAUoG,GACnB,KACJC,WAAYA,GAAc,UAO7BhR,EAGT,SAASmS,GACP7E,EACAgF,GAEA,MAAO,CACLjF,mBAAoBzL,EAClB0Q,EAAWjF,oBACX,SAAClH,GAAD,OAAUmH,EAASxC,UAAU3E,O,iGC1TtBoM,GAAb,4DACEC,SAA+B,GADjC,KAiBEC,SAAW,SAACC,GAAY,IAAD,uBACrB,YAAoB,EAAKF,SAAzB,+CAAmC,EACjCG,EADiC,SACzBD,IAFW,oFAjBzB,uDAGaC,IAEM,IADDtS,KAAKmS,SAAS7M,QAAQgN,IAElCtS,KAAKmS,SAASvQ,KAAK0Q,KANzB,oCAUgBA,GACZ,IAAMjN,EAAQrF,KAAKmS,SAAS7M,QAAQgN,IACrB,IAAXjN,GACFrF,KAAKmS,SAAS9D,OAAOhJ,EAAO,OAblC,KAwBakN,GAAsB,IAAIL,GAC1BM,GAAmB,IAAIN,GACvBO,GAAe,IAAIP,G,SCA1BQ,GAAc,GAEPC,GAAb,YAGE,WAAYjT,GAAkB,IAAD,8BAC3B,4CAAMA,KAHRkT,eAE6B,IAQ7BC,aAAe,WACb,EAAKhS,SAAS,CACZiS,QAAS,EAAKnT,MAAMmT,UAVK,EAc7BC,aAAe,SAACC,GACd,EAAKtT,MAAMuT,SAASD,GAChB,EAAKrT,MAAMmT,QACb,EAAKjS,SAAS,CACZiS,QAAQ,KAlBe,EAuB7BI,gBAAkB,WACZ,EAAKvT,MAAMmT,QACb,EAAKjS,SAAS,CACZiS,QAAQ,KAxBZ,EAAKnT,MAAQ,CACXmT,QAAQ,GAEV,EAAKF,UAAY1R,cALU,EAH/B,sEAkCY,IAYJiS,EAZG,OACDC,EAAYpT,KAAKN,MAAM2T,QAAQhI,MAAK,SAACiI,GACzC,MAAO,WAAYA,IAAWA,EAAOC,YAGjCC,EAAU,CAAC,MAAO,iBAoBxB,OAnBIJ,EACFI,EAAQ5R,KAAK,mBAEb4R,EAAQ5R,KAAK,YAIX5B,KAAKL,MAAMmT,SACbK,EACE,gBAAC,GAAD,CACEM,UAAWzT,KAAK4S,UAChBS,QAASrT,KAAKN,MAAM2T,QACpBK,aAAc1T,KAAKN,MAAMgU,aACzBT,SAAUjT,KAAK+S,aACfY,YAAa3T,KAAKkT,mBAMtB,gCACE,0BACEU,IAAK5T,KAAK4S,UACV9R,UAAW0S,EAAQpT,KAAK,KACxBqG,KAAK,SACLoN,QAAS,WACPT,GAAa,EAAKP,iBAGnB7S,KAAKN,MAAMoU,eAAe9T,KAAKN,MAAMsT,WAEvCG,OAvET,GAAiCjS,aAyF3B6S,G,YAOJ,WAAYrU,GAA8B,IAAD,8BACvC,4CAAMA,KAJRsU,eAAgC,KAGS,EAFzCC,aAEyC,IAQzCC,aAAe,SAACrO,GAId,OAHA,EAAKhF,SAAS,CACZsT,MAAOtO,EAAK9E,SAEP8E,GAZgC,EAezCuO,gBAAkB,SAACC,GACjB,IAAK,EAAKJ,QAAQK,QAChB,MAAM,IAAIhT,MACR,8DAGJ,IAAK+S,EAAME,OACT,MAAM,IAAIjT,MACR,6DAIJ,IAAMiT,EAASF,EAAME,OAChB,EAAKN,QAAQK,QAAQE,SAASD,IAEjC,EAAK7U,MAAMiU,eA9B0B,EAkCzCc,eAAiB,SAACJ,GACZA,EAAMK,UAAYhC,IACpB,EAAKhT,MAAMiU,eApC0B,EA8EzCgB,cAAgB,WACd,OAAO,EAAKjV,MAAM2T,QAAQ5J,KAAI,SAAC6J,EAAQ9G,GACrC,GAAI,WAAY8G,EACd,OACE,sBAAIxS,UAAU,kBAAkBJ,IAAK,QAAU8L,GAC5C8G,EAAOsB,QAId,GAAI,YAAatB,EACf,OAAO,uBAAKxS,UAAU,mBAAmBJ,IAAK,QAAU8L,IAG1D,IAAMgH,EAAU,CAAC,iBAIjB,OAHAF,EAAOuB,QAAUrB,EAAQ5R,KAAK,UAC9B0R,EAAOC,UAAYC,EAAQ5R,KAAK,YAG9B,0BACElB,IAAK4S,EAAO5S,IACZI,UAAW0S,EAAQpT,KAAK,KACxByT,QAAS,kBAAM,EAAKnU,MAAMuT,SAASK,EAAOA,SAC1C7M,KAAK,UAEJ,EAAK/G,MAAMgU,aAAaJ,EAAOA,aApGtC,EAAKW,QAAU/S,cACf,EAAKvB,MAAQ,CACXwU,MAAO,IAJ8B,E,iFAyCvC,GAAInU,KAAKgU,eACP,MAAM,IAAI1S,MAAM,4BAGlB,IAAMwT,EAAc9U,KAAKN,MAAM+T,UAAUa,QACzC,IAAKQ,EACH,MAAM,IAAIxT,MAAM,+CAGlB,IAAMyT,EAAS/U,KAAKiU,QAAQK,QAC5B,IAAKS,EACH,MAAM,IAAIzT,MAAM,6CAGlBtB,KAAKgU,eAAiB,IAAIgB,KAAOF,EAAaC,EAAQ,CACpDE,UAAW,CACTC,WAAY,CAAEC,SAAS,GACvBC,qBAAsB,CACpBD,SAAS,EACT1T,GAAIzB,KAAKkU,iBAKflD,SAASqE,KAAKC,iBAAiB,QAAStV,KAAKoU,iBAC7CpD,SAASqE,KAAKC,iBAAiB,QAAStV,KAAKyU,kB,6CAIzCzU,KAAKgU,iBACPhU,KAAKgU,eAAeuB,wBACpBvV,KAAKgU,eAAiB,MAExBhD,SAASqE,KAAKG,oBAAoB,QAASxV,KAAKoU,iBAChDpD,SAASqE,KAAKG,oBAAoB,QAASxV,KAAKyU,kB,+BAkChD,OACE,uBACE3T,UAAU,qBACVqT,MAAOnU,KAAKL,MAAMwU,MAClBP,IAAK5T,KAAKiU,SAETjU,KAAK2U,qB,GA1HgBzT,aC9GjBuU,GAAb,YAII,WAAY/V,GAAe,IAAD,8BACtB,4CAAMA,KAJVgW,aAG0B,IAF1B1B,oBAE0B,IAmE1B2B,iBAAmB,WACf,EAAK9U,SAAS,CACV+U,UAAU,KArEQ,EAyE1BC,iBAAmB,WACf,EAAKhV,SAAS,CACV+U,UAAU,KAzEd,EAAKF,QAAUxU,cACf,EAAK8S,eAAiB,KACtB,EAAKrU,MAAQ,CACTiW,UAAU,EACVzB,MAAO,CAAE2B,OAAQ,OANC,EAJ9B,0EAeQ,IAAI9V,KAAKgU,eAAT,CAIA,IAAMc,EAAc9U,KAAKN,MAAMqW,WAAWzB,QAC1C,IAAKQ,EACD,MAAM,IAAIxT,MAAM,sBAGpB,IAAM0U,EAAShW,KAAK0V,QAAQpB,QAC5B,IAAK0B,EACD,MAAM,IAAI1U,MAAM,0BAGpBtB,KAAKgU,eAAiB,IAAIgB,KAAOF,EAAakB,EAAQ,CAClDC,UAAW,QACXhB,UAAW,CACPiB,OAAQ,CACJf,SAAS,EACTe,OAAQ,SAEZC,gBAAiB,CACbhB,SAAS,EACTiB,kBAAmB,gBAtCvC,sCA6CYpW,KAAKgU,iBACLhU,KAAKgU,eAAeuB,wBACpBvV,KAAKgU,eAAiB,QA/ClC,yCAmDuBqC,EAAUC,GACrBA,EAAUV,WAAa5V,KAAKL,MAAMiW,WAC9B5V,KAAKL,MAAMiW,SACX5V,KAAKuW,aAELvW,KAAKwW,mBAxDrB,0CA8DQ,IAAM1B,EAAc9U,KAAKN,MAAMqW,WAAWzB,QAC1C,IAAKQ,EACD,MAAM,IAAIxT,MAAM,sBAGpBwT,EAAYQ,iBAAiB,aAActV,KAAK2V,kBAChDb,EAAYQ,iBAAiB,aAActV,KAAK6V,oBApExD,6CAoFQ,IAAMf,EAAc9U,KAAKN,MAAMqW,WAAWzB,QACtCQ,IACAA,EAAYU,oBACR,aACAxV,KAAK2V,kBAETb,EAAYU,oBACR,aACAxV,KAAK6V,qBA5FrB,+BAkGQ,OAAK7V,KAAKL,MAAMiW,SAITa,eACH,uBAAKtC,MAAOnU,KAAKL,MAAMwU,MAAOP,IAAK5T,KAAK0V,SACnC1V,KAAKN,MAAMuB,UAEhB+P,SAASqE,MAPF,SAnGnB,GAA6BnU,aCAhBwV,GAAb,YACI,WAAYhX,GAAe,IAAD,8BACtB,4CAAMA,KAMHiX,aAAe,SAACtC,GACnB,IAAMlP,EAASkP,EAAME,OAA4BpP,MAEjD,GADA,EAAKtE,SAAS,CAAE+V,SAAUzR,IACrBA,EAAM0R,OAAX,CAGA,IAAM1U,EAAMS,OAAOuC,GACf,EAAKzF,MAAMoX,UAAYlU,OAAOoC,UAAU7C,IAGxC,EAAKzC,MAAMqX,cAAgB5U,EAAM,GAGrC,EAAKzC,MAAMsX,SAAS7U,KAlBpB,EAAKxC,MAAQ,CACTiX,SAAUlX,EAAMyF,MAAM/B,YAHJ,EAD9B,sEAyBQ,OACI,yBACItC,UAAU,eACVqE,MAAOnF,KAAKL,MAAMiX,SAClBI,SAAUhX,KAAK2W,aACflQ,KAAK,SACL1C,IAAI,IACJkT,KAAK,UAhCrB,GAAkC/V,iBCGrBgW,GAAb,YACI,WAAYxX,GAAe,IAAD,8BACtB,4CAAMA,KAwBHiX,aAAe,SAACtC,GACnB,IAEI8C,EACAC,EAHEhS,EAAMiP,EAAME,OAAOpP,MAKzB,IACEiS,EAASC,GAAiBjS,GAC1B,MAAOkS,GACPH,EAASG,EAAIjW,QAGX+V,GAAU,EAAK1X,MAAMqX,cAAgBK,EAAO9S,eAC9C8S,OAASvX,EACTsX,EAAS,2BAEX,EAAKtW,SAAS,CAAE+V,SAAUxR,EAAKtF,MAAOqX,IAAU,WAC1CC,GACF,EAAK1X,MAAMsX,SAASI,OAzCxB,EAAKzX,MAAQ,CACXG,MAAO,GACP8W,SAAUW,GAAiB7X,EAAMyF,QAJb,EAD9B,gFASuBqS,GACjB,IAAKxX,KAAKN,MAAMyF,MAAMN,MAAM2S,EAASrS,OAAQ,CAC3C,IAAIiS,EACJ,IACEA,EAASC,GAAiBrX,KAAKL,MAAMiX,UACrC,MAAOU,GACP,OAGGF,EAAOvS,MAAM7E,KAAKN,MAAMyF,QAC3BnF,KAAKa,SAAS,CACZ+V,SAAUW,GAAiBvX,KAAKN,MAAMyF,YApBlD,+BAkDQ,OACI,yBACIrE,UAAW2W,KAAW,eAAgB,CAAE,eAAgBzX,KAAKL,MAAMG,QACnEqF,MAAOnF,KAAKL,MAAMiX,SAClBI,SAAUhX,KAAK2W,aACflQ,KAAK,aAvDrB,GAAmCvF,iBA6DnC,SAASmW,GAAiBjS,GAClB,IAAKA,EAAIyR,OACP,MAAM,IAAIvV,MAAM,UAKlB,GAFc8D,EAAIE,QAAQ,OACRF,EAAIsS,YAAY,KAEhC,MAAM,IAAIpW,MAAM,oBAGlB,OAAO2B,EAAS8O,WAAW3M,GAGnC,SAASmS,GAAiBI,GACxB,IAAMC,EAAMD,EAASE,UAAUzU,WAC/B,OAAIwU,EAAI9S,OAAS,GACR8S,EAGFD,EAASnH,a,wBC9ELsH,GAAb,YAGE,WAAYpY,GAAe,IAAD,8BACxB,4CAAMA,KAHRqY,aAE0B,EAExB,EAAKA,QAAU7W,IAAM8W,YAFG,EAH5B,sEASI,IAAM3T,EAA+B,IAA1BrE,KAAKN,MAAM8B,IAAIwE,SACpBiS,EAA+B,IAA1BjY,KAAKN,MAAM8B,IAAIyE,SAEpBiS,EAAQ,aACZC,QAAS,eACTC,mBAAmB,GAAD,OAAK/T,EAAL,cAAY4T,EAAZ,MAClBI,MAAO,OACPC,OAAQ,QACLtY,KAAKN,MAAMyU,OAGZoE,EACF,yBACE3E,IAAK5T,KAAK+X,QACVlE,QAAS7T,KAAKN,MAAMmU,QACpB2E,MAAOxY,KAAKN,MAAM8Y,MAClB1X,UAAW2W,KAAW1W,KAAO+W,KAAM,aACnC3D,MAAO+D,GALT,QA6BF,OAlBIlY,KAAKN,MAAM+Y,UACbF,EACE,oCACGA,EACD,kBAAC,GAAD,CAAStX,SAAUjB,KAAKN,MAAM+Y,QAAS1C,WAAY/V,KAAK+X,YAK1D/X,KAAKN,MAAMgZ,OACbH,EACE,yBAAKpE,MAAO,CAAEwE,WAAY,SACvBJ,EACD,0BAAMpE,MAAO,CAAEyE,WAAY,QAAU5Y,KAAKN,MAAMgZ,QAK/CH,MAlDX,GAA0BrX,IAAM2X,eCZnBC,GAAc,SAACpZ,GAC1B,OACE,uBAAKoB,UAAU,qBACb,uBAAKA,UAAU,aACb,yBAAIpB,EAAMmP,QAAQ5G,YAClB,2BACA,4CAHF,IAG0BvI,EAAMmP,QAAQhJ,KAAKkT,eAC3C,2BACA,0CALF,IAKwBrZ,EAAMmP,QAAQhJ,KAAKmT,gBCgDpCC,GAAavJ,IAjDH,SAAChQ,GACtB,IAGM0H,EAAS1H,EAAM0H,OAEfgC,EAAchC,EAAOgC,YAAYK,KAAI,SAACZ,EAAY2D,GAAb,OACzC,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAKqH,EAAWf,KAAM4Q,KAAM7P,EAAWZ,gBAEjDoB,EAAWjC,EAAOiC,SAASI,KAAI,SAACyP,EAAS1M,GAAV,OACnC,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAK0X,EAAQpR,KAAM4Q,KAAMQ,EAAQjR,gBAG3CsB,EAASnC,EAAOmC,OAAOE,KAAI,SAACoF,EAASrC,GAAV,OAC/B,gBAAC,GAAD,CACE9L,IAAK8L,EACLhL,IAAKqN,EAAQhJ,KACb4S,QAAS,gBAAC,GAAD,CAAa5J,QAASA,SAInC,OACE,uBAAK/N,UAAU,sBAAsB+S,QArBnB,WAClBnU,EAAMmU,SAAWnU,EAAMmU,QAAQnU,EAAM0H,UAqBnC,uBAAKtG,UAAU,eACb,gBAAC,GAAD,CAAMU,IAAK4F,EAAQsR,KAAMtR,EAAOa,cAElC,uBAAKnH,UAAU,aACb,gBAAC,GAAD,CACEU,IAAK9B,EAAMuN,SAAS5G,IAAI8S,QAAQC,MAA3B,MACLV,KAAMtR,EAAOkC,cAActB,cAE7B,uBAAKmM,MAAO,CAAEkF,MAAO,SAArB,eAEGjQ,GAEH,uBAAK+K,MAAO,CAAEgE,QAAS,iBAAvB,YAEG9O,GAEH,uBAAK8K,MAAO,CAAEmF,MAAO,UACrB,uBAAKnF,MAAO,CAAEwE,WAAY,SAA1B,WAEGpP,QCxCLuK,GAAiB,SAACjF,GACtB,OACE,gBAAC,GAAD,CAAMrN,IAAKqN,EAAQhJ,KAAM4S,QAAS,gBAAC,GAAD,CAAa5J,QAASA,OAItD6E,GAAe,SAAC7E,GACpB,OACE,gBAAC,GAAD,CACErN,IAAKqN,EAAQhJ,KACb4S,QAAS,gBAAC,GAAD,CAAa5J,QAASA,IAC/B6J,KAAM7J,EAAQ5G,cAKPsR,GAAgB,SAAC7Z,GAC5B,IAAM2T,EAAU3T,EAAM8Z,SAAS/P,KAAI,SAACoF,GAAD,MAAc,CAC/CnO,IAAKmO,EAAQhJ,KAAKC,KAClBwN,OAAQzE,EACRgG,OAAQhG,IAAYnP,EAAMsT,aAG5B,OACE,gBAAC,GAAD,CACEK,QAASA,EACTL,SAAUtT,EAAMsT,SAChBC,SAAUvT,EAAMsX,SAChBtD,aAAcA,GACdI,eAAgBA,MCxChB7L,GAAW,CACff,YAAa,qBACbD,aAAc,eACdH,MAAO,QACPK,UAAW,aAGAsS,GAAa,SAAC,GAAoC,IAAlCla,EAAiC,EAAjCA,OACrBma,EAAU,GAChB,IAAK,IAAIC,KAAapa,EAAO8G,IAAIU,OAAQ,CACvC,IAAMC,EAAQzH,EAAO8G,IAAIU,OACvB4S,GACC3S,MACH0S,EAAQ9X,KACN,uBAAKlB,IAAKiZ,GACR,yBACG1R,GAAS0R,GADZ,IACkD,IAC/CzX,EAAe,IAAR8E,EAAa,GAFvB,OAQN,OACE,uBAAKlG,UAAU,oBACb,uBAAKA,UAAU,eACb,yBAAIvB,EAAO0I,aAEb,uBAAKnH,UAAU,aAAa4Y,KCwDrBE,GAAelK,IAxEH,SAAChQ,GACxB,IAAM6Y,EAAO7Y,EAAMuN,SAAS5G,IAAI8S,QAAQC,MAAMS,iBACxCC,EAAQ,IAAItT,EAAO,CACvBC,KAAM,SACNX,KAAM,YACNC,eAAgB,CAAEG,GAAI,aACtBiD,SAAU,QACVpC,OAAQ,GACRF,WAAY,GACZkT,uBAAwB,GAExB9T,SAAUsS,EAAKtS,SACfD,SAAUuS,EAAKvS,SAEf6F,MAAO,GACPI,SAAU,GACVF,MAAO,KAyBHsH,EAAU3T,EAAMuN,SAAS5C,QAC5B2P,QAAO,SAACvJ,GAEP,QAAI/Q,EAAMua,WAAYxJ,EAAE9J,QAAQM,aAAaqE,eAGtCmF,EAAEyJ,WAAWxa,EAAM0H,WAE3BqC,KAAI,SAACgH,GAAD,MAAQ,CACX/P,IAAK+P,EAAE3K,KACPwN,OAAQ7C,EACRoE,OAAQpE,IAAM/Q,EAAMsT,aASxB,OANAK,EAAQ8G,QAAQ,CACdzZ,IAAK,YACL4S,OAAQ,KACRuB,QAASnV,EAAMsT,WAIf,gBAAC,GAAD,CACEK,QAASA,EACTL,SAAUtT,EAAMsT,SAChBC,SAAUvT,EAAMsX,SAChBtD,aAvCiB,SAACnU,GACpB,OAAIA,EAEA,gBAAC,GAAD,CACEiC,IAAKjC,EACLkZ,QAAS,gBAAC,GAAD,CAAYlZ,OAAQA,IAC7BmZ,KAAMnZ,EAAO0I,aAIV,gBAAC,GAAD,CAAMzG,IAAKsY,EAAOpB,KAAMoB,EAAM7R,cA8BrC6L,eAhDmB,SAACvU,GACtB,OAAIA,EACK,gBAAC,GAAD,CAAMiC,IAAKjC,EAAQkZ,QAAS,gBAAC,GAAD,CAAYlZ,OAAQA,MAEhD,gBAAC,GAAD,CAAMiC,IAAKsY,UChCXM,GAAb,4DACE/Q,SAA2B,GAD7B,KAEED,YAAiC,GAFnC,KAIEiR,cAAgB,SAACC,GAA6B,IAAD,uBAC3C,YAAmB,EAAKlR,YAAxB,+CAAqC,CAAC,IAA7BmR,EAA4B,QAC/BC,EAAQF,EAAO7T,OAAS8T,EAAO9T,MAAQ6T,EAAOxS,OAASyS,EAAOzS,KAQlE,GAPoB,UAAhBwS,EAAO7T,MAAoC,UAAhB8T,EAAO9T,OACpC+T,EACEA,GACCF,EAAOlS,sBAAwBmS,EAAOnS,qBACrCkS,EAAOnS,sBAAwBoS,EAAOpS,qBAGxCqS,EAEF,YADAD,EAAO5S,OAAS4S,EAAO5S,OAAOnD,IAAI8V,EAAO3S,UAXF,kFAe3C,EAAKyB,YAAYxH,KAAK0Y,IAnB1B,KAsBEG,WAAa,SAACC,GAA2B,IAAD,uBACtC,YAAoB,EAAKrR,SAAzB,+CAAmC,CAAC,IAA3BsR,EAA0B,QAC7BH,EACFE,EAAQjU,OAASkU,EAAQlU,MAAQiU,EAAQ5S,OAAS6S,EAAQ7S,KAK5D,GAJqB,UAAjB4S,EAAQjU,MAAqC,UAAjBkU,EAAQlU,OACtC+T,EAAQA,GAASE,EAAQ3R,cAAgB4R,EAAQ5R,aAG/CyR,EAEF,YADAG,EAAQhT,OAASgT,EAAQhT,OAAOnD,IAAIkW,EAAQ/S,UATV,kFAatC,EAAK0B,SAASzH,KAAK8Y,IAnCvB,mDAsCS3M,GACL,IAAMpH,EAAU,CACdO,YAAajE,EAASW,IACtBuD,UAAWlE,EAASW,IACpBqD,aAAchE,EAASW,IACvBkD,MAAO7D,EAASW,KALO,uBAQzB,YAAmBmK,EAAI1D,QAAvB,+CAAgC,CAAC,IAAxB9K,EAAuB,QACzBA,IACLoH,EAAQO,YAAcP,EAAQO,YAAY1C,IAAIjF,EAAOoH,QAAQO,aAC7DP,EAAQQ,UAAYR,EAAQQ,UAAU3C,IAAIjF,EAAOoH,QAAQQ,WACzDR,EAAQM,aAAeN,EAAQM,aAAazC,IAC1CjF,EAAOoH,QAAQM,cAEjBN,EAAQG,MAAQH,EAAQG,MAAMtC,IAAIjF,EAAOoH,QAAQG,SAf1B,kFAkBzB,GAAIiH,EAAI2C,cAAgB3C,EAAI4C,WAAa,EAAG,CAI1C,IAAMiK,EAAK7M,EAAI2C,aAAa/J,QACtBxE,EAAMc,EAASsC,SAASwI,EAAI4C,WAAY,GAC9ChK,EAAQO,YAAcP,EAAQO,YAAY1C,IAAIoW,EAAG1T,YAAYjD,IAAI9B,IACjEwE,EAAQQ,UAAYR,EAAQQ,UAAU3C,IAAIoW,EAAGzT,UAAUlD,IAAI9B,IAC3DwE,EAAQM,aAAeN,EAAQM,aAAazC,IAAIoW,EAAG3T,aAAahD,IAAI9B,IACpEwE,EAAQG,MAAQH,EAAQG,MAAMtC,IAAIoW,EAAG9T,MAAM7C,IAAI9B,IAIjDwE,EAAQO,YAAcP,EAAQO,YAAY2T,MAAM,GAAK,OACrDlU,EAAQQ,UAAYR,EAAQQ,UAAU0T,MAAM,GAAK,OACjDlU,EAAQG,MAAQH,EAAQG,MAAM+T,MAAM,GAAK,OAGzClU,EAAQM,aAAeN,EAAQM,aAAa4T,MAAM,EAAG,OAErD,IAAMC,EAAiB7X,EAASW,IAC7BK,IAAI8J,EAAI3G,OAAOkC,cAAcyR,UAC7B9W,IAAI8J,EAAIwC,aACRtM,IAAI8J,EAAIc,QAAQhJ,KAAKkT,gBACrB9U,IAAI0C,EAAQG,OAETkU,EAAcF,EAAe7W,IAAI0C,EAAQM,cAE/C8G,EAAI3G,OAAOgC,YACRK,KAAI,SAACZ,GAGJ,OAFAA,EAAahH,EAAMgH,IACRlB,OAASkB,EAAWlB,OAAO1D,IAAI6W,GACnCjS,KAERpI,QAAQT,KAAKqa,eAEhBtM,EAAI3G,OAAOiC,SACRI,KAAI,SAACyP,GAGJ,OAFAA,EAAUrX,EAAMqX,IACRvR,OAASuR,EAAQvR,OAAO1D,IAAI+W,GAC7B9B,KAERzY,QAAQT,KAAKya,cAlGpB,+BAsGI,IAAIrR,EAAcpJ,KAAKoJ,YAAYK,IAAI5H,GACnCwH,EAAWrJ,KAAKqJ,SAASI,IAAI5H,GAF1B,uBAIP,YAAoBwH,EAApB,+CAA8B,CAAC,IAAtB6P,EAAqB,+BAC5B,YAAuB9P,EAAvB,+CAAoC,CAAC,IAA5BP,EAA2B,QAC9BqQ,EAAQvR,OAAOsT,UAAYpS,EAAWlB,OAAOsT,UAG5C/B,EAAQgC,UAAUrS,KAGnBqQ,EAAQvR,OAAOlE,KAAKoF,EAAWlB,SAEjCkB,EAAWlB,OAASkB,EAAWlB,OAAOhE,IAAIuV,EAAQvR,QAClDuR,EAAQvR,OAAS1E,EAASS,MACjBmF,EAAWlB,OAAOlE,KAAKyV,EAAQvR,SAExCuR,EAAQvR,OAASuR,EAAQvR,OAAOhE,IAAIkF,EAAWlB,QAC/CkB,EAAWlB,OAAS1E,EAASS,OAE7BmF,EAAWlB,OAAS1E,EAASS,KAC7BwV,EAAQvR,OAAS1E,EAASS,QAlBF,oFAJvB,kFA8BP,MAAO,CAAE0F,YAHTA,EAAcA,EAAY4Q,QAAO,SAACxN,GAAD,OAAQA,EAAE7E,OAAOsT,YAG5B5R,SAFtBA,EAAWA,EAAS2Q,QAAO,SAAC9W,GAAD,OAAQA,EAAEyE,OAAOsT,iBAjIhD,KCsBME,GAAiB,SAACzb,GAAD,OACrB,uBAAKoB,UAAU,QACb,uBAAKA,UAAU,eACZpB,EAAM8B,IAAIsG,KAAKG,WADlB,KACgCvI,EAAM8B,IAAIsE,KAD1C,OAoTJ,SAASsV,GAAUzD,GACjB,IACIhQ,EADEiQ,EAAMD,EAAS3P,YAAY5E,WAOjC,OAJEuE,EADEiQ,EAAIyD,SAAS,MAAQzD,EAAI9S,OAAS,EAC5B,wBAAM0T,MAAOb,EAASnH,cAAemH,EAAS3P,aAE7C4P,EAEJ,gCAAGjQ,EAAH,UAGF,IAAM2T,GAAY/L,G,2MAxThBgM,kBAAoB,WACzB,EAAK7b,MAAM+P,QAAQrB,UAAU,EAAK1O,MAAM2F,Q,EAGnCmW,oBAAsB,SAAC3M,GAC5B,EAAK4M,YAAY,CACf5M,QAASA,EACTxE,QAAS,EAAK3K,MAAM2K,QACjB2P,QAAO,SAACza,GAAD,OAAuB,OAAXA,KACnBwF,MAAM,EAAG8J,EAAQhJ,KAAKmT,iB,EAItB0C,wBAA0B,SAACvZ,GAChC,EAAKsZ,YAAY,CAAElL,YAAapO,K,EAG3BwZ,uBAAyB,SAACxZ,GAC/B,EAAKsZ,YAAY,CAAE9K,WAAYxO,K,EAG1ByZ,oBAAsB,WAC3B,EAAKH,YAAY,CACfpR,QAAS,IAAI6D,MAAM,EAAKxO,MAAMmP,QAAQhJ,KAAKmT,cAAc6C,KACvD,EAAKnc,MAAM2K,QAAQ,O,EAKlByR,gBAAkB,SAACzW,EAAe9F,GACvC,IAAM8K,EAAU,EAAK3K,MAAM2K,QAAQtF,QACnCsF,EAAQhF,GAAS9F,EACjB,EAAKkc,YAAY,CAAEpR,QAASA,K,EAGvB0R,sBAAwB,SAACxc,GAC9B,EAAKkc,YAAY,CAAE/K,aAAcnR,K,EAG5Byc,sBAAwB,SAC7BnT,EACAwL,GAEA,GAAIA,EAAM4H,SAOR,OANA5H,EAAM6H,iBACN7H,EAAM8H,uBACN,EAAKzc,MAAM+P,QAAQL,gBAAgB,CACjCtH,KAAMe,EAAWf,KACjBH,OAAQkB,EAAWlB,SAIe,IAAlCkB,EAAWf,KAAKvB,OAAOzB,OACzBsX,GAAoBhK,SAASvJ,EAAWf,KAAKvB,OAAO,IAEpD6V,GAA2BhK,SAASvJ,I,EAIjCwT,mBAAqB,SAC1BnD,EACA7E,GAEA,GAAIA,EAAM4H,SAOR,OANA5H,EAAM6H,iBACN7H,EAAM8H,uBACN,EAAKzc,MAAM+P,QAAQL,gBAAgB,CACjCtH,KAAMoR,EAAQpR,KACdH,OAAQuR,EAAQvR,SAIe,IAA/BuR,EAAQpR,KAAKxB,OAAOxB,OACtBsX,GAAoBhK,SAAS8G,EAAQpR,KAAKxB,OAAO,IAEjD8V,GAAwBhK,SAAS8G,I,EAIrCoD,sBAAsD,SAACjI,GAAW,IACxD/G,EAAiB,EAAK5N,MAAMC,MAA5B2N,aACR,GAAK+G,EAAM4H,UAAa3O,EAAxB,CAGA+G,EAAM6H,iBACN7H,EAAM8H,kBACN,IAEI7H,EAFEiI,EAAS,EAAKC,YAapB,GANAlI,GAJAA,EAAUiI,EAAOnT,YAAYqT,MAAK,SAACpY,GACjC,OAAOA,EAAEyD,KAAKhC,OAASwH,EAAaxF,KAAKhC,UAKzCyW,EAAOlT,SAASoT,MAAK,SAACpY,GACpB,OAAOA,EAAEyD,KAAKhC,OAASwH,EAAaxF,KAAKhC,QAG7C,CAQA,IAAM4W,EAASpP,EAAa3F,OACzBtE,IAAIiR,EAAQ3M,QACZ1D,IAAI,EAAKvE,MAAM6Q,aAClB,EAAKkL,YAAY,CACflL,YAAamM,SAXb1T,QAAQlJ,MAAR,yBACoBwN,EAAaxF,KAAKhC,KADtC,cAEEyW,K,2EAaMI,GACV3c,KAAKN,MAAM+P,QAAQzB,UAAUhO,KAAKN,MAAM2F,MAAOsX,K,kCAI/C,IAAMC,EAAI,IAAIxC,GAEd,OADAwC,EAAE9O,OAAO9N,KAAKN,OACP,CACL0J,YAAawT,EAAExT,YACfC,SAAUuT,EAAEvT,Y,sCAQd,IAJe,IAAD,OACRwT,EAAW7c,KAAKN,MAAMmP,QAAQhJ,KAAKmT,aAEnC8D,EAAQ,GAHA,WAILtQ,GACP,IAAMjN,EAAS,EAAKG,MAAM2K,QAAQmC,GAClCsQ,EAAMlb,KACJ,gBAACgY,GAAD,CACElZ,IAAK8L,EACLpF,OAAQ,EAAK1H,MAAM0H,OACnB4L,SAAUzT,EACVyX,SAAU,SAACvG,GAAD,OAAO,EAAKqL,gBAAgBtP,EAAGiE,QAPtCjE,EAAI,EAAGA,EAAIqQ,EAAUrQ,IAAM,EAA3BA,GA0BT,OAdIqQ,EAAW,GACbC,EAAMzO,OACJ,EACA,EACA,0BACEwF,QAAS7T,KAAK4b,oBACdlb,IAAI,aACJI,UAAU,OAHZ,WAUGgc,I,sCAIP,OACE,uBAAKhc,UAAU,oBACb,uBAAKA,UAAU,eACb,uBAAKA,UAAU,uBACb,wBAAMA,UAAU,oBAAhB,mBAEF,gBAAC,GAAD,CACEqE,MAAOnF,KAAKN,MAAMiR,WAClBqG,SAAUhX,KAAK2b,uBACf5E,cAAc,EACdD,SAAS,IAEX,uBAAKhW,UAAU,uCACb,gBAAC8Y,GAAD,CACEK,UAAU,EACV7S,OAAQpH,KAAKN,MAAM0H,OACnB4L,SAAUhT,KAAKN,MAAMgR,aACrBsG,SAAUhX,KAAK+b,6B,uCASzB,OACE,uBAAKjb,UAAU,oBACb,uBAAKA,UAAU,cAAc+S,QAAS7T,KAAKsc,uBACzC,gBAAC,GAAD,CACEnX,MAAOnF,KAAKN,MAAM6Q,YAClByG,SAAUhX,KAAK0b,wBACf3E,cAAc,IAEhB,uBAAKjW,UAAU,uCACb,gBAAC,GAAD,CACE0Y,SAAUxZ,KAAKN,MAAM0H,OAAOmC,OAC5ByJ,SAAUhT,KAAKN,MAAMmP,QACrBmI,SAAUhX,KAAKwb,2B,+BAQjB,IAAD,OACDpU,EAASpH,KAAKN,MAAM0H,OACpBmV,EAASvc,KAAKwc,YAEdpT,EAAcmT,EAAOnT,YAAYK,KAAI,SAACZ,EAAY2D,GAAb,OACzC,uBAAK1L,UAAU,OAAOJ,IAAK8L,GACzB,gBAAC,GAAD,CACEqH,QAAS,EAAKmI,sBAAsBe,KAAK,KAAMlU,GAC/C4P,QAAS,gBAAC,GAAD,CAAgBjX,IAAKqH,IAC9BrH,IAAKqH,EAAWf,KAChB4Q,KAAM0C,GAAUvS,EAAWlB,cAI3B0B,EAAWkT,EAAOlT,SAASI,KAAI,SAACyP,EAAS1M,GAAV,OACnC,uBAAK1L,UAAU,OAAOJ,IAAK8L,GACzB,gBAAC,GAAD,CACEqH,QAAS,EAAKwI,mBAAmBU,KAAK,KAAM7D,GAC5CT,QAAS,gBAAC,GAAD,CAAgBjX,IAAK0X,IAC9B1X,IAAK0X,EAAQpR,KACb4Q,KAAM0C,GAAUlC,EAAQvR,cAI9B,OACE,gBAAC,KAAD,CAAWqV,YAAa5V,EAAOtB,KAAMT,MAAOrF,KAAKN,MAAM2F,QACpD,SAAC4X,GAAD,OACC,qCACEnc,UAAU,uBACV8S,IAAKqJ,EAASC,UACVD,EAASE,gBAEb,qCAAKrc,UAAU,eAAkBmc,EAASG,iBACxC,uBAAKjJ,MAAO,CAAEkF,MAAO,SACnB,gBAAC,GAAD,CACE7X,IAAK4F,EACLsR,KAAMtR,EAAOa,WACbwQ,QAAS,gBAACQ,GAAD,CAAY7R,OAAQA,OAGjC,uBAAK+M,MAAO,CAAEkF,MAAO,UACnB,gBAACgE,GAAA,EAAD,CACEC,QAAQ,SACRzJ,QAAS,EAAK0H,kBACdlU,KAAK,MAHP,WAQF,uBAAK8M,MAAO,CAAEmF,MAAO,WAEvB,uBAAKxY,UAAU,aACb,uBAAKqT,MAAO,CAAEkF,MAAO,SAClB,EAAKkE,iBACN,uBAAKzc,UAAU,mCACZ,EAAK0c,iBAEP,EAAKC,iBAGR,uBAAKtJ,MAAO,CAAEkF,MAAO,UACnB,uBACEvY,UAAU,OACVqT,MAAO,CACLgE,QAAS,eACTkB,MAAO,OACPqE,SAAU,UAGZ,yCACCtU,GAGH,uBACEtI,UAAU,OACVqT,MAAO,CACLgE,QAAS,eACTuF,SAAU,UAGZ,sCACCrU,IAGL,uBAAK8K,MAAO,CAAEmF,MAAO,mB,GArSRpY,c,qECzB3B,SAASyc,GAAMvW,EAAqB1G,GAClC,OAAQA,GACN,IAAK,WACH,OAAO0G,EAAOa,WAChB,IAAK,OACH,OAAOb,EAAOtB,MAIpB,IAAM8X,GAAc,4CAYPC,GAAb,2MAEEC,SAAW5c,cAFb,EAIEvB,MAAe,CACboe,MAAO,GACPjN,QAAS,IANb,EAoBSkL,sBAAwB,SAACnT,GAC9B,IACsC,EADhCmV,EAAI,mBAAenV,EAAW/C,MAC/B,EAAKnG,MAAMoe,MAAM1C,SAAS2C,KAC7B,EAAKC,SAAL,UAAiB,EAAKte,MAAMoe,MAA5B,YAAqCC,IAAQ,WAC3C,EAAKE,sBAEP,YAAKJ,SAASxJ,eAAd,SAAuB6J,mBA1B7B,EA8BS9B,mBAAqB,SAACnD,GAC3B,IACsC,EADhC8E,EAAI,mBAAe9E,EAAQpT,MAC5B,EAAKnG,MAAMoe,MAAM1C,SAAS2C,KAC7B,EAAKC,SAAL,UAAiB,EAAKte,MAAMoe,MAA5B,YAAqCC,IAAQ,WAC3C,EAAKE,sBAEP,YAAKJ,SAASxJ,eAAd,SAAuB6J,mBApC7B,EAwCSC,iBAAmB,SAAC/J,GACzB,IAAME,EAASF,EAAME,OACrB,EAAK0J,SAAS1J,EAAOpP,QA1CzB,EA6CSkZ,kBAAoB,SAACjX,GAC1B,EAAK1H,MAAM4e,aAAalX,GACxB,EAAK6W,SAAS,KA/ClB,EAkDSA,SAAW,SAACF,EAAeQ,GAC3BR,EAAMlH,QAUT,EAAKhW,SAAS,CAAEkd,MAAOA,GAASQ,GAChC,EAAKC,wBAVL,EAAKA,oBAAoBC,SACzB,EAAK5d,SACH,CACEkd,MAAO,GACPjN,QAAS,IAEXyN,KA1DR,EA4HEC,oBAAsBE,KAAS,EAAKR,iBAAiBnB,KAAtB,iBAAkC,KA5HnE,mFAUIX,GAA2BuC,WAAW3e,KAAKgc,uBAC3CI,GAAwBuC,WAAW3e,KAAKqc,sBAX5C,6CAeIrc,KAAKwe,oBAAoBC,SACzBrC,GAA2BwC,cAAc5e,KAAKgc,uBAC9CI,GAAwBwC,cAAc5e,KAAKqc,sBAjB/C,yCAmEI,IAAI0B,EAAQ/d,KAAKL,MAAMoe,MAAMlH,OAAOgI,cACpC,GAAKd,EAAL,CAKA,IAAMe,EAAa,CACjBC,SAAU,GACVC,SAAU,IAKZjB,EAAQA,EACLkB,QAAQrB,IAAa,SAACvH,EAAG3V,EAAKyE,GAE7B,OADA2Z,EAAWpe,GAAakB,KAAKuD,GACtB,MAER0R,OAEH,IAAItM,EAAUvK,KAAKN,MAAM6K,QAiBzB,IAhBIuU,EAAWC,SAASja,QAAUga,EAAWE,SAASla,UACpDyF,EAAUA,EAAQyP,QAAO,SAAC5S,GAAY,IAAD,uBACnC,IADmC,IACnC,EADmC,iBAC1BtB,EAD0B,QAEjC,IAAKsB,EAAOgC,YAAYiC,MAAK,SAACmB,GAAD,OAAOA,EAAE1G,OAASA,KAC7C,MAAM,CAAN,GAAO,IAFX,EAAiBgZ,EAAWC,SAA5B,+CAAsC,CAAC,IAAD,yCADH,6GAMnC,IANmC,IAMnC,EANmC,iBAM1BjZ,EAN0B,QAOjC,IAAKsB,EAAOiC,SAASgC,MAAK,SAACmB,GAAD,OAAOA,EAAE1G,OAASA,KAC1C,MAAM,CAAN,GAAO,IAFX,EAAiBgZ,EAAWE,SAA5B,+CAAsC,CAAC,IAAD,yCANH,kFAWnC,OAAO,MAIPjB,EAeFxT,EAda,IAAI2U,KAAK3U,EAAS,CAC7B4U,YAAY,EACZxB,MAAOA,GACPnd,KAAM,CACJ,CACEsF,KAAM,WACNsZ,OAAQ,IAEV,CACEtZ,KAAM,OACNsZ,OAAQ,OAICC,OAAOtB,GAExB/d,KAAKa,SAAS,CAAEiQ,QAASvG,SApDvBvK,KAAKa,SAAS,CAAEiQ,QAAS,OArE/B,sCA8HmB,IAAD,OACd,IAAK9Q,KAAKL,MAAMmR,QAAQhM,OACtB,MAAO,GAET,IAAIgM,EAAU9Q,KAAKL,MAAMmR,QAIzB,OAHIA,EAAQhM,OAAS,MACnBgM,EAAUA,EAAQ/L,MAAM,EAAG,MAG3B,yBAAOjE,UAAU,qBACf,6BACE,0BACE,oCACA,kCACA,yCACA,wCAGJ,6BACGgQ,EAAQrH,KAAI,SAACxE,GAAD,OACX,gBAAC,GAAD,CACEmC,OAAQnC,EACRvE,IAAKuE,EAAEa,KACP+N,QAAS,EAAKwK,2BArJ5B,+BA8JI,OACE,uBAAKvd,UAAWC,KAAO8c,cACrB,2BACE,yBACEjK,IAAK5T,KAAK8d,SACVhd,UAAU,gCACVwe,YAAY,6BACZna,MAAOnF,KAAKL,MAAMoe,MAClB/G,SAAUhX,KAAKoe,oBAGlBpe,KAAKuf,qBAzKd,GAAkCre,iBAoLlC,SAASse,GAAKnK,GACZ,OACE,uBAAKvU,UAAU,QACb,uBAAKA,UAAU,aAAauU,I,IAK5BoK,G,2MACJC,eAAiB,WACf,EAAKhgB,MAAMmU,QAAQ,EAAKnU,MAAM0H,S,wEAI9B,IAAMA,EAASpH,KAAKN,MAAM0H,OACpBgC,EAAchC,EAAOgC,YAAYK,KAAI,SAACkW,EAAKnT,GAAN,OACzC,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAKme,EAAI7X,KAAM2Q,QAAS+G,GAAKG,EAAI1X,iBAE3CoB,EAAWjC,EAAOiC,SAASI,KAAI,SAACmW,EAAMpT,GAAP,OACnC,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAKoe,EAAK9X,KAAM2Q,QAAS+G,GAAKI,EAAK3X,iBAEnD,OACE,sBAAI4L,QAAS7T,KAAK0f,gBAChB,sBAAI5e,UAAWC,KAAO8e,YACpB,gBAAC,GAAD,CAAMre,IAAK4F,EAAQsR,KAAMtR,EAAOa,cAElC,0BAAKb,EAAOkC,cAActB,aAC1B,0BAAKoB,GACL,0BAAKC,Q,GApBanI,iB,oBC3KnB,IC1BF4e,GD0BQC,GAAYrQ,IAtCzB,SAAsBhQ,GACpB,IAAMsgB,EAAS,IAAI5F,GADe,uBAElC,YAAgB1a,EAAM0N,KAAtB,+CAA4B,CAAC,IAApBW,EAAmB,QAC1BiS,EAAOlS,OAAOC,IAHkB,wFAMAiS,EAAOC,SAAjC7W,EAN0B,EAM1BA,YAAaC,EANa,EAMbA,SACrB,OAAKD,EAAYtE,QAAWuE,EAASvE,QAIrCpF,EAAMuN,SAASiT,WAAW7W,GAAU,SAACnG,GAAD,OAAOA,EAAE4E,QAG3C,uBAAKhH,UAAS,eAAUC,KAAOgf,YAC7B,uBAAKjf,UAAU,eAAf,mBACA,uBAAKA,UAAU,aACb,uBAAKA,UAAU,mBACb,uBAAKA,UAAU,OACb,uBAAKA,UAAU,OAAf,eAEGsI,EAAYK,KAAI,SAACkW,EAAKnT,GAAN,OACf,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAKme,EAAI7X,KAAM4Q,KAAMiH,EAAI1X,iBAG3C,uBAAKnH,UAAU,OAAf,YAEGuI,EAASI,KAAI,SAACmW,EAAMpT,GAAP,OACZ,gBAAC,GAAD,CAAM9L,IAAK8L,EAAGhL,IAAKoe,EAAK9X,KAAM4Q,KAAMkH,EAAK3X,sBApB9C,+B,oBE2GEkY,GAAc5Q,G,2MA3FzB6Q,iBAAmB,SAAChZ,GAClB,EAAK1H,MAAM+P,QAAQ3B,OAAO,CACxB1G,OAAQA,EACRyH,QAASwR,EAAqBjZ,EAAQ,EAAK1H,MAAMC,OACjD4Q,YAAatN,EAASW,IACtByG,QAAS,GACTqG,aAAc,KACdC,WAAY,K,EAIhB2P,cAAgB,SAAC9c,GACVA,EAAO+c,aAGZ,EAAK7gB,MAAM+P,QAAQnB,QAAQ9K,EAAOgd,OAAOnb,MAAO7B,EAAO+c,YAAYlb,Q,EAGrEob,UAAY,SAAC5a,EAAqBR,GAChC,OAAO,gBAACiW,GAAD,eAAW5a,IAAKmF,EAAKuB,OAAOtB,KAAMT,MAAOA,GAAWQ,K,EAG7D6a,kBAAoB,WAClB,IAAMlU,EAAI,EAAK9M,MAAMC,MAAM0N,eACrBvH,EAAO6a,OACX,6BACA,EAAKjhB,MAAMC,MAAMmM,OAAOU,GAAG1G,MAEzBA,GACF,EAAKpG,MAAM+P,QAAQR,YAAYzC,EAAG1G,I,EAItC8a,kBAAoB,WAClB,IAAMpU,EAAI,EAAK9M,MAAMC,MAAM0N,eACrBxB,EAAQ,EAAKnM,MAAMC,MAAMmM,OAAOU,GAClCqU,OAAOC,QAAP,0CAAkDjV,EAAM/F,QAC1D,EAAKpG,MAAM+P,QAAQP,YAAY1C,I,mFA5CjC4P,GAAoBuC,WAAW3e,KAAKogB,oB,6CAIpChE,GAAoBwC,cAAc5e,KAAKogB,oB,+BA4C/B,IAAD,OAEDW,EADK/gB,KAAKN,MAAMC,MAAMsN,SACA1C,QAAQyP,QAAO,SAAC5S,GAC1C,OAAQ,EAAK1H,MAAMmM,MAAMuB,KAAK/B,MAAK,SAAC0C,GAAD,OAASA,EAAI3G,SAAWA,QAG7D,OACE,uBAAKtG,UAAWC,KAAOof,aACrB,uBAAKrf,UAAU,YACb,sBAAIA,UAAU,cAAcd,KAAKN,MAAMmM,MAAM/F,MAC7C,uBAAKhF,UAAU,eACb,gBAAC,KAAD,CAAUkgB,GAAIC,KAAa5Z,KAAK,MAC9B,gBAACgW,GAAA,EAAD,CAAQC,QAAQ,OAAOzJ,QAAS7T,KAAK0gB,mBAArC,UAIA,gBAAC,KAASQ,OAAV,CAAiBC,OAAK,EAAC7D,QAAQ,OAAO8D,GAAG,iBAEzC,gBAAC,KAASC,KAAV,KACE,gBAAC,KAASC,KAAV,CAAezN,QAAS7T,KAAK4gB,mBAA7B,cAOR,gBAAC,GAAD,CACErW,QAASwW,EACTzC,aAActe,KAAKogB,mBAErB,2BAEA,gBAAC,KAAD,CAAiBmB,UAAWvhB,KAAKsgB,eAC/B,gBAAC,KAAD,CAAWkB,YAAa,QACrB,SAACvE,GAAD,OACC,qCAAKrJ,IAAKqJ,EAASC,UAAcD,EAASwE,gBACvC,EAAK/hB,MAAMmM,MAAMuB,KAAK3D,IAAI,EAAKgX,WAC/BxD,EAASqC,iBAMlB,2BACA,gBAACS,GAAD,CAAW3S,KAAMpN,KAAKN,MAAMmM,MAAMuB,Y,GA9FblM,cCfvBwgB,G,iLAEF,IAAMC,EAAgBphB,OAAOqhB,QAAQ5hB,KAAKN,MAAMuN,SAASvC,aACtDsP,QAAO,SAAC6H,GAAD,OAAWA,EAAM,GAAG/c,OAAS,KACpC2E,KAAI,SAACoY,GAAD,OAAWA,EAAM,MAIxB,OAFAF,EAAcvV,MAAK,SAAC1J,EAAGC,GAAJ,OAAUD,EAAEof,cAAcnf,MAG3C,2BACE,gDACCgf,EAAclY,KAAI,SAAC3D,GAAD,OACjB,gBAACic,GAAD,CAAarhB,IAAKoF,EAAMqD,SAAUrD,Y,GAZlB5E,aAoDpB6gB,GAAcxS,G,2MA1BlBoH,aAAe,SAAC9H,GACd,EAAKnP,MAAM+P,QAAQf,qBAAqB,EAAKhP,MAAMyJ,SAAU0F,I,wEAI7D,IAAM2K,EAAWxZ,KAAKN,MAAMC,MAAMsN,SAASvC,YAAY1K,KAAKN,MAAMyJ,UAC5D6J,EAAWrG,EAAkB3M,KAAKN,MAAMyJ,SAAUnJ,KAAKN,MAAMC,OACnE,OACE,uBAAKmB,UAAU,mBAAmBJ,IAAKV,KAAKN,MAAMyJ,UAChD,uBAAKrI,UAAU,eACb,uBAAKA,UAAU,uBACb,wBAAMA,UAAU,oBAAoBd,KAAKN,MAAMyJ,WAEjD,uBAAKrI,UAAU,uCACb,gBAAC,GAAD,CACE0Y,SAAUA,EACVxG,SAAUA,EACVgE,SAAUhX,KAAK2W,sB,GAlBAzV,cA6BhB8gB,GAAWtS,GAASgS,I,+BF1C5B5B,K,kBAAAA,E,qBAAAA,Q,SAsJQmC,GAAM1S,G,YAhJjB,WAAY7P,GAAe,IAAD,8BACxB,4CAAMA,KAgBRwiB,cAAgB,SAAC7N,GACG,UAAdA,EAAM3T,KACRsQ,SAASqE,KAAK8M,UAAU3d,IAAI,eAnBN,EAsB1B4d,YAAc,SAAC/N,GACK,UAAdA,EAAM3T,KACRsQ,SAASqE,KAAK8M,UAAUE,OAAO,eAxBT,EA4B1BC,iBAAmB,SAAC9V,GAClB,EAAK3L,SAAS,CACZ0hB,WAAYzC,GAAW0C,UAEzB,EAAK9iB,MAAM+P,QAAQX,eAAetC,IAhCV,EAmC1BiW,oBAAoD,SAACpO,GACnDA,EAAM6H,iBACN,IAAMwG,EAAW,kBAAc,EAAKhjB,MAAMC,MAAMmM,OAAOhH,OAAS,GAC1DgB,EAAO6a,OAAO,uCAAwC+B,GACvD5c,GAASA,EAAK+Q,QAGnB,EAAKnX,MAAM+P,QAAQT,SAASlJ,IA1CJ,EA6C1B6c,oBAAsB,WACpB,EAAK9hB,SAAS,CACZ0hB,WAAYzC,GAAWkC,YA/CD,EAoG1BY,cAAgB,WACd,IAAM/W,EAAQ,EAAKnM,MAAMC,MAAMmM,OAAO,EAAKpM,MAAMC,MAAM0N,gBAEvD,OACE,kBAACwV,GAAA,EAAD,CAAW5X,OAAK,GACd,kBAACkV,GAAD,CAAatU,MAAOA,MAzGA,EA8G1BiX,eAAiB,WACf,OACE,kBAACD,GAAA,EAAD,CAAW5X,OAAK,GACd,kBAAC+W,GAAD,QA9GJ,EAAKriB,MAAQ,CACX4iB,WAAYzC,GAAW0C,SAJD,E,iFASxBxR,SAASsE,iBAAiB,UAAWtV,KAAKkiB,eAC1ClR,SAASsE,iBAAiB,QAAStV,KAAKoiB,e,6CAGxCpR,SAASwE,oBAAoB,UAAWxV,KAAKkiB,eAC7ClR,SAASwE,oBAAoB,QAASxV,KAAKoiB,e,qCAqC7B,IAAD,OAGPW,EAFiB/iB,KAAKL,MAAM4iB,aAAezC,GAAWkC,SAGxD,WACAhiB,KAAKN,MAAMC,MAAM0N,eAEf2V,EAAehjB,KAAKN,MAAMC,MAAMmM,OAAOrC,KAAI,SAACoC,EAAOW,GACvD,IAAMqI,EAASkO,IAAcvW,EAC7B,OACE,kBAACyW,GAAA,EAAI3B,KAAL,CAAUzN,QAAS,kBAAM,EAAKyO,iBAAiB9V,IAAI9L,IAAK8L,GACtD,kBAACyW,GAAA,EAAIC,KAAL,CAAUrO,OAAQA,GAAShJ,EAAM/F,UAKvC,OACE,oCACE,kBAACmd,GAAA,EAAD,CAAKniB,UAAU,eACb,kBAACmiB,GAAA,EAAI3B,KAAL,KACE,kBAAC2B,GAAA,EAAIC,KAAL,CAAU3P,UAAQ,GAChB,0BAAM4P,KAAK,MAAMC,aAAW,gBAA5B,gBAEQ,IAHV,cAODJ,EACD,kBAACC,GAAA,EAAI3B,KAAL,KACE,kBAAC2B,GAAA,EAAIC,KAAL,CAAUrP,QAAS7T,KAAKyiB,qBAAxB,kBAIF,kBAACQ,GAAA,EAAI3B,KAAL,KACE,kBAAC2B,GAAA,EAAIC,KAAL,CACErO,OAAsB,aAAdkO,EACRlP,QAAS7T,KAAK2iB,qBAEd,0BAAMQ,KAAK,MAAMC,aAAW,aAA5B,gBAEQ,IANV,iB,+BAkCR,IAAKpjB,KAAKN,MAAMC,MAAMsN,SAAS5G,IAC7B,OAAO,KAET,IAAIgP,EACJ,GAAIrV,KAAKL,MAAM4iB,aAAezC,GAAW0C,QACvCnN,EAAOrV,KAAK4iB,oBACP,IAAI5iB,KAAKL,MAAM4iB,aAAezC,GAAWkC,SAG9C,OrBzJC,SAAqB3d,GAC1B,MAAM,IAAI/C,MAAM,sBAAwB+C,GqBwJ7Bgf,CAAYrjB,KAAKL,MAAM4iB,YAF9BlN,EAAOrV,KAAK8iB,iBAKd,OACE,kBAACD,GAAA,EAAD,CAAW5X,OAAK,GACd,kBAACqY,GAAA,EAAD,KACE,kBAACC,GAAA,EAAD,CAAKC,GAAG,IAAI1iB,UAAW2W,KAAW,aAAc1W,KAAO0iB,UACpDzjB,KAAK0jB,gBAER,kBAACH,GAAA,EAAD,KAAMlO,S,GA1IKnU,IAAMyiB,YGdrBC,G,YACJ,WAAYlkB,GAAe,IAAD,8BACxB,4CAAMA,KACDC,MAAQ,CACXsN,SAAU,MAHY,E,iFAML,IAAD,OAClBjN,KAAK6jB,OAAOC,OAAM,SAACxM,GACjB,EAAKzW,UAAS,WACZ,MAAMyW,U,uIAMayM,MAAM,4B,UACL,OADlBC,E,QACOC,O,sBACL,IAAI3iB,MAAJ,oDACyC0iB,EAASC,S,0CAMzCD,EAASE,Q,OAAxB9M,E,+DAEM,IAAI9V,MAAJ,4C,QAQR,GALM2L,EAAW,IAAIH,EAAcsK,GAEnCpX,KAAKN,MAAM+P,QAAQ7B,aAAa,CAAEX,aAE5BkX,EAAWC,GAA0BnX,GAGzCjN,KAAKN,MAAM+P,QAAQ7B,aAAauW,QAGhC,KACQE,EAAeD,GAAmCnX,KAGtDjN,KAAKN,MAAM+P,QAAQ7B,aAAayW,GAElC,MAAO/M,GACPtO,QAAQlJ,MAAM,qCAAsCwX,GAIxDtX,KAAKa,SAAS,CAAEoM,a,0FAIhB,IAAKjN,KAAKL,MAAMsN,SACd,OAAO,0CAET,IAAMqX,EAAK,8BAA0BtkB,KAAKL,MAAMsN,SAAS5G,IAAI8S,QAAQjI,KAA1D,QACLiD,EAAK,oEAEqBmQ,EAFrB,2BAKX,OACE,oCACE,kBAAC,GAAD,MACA,kBAAC,GAAD,CAAUC,KAAMD,IAChB,+BAAQnQ,GACR,kBAAC8N,GAAD,W,GArEmB/gB,IAAMyiB,WA2E3Ba,GAAwB,WAAO,IAAD,EAClBlV,KAAT3P,EAD2B,oBAQlC,OALA8kB,qBAAU,YnBuEL,SAAqB9kB,GAC1B,IAAMsS,EAAa5B,GAAU1Q,GACvBwQ,EAAU8B,EAAW9B,QACvB/K,EAAM6K,KAAKyU,UAAUzS,EAAWpM,MAEpCT,EAAMuf,KAAKC,mBAAQxf,EAAK,CAAEkM,GAAI,YAE9BuP,OAAOgE,QAAQjX,aAAa,GAAI,GAAhC,WAAwCuC,EAAxC,YAAmD/K,ImB7EjDgf,CAA0BzkB,GnBqDvB,SAA8BA,GACnCmQ,aAAagV,QAAQ,WAAY7U,KAAKyU,UAAUrU,GAAU1Q,KmBrDxDykB,CAAmCzkB,KAClC,CAACA,IAEG,MAGHolB,GAAuC,SAACrlB,GAC5C,OAAO+W,eACL,0BAAMuO,IAAI,WAAWT,KAAM7kB,EAAM6kB,OACjCvT,SAASiU,OAIAC,GAAY3V,GAASqU,I,OClGhCvjB,IAAY,CACV8kB,IAAK,+DAIT1O,SACE,gBAAC,EAAD,KACE,gBAACpH,GAAD,KACE,gBAAC6V,GAAD,QAGJlU,SAASoU,eAAe,U,mBCrB1B7lB,EAAOC,QAAU,CAAC,aAAe,mCAAmC,WAAa,mC,mBCAjFD,EAAOC,QAAU,CAAC,QAAU,gC,mBCA5BD,EAAOC,QAAU,CAAC,KAAO,qB,mBCAzBD,EAAOC,QAAU,CAAC,UAAY,+B,mBCA9BD,EAAOC,QAAU,CAAC,YAAc,oC","file":"static/js/main.390d7432.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sidebar\":\"App_Sidebar__3POeR\"};","import * as React from 'react';\nimport * as Sentry from '@sentry/browser';\n\nimport styles from './ErrorCatcher.module.css';\n\ninterface Props {}\n\ninterface State {\n  crashMsg?: string;\n}\n\nexport class ErrorCatcher extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      crashMsg: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    // Catch errors in any components below and re-render with error message\n    this.crash(\n      [\n        'Component Stack:',\n        errorInfo.componentStack,\n        '',\n        error && error.stack,\n      ].join('\\n')\n    );\n\n    Sentry.withScope((scope) => {\n      Object.keys(errorInfo).forEach((key) => {\n        scope.setExtra(key, errorInfo[key as keyof React.ErrorInfo]);\n      });\n      Sentry.captureException(error);\n    });\n  }\n\n  crash(msg: string) {\n    this.setState({\n      crashMsg: msg,\n    });\n  }\n\n  render() {\n    if (typeof this.state.crashMsg !== 'undefined') {\n      return (\n        <div className={styles.crashed}>\n          <h1>Crashed!</h1>\n          <pre>{this.state.crashMsg}</pre>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","export function assert(check: any, message?: string): void {\n  if (!check) {\n    throw new Error(message || 'Assertion failed');\n  }\n}\n\nexport function assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\nexport function mapValues<T, V>(\n  obj: { [s: string]: T },\n  fn: (v: T) => V\n): { [s: string]: V } {\n  let ret: { [key: string]: V } = {};\n  for (let key in obj) {\n    ret[key] = fn(obj[key]);\n  }\n  return ret;\n}\n\nexport function values<T>(obj: { [s: string]: T }): T[] {\n  const values = [];\n  for (let key in obj) {\n    values.push(obj[key]);\n  }\n  return values;\n}\n\nexport function clone<T>(orig: T): T {\n  return Object.assign(Object.create(Object.getPrototypeOf(orig)), orig);\n}\n\nexport function round2(num: number, places: number) {\n  const mag = Math.pow(10, places);\n  return Math.round(num * mag) / mag;\n}\n","import { assert } from './util';\n\nfunction num_gcd(a: number, b: number): number {\n  return !b ? a : num_gcd(b, a % b);\n}\n\nfunction num_divmod(a: number, b: number) {\n  assert(Number.isSafeInteger(a));\n  assert(Number.isSafeInteger(b));\n\n  return {\n    quotient: Math.floor(a / b),\n    remainder: a % b,\n  };\n}\n\nconst FLOAT_CONVERT_PRECISION = 10000;\n\nexport class Rational {\n  p: number;\n  q: number;\n\n  constructor(p: number, q: number) {\n    assert(Number.isSafeInteger(p), 'Numerator must be an integer');\n    assert(Number.isSafeInteger(q), 'Denominator must be an integer');\n    assert(q !== 0, 'Denominator must not be zero');\n\n    if (q < 0) {\n      p = -p;\n      q = -q;\n    }\n\n    if (p === 0) {\n      q = 1;\n    }\n\n    const div = num_gcd(p, q);\n    if (div > 1) {\n      p = p / div;\n      q = q / div;\n    }\n    this.p = p;\n    this.q = q;\n  }\n\n  //\n  // Operations returning Rational\n  //\n  floor() {\n    const divmod = num_divmod(this.p, this.q);\n    let result = new Rational(divmod.quotient, 1);\n    if (result.less(Rational.zero) && divmod.remainder !== 0) {\n      result = result.sub(Rational.one);\n    }\n    return result;\n  }\n\n  negate() {\n    return new Rational(-this.p, this.q);\n  }\n\n  invert() {\n    return new Rational(this.q, this.p);\n  }\n\n  add(other: Rational) {\n    return new Rational(this.p * other.q + this.q * other.p, this.q * other.q);\n  }\n\n  sub(other: Rational) {\n    return new Rational(this.p * other.q - this.q * other.p, this.q * other.q);\n  }\n\n  mul(other: Rational | number): Rational {\n    if (typeof other == 'number') {\n      other = Rational.fromFloat(other);\n    }\n    return new Rational(this.p * other.p, this.q * other.q);\n  }\n\n  div(other: Rational) {\n    return new Rational(this.p * other.q, this.q * other.p);\n  }\n\n  clamp(min: Rational | number, max: Rational | number) {\n    if (typeof min == 'number') {\n      min = Rational.fromFloat(min);\n    }\n    if (typeof max == 'number') {\n      max = Rational.fromFloat(max);\n    }\n\n    if (this.less(min)) return min;\n    if (max.less(this)) return max;\n    return this;\n  }\n\n  //\n  // Operations NOT returning Rational\n  //\n  divmod(other: Rational) {\n    var quotient = this.div(other);\n    var div = quotient.floor();\n    var mod = this.sub(other.mul(div));\n    return { quotient: div, remainder: mod };\n  }\n\n  equal(other: Rational) {\n    return this.p === other.p && this.q === other.q;\n  }\n\n  isNegative() {\n    return this.p < 0;\n  }\n  isPositive() {\n    return this.p > 0;\n  }\n\n  isOne() {\n    return this.p === 1;\n  }\n\n  isZero() {\n    return this.p === 0;\n  }\n\n  less(other: Rational) {\n    return this.p * other.q < this.q * other.p;\n  }\n\n  toFloat() {\n    return this.p / this.q;\n  }\n\n  // Disabled to force choice between toFraction and toDecimal\n  toString: null;\n\n  toFraction() {\n    if (this.q === 1) {\n      return this.p.toString();\n    }\n    return this.p.toString() + '/' + this.q.toString();\n  }\n\n  toDecimal(maxDigits?: number, roundingFactor?: Rational) {\n    if (maxDigits == null) {\n      maxDigits = 3;\n    }\n    if (roundingFactor == null) {\n      roundingFactor = new Rational(5, 10 ** (maxDigits + 1));\n    }\n\n    let sign = '';\n    let x: Rational = this;\n    if (x.isNegative()) {\n      sign = '-';\n      x = x.negate();\n    }\n    x = x.add(roundingFactor);\n    let divmod = num_divmod(x.p, x.q);\n    var integerPart = divmod.quotient.toString();\n    var decimalPart = '';\n    var fraction = new Rational(divmod.remainder, x.q);\n    let ten = new Rational(10, 1);\n    while (maxDigits > 0 && !fraction.equal(roundingFactor)) {\n      fraction = fraction.mul(ten);\n      roundingFactor = roundingFactor.mul(ten);\n      let divmod = num_divmod(fraction.p, fraction.q);\n      decimalPart += divmod.quotient.toString();\n      fraction = new Rational(divmod.remainder, fraction.q);\n      maxDigits--;\n    }\n    if (fraction.equal(roundingFactor)) {\n      while (decimalPart[decimalPart.length - 1] === '0') {\n        decimalPart = decimalPart.slice(0, decimalPart.length - 1);\n      }\n    }\n    if (decimalPart !== '') {\n      return sign + integerPart + '.' + decimalPart;\n    }\n    return sign + integerPart;\n  }\n\n  //\n  // Statics\n  //\n  static fromFloat(num: number) {\n    if (Number.isInteger(num)) {\n      return new this(num, 1);\n    }\n\n    // Sufficient precision for our data?\n    const r = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n\n    const divmod = r.divmod(Rational.one);\n    for (const [key, value] of lookups) {\n      if (divmod.remainder.equal(key)) {\n        return divmod.quotient.add(value);\n      }\n    }\n\n    return r;\n  }\n  static fromInts(p: number, q: number) {\n    return new this(p, q);\n  }\n  static fromString(str: string) {\n    const index = str.indexOf('/');\n    if (index === -1) {\n      return Rational.fromFloat(Number(str));\n    } else {\n      const p = Number(str.slice(0, index));\n      const q = Number(str.slice(index + 1));\n      return Rational.fromInts(p, q);\n    }\n  }\n\n  static zero = new Rational(0, 1);\n  static one = new Rational(1, 1);\n  static oneThird = new Rational(1, 3);\n  static twoThirds = new Rational(2, 3);\n}\n\nconst lookups: [Rational, Rational][] = [];\n\nfor (let q = 2; q < 100; q++) {\n  for (let p = 1; p < q; p++) {\n    const num = p / q;\n\n    // Is there a better way to quickly filter out non-repeating decimals?\n    if (num.toString().length < 10) {\n      continue;\n    }\n\n    // Support computer input, use proper rounding\n    const rounded = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([rounded, Rational.fromInts(p, q)]);\n\n    // Support human input, who just leave off the end after a while\n    const floored = new Rational(\n      Math.floor(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([floored, Rational.fromInts(p, q)]);\n  }\n}\n","import { Rational } from './rational';\nimport { assert, values } from './util';\n\nimport * as schema from './schema';\n\ntype LocalisedName = schema.LocalisedName;\n\ninterface IBaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n}\n\nexport class BaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n\n  constructor(data: IBaseDisplayable) {\n    this.name = data.name;\n    this.localised_name = data.localised_name;\n    this.icon_col = data.icon_col;\n    this.icon_row = data.icon_row;\n  }\n\n  niceName() {\n    return this.localised_name.en;\n  }\n}\n\nabstract class BaseItem<T extends schema.Item> extends BaseDisplayable {\n  raw: T;\n  usedBy: Recipe[] = [];\n  madeBy: Recipe[] = [];\n\n  constructor(d: T) {\n    super(d);\n    this.raw = d;\n    this.name = d.name;\n    this.localised_name = d.localised_name;\n    this.icon_col = d.icon_col;\n    this.icon_row = d.icon_row;\n  }\n}\n\nexport class Module extends BaseItem<schema.ModuleItem> {\n  type: 'module';\n  limitedTo: Set<string>;\n  effects: {\n    speed: Rational;\n    productivity: Rational;\n    consumption: Rational;\n    pollution: Rational;\n  };\n\n  constructor(d: schema.ModuleItem) {\n    super(d);\n    this.type = d.type;\n    this.limitedTo = new Set(d.limitation);\n\n    this.effects = {\n      speed: Rational.fromFloat((d.effect.speed || { bonus: 0 }).bonus),\n      productivity: Rational.fromFloat(\n        (d.effect.productivity || { bonus: 0 }).bonus\n      ),\n      consumption: Rational.fromFloat(\n        (d.effect.consumption || { bonus: 0 }).bonus\n      ),\n      pollution: Rational.fromFloat((d.effect.pollution || { bonus: 0 }).bonus),\n    };\n  }\n\n  canUseWith(recipe: Recipe) {\n    if (this.limitedTo.size === 0) {\n      return true;\n    }\n\n    return this.limitedTo.has(recipe.name);\n  }\n}\n\nclass GenericItem extends BaseItem<schema.Item> {\n  type: 'generic' = 'generic';\n}\n\nexport type Item = Module | GenericItem;\n\nexport class Fluid extends BaseItem<schema.FluidItem> {\n  default_temperature: number;\n  type: 'fluid' = 'fluid';\n\n  constructor(d: schema.FluidItem) {\n    super(d);\n    this.default_temperature = d.default_temperature;\n  }\n}\n\nabstract class BaseIngredient {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Ingredient) {\n    this.name = d.name;\n    this.amount = Rational.fromFloat(d.amount);\n  }\n}\n\nexport class ItemIngredient extends BaseIngredient {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()} × ${this.item.niceName()}`;\n  }\n}\n\nexport class FluidIngredient extends BaseIngredient {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  minimum_temperature: number;\n  maximum_temperature: number;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n\n    this.minimum_temperature = d.minimum_temperature || -Infinity;\n    this.maximum_temperature = d.maximum_temperature || Infinity;\n\n    if (this.maximum_temperature >= 1.797e308) {\n      this.maximum_temperature = Infinity;\n    }\n    if (this.minimum_temperature <= -1.797e308) {\n      this.minimum_temperature = -Infinity;\n    }\n  }\n\n  niceName() {\n    const min = this.minimum_temperature;\n    const max = this.maximum_temperature;\n    let range = '';\n    if (min !== -Infinity && max !== Infinity) {\n      range = ` (${min}° – ${max}°)`;\n    } else if (max !== Infinity) {\n      range = ` (≤ ${max}°)`;\n    } else if (min !== -Infinity) {\n      range = ` (≥ ${max}°)`;\n    }\n    return `${this.amount.toDecimal()} × ${this.item.niceName()}${range}`;\n  }\n}\n\nexport type Ingredient = ItemIngredient | FluidIngredient;\n\nabstract class BaseProduct {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Product) {\n    this.name = d.name;\n\n    let amount;\n    if ('amount' in d) {\n      amount = Rational.fromFloat(d.amount);\n    } else {\n      amount = Rational.fromInts(d.amount_min + d.amount_max, 2);\n    }\n\n    if (typeof d.probability == 'number') {\n      if (d.probability === 0) {\n        amount = Rational.zero;\n      } else if (d.probability !== 1) {\n        assert(d.probability > 0);\n        assert(d.probability < 1);\n        amount = amount.mul(Rational.fromFloat(d.probability));\n      }\n    }\n    this.amount = amount;\n  }\n}\n\nexport class ItemProduct extends BaseProduct {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()} × ${this.item.niceName()}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return ingredient.type === 'item' && ingredient.item === this.item;\n  }\n}\n\nexport class FluidProduct extends BaseProduct {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  temperature: number;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n    if (!this.item) {\n      console.error('could not find item', d);\n    }\n    this.temperature = d.temperature || this.item.default_temperature;\n  }\n\n  niceName() {\n    let temp = '';\n    if (this.temperature !== this.item.default_temperature) {\n      temp = ` (${this.temperature}°)`;\n    }\n    return `${this.amount.toDecimal()} × ${this.item.niceName()}${temp}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return (\n      ingredient.type === 'fluid' &&\n      ingredient.item === this.item &&\n      ingredient.maximum_temperature >= this.temperature &&\n      ingredient.minimum_temperature <= this.temperature\n    );\n  }\n}\n\nexport type Product = ItemProduct | FluidProduct;\n\nexport class Recipe extends BaseDisplayable {\n  category: string;\n  ingredients: Ingredient[];\n  products: Product[];\n  crafting_time: Rational;\n\n  madeIn: AssemblingMachine[] = [];\n\n  constructor(d: schema.Recipe, gd: GameData) {\n    super(d);\n    this.name = d.name;\n    this.category = d.category;\n    this.crafting_time = Rational.fromFloat(d.energy_required);\n\n    this.ingredients = d.ingredients.map((ingredient) => {\n      if (ingredient.type === 'fluid') {\n        return new FluidIngredient(ingredient, gd);\n      } else {\n        return new ItemIngredient(ingredient, gd);\n      }\n    });\n\n    this.products = d.results.map((result) => {\n      if (result.type === 'fluid') {\n        return new FluidProduct(result, gd);\n      } else {\n        return new ItemProduct(result, gd);\n      }\n    });\n  }\n\n  niceName() {\n    if (this.products.length > 1) {\n      return super.niceName();\n    } else if (this.products[0].amount.equal(Rational.one)) {\n      return this.products[0].item.niceName();\n    } else {\n      return this.products[0].niceName();\n    }\n  }\n}\n\nexport abstract class BaseEntity<T extends schema.BaseEntity> {\n  data: T;\n  constructor(data: T) {\n    this.data = data;\n  }\n\n  niceName() {\n    return this.data.localised_name.en;\n  }\n}\n\nexport class AssemblingMachine extends BaseEntity<schema.AssemblingMachine> {\n  canBuildRecipe(recipe: Recipe) {\n    // TODO: this needs to account for entity fluid boxes\n    if (this.data.crafting_categories.indexOf(recipe.category) === -1) {\n      return false;\n    }\n\n    // ingredient_count seems to be item specific. this is disabled until\n    // I can figure out how many fluids a machine can support\n    // if (recipe.ingredients.length > this.data.ingredient_count) {\n    //     return false\n    // }\n    return true;\n  }\n}\n\nexport type Entity = AssemblingMachine;\n\ntype CategoryMap = { [category: string]: AssemblingMachine[] };\n\nconst createCategoryMap = (entities: Entity[]) => {\n  const catMap: CategoryMap = {};\n  for (let entity of entities) {\n    if (!(entity instanceof AssemblingMachine)) {\n    }\n    for (let category of entity.data.crafting_categories) {\n      if (!catMap.hasOwnProperty(category)) {\n        catMap[category] = [];\n      }\n      catMap[category].push(entity);\n    }\n  }\n  return catMap;\n};\n\nexport class GameData {\n  raw: schema.Root;\n\n  items: Item[] = [];\n  itemMap: { [name: string]: Item } = {};\n\n  fluids: Fluid[] = [];\n  fluidMap: { [name: string]: Fluid } = {};\n\n  modules: Module[] = [];\n  moduleMap: { [name: string]: Module } = {};\n\n  recipes: Recipe[] = [];\n  recipeMap: { [name: string]: Recipe } = {};\n\n  entities: Entity[] = [];\n  entityMap: { [name: string]: Entity } = {};\n\n  categoryMap: CategoryMap;\n\n  constructor(raw: schema.Root) {\n    console.groupCollapsed('Game data processing');\n    this.raw = raw;\n\n    type Thing<T> = {\n      new (d: T): Entity;\n    };\n\n    const addOfType = <S extends schema.BaseEntity, C extends Thing<S>>(\n      entities: S[],\n      ctor: C\n    ) => {\n      for (let edata of entities) {\n        const entity = new ctor(edata);\n        this.entityMap[edata.name] = entity;\n        this.entities.push(entity);\n      }\n    };\n\n    addOfType(values(raw['assembling-machine']), AssemblingMachine);\n    addOfType(values(raw['furnace']), AssemblingMachine);\n    addOfType(values(raw['rocket-silo']), AssemblingMachine);\n\n    for (let itemName in raw.items) {\n      const thing = raw.items[itemName];\n      if ('type' in thing && thing.type === 'fluid') {\n        const fluid = new Fluid(thing);\n        this.fluids.push(fluid);\n        this.fluidMap[fluid.name] = fluid;\n      } else if ('type' in thing && thing.type === 'module') {\n        const item = new Module(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n        this.modules.push(item);\n        this.moduleMap[item.name] = item;\n      } else {\n        const item = new GenericItem(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n      }\n    }\n\n    for (let recipeName in raw.recipes) {\n      const recipe = new Recipe(raw.recipes[recipeName], this);\n\n      for (let entityName in this.entityMap) {\n        const entity = this.entityMap[entityName];\n\n        if ('canBuildRecipe' in entity && entity.canBuildRecipe(recipe)) {\n          recipe.madeIn.push(entity);\n        }\n      }\n      if (!recipe.madeIn.length) {\n        // Filter to only recipes buildable by knonwn assembling machines\n        console.warn('Ignoring uncraftable recipe', recipe.name, recipe);\n        continue;\n      }\n\n      const hasProducts = recipe.products.some((p) => p.amount.isPositive());\n      if (!hasProducts) {\n        console.debug('Ignoring void recipe', recipe.name, recipe);\n        continue;\n      }\n\n      this.recipeMap[recipe.name] = recipe;\n      this.recipes.push(recipe);\n\n      for (let ingredient of recipe.ingredients) {\n        ingredient.item.usedBy.push(recipe);\n      }\n      for (let product of recipe.products) {\n        product.item.madeBy.push(recipe);\n      }\n    }\n\n    this.categoryMap = createCategoryMap(this.entities);\n    console.log(`Processed ${this.items.length} items`);\n    console.log(`Processed ${this.fluids.length} fluids`);\n    console.log(`Processed ${this.recipes.length} recipes`);\n    console.log(`Processed ${this.entities.length} entities`);\n    console.groupEnd();\n  }\n\n  getItemOrder(item: Item | Fluid) {\n    let groupOrder = '';\n    let subgroupOrder = '';\n    const group = this.raw.groups[item.raw.group];\n    if (group) {\n      groupOrder = group.order;\n      subgroupOrder = group.subgroups[item.raw.subgroup] || '';\n    }\n    return [groupOrder, subgroupOrder, item.raw.order, item.raw.name];\n  }\n\n  // Sort by\n  // 1. group\n  // 2. subgroup\n  // 3. item order string\n  // 4. item name\n  sortByItem<T>(collection: T[], keyFn: (obj: T) => Item | Fluid): void {\n    const sortFn = (a: T, b: T) => {\n      const ordersA = this.getItemOrder(keyFn(a));\n      const ordersB = this.getItemOrder(keyFn(b));\n\n      for (const i in ordersA) {\n        const valA = ordersA[i];\n        const valB = ordersB[i];\n        if (valA > valB) {\n          return 1;\n        } else if (valA < valB) {\n          return -1;\n        }\n      }\n\n      return 0;\n    };\n\n    collection.sort(sortFn);\n  }\n}\n","import * as game from './game';\nimport { AppState } from './state';\nimport { assert } from './util';\n\nexport function getDefaultMachine(\n  category: string,\n  state: AppState\n): game.AssemblingMachine;\nexport function getDefaultMachine(\n  recipe: game.Recipe,\n  state: AppState\n): game.AssemblingMachine;\n\nexport function getDefaultMachine(\n  input: game.Recipe | string,\n  state: AppState\n): game.AssemblingMachine {\n  const category = input instanceof game.Recipe ? input.category : input;\n\n  let defaultMachine: game.AssemblingMachine;\n  if (category in state.settings.assemblerOverrides) {\n    defaultMachine = state.settings.assemblerOverrides[category];\n  } else {\n    defaultMachine = state.gameData.categoryMap[category][0];\n  }\n\n  if (input instanceof game.Recipe) {\n    assert(input.madeIn.indexOf(defaultMachine) !== -1);\n  }\n\n  return defaultMachine;\n}\n","import React from 'react';\nimport { createDakpan } from 'dakpan';\n\nimport * as game from './game';\nimport { Rational } from './rational';\nimport { getDefaultMachine } from './stateutil';\n\nexport interface RecipeRowData {\n  recipe: game.Recipe;\n  machine: game.AssemblingMachine;\n  numMachines: Rational;\n  modules: (game.Module | null)[];\n  beaconModule: game.Module | null;\n  numBeacons: number;\n}\n\nexport interface RecipeGroupData {\n  name: string;\n  rows: RecipeRowData[];\n}\n\nexport interface AppSettingsData {\n  assemblerOverrides: {\n    [category: string]: game.AssemblingMachine;\n  };\n}\n\nexport interface RecipeTarget {\n  item: game.Item | game.Fluid;\n  amount: Rational;\n}\n\nexport interface AppState {\n  // Loaded automatically\n  gameData: game.GameData;\n\n  // Preserved via url/localstorage\n  groups: RecipeGroupData[];\n  settings: AppSettingsData;\n\n  // unsaved state\n  activeGroupIdx: number;\n  recipeTarget: RecipeTarget | undefined;\n}\n\nexport const defaultState: AppState = {\n  gameData: ({ fakeGameData: true } as any) as game.GameData, // set early by apploader\n  groups: [\n    {\n      name: 'Factory 1',\n      rows: [],\n    },\n  ],\n  settings: {\n    assemblerOverrides: {},\n  },\n\n  activeGroupIdx: 0,\n  recipeTarget: undefined,\n};\n\nfunction getActiveGroup(state: AppState) {\n  return state.groups[state.activeGroupIdx];\n}\n\nfunction updateGroup(state: AppState, newGroup: Partial<RecipeGroupData>) {\n  const groups = state.groups.map((oldGroup, index) => {\n    return index === state.activeGroupIdx\n      ? { ...oldGroup, ...newGroup }\n      : oldGroup;\n  });\n\n  return { ...state, groups };\n}\n\nexport const [StateProvider, useDakpan] = createDakpan(defaultState)({\n  replaceState: (newState: Partial<AppState>) => (state) => {\n    return { ...state, ...newState };\n  },\n\n  addRow: (row: RecipeRowData) => (state) => {\n    const group = getActiveGroup(state);\n    // ignore adding duplicate rows\n    if (group.rows.some((r) => r.recipe.name === row.recipe.name)) {\n      return;\n    }\n\n    return updateGroup(state, { rows: [...group.rows, row] });\n  },\n\n  updateRow: (i: number, updates: Partial<RecipeRowData>) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows[i] = { ...group.rows[i], ...updates };\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  removeRow: (i: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows.splice(i, 1);\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  moveRow: (oldIndex: number, newIndex: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n\n    const [removed] = rows.splice(oldIndex, 1);\n    rows.splice(newIndex, 0, removed);\n\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  updateDefaultMachine: (category, newMachine) => (state) => {\n    const oldMachine = getDefaultMachine(category, state);\n\n    const groups = state.groups.map((group) => {\n      const rows = group.rows.map((row) => {\n        if (row.recipe.category !== category || row.machine !== oldMachine) {\n          return row;\n        }\n        return {\n          ...row,\n          machine: newMachine,\n        };\n      });\n\n      return { ...group, rows };\n    });\n\n    return {\n      ...state,\n      groups,\n      settings: {\n        ...state.settings,\n        assemblerOverrides: {\n          ...state.settings.assemblerOverrides,\n          [category]: newMachine,\n        },\n      },\n    };\n  },\n\n  setActiveGroup: (groupIdx: number) => (state) => {\n    return { ...state, activeGroupIdx: groupIdx };\n  },\n\n  addGroup: (name) => (state) => {\n    const groups = [\n      ...state.groups,\n      {\n        name,\n        rows: [],\n      },\n    ];\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx: state.groups.length,\n    };\n  },\n\n  renameGroup: (index: number, name: string) => (state) => {\n    const groups = [...state.groups];\n    groups[index] = { ...groups[index], name };\n    return {\n      ...state,\n      groups,\n    };\n  },\n\n  removeGroup: (index: number) => (state) => {\n    // Remove group\n    const groups = [...state.groups];\n    groups.splice(index, 1);\n\n    // Add new group if necessary\n    if (!groups.length) {\n      groups.push({\n        name: 'Factory 1',\n        rows: [],\n      });\n    }\n\n    // Fix the index if it's outside of bounds\n    const maxIndex = groups.length - 1;\n    const activeGroupIdx = Math.min(state.activeGroupIdx, maxIndex);\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx,\n    };\n  },\n\n  setRecipeTarget: (recipeTarget: RecipeTarget) => (state) => {\n    return {\n      ...state,\n      recipeTarget,\n    };\n  },\n});\n\nexport type AppActions = NonNullable<ReturnType<typeof useDakpan>[1]>;\n\nexport const withBoth = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'state' | 'actions'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state, actions] = useDakpan();\n    return <OldComponent state={state} actions={actions} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n\ntype PropsOf<\n  T extends React.ComponentType<any>\n> = T extends React.ComponentType<infer P> ? P : never;\n\nexport const withGame = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'gameData'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state] = useDakpan();\n    return <OldComponent gameData={state.gameData} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n","import * as game from './game';\nimport { Rational } from './rational';\nimport { AppState, AppSettingsData } from './state';\nimport { getDefaultMachine } from './stateutil';\nimport { mapValues } from './util';\n\nimport { inflate, deflate } from 'pako';\n\ntype SerializedRowV1 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  number, // num assembling machines\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedAppStateV1 {\n  version: 1;\n  data: SerializedRowV1[];\n}\n\nfunction state1to2(state: SerializedAppStateV1): SerializedAppStateV2 {\n  return {\n    version: 2,\n    data: {\n      rows: state.data,\n      settings: {\n        assemblerOverrides: {},\n      },\n    },\n  };\n}\n\ninterface SerializedAppStateV2 {\n  version: 2;\n  data: {\n    rows: SerializedRowV1[];\n    settings: SerializedSettings;\n  };\n}\n\n// V3 = v2 but compressed\nfunction state2to3(state: SerializedAppStateV2): SerializedAppStateV3 {\n  return {\n    version: 3,\n    data: state.data,\n  };\n}\n\ninterface SerializedAppStateV3 {\n  version: 3;\n  data: SerializedAppStateV2['data'];\n}\n\n// v4 is multiple groups of rows\nfunction state3to4(state: SerializedAppStateV3): SerializedAppStateV4 {\n  return {\n    version: 4,\n    data: {\n      settings: state.data.settings,\n      groups: [\n        {\n          name: 'Factory 1',\n          rows: state.data.rows,\n        },\n      ],\n    },\n  };\n}\n\n// v4 has multiple groups, each with multiple rows\ninterface SerializedGroupV4 {\n  name: string;\n  rows: SerializedRowV1[];\n}\ninterface SerializedAppStateV4 {\n  version: 4;\n  data: {\n    groups: SerializedGroupV4[];\n    settings: SerializedSettings;\n  };\n}\n\nfunction groupv4to5(group: SerializedGroupV4): SerializedGroupV5 {\n  return {\n    name: group.name,\n    rows: group.rows.map((r) => {\n      return [r[0], r[1], r[2].toString(), r[3], r[4], r[5]];\n    }),\n  };\n}\n\n// v5 has multiple groups, each with multiple rows\nfunction state4to5(state: SerializedAppStateV4): SerializedAppStateV5 {\n  return {\n    version: 5,\n    data: {\n      settings: state.data.settings,\n      groups: state.data.groups.map(groupv4to5),\n    },\n  };\n}\ntype SerializedRowV5 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  string, // num assembling machines as a rational\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedGroupV5 {\n  name: string;\n  rows: SerializedRowV5[];\n}\ninterface SerializedAppStateV5 {\n  version: 5;\n  data: {\n    groups: SerializedGroupV5[];\n    settings: SerializedSettings;\n  };\n}\n\ninterface SerializedAppStateOther {\n  version: 0;\n  data: unknown;\n}\n\ntype MultiSerializedAppState =\n  | SerializedAppStateOther\n  | SerializedAppStateV1\n  | SerializedAppStateV2\n  | SerializedAppStateV3\n  | SerializedAppStateV4\n  | SerializedAppStateV5;\n\n// Latest values\n// type SerializedGroup = SerializedGroupV5;\ntype SerializedRow = SerializedRowV5;\ntype SerializedAppState = SerializedAppStateV5;\n\ninterface SerializedSettings {\n  assemblerOverrides: {\n    [category: string]: string;\n  };\n}\n\nexport function setLocalStorageState(state: AppState) {\n  localStorage.setItem('appstate', JSON.stringify(serialize(state)));\n}\n\nexport function getLocalStorageState(gameData: game.GameData): AppState | null {\n  const statestr = localStorage.getItem('appstate');\n  if (!statestr) {\n    return null;\n  }\n  const stateobj: MultiSerializedAppState = JSON.parse(statestr);\n  if (stateobj.version === 1) {\n    (stateobj as any).version = 3;\n  }\n\n  return deserialize(gameData, stateobj);\n}\n\nexport function setUrlState(state: AppState) {\n  const serialized = serialize(state);\n  const version = serialized.version;\n  let str = JSON.stringify(serialized.data);\n  // compress\n  str = btoa(deflate(str, { to: 'string' }));\n\n  window.history.replaceState('', '', `#${version}-${str}`);\n}\n\nfunction serialize(state: AppState): SerializedAppState {\n  const groups = state.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map((row) => {\n        let machineName: string | null = row.machine.data.name;\n        const defaultMachine = getDefaultMachine(row.recipe, state);\n\n        if (defaultMachine.data.name === machineName) {\n          machineName = null;\n        }\n\n        const srow: SerializedRow = [\n          row.recipe.name,\n          machineName,\n          row.numMachines.toFraction(),\n          row.modules.map((m) => (m ? m.name : null)),\n          row.beaconModule ? row.beaconModule.name : undefined,\n          row.numBeacons,\n        ];\n        return srow;\n      }),\n    };\n  });\n\n  const settings = {\n    assemblerOverrides: mapValues(\n      state.settings.assemblerOverrides,\n      (a) => a.data.name\n    ),\n  };\n\n  return {\n    version: 5,\n    data: { groups, settings },\n  };\n}\n\nconst reStateUrl = /^#(\\d+)?(?:-)?(.+)$/;\n\nexport function getUrlState(gameData: game.GameData) {\n  const matches = reStateUrl.exec(document.location.hash);\n  if (!matches) {\n    return null;\n  }\n  const version = Number(matches[1] || 1);\n\n  let str = decodeURIComponent(matches[2]);\n  if (version > 2) {\n    str = inflate(atob(str), { to: 'string' });\n  }\n\n  let data = JSON.parse(str);\n\n  return deserialize(gameData, {\n    version: version as 0,\n    data,\n  });\n}\n\nfunction migrateSerializedState(\n  state: MultiSerializedAppState\n): SerializedAppState {\n  switch (state.version) {\n    case 1:\n      state = state1to2(state);\n    // fall through\n    case 2:\n      state = state2to3(state);\n    // fall through\n    case 3:\n      state = state3to4(state);\n    // fall through\n    case 4:\n      state = state4to5(state);\n    // fall through\n    case 5:\n      // the latest\n      break;\n    default:\n      throw new Error(`unknown state: ${state}`);\n  }\n\n  return state;\n}\n\nfunction deserialize(\n  gameData: game.GameData,\n  unmigrated: MultiSerializedAppState\n): AppState {\n  const migrated = migrateSerializedState(unmigrated).data;\n\n  const state: AppState = {\n    gameData: gameData,\n\n    settings: deserializeSettings(gameData, migrated.settings),\n    groups: [],\n\n    activeGroupIdx: 0,\n    recipeTarget: undefined,\n  };\n\n  state.groups = migrated.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map(\n        ([\n          recipeName,\n          machineName,\n          numMachines,\n          modules,\n          beaconModule,\n          numBeacons,\n        ]) => {\n          const recipe = gameData.recipeMap[recipeName];\n\n          const machine = machineName\n            ? gameData.entityMap[machineName]\n            : getDefaultMachine(recipe, state);\n\n          return {\n            recipe: recipe,\n            machine: machine,\n            numMachines: Rational.fromString(numMachines),\n            modules: modules.map((n) => (n ? gameData.moduleMap[n] : null)),\n            beaconModule: beaconModule\n              ? gameData.moduleMap[beaconModule]\n              : null,\n            numBeacons: numBeacons || 0,\n          };\n        }\n      ),\n    };\n  });\n\n  return state;\n}\n\nfunction deserializeSettings(\n  gameData: game.GameData,\n  serialized: SerializedSettings\n): AppSettingsData {\n  return {\n    assemblerOverrides: mapValues(\n      serialized.assemblerOverrides,\n      (name) => gameData.entityMap[name]\n    ),\n  };\n}\n","import * as game from './game';\n\ninterface SignalHandler<T> {\n  (arg: T): void;\n}\n\nexport class Signal<T> {\n  handlers: SignalHandler<T>[] = [];\n\n  addHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index === -1) {\n      this.handlers.push(handler);\n    }\n  }\n\n  removeHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index !== -1) {\n      this.handlers.splice(index, 1);\n    }\n  }\n\n  dispatch = (arg: T) => {\n    for (let handler of this.handlers) {\n      handler(arg);\n    }\n  };\n}\n\nexport const addIngredientFilter = new Signal<game.Ingredient>();\nexport const addProductFilter = new Signal<game.Product>();\nexport const addRecipeRow = new Signal<game.Recipe>();\n","import * as React from 'react';\nimport Popper from 'popper.js';\n\ninterface DropdownHeader {\n  header: React.ReactNode;\n}\n\ninterface DropdownDivider {\n  divider: true;\n}\n\ninterface DropdownEntry<T> {\n  key: React.Key;\n  disabled?: boolean;\n  active?: boolean;\n  option: T;\n}\n\ntype DropdownOption<T> = DropdownHeader | DropdownDivider | DropdownEntry<T>;\n\ninterface Props<T> {\n  options: DropdownOption<T>[];\n  selected: T;\n  onSelect(selected: T): void;\n\n  renderOption(option: T): React.ReactNode;\n  renderSelected(option: T): React.ReactNode;\n}\ninterface State {\n  isOpen: boolean;\n}\n\nconst ESC_KEYCODE = 27;\n\nexport class Dropdown<T> extends React.Component<Props<T>, State> {\n  buttonRef: React.RefObject<any>;\n\n  constructor(props: Props<T>) {\n    super(props);\n    this.state = {\n      isOpen: false,\n    };\n    this.buttonRef = React.createRef();\n  }\n\n  handleToggle = () => {\n    this.setState({\n      isOpen: !this.state.isOpen,\n    });\n  };\n\n  handleSelect = (selected: T) => {\n    this.props.onSelect(selected);\n    if (this.state.isOpen) {\n      this.setState({\n        isOpen: false,\n      });\n    }\n  };\n\n  handleWantClose = () => {\n    if (this.state.isOpen) {\n      this.setState({\n        isOpen: false,\n      });\n    }\n  };\n\n  render() {\n    const canToggle = this.props.options.some((option) => {\n      return 'option' in option && !option.disabled;\n    });\n\n    const classes = ['btn', 'btn-secondary'];\n    if (canToggle) {\n      classes.push('dropdown-toggle');\n    } else {\n      classes.push('disabled');\n    }\n\n    let floater: React.ReactNode | null;\n    if (this.state.isOpen) {\n      floater = (\n        <DropdownMenu\n          parentRef={this.buttonRef}\n          options={this.props.options}\n          renderOption={this.props.renderOption}\n          onSelect={this.handleSelect}\n          onWantClose={this.handleWantClose}\n        />\n      );\n    }\n\n    return (\n      <>\n        <button\n          ref={this.buttonRef}\n          className={classes.join(' ')}\n          type=\"button\"\n          onClick={() => {\n            canToggle && this.handleToggle();\n          }}\n        >\n          {this.props.renderSelected(this.props.selected)}\n        </button>\n        {floater}\n      </>\n    );\n  }\n}\n\ninterface DropdownMenuProps<T> {\n  parentRef: React.RefObject<any>;\n  options: DropdownOption<T>[];\n  renderOption(option: T): React.ReactNode;\n  onSelect(selected: T): void;\n  onWantClose(): void;\n}\n\ninterface DropdownMenuState {\n  style: React.CSSProperties;\n}\n\nclass DropdownMenu<T> extends React.Component<\n  DropdownMenuProps<T>,\n  DropdownMenuState\n> {\n  popperInstance: Popper | null = null;\n  menuRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: DropdownMenuProps<T>) {\n    super(props);\n    this.menuRef = React.createRef();\n    this.state = {\n      style: {},\n    };\n  }\n\n  popperUpdate = (data: Popper.Data) => {\n    this.setState({\n      style: data.styles as React.CSSProperties,\n    });\n    return data;\n  };\n\n  handleBodyClick = (event: MouseEvent) => {\n    if (!this.menuRef.current) {\n      throw new Error(\n        'Click event without menu rendered. This should not happen.'\n      );\n    }\n    if (!event.target) {\n      throw new Error(\n        'Click event without click target. This should not happen.'\n      );\n    }\n    // TODO: why doesnt EventTarget satisfy \"Node\"\n    const target = event.target as any;\n    if (!this.menuRef.current.contains(target)) {\n      // Click was outside menu\n      this.props.onWantClose();\n    }\n  };\n\n  handleKeyEvent = (event: KeyboardEvent) => {\n    if (event.keyCode === ESC_KEYCODE) {\n      this.props.onWantClose();\n    }\n  };\n\n  componentDidMount() {\n    if (this.popperInstance) {\n      throw new Error('Component mounted twice?');\n    }\n\n    const referenceEl = this.props.parentRef.current;\n    if (!referenceEl) {\n      throw new Error('Cannot mount DropdownMenu without parentRef');\n    }\n\n    const menuEl = this.menuRef.current;\n    if (!menuEl) {\n      throw new Error('Cannot mount DropdownMenu without menuRef');\n    }\n\n    this.popperInstance = new Popper(referenceEl, menuEl, {\n      modifiers: {\n        applyStyle: { enabled: false },\n        updateStateWithStyle: {\n          enabled: true,\n          fn: this.popperUpdate,\n        },\n      },\n    });\n\n    document.body.addEventListener('click', this.handleBodyClick);\n    document.body.addEventListener('keyup', this.handleKeyEvent);\n  }\n\n  componentWillUnmount() {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n    document.body.removeEventListener('click', this.handleBodyClick);\n    document.body.removeEventListener('keyup', this.handleKeyEvent);\n  }\n\n  renderOptions = () => {\n    return this.props.options.map((option, i) => {\n      if ('header' in option) {\n        return (\n          <h6 className=\"dropdown-header\" key={'ddkey' + i}>\n            {option.header}\n          </h6>\n        );\n      }\n      if ('divider' in option) {\n        return <div className=\"dropdown-divider\" key={'ddkey' + i} />;\n      }\n\n      const classes = ['dropdown-item'];\n      option.active && classes.push('active');\n      option.disabled && classes.push('disabled');\n\n      return (\n        <button\n          key={option.key}\n          className={classes.join(' ')}\n          onClick={() => this.props.onSelect(option.option)}\n          type=\"button\"\n        >\n          {this.props.renderOption(option.option)}\n        </button>\n      );\n    });\n  };\n\n  render() {\n    return (\n      <div\n        className=\"dropdown-menu show\"\n        style={this.state.style}\n        ref={this.menuRef}\n      >\n        {this.renderOptions()}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Popper from 'popper.js';\n\ninterface Props {\n    relativeTo: React.RefObject<HTMLElement>;\n}\n\ninterface State {\n    showSelf: boolean;\n    style: React.CSSProperties;\n}\n\nexport class Tooltip extends React.Component<Props, State> {\n    selfRef: React.RefObject<any>;\n    popperInstance: Popper | null;\n\n    constructor(props: Props) {\n        super(props);\n        this.selfRef = React.createRef();\n        this.popperInstance = null;\n        this.state = {\n            showSelf: false,\n            style: { zIndex: 1001 },\n        };\n    }\n\n    initPopper() {\n        if (this.popperInstance) {\n            return;\n        }\n\n        const referenceEl = this.props.relativeTo.current;\n        if (!referenceEl) {\n            throw new Error('Invalid relativeTo');\n        }\n\n        const selfEl = this.selfRef.current;\n        if (!selfEl) {\n            throw new Error('No self reference yet?');\n        }\n\n        this.popperInstance = new Popper(referenceEl, selfEl, {\n            placement: 'right',\n            modifiers: {\n                offset: {\n                    enabled: true,\n                    offset: '0, 20',\n                },\n                preventOverflow: {\n                    enabled: true,\n                    boundariesElement: 'window',\n                },\n            },\n        });\n    }\n\n    cleanupPopper() {\n        if (this.popperInstance) {\n            this.popperInstance.disableEventListeners();\n            this.popperInstance = null;\n        }\n    }\n\n    componentDidUpdate(_: Props, prevState: State) {\n        if (prevState.showSelf !== this.state.showSelf) {\n            if (this.state.showSelf) {\n                this.initPopper();\n            } else {\n                this.cleanupPopper();\n            }\n        }\n    }\n\n    componentDidMount() {\n        const referenceEl = this.props.relativeTo.current;\n        if (!referenceEl) {\n            throw new Error('Invalid relativeTo');\n        }\n\n        referenceEl.addEventListener('mouseenter', this.handleMouseEnter);\n        referenceEl.addEventListener('mouseleave', this.handleMouseLeave);\n    }\n\n    handleMouseEnter = () => {\n        this.setState({\n            showSelf: true,\n        });\n    };\n\n    handleMouseLeave = () => {\n        this.setState({\n            showSelf: false,\n        });\n    };\n\n    componentWillUnmount() {\n        const referenceEl = this.props.relativeTo.current;\n        if (referenceEl) {\n            referenceEl.removeEventListener(\n                'mouseenter',\n                this.handleMouseEnter\n            );\n            referenceEl.removeEventListener(\n                'mouseleave',\n                this.handleMouseLeave\n            );\n        }\n    }\n\n    render() {\n        if (!this.state.showSelf) {\n            return null;\n        }\n\n        return ReactDOM.createPortal(\n            <div style={this.state.style} ref={this.selfRef}>\n                {this.props.children}\n            </div>,\n            document.body\n        );\n    }\n}\n","import * as React from 'react';\n\ninterface Props {\n    value: number;\n    onChange: (value: number) => void;\n    intOnly?: boolean;\n    positiveOnly?: boolean;\n}\n\ninterface State {\n    txtValue: string;\n}\n\nexport class IntegerInput extends React.PureComponent<Props, State> {\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n            txtValue: props.value.toString(),\n        };\n    }\n\n    public handleChange = (event: React.FormEvent<HTMLInputElement>) => {\n        const value = (event.target as HTMLInputElement).value;\n        this.setState({ txtValue: value });\n        if (!value.trim()) {\n            return;\n        }\n        const num = Number(value);\n        if (this.props.intOnly && !Number.isInteger(num)) {\n            return;\n        }\n        if (this.props.positiveOnly && num < 0) {\n            return;\n        }\n        this.props.onChange(num);\n    };\n\n    render() {\n        return (\n            <input\n                className=\"form-control\"\n                value={this.state.txtValue}\n                onChange={this.handleChange}\n                type=\"number\"\n                min=\"0\"\n                step=\"1\"\n            />\n        );\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nimport { Rational } from '../../rational';\n\ninterface Props {\n    value: Rational;\n    onChange: (value: Rational) => void;\n    positiveOnly?: boolean;\n}\n\ninterface State {\n    error: string | undefined;\n    txtValue: string;\n}\n\nexport class RationalInput extends React.PureComponent<Props, State> {\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n          error: '',\n          txtValue: rationalToString(props.value),\n        };\n    }\n\n    componentDidUpdate(oldProps: Props) {\n      if (!this.props.value.equal(oldProps.value)) {\n        let parsed: Rational;\n        try {\n          parsed = stringToRational(this.state.txtValue)\n        } catch (err) {\n          return;\n        }\n\n        if (!parsed.equal(this.props.value)) {\n          this.setState({\n            txtValue: rationalToString(this.props.value)\n          })\n        }\n      }\n    }\n\n    public handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const str = event.target.value;\n\n        let errmsg: string | undefined;\n        let parsed: Rational | undefined;\n\n        try {\n          parsed = stringToRational(str);\n        } catch (err) {\n          errmsg = err.message;\n        }\n\n        if (parsed && this.props.positiveOnly && parsed.isNegative()) {\n          parsed = undefined;\n          errmsg = 'Number must be positive';\n        }\n        this.setState({ txtValue: str, error: errmsg }, () => {\n          if (parsed) {\n            this.props.onChange(parsed);\n          }\n        });\n    };\n\n    render() {\n        return (\n            <input\n                className={classNames('form-control', { 'is-invalid': !!this.state.error})}\n                value={this.state.txtValue}\n                onChange={this.handleChange}\n                type=\"text\"\n            />\n        );\n    }\n}\n\nfunction stringToRational(str: string): Rational {\n        if (!str.trim()) {\n          throw new Error('Empty!');\n        }\n\n        const index = str.indexOf('/');\n        const lastIndex = str.lastIndexOf('/');\n        if (index !== lastIndex) {\n          throw new Error('Too many slashes');\n        }\n\n        return Rational.fromString(str);\n}\n\nfunction rationalToString(rational: Rational): string {\n  const dec = rational.toFloat().toString();\n  if (dec.length < 10) {\n    return dec;\n  }\n\n  return rational.toFraction();\n}\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport { Tooltip } from './generic';\n\nimport styles from './Icon.module.css';\n\ninterface Props {\n  obj: { icon_row: number; icon_col: number };\n\n  title?: string;\n  onClick?(event: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\n  style?: React.CSSProperties;\n  tooltip?: React.ReactNode;\n  text?: React.ReactNode;\n}\n\ninterface State {}\n\nexport class Icon extends React.PureComponent<Props, State> {\n  iconRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.iconRef = React.createRef();\n  }\n\n  render() {\n    const x = -this.props.obj.icon_col * 32;\n    const y = -this.props.obj.icon_row * 32;\n\n    const divStyle = {\n      display: 'inline-block',\n      backgroundPosition: `${x}px ${y}px`,\n      width: '32px',\n      height: '32px',\n      ...this.props.style,\n    };\n\n    let icon = (\n      <div\n        ref={this.iconRef}\n        onClick={this.props.onClick}\n        title={this.props.title}\n        className={classNames(styles.Icon, 'game-icon')}\n        style={divStyle}\n      >\n        &nbsp;\n      </div>\n    );\n\n    if (this.props.tooltip) {\n      icon = (\n        <>\n          {icon}\n          <Tooltip children={this.props.tooltip} relativeTo={this.iconRef} />\n        </>\n      );\n    }\n\n    if (this.props.text) {\n      icon = (\n        <div style={{ lineHeight: '32px' }}>\n          {icon}\n          <span style={{ marginLeft: '9px' }}>{this.props.text}</span>\n        </div>\n      );\n    }\n\n    return icon;\n  }\n}\n","import * as React from 'react';\nimport * as game from '../game';\n\ninterface Props {\n  machine: game.AssemblingMachine;\n}\n\nexport const MachineCard = (props: Props) => {\n  return (\n    <div className=\"machine-card card\">\n      <div className=\"card-body\">\n        <b>{props.machine.niceName()}</b>\n        <br />\n        <b>Crafting Speed:</b> {props.machine.data.crafting_speed}\n        <br />\n        <b>Module Slots:</b> {props.machine.data.module_slots}\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { withGame } from '../state';\n\ninterface Props {\n  gameData: game.GameData;\n  recipe: game.Recipe;\n  onClick?(r: game.Recipe): void;\n}\n\nconst GameRecipeCard = (props: Props) => {\n  const handleClick = () => {\n    props.onClick && props.onClick(props.recipe);\n  };\n  const recipe = props.recipe;\n\n  const ingredients = recipe.ingredients.map((ingredient, i) => (\n    <Icon key={i} obj={ingredient.item} text={ingredient.niceName()} />\n  ));\n  const products = recipe.products.map((product, i) => (\n    <Icon key={i} obj={product.item} text={product.niceName()} />\n  ));\n\n  const madeIn = recipe.madeIn.map((machine, i) => (\n    <Icon\n      key={i}\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n    />\n  ));\n\n  return (\n    <div className=\"recipe-tooltip card\" onClick={handleClick}>\n      <div className=\"card-header\">\n        <Icon obj={recipe} text={recipe.niceName()} />\n      </div>\n      <div className=\"card-body\">\n        <Icon\n          obj={props.gameData.raw.sprites.extra['clock']}\n          text={recipe.crafting_time.toDecimal()}\n        />\n        <div style={{ float: 'left' }}>\n          Ingredients:\n          {ingredients}\n        </div>\n        <div style={{ display: 'inline-block' }}>\n          Products:\n          {products}\n        </div>\n        <div style={{ clear: 'both' }} />\n        <div style={{ lineHeight: '32px' }}>\n          Made In:\n          {madeIn}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const RecipeCard = withGame(GameRecipeCard);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { Dropdown } from './generic';\n\ntype Machine = game.AssemblingMachine;\n\ninterface MachinePickerProps {\n  machines: Machine[];\n  selected: Machine;\n  onChange(m: Machine): void;\n}\n\nconst renderSelected = (machine: Machine) => {\n  return (\n    <Icon obj={machine.data} tooltip={<MachineCard machine={machine} />} />\n  );\n};\n\nconst renderOption = (machine: Machine) => {\n  return (\n    <Icon\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n      text={machine.niceName()}\n    />\n  );\n};\n\nexport const MachinePicker = (props: MachinePickerProps) => {\n  const options = props.machines.map((machine) => ({\n    key: machine.data.name,\n    option: machine,\n    active: machine === props.selected,\n  }));\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n","import * as React from 'react';\n\nimport { Module } from '../game';\nimport { round2 } from '../util';\n\nconst niceName = {\n  consumption: 'Energy Consumption',\n  productivity: 'Productivity',\n  speed: 'Speed',\n  pollution: 'Pollution',\n};\n\nexport const ModuleCard = ({ module }: { module: Module }) => {\n  const bonuses = [];\n  for (let bonusName in module.raw.effect) {\n    const bonus = module.raw.effect[\n      bonusName as keyof typeof module.raw.effect\n    ]!.bonus;\n    bonuses.push(\n      <div key={bonusName}>\n        <b>\n          {niceName[bonusName as keyof typeof niceName]}:{' '}\n          {round2(bonus * 100, 2)}%\n        </b>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"module-card card\">\n      <div className=\"card-header\">\n        <b>{module.niceName()}</b>\n      </div>\n      <div className=\"card-body\">{bonuses}</div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport { GameData, Module, Recipe } from '../game';\n\nimport { Icon } from './Icon';\nimport { ModuleCard } from './ModuleCard';\nimport { Dropdown } from './generic';\nimport { withGame } from '../state';\n\ninterface ModulePickerProps {\n  gameData: GameData;\n  recipe: Recipe;\n  isBeacon?: boolean;\n  selected: Module | null;\n  onChange(m: Module | null): void;\n}\n\nconst GameModulePicker = (props: ModulePickerProps) => {\n  const icon = props.gameData.raw.sprites.extra.slot_icon_module;\n  const nomod = new Module({\n    type: 'module',\n    name: 'no_module',\n    localised_name: { en: 'No Module' },\n    category: 'speed',\n    effect: {},\n    limitation: [],\n    rocket_launch_products: [],\n\n    icon_row: icon.icon_row,\n    icon_col: icon.icon_col,\n\n    group: '',\n    subgroup: '',\n    order: '',\n  });\n\n  const renderSelected = (module: Module | null) => {\n    if (module) {\n      return <Icon obj={module} tooltip={<ModuleCard module={module} />} />;\n    } else {\n      return <Icon obj={nomod} />;\n    }\n  };\n\n  const renderOption = (module: Module | null) => {\n    if (module) {\n      return (\n        <Icon\n          obj={module}\n          tooltip={<ModuleCard module={module} />}\n          text={module.niceName()}\n        />\n      );\n    } else {\n      return <Icon obj={nomod} text={nomod.niceName()} />;\n    }\n  };\n\n  const options = props.gameData.modules\n    .filter((m) => {\n      // TODO: what is the actual logic for which modules are allowed in beacons?\n      if (props.isBeacon && m.effects.productivity.isPositive()) {\n        return false;\n      }\n      return m.canUseWith(props.recipe);\n    })\n    .map((m) => ({\n      key: m.name,\n      option: m as Module | null,\n      active: m === props.selected,\n    }));\n\n  options.unshift({\n    key: 'no_module',\n    option: null,\n    active: !props.selected,\n  });\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n\nexport const ModulePicker = withGame(GameModulePicker);\n","import * as game from './game';\n\nimport { clone } from './util';\n\nimport { Rational } from './rational';\n\nimport { RecipeRowData } from './state';\n\nexport class Totals {\n  products: game.Product[] = [];\n  ingredients: game.Ingredient[] = [];\n\n  addIngredient = (newIng: game.Ingredient) => {\n    for (let oldIng of this.ingredients) {\n      let match = newIng.type === oldIng.type && newIng.item === oldIng.item;\n      if (newIng.type === 'fluid' && oldIng.type === 'fluid') {\n        match =\n          match &&\n          (newIng.maximum_temperature === oldIng.maximum_temperature &&\n            newIng.minimum_temperature === oldIng.minimum_temperature);\n      }\n\n      if (match) {\n        oldIng.amount = oldIng.amount.add(newIng.amount);\n        return;\n      }\n    }\n    this.ingredients.push(newIng);\n  };\n\n  addProduct = (newProd: game.Product) => {\n    for (let oldProd of this.products) {\n      let match =\n        newProd.type === oldProd.type && newProd.item === oldProd.item;\n      if (newProd.type === 'fluid' && oldProd.type === 'fluid') {\n        match = match && newProd.temperature === oldProd.temperature;\n      }\n\n      if (match) {\n        oldProd.amount = oldProd.amount.add(newProd.amount);\n        return;\n      }\n    }\n    this.products.push(newProd);\n  };\n\n  addRow(row: RecipeRowData) {\n    const effects = {\n      consumption: Rational.one,\n      pollution: Rational.one,\n      productivity: Rational.one,\n      speed: Rational.one,\n    };\n\n    for (let module of row.modules) {\n      if (!module) continue;\n      effects.consumption = effects.consumption.add(module.effects.consumption);\n      effects.pollution = effects.pollution.add(module.effects.pollution);\n      effects.productivity = effects.productivity.add(\n        module.effects.productivity\n      );\n      effects.speed = effects.speed.add(module.effects.speed);\n    }\n\n    if (row.beaconModule && row.numBeacons > 0) {\n      // TODO: export and use \"distribution_effectivity\" from beacon entities\n      // assume the common value of 0.5 for now\n\n      const be = row.beaconModule.effects;\n      const num = Rational.fromInts(row.numBeacons, 2);\n      effects.consumption = effects.consumption.add(be.consumption.mul(num));\n      effects.pollution = effects.pollution.add(be.pollution.mul(num));\n      effects.productivity = effects.productivity.add(be.productivity.mul(num));\n      effects.speed = effects.speed.add(be.speed.mul(num));\n    }\n\n    // Allowed -80% to de facto max of signed short int\n    effects.consumption = effects.consumption.clamp(0.2, 32767);\n    effects.pollution = effects.pollution.clamp(0.2, 32767);\n    effects.speed = effects.speed.clamp(0.2, 32767);\n\n    // Special minimum: -0%\n    effects.productivity = effects.productivity.clamp(1, 32767);\n\n    const ingredientMult = Rational.one\n      .mul(row.recipe.crafting_time.invert())\n      .mul(row.numMachines)\n      .mul(row.machine.data.crafting_speed)\n      .mul(effects.speed);\n\n    const productMult = ingredientMult.mul(effects.productivity);\n\n    row.recipe.ingredients\n      .map((ingredient) => {\n        ingredient = clone(ingredient);\n        ingredient.amount = ingredient.amount.mul(ingredientMult);\n        return ingredient;\n      })\n      .forEach(this.addIngredient);\n\n    row.recipe.products\n      .map((product) => {\n        product = clone(product);\n        product.amount = product.amount.mul(productMult);\n        return product;\n      })\n      .forEach(this.addProduct);\n  }\n\n  reduce() {\n    let ingredients = this.ingredients.map(clone);\n    let products = this.products.map(clone);\n\n    for (let product of products) {\n      for (let ingredient of ingredients) {\n        if (product.amount.isZero() || ingredient.amount.isZero()) {\n          continue;\n        }\n        if (!product.satisfies(ingredient)) {\n          continue;\n        }\n        if (product.amount.less(ingredient.amount)) {\n          // More ingredient than product\n          ingredient.amount = ingredient.amount.sub(product.amount);\n          product.amount = Rational.zero;\n        } else if (ingredient.amount.less(product.amount)) {\n          // More product than ingredient\n          product.amount = product.amount.sub(ingredient.amount);\n          ingredient.amount = Rational.zero;\n        } else {\n          ingredient.amount = Rational.zero;\n          product.amount = Rational.zero;\n        }\n      }\n    }\n\n    ingredients = ingredients.filter((i) => !i.amount.isZero());\n    products = products.filter((p) => !p.amount.isZero());\n\n    return { ingredients, products };\n  }\n}\n","import * as React from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport Button from 'react-bootstrap/Button';\n\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { Icon } from './Icon';\nimport { RecipeCard } from './RecipeCard';\nimport { MachinePicker } from './MachinePicker';\nimport { ModulePicker } from './ModulePicker';\nimport { IntegerInput, RationalInput } from './generic';\n\n// import {clone} from '../util'\nimport { Totals } from '../totals';\nimport { withBoth, RecipeRowData, AppActions, AppState } from '../state';\n\nimport * as signal from '../signal';\n\ninterface Props extends RecipeRowData {\n  index: number;\n  actions: AppActions;\n  state: AppState;\n}\n\ninterface IngredientCardProps {\n  obj: game.Ingredient | game.Product;\n}\n\nconst IngredientCard = (props: IngredientCardProps) => (\n  <div className=\"card\">\n    <div className=\"card-header\">\n      {props.obj.item.niceName()} ({props.obj.name})\n    </div>\n  </div>\n);\n\nclass RawRecipeRow extends React.Component<Props, {}> {\n  public handleRemoveClick = () => {\n    this.props.actions.removeRow(this.props.index);\n  };\n\n  public handleMachineChange = (machine: game.AssemblingMachine) => {\n    this.applyChange({\n      machine: machine,\n      modules: this.props.modules\n        .filter((module) => module !== null)\n        .slice(0, machine.data.module_slots),\n    });\n  };\n\n  public handleNumMachinesChange = (num: Rational) => {\n    this.applyChange({ numMachines: num });\n  };\n\n  public handleNumBeaconsChange = (num: number) => {\n    this.applyChange({ numBeacons: num });\n  };\n\n  public handleSetAllModules = () => {\n    this.applyChange({\n      modules: new Array(this.props.machine.data.module_slots).fill(\n        this.props.modules[0]\n      ),\n    });\n  };\n\n  public handleSetModule = (index: number, module: game.Module | null) => {\n    const modules = this.props.modules.slice();\n    modules[index] = module;\n    this.applyChange({ modules: modules });\n  };\n\n  public handleSetBeaconModule = (module: game.Module | null) => {\n    this.applyChange({ beaconModule: module });\n  };\n\n  public handleIngredientClick = (\n    ingredient: game.Ingredient,\n    event: React.MouseEvent\n  ) => {\n    if (event.shiftKey) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.props.actions.setRecipeTarget({\n        item: ingredient.item,\n        amount: ingredient.amount,\n      });\n      return;\n    }\n    if (ingredient.item.madeBy.length === 1) {\n      signal.addRecipeRow.dispatch(ingredient.item.madeBy[0]);\n    } else {\n      signal.addIngredientFilter.dispatch(ingredient);\n    }\n  };\n\n  public handleProductClick = (\n    product: game.Product,\n    event: React.MouseEvent\n  ) => {\n    if (event.shiftKey) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.props.actions.setRecipeTarget({\n        item: product.item,\n        amount: product.amount,\n      });\n      return;\n    }\n    if (product.item.usedBy.length === 1) {\n      signal.addRecipeRow.dispatch(product.item.usedBy[0]);\n    } else {\n      signal.addProductFilter.dispatch(product);\n    }\n  };\n\n  handleInputGroupClick: React.MouseEventHandler<any> = (event) => {\n    const { recipeTarget } = this.props.state;\n    if (!event.shiftKey || !recipeTarget) {\n      return;\n    }\n    event.preventDefault();\n    event.stopPropagation();\n    const output = this.getOutput();\n\n    let current: game.Ingredient | game.Product | undefined;\n    current = output.ingredients.find((x) => {\n      return x.item.name === recipeTarget.item.name;\n    });\n\n    current =\n      current ||\n      output.products.find((x) => {\n        return x.item.name === recipeTarget.item.name;\n      });\n\n    if (!current) {\n      console.error(\n        `Could not find ${recipeTarget.item.name} in totals`,\n        output\n      );\n      return;\n    }\n\n    const newNum = recipeTarget.amount\n      .div(current.amount)\n      .mul(this.props.numMachines);\n    this.applyChange({\n      numMachines: newNum,\n    });\n  };\n\n  applyChange(change: Partial<RecipeRowData>) {\n    this.props.actions.updateRow(this.props.index, change);\n  }\n\n  getOutput() {\n    const t = new Totals();\n    t.addRow(this.props);\n    return {\n      ingredients: t.ingredients,\n      products: t.products,\n    };\n  }\n\n  renderModules() {\n    const numSlots = this.props.machine.data.module_slots;\n\n    const slots = [];\n    for (let i = 0; i < numSlots; i++) {\n      const module = this.props.modules[i];\n      slots.push(\n        <ModulePicker\n          key={i}\n          recipe={this.props.recipe}\n          selected={module}\n          onChange={(m) => this.handleSetModule(i, m)}\n        />\n      );\n    }\n\n    if (numSlots > 1) {\n      slots.splice(\n        1,\n        0,\n        <button\n          onClick={this.handleSetAllModules}\n          key=\"applicator\"\n          className=\"btn\"\n        >\n          →\n        </button>\n      );\n    }\n\n    return slots;\n  }\n\n  renderBeacons() {\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">Beacon Modules</span>\n          </div>\n          <IntegerInput\n            value={this.props.numBeacons}\n            onChange={this.handleNumBeaconsChange}\n            positiveOnly={true}\n            intOnly={true}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <ModulePicker\n              isBeacon={true}\n              recipe={this.props.recipe}\n              selected={this.props.beaconModule}\n              onChange={this.handleSetBeaconModule}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderMachines() {\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\" onClick={this.handleInputGroupClick}>\n          <RationalInput\n            value={this.props.numMachines}\n            onChange={this.handleNumMachinesChange}\n            positiveOnly={true}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={this.props.recipe.madeIn}\n              selected={this.props.machine}\n              onChange={this.handleMachineChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const recipe = this.props.recipe;\n    const output = this.getOutput();\n\n    const ingredients = output.ingredients.map((ingredient, i) => (\n      <div className=\"mb-1\" key={i}>\n        <Icon\n          onClick={this.handleIngredientClick.bind(null, ingredient)}\n          tooltip={<IngredientCard obj={ingredient} />}\n          obj={ingredient.item}\n          text={perSecond(ingredient.amount)}\n        />\n      </div>\n    ));\n    const products = output.products.map((product, i) => (\n      <div className=\"mb-1\" key={i}>\n        <Icon\n          onClick={this.handleProductClick.bind(null, product)}\n          tooltip={<IngredientCard obj={product} />}\n          obj={product.item}\n          text={perSecond(product.amount)}\n        />\n      </div>\n    ));\n    return (\n      <Draggable draggableId={recipe.name} index={this.props.index}>\n        {(provided) => (\n          <div\n            className=\"recipe-row card mb-3\"\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n          >\n            <div className=\"card-header\" {...provided.dragHandleProps}>\n              <div style={{ float: 'left' }}>\n                <Icon\n                  obj={recipe}\n                  text={recipe.niceName()}\n                  tooltip={<RecipeCard recipe={recipe} />}\n                />\n              </div>\n              <div style={{ float: 'right' }}>\n                <Button\n                  variant=\"danger\"\n                  onClick={this.handleRemoveClick}\n                  size=\"sm\"\n                >\n                  Remove\n                </Button>\n              </div>\n              <div style={{ clear: 'both' }} />\n            </div>\n            <div className=\"card-body\">\n              <div style={{ float: 'left' }}>\n                {this.renderMachines()}\n                <div className=\"mb-3 btn-group btn-icon-wrapper\">\n                  {this.renderModules()}\n                </div>\n                {this.renderBeacons()}\n              </div>\n\n              <div style={{ float: 'right' }}>\n                <div\n                  className=\"mr-3\"\n                  style={{\n                    display: 'inline-block',\n                    float: 'left',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Ingredients:</b>\n                  {ingredients}\n                </div>\n\n                <div\n                  className=\"mr-2\"\n                  style={{\n                    display: 'inline-block',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Products:</b>\n                  {products}\n                </div>\n              </div>\n              <div style={{ clear: 'both' }} />\n            </div>\n          </div>\n        )}\n      </Draggable>\n    );\n  }\n}\n\nfunction perSecond(rational: Rational): React.ReactNode {\n  const dec = rational.toDecimal().toString();\n  let amount: React.ReactNode;\n  if (dec.includes('.') && dec.length > 4) {\n    amount =<abbr title={rational.toFraction()}>{rational.toDecimal()}</abbr>\n  } else {\n    amount = dec;\n  }\n  return <>{amount} / sec</>\n}\n\nexport const RecipeRow = withBoth(RawRecipeRow);\n","import * as React from 'react';\nimport Fuse from 'fuse.js';\nimport debounce from 'lodash/debounce';\n\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\n\nimport styles from './RecipePicker.module.css';\n\ntype KeyTypes = 'niceName' | 'name';\n\nfunction getFn(recipe: game.Recipe, key: string) {\n  switch (key as KeyTypes) {\n    case 'niceName':\n      return recipe.niceName();\n    case 'name':\n      return recipe.name;\n  }\n}\n\nconst RE_ADVANCED = /((?:produces)|(?:consumes)):([a-z0-9-]+)/g;\n\ninterface Props {\n  recipes: game.Recipe[];\n  onPickRecipe(r: game.Recipe): void;\n}\n\ninterface State {\n  query: string;\n  matches: game.Recipe[];\n}\n\nexport class RecipePicker extends React.PureComponent<Props, State> {\n\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    query: '',\n    matches: [],\n  };\n\n  componentDidMount() {\n    signal.addIngredientFilter.addHandler(this.handleIngredientClick);\n    signal.addProductFilter.addHandler(this.handleProductClick);\n  }\n\n  componentWillUnmount() {\n    this.debCalculateMatches.cancel();\n    signal.addIngredientFilter.removeHandler(this.handleIngredientClick);\n    signal.addProductFilter.removeHandler(this.handleProductClick);\n  }\n\n  public handleIngredientClick = (ingredient: game.Ingredient) => {\n    const term = `produces:${ingredient.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  public handleProductClick = (product: game.Product) => {\n    const term = `consumes:${product.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  public handleQueryInput = (event: React.FormEvent<HTMLInputElement>) => {\n    const target = event.target as HTMLInputElement;\n    this.setQuery(target.value);\n  };\n\n  public handleRecipeClick = (recipe: game.Recipe) => {\n    this.props.onPickRecipe(recipe);\n    this.setQuery('');\n  };\n\n  public setQuery = (query: string, callback?: () => void) => {\n    if (!query.trim()) {\n      this.debCalculateMatches.cancel();\n      this.setState(\n        {\n          query: '',\n          matches: [],\n        },\n        callback\n      );\n    } else {\n      this.setState({ query: query }, callback);\n      this.debCalculateMatches();\n    }\n  };\n\n  calculateMatches() {\n    let query = this.state.query.trim().toLowerCase();\n    if (!query) {\n      this.setState({ matches: [] });\n      return;\n    }\n\n    const conditions = {\n      consumes: [] as string[],\n      produces: [] as string[],\n    };\n\n    type ckey = keyof typeof conditions;\n\n    query = query\n      .replace(RE_ADVANCED, (_, key, value) => {\n        conditions[key as ckey].push(value);\n        return '';\n      })\n      .trim();\n\n    let recipes = this.props.recipes;\n    if (conditions.consumes.length || conditions.produces.length) {\n      recipes = recipes.filter((recipe) => {\n        for (let name of conditions.consumes) {\n          if (!recipe.ingredients.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        for (let name of conditions.produces) {\n          if (!recipe.products.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n\n    if (query) {\n      const fuse = new Fuse(recipes, {\n        shouldSort: true,\n        getFn: getFn,\n        keys: [\n          {\n            name: 'niceName',\n            weight: 0.7,\n          },\n          {\n            name: 'name',\n            weight: 0.2,\n          },\n        ],\n      });\n      recipes = fuse.search(query);\n    }\n    this.setState({ matches: recipes });\n  }\n\n  debCalculateMatches = debounce(this.calculateMatches.bind(this), 200);\n\n  renderMatches() {\n    if (!this.state.matches.length) {\n      return '';\n    }\n    let matches = this.state.matches;\n    if (matches.length > 100) {\n      matches = matches.slice(0, 100);\n    }\n    return (\n      <table className=\"table table-hover\">\n        <thead>\n          <tr>\n            <th>Recipe</th>\n            <th>Time</th>\n            <th>Ingredients</th>\n            <th>Products</th>\n          </tr>\n        </thead>\n        <tbody>\n          {matches.map((r) => (\n            <RecipeMatch\n              recipe={r}\n              key={r.name}\n              onClick={this.handleRecipeClick}\n            />\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  render() {\n    return (\n      <div className={styles.RecipePicker}>\n        <div>\n          <input\n            ref={this.inputRef}\n            className=\"editable-display form-control\"\n            placeholder=\"What do you want to build?\"\n            value={this.state.query}\n            onChange={this.handleQueryInput}\n          />\n        </div>\n        {this.renderMatches()}\n      </div>\n    );\n  }\n}\n\ninterface RecipeMatchProps {\n  recipe: game.Recipe;\n  onClick(recipe: game.Recipe): void;\n}\n\nfunction card(body: React.ReactNode) {\n  return (\n    <div className=\"card\">\n      <div className=\"card-body\">{body}</div>\n    </div>\n  );\n}\n\nclass RecipeMatch extends React.PureComponent<RecipeMatchProps, {}> {\n  handleClickAdd = () => {\n    this.props.onClick(this.props.recipe);\n  };\n\n  render() {\n    const recipe = this.props.recipe;\n    const ingredients = recipe.ingredients.map((ing, i) => (\n      <Icon key={i} obj={ing.item} tooltip={card(ing.niceName())} />\n    ));\n    const products = recipe.products.map((prod, i) => (\n      <Icon key={i} obj={prod.item} tooltip={card(prod.niceName())} />\n    ));\n    return (\n      <tr onClick={this.handleClickAdd}>\n        <td className={styles.ResultName}>\n          <Icon obj={recipe} text={recipe.niceName()} />\n        </td>\n        <td>{recipe.crafting_time.toDecimal()}</td>\n        <td>{ingredients}</td>\n        <td>{products}</td>\n      </tr>\n    );\n  }\n}\n","import * as React from 'react';\nimport { Icon } from './Icon';\nimport { withGame, RecipeRowData } from '../state';\nimport { Totals } from '../totals';\nimport * as game from '../game';\n\nimport styles from './TotalCard.module.css';\n\ninterface Props {\n  gameData: game.GameData;\n  rows: RecipeRowData[];\n}\n\nfunction RawTotalCard(props: Props) {\n  const totals = new Totals();\n  for (let row of props.rows) {\n    totals.addRow(row);\n  }\n\n  const { ingredients, products } = totals.reduce();\n  if (!ingredients.length && !products.length) {\n    return <div />;\n  }\n\n  props.gameData.sortByItem(products, (p) => p.item);\n\n  return (\n    <div className={`card ${styles.TotalCard}`}>\n      <div className=\"card-header\">Combined Totals</div>\n      <div className=\"card-body\">\n        <div className=\"container-fluid\">\n          <div className=\"row\">\n            <div className=\"col\">\n              Ingredients:\n              {ingredients.map((ing, i) => (\n                <Icon key={i} obj={ing.item} text={ing.niceName()} />\n              ))}\n            </div>\n            <div className=\"col\">\n              Products:\n              {products.map((prod, i) => (\n                <Icon key={i} obj={prod.item} text={prod.niceName()} />\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport const TotalCard = withGame(RawTotalCard);\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Nav from 'react-bootstrap/Nav';\nimport Col from 'react-bootstrap/Col';\n\nimport { RecipeGroup } from './RecipeGroup';\nimport { Settings } from './Settings';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport { assertNever } from '../util';\n\nimport styles from './App.module.css';\n\ninterface Props {\n  state: AppState;\n  actions: AppActions;\n}\n\ninterface State {\n  activePage: ActivePage;\n}\n\nenum ActivePage {\n  Factory = 'FACTORY',\n  Settings = 'SETTINGS',\n}\n\nclass RawApp extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      activePage: ActivePage.Factory,\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n    document.addEventListener('keyup', this.handleKeyUp);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    document.removeEventListener('keyup', this.handleKeyUp);\n  }\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.add('shift-down');\n    }\n  };\n  handleKeyUp = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.remove('shift-down');\n    }\n  };\n\n  handleClickGroup = (i: number) => {\n    this.setState({\n      activePage: ActivePage.Factory,\n    });\n    this.props.actions.setActiveGroup(i);\n  };\n\n  handleClickAddGroup: React.MouseEventHandler<any> = (event) => {\n    event.preventDefault();\n    const defaultName = `Factory ${this.props.state.groups.length + 1}`;\n    const name = prompt('What do you want to name this group?', defaultName);\n    if (!name || !name.trim()) {\n      return;\n    }\n    this.props.actions.addGroup(name);\n  };\n\n  handleClickSettings = () => {\n    this.setState({\n      activePage: ActivePage.Settings,\n    });\n  };\n\n  renderNavbar() {\n    const settingsActive = this.state.activePage === ActivePage.Settings;\n\n    const activeKey = settingsActive\n      ? 'settings'\n      : this.props.state.activeGroupIdx;\n\n    const factoryPills = this.props.state.groups.map((group, i) => {\n      const active = activeKey === i;\n      return (\n        <Nav.Item onClick={() => this.handleClickGroup(i)} key={i}>\n          <Nav.Link active={active}>{group.name}</Nav.Link>\n        </Nav.Item>\n      );\n    });\n\n    return (\n      <>\n        <Nav className=\"flex-column\">\n          <Nav.Item>\n            <Nav.Link disabled>\n              <span role=\"img\" aria-label=\"Factory icon\">\n                🏭\n              </span>{' '}\n              Factories\n            </Nav.Link>\n          </Nav.Item>\n          {factoryPills}\n          <Nav.Item>\n            <Nav.Link onClick={this.handleClickAddGroup}>\n              Add A Factory\n            </Nav.Link>\n          </Nav.Item>\n          <Nav.Item>\n            <Nav.Link\n              active={activeKey === 'settings'}\n              onClick={this.handleClickSettings}\n            >\n              <span role=\"img\" aria-label=\"Gear icon\">\n                ⚙️\n              </span>{' '}\n              Settings\n            </Nav.Link>\n          </Nav.Item>\n        </Nav>\n      </>\n    );\n  }\n\n  renderFactory = () => {\n    const group = this.props.state.groups[this.props.state.activeGroupIdx];\n\n    return (\n      <Container fluid>\n        <RecipeGroup group={group} />\n      </Container>\n    );\n  };\n\n  renderSettings = () => {\n    return (\n      <Container fluid>\n        <Settings />\n      </Container>\n    );\n  };\n\n  render() {\n    if (!this.props.state.gameData.raw) {\n      return null;\n    }\n    let body: JSX.Element;\n    if (this.state.activePage === ActivePage.Factory) {\n      body = this.renderFactory();\n    } else if (this.state.activePage === ActivePage.Settings) {\n      body = this.renderSettings();\n    } else {\n      return assertNever(this.state.activePage);\n    }\n\n    return (\n      <Container fluid>\n        <Row>\n          <Col xs=\"2\" className={classNames('bg-primary', styles.Sidebar)}>\n            {this.renderNavbar()}\n          </Col>\n          <Col>{body}</Col>\n        </Row>\n      </Container>\n    );\n  }\n}\n\nexport const App = withBoth(RawApp);\n","import * as React from 'react';\nimport Button from 'react-bootstrap/Button';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport Dropdown from 'react-bootstrap/Dropdown';\n\nimport { DropResult, DragDropContext, Droppable } from 'react-beautiful-dnd';\n\nimport * as signal from '../signal';\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { RecipeRow } from './RecipeRow';\nimport { RecipePicker } from './RecipePicker';\nimport { TotalCard } from './TotalCard';\n\nimport { RecipeGroupData, RecipeRowData } from '../state';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport * as su from '../stateutil';\n\nimport styles from './RecipeGroup.module.css';\n\ninterface Props {\n  group: RecipeGroupData;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawRecipeGroup extends React.Component<Props, {}> {\n  componentDidMount() {\n    signal.addRecipeRow.addHandler(this.handlePickRecipe);\n  }\n\n  componentWillUnmount() {\n    signal.addRecipeRow.removeHandler(this.handlePickRecipe);\n  }\n\n  handlePickRecipe = (recipe: game.Recipe) => {\n    this.props.actions.addRow({\n      recipe: recipe,\n      machine: su.getDefaultMachine(recipe, this.props.state),\n      numMachines: Rational.one,\n      modules: [],\n      beaconModule: null,\n      numBeacons: 0,\n    });\n  };\n\n  handleDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    this.props.actions.moveRow(result.source.index, result.destination.index);\n  };\n\n  renderRow = (data: RecipeRowData, index: number) => {\n    return <RecipeRow key={data.recipe.name} index={index} {...data} />;\n  };\n\n  handleClickRename = () => {\n    const i = this.props.state.activeGroupIdx;\n    const name = prompt(\n      'Whatcha wanna call it now?',\n      this.props.state.groups[i].name\n    );\n    if (name) {\n      this.props.actions.renameGroup(i, name);\n    }\n  };\n\n  handleClickDelete = () => {\n    const i = this.props.state.activeGroupIdx;\n    const group = this.props.state.groups[i];\n    if (window.confirm(`Are you sure you want to delete ${group.name}`)) {\n      this.props.actions.removeGroup(i);\n    }\n  };\n\n  render() {\n    const gd = this.props.state.gameData;\n    const availableRecipes = gd.recipes.filter((recipe) => {\n      return !this.props.group.rows.some((row) => row.recipe === recipe);\n    });\n\n    return (\n      <div className={styles.RecipeGroup}>\n        <div className=\"clearfix\">\n          <h3 className=\"float-left\">{this.props.group.name}</h3>\n          <div className=\"float-right\">\n            <Dropdown as={ButtonGroup} size=\"sm\">\n              <Button variant=\"info\" onClick={this.handleClickRename}>\n                Rename\n              </Button>\n\n              <Dropdown.Toggle split variant=\"info\" id=\"button-split\" />\n\n              <Dropdown.Menu>\n                <Dropdown.Item onClick={this.handleClickDelete}>\n                  Delete\n                </Dropdown.Item>\n              </Dropdown.Menu>\n            </Dropdown>\n          </div>\n        </div>\n        <RecipePicker\n          recipes={availableRecipes}\n          onPickRecipe={this.handlePickRecipe}\n        />\n        <hr />\n\n        <DragDropContext onDragEnd={this.handleDragEnd}>\n          <Droppable droppableId={'eyy'}>\n            {(provided) => (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {this.props.group.rows.map(this.renderRow)}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        <hr />\n        <TotalCard rows={this.props.group.rows} />\n      </div>\n    );\n  }\n}\n\nexport const RecipeGroup = withBoth(RawRecipeGroup);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { AppActions, AppState, withGame, withBoth } from '../state';\nimport { getDefaultMachine } from '../stateutil';\n\nimport { MachinePicker } from './MachinePicker';\n\ninterface RawSettingsProps {\n  gameData: game.GameData;\n}\n\nclass RawSettings extends React.Component<RawSettingsProps, {}> {\n  render() {\n    const categoryNames = Object.entries(this.props.gameData.categoryMap)\n      .filter((entry) => entry[1].length > 1)\n      .map((entry) => entry[0]);\n\n    categoryNames.sort((a, b) => a.localeCompare(b));\n\n    return (\n      <div>\n        <h3>Default Assemblers</h3>\n        {categoryNames.map((name) => (\n          <CategoryRow key={name} category={name} />\n        ))}\n      </div>\n    );\n  }\n}\n\ninterface CategoryRowProps {\n  category: string;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawCategoryRow extends React.Component<CategoryRowProps, {}> {\n  handleChange = (machine: game.AssemblingMachine) => {\n    this.props.actions.updateDefaultMachine(this.props.category, machine);\n  };\n\n  render() {\n    const machines = this.props.state.gameData.categoryMap[this.props.category];\n    const selected = getDefaultMachine(this.props.category, this.props.state);\n    return (\n      <div className=\"btn-toolbar mb-3\" key={this.props.category}>\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">{this.props.category}</span>\n          </div>\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={machines}\n              selected={selected}\n              onChange={this.handleChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst CategoryRow = withBoth(RawCategoryRow);\n\nexport const Settings = withGame(RawSettings);\n","import React, { useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport * as game from '../game';\nimport { AppActions, withBoth, useDakpan } from '../state';\nimport * as serialization from '../serialization';\n\nimport { App } from './App';\n\ninterface Props {\n  actions: AppActions;\n}\ninterface State {\n  gameData: game.GameData | null;\n}\n\nclass RawAppLoader extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      gameData: null,\n    };\n  }\n  componentDidMount() {\n    this.load().catch((err) => {\n      this.setState(() => {\n        throw err;\n      });\n    });\n  }\n\n  async load() {\n    const response = await fetch('assets/seablock-17.json');\n    if (response.status !== 200) {\n      throw new Error(\n        `Could not load game data, got HTTP status ${response.status}`\n      );\n    }\n\n    let parsed;\n    try {\n      parsed = await response.json();\n    } catch (err) {\n      throw new Error(`Could not parse game data: ${err}`);\n    }\n\n    const gameData = new game.GameData(parsed);\n\n    this.props.actions.replaceState({ gameData });\n\n    const urlState = serialization.getUrlState(gameData);\n    if (urlState) {\n      // everything comes from url state\n      this.props.actions.replaceState(urlState);\n    } else {\n      // Load just settings\n      try {\n        const storageState = serialization.getLocalStorageState(gameData);\n        if (storageState) {\n          // everything comes from url state\n          this.props.actions.replaceState(storageState);\n        }\n      } catch (err) {\n        console.error('Failed to load local storage state', err);\n      }\n    }\n\n    this.setState({ gameData });\n  }\n\n  render() {\n    if (!this.state.gameData) {\n      return <h1>Loading...</h1>;\n    }\n    const sheet = `assets/sprite-sheet-${this.state.gameData.raw.sprites.hash}.png`;\n    const style = `\n        .game-icon {\n            background-image: url(${sheet});\n        }\n        `;\n    return (\n      <>\n        <StateWriter />\n        <Prefetch href={sheet} />\n        <style>{style}</style>\n        <App />\n      </>\n    );\n  }\n}\n\nconst StateWriter: React.FC = () => {\n  const [state] = useDakpan();\n\n  useEffect(() => {\n    serialization.setUrlState(state);\n    serialization.setLocalStorageState(state);\n  }, [state]);\n\n  return null;\n};\n\nconst Prefetch: React.FC<{ href: string }> = (props) => {\n  return ReactDOM.createPortal(\n    <link rel=\"prefetch\" href={props.href} />,\n    document.head\n  );\n};\n\nexport const AppLoader = withBoth(RawAppLoader);\n","import * as Sentry from '@sentry/browser';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { ErrorCatcher } from './components/ErrorCatcher';\nimport { AppLoader } from './components/AppLoader';\nimport { StateProvider } from './state';\n\nimport './index.css';\n\nif (process.env.NODE_ENV === 'production') {\n  Sentry.init({\n    dsn: 'https://2ab99c1e02a448cbaa06595164416044@sentry.io/1385727',\n  });\n}\n\nReactDOM.render(\n  <ErrorCatcher>\n    <StateProvider>\n      <AppLoader />\n    </StateProvider>\n  </ErrorCatcher>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipePicker\":\"RecipePicker_RecipePicker__3sU3V\",\"ResultName\":\"RecipePicker_ResultName__jSE56\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"crashed\":\"ErrorCatcher_crashed__3tour\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Icon\":\"Icon_Icon__377W-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"TotalCard\":\"TotalCard_TotalCard__2ci0q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipeGroup\":\"RecipeGroup_RecipeGroup__3MC_F\"};"],"sourceRoot":""}