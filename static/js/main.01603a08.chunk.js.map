{"version":3,"sources":["components/RecipeGroup.module.css","components/App.module.css","components/ErrorCatcher.tsx","util.ts","rational.ts","game.ts","stateutil.ts","state.tsx","serialization.ts","signal.ts","components/generic/Dropdown.tsx","components/generic/Tooltip.tsx","components/generic/IntegerInput.tsx","components/generic/RationalInput.tsx","components/Icon.tsx","components/IngredientCard.tsx","components/RecipeOutput.tsx","components/MachineCard.tsx","components/RecipeCard.tsx","components/MachinePicker.tsx","components/ModuleCard.tsx","components/ModulePicker.tsx","totals.ts","components/RecipeRow.tsx","components/RecipePicker.tsx","components/TotalCard.tsx","components/App.tsx","components/RecipeGroup.tsx","components/Settings.tsx","components/AppLoader.tsx","index.tsx","components/RecipePicker.module.css","components/ErrorCatcher.module.css","components/Icon.module.css","components/TotalCard.module.css"],"names":["module","exports","ErrorCatcher","props","state","crashMsg","undefined","error","errorInfo","this","crash","componentStack","stack","join","Sentry","scope","Object","keys","forEach","key","setExtra","msg","setState","className","styles","crashed","children","React","assert","check","message","Error","mapValues","obj","fn","ret","values","push","clone","orig","assign","create","getPrototypeOf","round2","num","places","mag","Math","pow","round","format_magnitude","amount","suffixes","i","length","num_divmod","a","b","Number","isSafeInteger","quotient","floor","remainder","Rational","p","q","toString","div","num_gcd","divmod","result","less","zero","sub","one","other","fromFloat","min","max","mul","maxDigits","roundingFactor","sign","x","isNegative","negate","add","integerPart","decimalPart","fraction","ten","equal","slice","isInteger","r","lookups","value","str","index","indexOf","fromInts","oneThird","twoThirds","rounded","floored","BaseDisplayable","data","name","localised_name","icon_col","icon_row","en","BaseItem","d","raw","usedBy","madeBy","Module","type","limitedTo","effects","Set","limitation","speed","effect","bonus","productivity","consumption","pollution","recipe","size","has","GenericItem","Fluid","default_temperature","BaseIngredient","ItemIngredient","gd","item","itemMap","toDecimal","niceName","FluidIngredient","minimum_temperature","maximum_temperature","fluidMap","Infinity","range","BaseProduct","amount_min","amount_max","probability","ItemProduct","ingredient","FluidProduct","temperature","console","temp","Recipe","category","ingredients","products","crafting_time","madeIn","energy_required","map","results","AssemblingMachine","crafting_categories","createCategoryMap","entities","catMap","entity","hasOwnProperty","GameData","items","fluids","modules","moduleMap","recipes","recipeMap","entityMap","categoryMap","groupCollapsed","addOfType","ctor","edata","itemName","thing","fluid","recipeName","entityName","canBuildRecipe","some","isPositive","debug","warn","log","groupEnd","groupOrder","subgroupOrder","group","groups","order","subgroups","subgroup","collection","keyFn","sort","ordersA","getItemOrder","ordersB","valA","valB","getDefaultMachine","input","defaultMachine","game","settings","assemblerOverrides","gameData","defaultState","fakeGameData","rows","activeGroupIdx","recipeTarget","getActiveGroup","updateGroup","newGroup","oldGroup","createDakpan","replaceState","newState","addRow","row","updateRow","updates","Array","from","removeRow","splice","moveRow","oldIndex","newIndex","removed","updateDefaultMachine","newMachine","oldMachine","machine","setActiveGroup","groupIdx","addGroup","renameGroup","removeGroup","maxIndex","setRecipeTarget","StateProvider","useDakpan","withBoth","OldComponent","actions","withGame","groupv4to5","getLocalStorageState","statestr","localStorage","getItem","stateobj","JSON","parse","version","deserialize","serialize","machineName","numMachines","toFraction","m","beaconModule","numBeacons","reStateUrl","getUrlState","matches","exec","document","location","hash","decodeURIComponent","inflate","atob","to","migrateSerializedState","state1to2","state2to3","state3to4","state4to5","unmigrated","migrated","deserializeSettings","fromString","n","serialized","Signal","handlers","dispatch","arg","handler","addIngredientFilter","addProductFilter","addRecipeRow","ESC_KEYCODE","Dropdown","buttonRef","isOpen","handleToggle","handleSelect","selected","onSelect","handleWantClose","floater","canToggle","options","option","disabled","classes","parentRef","renderOption","onWantClose","ref","onClick","renderSelected","DropdownMenu","popperInstance","menuRef","style","popperUpdate","handleBodyClick","event","current","target","contains","handleKeyEvent","keyCode","renderOptions","header","active","referenceEl","menuEl","Popper","modifiers","applyStyle","enabled","updateStateWithStyle","body","addEventListener","disableEventListeners","removeEventListener","Tooltip","selfRef","handleMouseEnter","showSelf","handleMouseLeave","zIndex","relativeTo","selfEl","placement","offset","preventOverflow","boundariesElement","_","prevState","initPopper","cleanupPopper","ReactDOM","IntegerInput","handleChange","txtValue","trim","isNaN","onChange","oldProps","step","RationalInput","errmsg","parsed","stringToRational","err","positiveOnly","rationalToString","classNames","lastIndexOf","rational","dec","toFloat","Icon","iconRef","createRef","y","divStyle","display","backgroundPosition","width","height","icon","title","tooltip","text","lineHeight","marginLeft","PureComponent","IngredientCard","extras","fuel_value","totalValue","Card","Body","extra","Header","RawRecipeOutput","handleClick","shiftKey","preventDefault","stopPropagation","signal","showName","includes","perSecond","RecipeOutput","MachineCard","crafting_speed","module_slots","RecipeCard","product","sprites","float","clear","MachinePicker","machines","ModuleCard","bonuses","bonusName","ModulePicker","slot_icon_module","nomod","rocket_launch_products","filter","isBeacon","canUseWith","unshift","Totals","addIngredient","newIng","oldIng","match","addProduct","newProd","oldProd","be","clamp","ingredientMult","invert","productMult","isZero","satisfies","RecipeRow","handleRemoveClick","handleMachineChange","applyChange","handleNumMachinesChange","handleNumBeaconsChange","handleSetAllModules","fill","handleSetModule","handleSetBeaconModule","handleInputGroupClick","output","find","newNum","change","t","numSlots","slots","getOutput","draggableId","provided","innerRef","draggableProps","dragHandleProps","Button","variant","renderMachines","renderModules","renderBeacons","minWidth","getFn","RE_ADVANCED","RecipePicker","inputRef","query","handleIngredientClick","term","setQuery","calculateMatches","scrollIntoView","handleProductClick","handleQueryInput","handleRecipeClick","onPickRecipe","callback","debCalculateMatches","cancel","debounce","bind","addHandler","removeHandler","toLowerCase","conditions","consumes","produces","replace","Fuse","shouldSort","weight","search","placeholder","renderMatches","RecipeMatch","handleClickAdd","ing","prod","ResultName","ActivePage","TotalCard","totals","reduce","sortByItem","RecipeGroup","handlePickRecipe","su","handleDragEnd","destination","source","renderRow","handleClickRename","prompt","handleClickDelete","window","confirm","availableRecipes","as","ButtonGroup","Toggle","split","id","Menu","Item","onDragEnd","droppableId","droppableProps","RawSettings","categoryNames","entries","entry","localeCompare","CategoryRow","Settings","App","handleKeyDown","classList","handleKeyUp","remove","handleClickGroup","activePage","Factory","handleClickAddGroup","defaultName","handleClickSettings","renderFactory","renderSettings","activeKey","factoryPills","Nav","Link","role","aria-label","assertNever","Container","Row","Col","xs","Sidebar","renderNavbar","RawAppLoader","load","catch","fetch","response","status","json","urlState","serialization","storageState","sheet","href","StateWriter","useEffect","stringify","btoa","deflate","history","setItem","Prefetch","rel","head","AppLoader","dsn","getElementById"],"mappings":"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","file":"static/js/main.01603a08.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipeGroup\":\"RecipeGroup_RecipeGroup__3MC_F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sidebar\":\"App_Sidebar__3POeR\"};","import * as React from 'react';\nimport * as Sentry from '@sentry/browser';\n\nimport styles from './ErrorCatcher.module.css';\n\ninterface Props {}\n\ninterface State {\n  crashMsg?: string;\n}\n\nexport class ErrorCatcher extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      crashMsg: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    // Catch errors in any components below and re-render with error message\n    this.crash(\n      [\n        'Component Stack:',\n        errorInfo.componentStack,\n        '',\n        error && error.stack,\n      ].join('\\n')\n    );\n\n    Sentry.withScope((scope) => {\n      Object.keys(errorInfo).forEach((key) => {\n        scope.setExtra(key, errorInfo[key as keyof React.ErrorInfo]);\n      });\n      Sentry.captureException(error);\n    });\n  }\n\n  crash(msg: string) {\n    this.setState({\n      crashMsg: msg,\n    });\n  }\n\n  render() {\n    if (typeof this.state.crashMsg !== 'undefined') {\n      return (\n        <div className={styles.crashed}>\n          <h1>Crashed!</h1>\n          <pre>{this.state.crashMsg}</pre>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","export function assert(check: any, message?: string): void {\n  if (!check) {\n    throw new Error(message || 'Assertion failed');\n  }\n}\n\nexport function assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\nexport function mapValues<T, V>(\n  obj: { [s: string]: T },\n  fn: (v: T) => V\n): { [s: string]: V } {\n  let ret: { [key: string]: V } = {};\n  for (let key in obj) {\n    ret[key] = fn(obj[key]);\n  }\n  return ret;\n}\n\nexport function values<T>(obj: { [s: string]: T }): T[] {\n  const values = [];\n  for (let key in obj) {\n    values.push(obj[key]);\n  }\n  return values;\n}\n\nexport function clone<T>(orig: T): T {\n  return Object.assign(Object.create(Object.getPrototypeOf(orig)), orig);\n}\n\nexport function round2(num: number, places: number) {\n  const mag = Math.pow(10, places);\n  return Math.round(num * mag) / mag;\n}\n\nexport function format_magnitude(amount: number, suffixes: string[]): string {\n  let i = 0;\n  for (; i < suffixes.length; i++) {\n    if (amount >= 1000) {\n      amount = amount / 1000;\n    } else {\n      break;\n    }\n  }\n\n  return `${round2(amount, 2)} ${suffixes[i]}`;\n}\n\nexport function format_watts(watts: number): string {\n  return format_magnitude(watts, ['W', 'kW', 'MW', 'GW', 'TW', 'PW']);\n}\n\nexport function format_joules(joules: number): string {\n  return format_magnitude(joules, ['J', 'kJ', 'MJ', 'GJ', 'TJ', 'PJ']);\n}\n","import { assert } from './util';\n\nfunction num_gcd(a: number, b: number): number {\n  return !b ? a : num_gcd(b, a % b);\n}\n\nfunction num_divmod(a: number, b: number) {\n  assert(Number.isSafeInteger(a));\n  assert(Number.isSafeInteger(b));\n\n  return {\n    quotient: Math.floor(a / b),\n    remainder: a % b,\n  };\n}\n\nconst FLOAT_CONVERT_PRECISION = 10000;\n\nexport class Rational {\n  p: number;\n  q: number;\n\n  constructor(p: number, q: number) {\n    assert(\n      Number.isSafeInteger(p),\n      `Numerator must be a safe integer, got ${p}`\n    );\n    assert(\n      Number.isSafeInteger(q),\n      `Denominator must be a safe integer, got ${q}`\n    );\n    assert(q !== 0, 'Denominator must not be zero');\n\n    if (q < 0) {\n      p = -p;\n      q = -q;\n    }\n\n    if (p === 0) {\n      q = 1;\n    }\n\n    const div = num_gcd(p, q);\n    if (div > 1) {\n      p = p / div;\n      q = q / div;\n    }\n    this.p = p;\n    this.q = q;\n  }\n\n  //\n  // Operations returning Rational\n  //\n  floor() {\n    const divmod = num_divmod(this.p, this.q);\n    let result = new Rational(divmod.quotient, 1);\n    if (result.less(Rational.zero) && divmod.remainder !== 0) {\n      result = result.sub(Rational.one);\n    }\n    return result;\n  }\n\n  negate() {\n    return new Rational(-this.p, this.q);\n  }\n\n  invert() {\n    return new Rational(this.q, this.p);\n  }\n\n  add(other: Rational) {\n    return new Rational(this.p * other.q + this.q * other.p, this.q * other.q);\n  }\n\n  sub(other: Rational) {\n    return new Rational(this.p * other.q - this.q * other.p, this.q * other.q);\n  }\n\n  mul(other: Rational | number): Rational {\n    if (typeof other == 'number') {\n      other = Rational.fromFloat(other);\n    }\n    return new Rational(this.p * other.p, this.q * other.q);\n  }\n\n  div(other: Rational) {\n    return new Rational(this.p * other.q, this.q * other.p);\n  }\n\n  clamp(min: Rational | number, max: Rational | number) {\n    if (typeof min == 'number') {\n      min = Rational.fromFloat(min);\n    }\n    if (typeof max == 'number') {\n      max = Rational.fromFloat(max);\n    }\n\n    if (this.less(min)) return min;\n    if (max.less(this)) return max;\n    return this;\n  }\n\n  //\n  // Operations NOT returning Rational\n  //\n  divmod(other: Rational) {\n    var quotient = this.div(other);\n    var div = quotient.floor();\n    var mod = this.sub(other.mul(div));\n    return { quotient: div, remainder: mod };\n  }\n\n  equal(other: Rational) {\n    return this.p === other.p && this.q === other.q;\n  }\n\n  isNegative() {\n    return this.p < 0;\n  }\n  isPositive() {\n    return this.p > 0;\n  }\n\n  isOne() {\n    return this.p === 1;\n  }\n\n  isZero() {\n    return this.p === 0;\n  }\n\n  less(other: Rational) {\n    return this.p * other.q < this.q * other.p;\n  }\n\n  toFloat() {\n    return this.p / this.q;\n  }\n\n  // Disabled to force choice between toFraction and toDecimal\n  toString: null;\n\n  toFraction() {\n    if (this.q === 1) {\n      return this.p.toString();\n    }\n    return this.p.toString() + '/' + this.q.toString();\n  }\n\n  toDecimal(maxDigits?: number, roundingFactor?: Rational) {\n    if (maxDigits == null) {\n      maxDigits = 3;\n    }\n    if (roundingFactor == null) {\n      roundingFactor = new Rational(5, 10 ** (maxDigits + 1));\n    }\n\n    let sign = '';\n    let x: Rational = this;\n    if (x.isNegative()) {\n      sign = '-';\n      x = x.negate();\n    }\n    x = x.add(roundingFactor);\n    let divmod = num_divmod(x.p, x.q);\n    var integerPart = divmod.quotient.toString();\n    var decimalPart = '';\n    var fraction = new Rational(divmod.remainder, x.q);\n    let ten = new Rational(10, 1);\n    while (maxDigits > 0 && !fraction.equal(roundingFactor)) {\n      fraction = fraction.mul(ten);\n      roundingFactor = roundingFactor.mul(ten);\n      let divmod = num_divmod(fraction.p, fraction.q);\n      decimalPart += divmod.quotient.toString();\n      fraction = new Rational(divmod.remainder, fraction.q);\n      maxDigits--;\n    }\n    if (fraction.equal(roundingFactor)) {\n      while (decimalPart[decimalPart.length - 1] === '0') {\n        decimalPart = decimalPart.slice(0, decimalPart.length - 1);\n      }\n    }\n    if (decimalPart !== '') {\n      return sign + integerPart + '.' + decimalPart;\n    }\n    return sign + integerPart;\n  }\n\n  //\n  // Statics\n  //\n  static fromFloat(num: number) {\n    if (Number.isInteger(num)) {\n      return new this(num, 1);\n    }\n\n    // Sufficient precision for our data?\n    const r = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n\n    const divmod = r.divmod(Rational.one);\n    for (const [key, value] of lookups) {\n      if (divmod.remainder.equal(key)) {\n        return divmod.quotient.add(value);\n      }\n    }\n\n    return r;\n  }\n  static fromInts(p: number, q: number) {\n    return new this(p, q);\n  }\n  static fromString(str: string) {\n    const index = str.indexOf('/');\n    if (index === -1) {\n      return Rational.fromFloat(Number(str));\n    } else {\n      const p = Number(str.slice(0, index));\n      const q = Number(str.slice(index + 1));\n      return Rational.fromInts(p, q);\n    }\n  }\n\n  static zero = new Rational(0, 1);\n  static one = new Rational(1, 1);\n  static oneThird = new Rational(1, 3);\n  static twoThirds = new Rational(2, 3);\n}\n\nconst lookups: [Rational, Rational][] = [];\n\nfor (let q = 2; q < 100; q++) {\n  for (let p = 1; p < q; p++) {\n    const num = p / q;\n\n    // Is there a better way to quickly filter out non-repeating decimals?\n    if (num.toString().length < 10) {\n      continue;\n    }\n\n    // Support computer input, use proper rounding\n    const rounded = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([rounded, Rational.fromInts(p, q)]);\n\n    // Support human input, who just leave off the end after a while\n    const floored = new Rational(\n      Math.floor(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([floored, Rational.fromInts(p, q)]);\n  }\n}\n","import { Rational } from './rational';\nimport { assert, values } from './util';\n\nimport * as schema from './schema';\n\ntype LocalisedName = schema.LocalisedName;\n\ninterface IBaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n}\n\nexport class BaseDisplayable {\n  name: string;\n  localised_name: LocalisedName;\n  icon_col: number;\n  icon_row: number;\n\n  constructor(data: IBaseDisplayable) {\n    this.name = data.name;\n    this.localised_name = data.localised_name;\n    this.icon_col = data.icon_col;\n    this.icon_row = data.icon_row;\n  }\n\n  niceName() {\n    return this.localised_name.en;\n  }\n}\n\nabstract class BaseItem<T extends schema.Item> extends BaseDisplayable {\n  raw: T;\n  usedBy: Recipe[] = [];\n  madeBy: Recipe[] = [];\n\n  constructor(d: T) {\n    super(d);\n    this.raw = d;\n    this.name = d.name;\n    this.localised_name = d.localised_name;\n    this.icon_col = d.icon_col;\n    this.icon_row = d.icon_row;\n  }\n}\n\nexport class Module extends BaseItem<schema.ModuleItem> {\n  type: 'module';\n  limitedTo: Set<string>;\n  effects: {\n    speed: Rational;\n    productivity: Rational;\n    consumption: Rational;\n    pollution: Rational;\n  };\n\n  constructor(d: schema.ModuleItem) {\n    super(d);\n    this.type = d.type;\n    this.limitedTo = new Set(d.limitation);\n\n    this.effects = {\n      speed: Rational.fromFloat((d.effect.speed || { bonus: 0 }).bonus),\n      productivity: Rational.fromFloat(\n        (d.effect.productivity || { bonus: 0 }).bonus\n      ),\n      consumption: Rational.fromFloat(\n        (d.effect.consumption || { bonus: 0 }).bonus\n      ),\n      pollution: Rational.fromFloat((d.effect.pollution || { bonus: 0 }).bonus),\n    };\n  }\n\n  canUseWith(recipe: Recipe) {\n    if (this.limitedTo.size === 0) {\n      return true;\n    }\n\n    return this.limitedTo.has(recipe.name);\n  }\n}\n\nclass GenericItem extends BaseItem<schema.Item> {\n  type: 'generic' = 'generic';\n}\n\nexport type Item = Module | GenericItem;\n\nexport class Fluid extends BaseItem<schema.FluidItem> {\n  default_temperature: number;\n  type: 'fluid' = 'fluid';\n\n  constructor(d: schema.FluidItem) {\n    super(d);\n    this.default_temperature = d.default_temperature;\n  }\n}\n\nexport abstract class BaseIngredient {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Ingredient) {\n    this.name = d.name;\n    this.amount = Rational.fromFloat(d.amount);\n  }\n}\n\nexport class ItemIngredient extends BaseIngredient {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}`;\n  }\n}\n\nexport class FluidIngredient extends BaseIngredient {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  minimum_temperature: number;\n  maximum_temperature: number;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n\n    this.minimum_temperature = d.minimum_temperature || -Infinity;\n    this.maximum_temperature = d.maximum_temperature || Infinity;\n\n    if (this.maximum_temperature >= 1.797e308) {\n      this.maximum_temperature = Infinity;\n    }\n    if (this.minimum_temperature <= -1.797e308) {\n      this.minimum_temperature = -Infinity;\n    }\n  }\n\n  niceName() {\n    const min = this.minimum_temperature;\n    const max = this.maximum_temperature;\n    let range = '';\n    if (min !== -Infinity && max !== Infinity) {\n      range = ` (${min}  ${max})`;\n    } else if (max !== Infinity) {\n      range = ` ( ${max})`;\n    } else if (min !== -Infinity) {\n      range = ` ( ${max})`;\n    }\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}${range}`;\n  }\n}\n\nexport type Ingredient = ItemIngredient | FluidIngredient;\n\nabstract class BaseProduct {\n  name: string;\n  amount: Rational;\n\n  constructor(d: schema.Product) {\n    this.name = d.name;\n\n    let amount;\n    if ('amount' in d) {\n      amount = Rational.fromFloat(d.amount);\n    } else {\n      amount = Rational.fromInts(d.amount_min + d.amount_max, 2);\n    }\n\n    if (typeof d.probability == 'number') {\n      if (d.probability === 0) {\n        amount = Rational.zero;\n      } else if (d.probability !== 1) {\n        assert(d.probability > 0);\n        assert(d.probability < 1);\n        amount = amount.mul(Rational.fromFloat(d.probability));\n      }\n    }\n    this.amount = amount;\n  }\n}\n\nexport class ItemProduct extends BaseProduct {\n  type: 'item' = 'item';\n  item: Item;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.itemMap[d.name];\n  }\n\n  niceName() {\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return ingredient.type === 'item' && ingredient.item === this.item;\n  }\n}\n\nexport class FluidProduct extends BaseProduct {\n  type: 'fluid' = 'fluid';\n  item: Fluid;\n  temperature: number;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d);\n    this.item = gd.fluidMap[d.name];\n    if (!this.item) {\n      console.error('could not find item', d);\n    }\n    this.temperature = d.temperature || this.item.default_temperature;\n  }\n\n  niceName() {\n    let temp = '';\n    if (this.temperature !== this.item.default_temperature) {\n      temp = ` (${this.temperature})`;\n    }\n    return `${this.amount.toDecimal()}  ${this.item.niceName()}${temp}`;\n  }\n\n  satisfies(ingredient: Ingredient) {\n    return (\n      ingredient.type === 'fluid' &&\n      ingredient.item === this.item &&\n      ingredient.maximum_temperature >= this.temperature &&\n      ingredient.minimum_temperature <= this.temperature\n    );\n  }\n}\n\nexport type Product = ItemProduct | FluidProduct;\n\nexport class Recipe extends BaseDisplayable {\n  category: string;\n  ingredients: Ingredient[];\n  products: Product[];\n  crafting_time: Rational;\n\n  madeIn: AssemblingMachine[] = [];\n\n  constructor(d: schema.Recipe, gd: GameData) {\n    super(d);\n    this.name = d.name;\n    this.category = d.category;\n    this.crafting_time = Rational.fromFloat(d.energy_required);\n\n    this.ingredients = d.ingredients.map((ingredient) => {\n      if (ingredient.type === 'fluid') {\n        return new FluidIngredient(ingredient, gd);\n      } else {\n        return new ItemIngredient(ingredient, gd);\n      }\n    });\n\n    this.products = d.results.map((result) => {\n      if (result.type === 'fluid') {\n        return new FluidProduct(result, gd);\n      } else {\n        return new ItemProduct(result, gd);\n      }\n    });\n  }\n\n  niceName() {\n    if (this.products.length > 1) {\n      return super.niceName();\n    } else if (this.products[0].amount.equal(Rational.one)) {\n      return this.products[0].item.niceName();\n    } else {\n      return this.products[0].niceName();\n    }\n  }\n}\n\nexport abstract class BaseEntity<T extends schema.BaseEntity> {\n  data: T;\n  constructor(data: T) {\n    this.data = data;\n  }\n\n  niceName() {\n    return this.data.localised_name.en;\n  }\n}\n\nexport class AssemblingMachine extends BaseEntity<schema.AssemblingMachine> {\n  canBuildRecipe(recipe: Recipe) {\n    // TODO: this needs to account for entity fluid boxes\n    if (this.data.crafting_categories.indexOf(recipe.category) === -1) {\n      return false;\n    }\n\n    // ingredient_count seems to be item specific. this is disabled until\n    // I can figure out how many fluids a machine can support\n    // if (recipe.ingredients.length > this.data.ingredient_count) {\n    //     return false\n    // }\n    return true;\n  }\n}\n\nexport type Entity = AssemblingMachine;\n\ntype CategoryMap = { [category: string]: AssemblingMachine[] };\n\nconst createCategoryMap = (entities: Entity[]) => {\n  const catMap: CategoryMap = {};\n  for (let entity of entities) {\n    if (!(entity instanceof AssemblingMachine)) {\n    }\n    for (let category of entity.data.crafting_categories) {\n      if (!catMap.hasOwnProperty(category)) {\n        catMap[category] = [];\n      }\n      catMap[category].push(entity);\n    }\n  }\n  return catMap;\n};\n\nexport class GameData {\n  raw: schema.Root;\n\n  items: Item[] = [];\n  itemMap: { [name: string]: Item } = {};\n\n  fluids: Fluid[] = [];\n  fluidMap: { [name: string]: Fluid } = {};\n\n  modules: Module[] = [];\n  moduleMap: { [name: string]: Module } = {};\n\n  recipes: Recipe[] = [];\n  recipeMap: { [name: string]: Recipe } = {};\n\n  entities: Entity[] = [];\n  entityMap: { [name: string]: Entity } = {};\n\n  categoryMap: CategoryMap;\n\n  constructor(raw: schema.Root) {\n    console.groupCollapsed('Game data processing');\n    this.raw = raw;\n\n    type Thing<T> = {\n      new (d: T): Entity;\n    };\n\n    const addOfType = <S extends schema.BaseEntity, C extends Thing<S>>(\n      entities: S[],\n      ctor: C\n    ) => {\n      for (let edata of entities) {\n        const entity = new ctor(edata);\n        this.entityMap[edata.name] = entity;\n        this.entities.push(entity);\n      }\n    };\n\n    addOfType(values(raw['assembling-machine']), AssemblingMachine);\n    addOfType(values(raw['furnace']), AssemblingMachine);\n    addOfType(values(raw['rocket-silo']), AssemblingMachine);\n\n    for (let itemName in raw.items) {\n      const thing = raw.items[itemName];\n      if ('type' in thing && thing.type === 'fluid') {\n        const fluid = new Fluid(thing);\n        this.fluids.push(fluid);\n        this.fluidMap[fluid.name] = fluid;\n      } else if ('type' in thing && thing.type === 'module') {\n        const item = new Module(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n        this.modules.push(item);\n        this.moduleMap[item.name] = item;\n      } else {\n        const item = new GenericItem(thing);\n        this.items.push(item);\n        this.itemMap[item.name] = item;\n      }\n    }\n\n    for (let recipeName in raw.recipes) {\n      const recipe = new Recipe(raw.recipes[recipeName], this);\n\n      for (let entityName in this.entityMap) {\n        const entity = this.entityMap[entityName];\n\n        if ('canBuildRecipe' in entity && entity.canBuildRecipe(recipe)) {\n          recipe.madeIn.push(entity);\n        }\n      }\n      if (!recipe.madeIn.length) {\n        // Filter to only recipes buildable by knonwn assembling machines\n        console.warn('Ignoring uncraftable recipe', recipe.name, recipe);\n        continue;\n      }\n\n      const hasProducts = recipe.products.some((p) => p.amount.isPositive());\n      if (!hasProducts) {\n        console.debug('Ignoring void recipe', recipe.name, recipe);\n        continue;\n      }\n\n      this.recipeMap[recipe.name] = recipe;\n      this.recipes.push(recipe);\n\n      for (let ingredient of recipe.ingredients) {\n        ingredient.item.usedBy.push(recipe);\n      }\n      for (let product of recipe.products) {\n        product.item.madeBy.push(recipe);\n      }\n    }\n\n    this.categoryMap = createCategoryMap(this.entities);\n    console.log(`Processed ${this.items.length} items`);\n    console.log(`Processed ${this.fluids.length} fluids`);\n    console.log(`Processed ${this.recipes.length} recipes`);\n    console.log(`Processed ${this.entities.length} entities`);\n    console.groupEnd();\n  }\n\n  getItemOrder(item: Item | Fluid) {\n    let groupOrder = '';\n    let subgroupOrder = '';\n    const group = this.raw.groups[item.raw.group];\n    if (group) {\n      groupOrder = group.order;\n      subgroupOrder = group.subgroups[item.raw.subgroup] || '';\n    }\n    return [groupOrder, subgroupOrder, item.raw.order, item.raw.name];\n  }\n\n  // Sort by\n  // 1. group\n  // 2. subgroup\n  // 3. item order string\n  // 4. item name\n  sortByItem<T>(collection: T[], keyFn: (obj: T) => Item | Fluid): void {\n    const sortFn = (a: T, b: T) => {\n      const ordersA = this.getItemOrder(keyFn(a));\n      const ordersB = this.getItemOrder(keyFn(b));\n\n      for (const i in ordersA) {\n        const valA = ordersA[i];\n        const valB = ordersB[i];\n        if (valA > valB) {\n          return 1;\n        } else if (valA < valB) {\n          return -1;\n        }\n      }\n\n      return 0;\n    };\n\n    collection.sort(sortFn);\n  }\n}\n","import * as game from './game';\nimport { AppState } from './state';\nimport { assert } from './util';\n\nexport function getDefaultMachine(\n  category: string,\n  state: AppState\n): game.AssemblingMachine;\nexport function getDefaultMachine(\n  recipe: game.Recipe,\n  state: AppState\n): game.AssemblingMachine;\n\nexport function getDefaultMachine(\n  input: game.Recipe | string,\n  state: AppState\n): game.AssemblingMachine {\n  const category = input instanceof game.Recipe ? input.category : input;\n\n  let defaultMachine: game.AssemblingMachine;\n  if (category in state.settings.assemblerOverrides) {\n    defaultMachine = state.settings.assemblerOverrides[category];\n  } else {\n    defaultMachine = state.gameData.categoryMap[category][0];\n  }\n\n  if (input instanceof game.Recipe) {\n    assert(input.madeIn.indexOf(defaultMachine) !== -1);\n  }\n\n  return defaultMachine;\n}\n","import React from 'react';\nimport { createDakpan } from 'dakpan';\n\nimport * as game from './game';\nimport { Rational } from './rational';\nimport { getDefaultMachine } from './stateutil';\n\nexport interface RecipeRowData {\n  recipe: game.Recipe;\n  machine: game.AssemblingMachine;\n  numMachines: Rational;\n  modules: (game.Module | null)[];\n  beaconModule: game.Module | null;\n  numBeacons: number;\n}\n\nexport interface RecipeGroupData {\n  name: string;\n  rows: RecipeRowData[];\n}\n\nexport interface AppSettingsData {\n  assemblerOverrides: {\n    [category: string]: game.AssemblingMachine;\n  };\n}\n\nexport interface RecipeTarget {\n  item: game.Item | game.Fluid;\n  amount: Rational;\n}\n\nexport interface AppState {\n  // Loaded automatically\n  gameData: game.GameData;\n\n  // Preserved via url/localstorage\n  groups: RecipeGroupData[];\n  settings: AppSettingsData;\n\n  // unsaved state\n  activeGroupIdx: number;\n  recipeTarget: RecipeTarget | undefined;\n}\n\nexport const defaultState: AppState = {\n  gameData: ({ fakeGameData: true } as any) as game.GameData, // set early by apploader\n  groups: [\n    {\n      name: 'Factory 1',\n      rows: [],\n    },\n  ],\n  settings: {\n    assemblerOverrides: {},\n  },\n\n  activeGroupIdx: 0,\n  recipeTarget: undefined,\n};\n\nfunction getActiveGroup(state: AppState) {\n  return state.groups[state.activeGroupIdx];\n}\n\nfunction updateGroup(state: AppState, newGroup: Partial<RecipeGroupData>) {\n  const groups = state.groups.map((oldGroup, index) => {\n    return index === state.activeGroupIdx\n      ? { ...oldGroup, ...newGroup }\n      : oldGroup;\n  });\n\n  return { ...state, groups };\n}\n\nexport const [StateProvider, useDakpan] = createDakpan(defaultState)({\n  replaceState: (newState: Partial<AppState>) => (state) => {\n    return { ...state, ...newState };\n  },\n\n  addRow: (row: RecipeRowData) => (state) => {\n    const group = getActiveGroup(state);\n    // ignore adding duplicate rows\n    if (group.rows.some((r) => r.recipe.name === row.recipe.name)) {\n      return;\n    }\n\n    return updateGroup(state, { rows: [...group.rows, row] });\n  },\n\n  updateRow: (i: number, updates: Partial<RecipeRowData>) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows[i] = { ...group.rows[i], ...updates };\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  removeRow: (i: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n    rows.splice(i, 1);\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  moveRow: (oldIndex: number, newIndex: number) => (state) => {\n    const group = getActiveGroup(state);\n    const rows = Array.from(group.rows);\n\n    const [removed] = rows.splice(oldIndex, 1);\n    rows.splice(newIndex, 0, removed);\n\n    return updateGroup(state, {\n      rows: rows,\n    });\n  },\n\n  updateDefaultMachine: (category, newMachine) => (state) => {\n    const oldMachine = getDefaultMachine(category, state);\n\n    const groups = state.groups.map((group) => {\n      const rows = group.rows.map((row) => {\n        if (row.recipe.category !== category || row.machine !== oldMachine) {\n          return row;\n        }\n        return {\n          ...row,\n          machine: newMachine,\n        };\n      });\n\n      return { ...group, rows };\n    });\n\n    return {\n      ...state,\n      groups,\n      settings: {\n        ...state.settings,\n        assemblerOverrides: {\n          ...state.settings.assemblerOverrides,\n          [category]: newMachine,\n        },\n      },\n    };\n  },\n\n  setActiveGroup: (groupIdx: number) => (state) => {\n    return { ...state, activeGroupIdx: groupIdx };\n  },\n\n  addGroup: (name) => (state) => {\n    const groups = [\n      ...state.groups,\n      {\n        name,\n        rows: [],\n      },\n    ];\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx: state.groups.length,\n    };\n  },\n\n  renameGroup: (index: number, name: string) => (state) => {\n    const groups = [...state.groups];\n    groups[index] = { ...groups[index], name };\n    return {\n      ...state,\n      groups,\n    };\n  },\n\n  removeGroup: (index: number) => (state) => {\n    // Remove group\n    const groups = [...state.groups];\n    groups.splice(index, 1);\n\n    // Add new group if necessary\n    if (!groups.length) {\n      groups.push({\n        name: 'Factory 1',\n        rows: [],\n      });\n    }\n\n    // Fix the index if it's outside of bounds\n    const maxIndex = groups.length - 1;\n    const activeGroupIdx = Math.min(state.activeGroupIdx, maxIndex);\n\n    return {\n      ...state,\n      groups,\n      activeGroupIdx,\n    };\n  },\n\n  setRecipeTarget: (recipeTarget: RecipeTarget) => (state) => {\n    return {\n      ...state,\n      recipeTarget,\n    };\n  },\n});\n\nexport type AppActions = NonNullable<ReturnType<typeof useDakpan>[1]>;\n\nexport const withBoth = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'state' | 'actions'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state, actions] = useDakpan();\n    return <OldComponent state={state} actions={actions} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n\ntype PropsOf<\n  T extends React.ComponentType<any>\n> = T extends React.ComponentType<infer P> ? P : never;\n\nexport const withGame = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'gameData'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [state] = useDakpan();\n    return <OldComponent gameData={state.gameData} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n\nexport const withActions = <T extends React.ComponentType<any>>(\n  OldComponent: T\n) => {\n  type NewProps = Omit<PropsOf<T>, 'actions'>;\n\n  const WrappedComponent: React.FC<NewProps> = (props: any) => {\n    const [, actions] = useDakpan();\n    return <OldComponent actions={actions} {...props} />;\n  };\n\n  return WrappedComponent;\n};\n","import * as game from './game';\nimport { Rational } from './rational';\nimport { AppState, AppSettingsData } from './state';\nimport { getDefaultMachine } from './stateutil';\nimport { mapValues } from './util';\n\nimport { inflate, deflate } from 'pako';\n\ntype SerializedRowV1 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  number, // num assembling machines\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedAppStateV1 {\n  version: 1;\n  data: SerializedRowV1[];\n}\n\nfunction state1to2(state: SerializedAppStateV1): SerializedAppStateV2 {\n  return {\n    version: 2,\n    data: {\n      rows: state.data,\n      settings: {\n        assemblerOverrides: {},\n      },\n    },\n  };\n}\n\ninterface SerializedAppStateV2 {\n  version: 2;\n  data: {\n    rows: SerializedRowV1[];\n    settings: SerializedSettings;\n  };\n}\n\n// V3 = v2 but compressed\nfunction state2to3(state: SerializedAppStateV2): SerializedAppStateV3 {\n  return {\n    version: 3,\n    data: state.data,\n  };\n}\n\ninterface SerializedAppStateV3 {\n  version: 3;\n  data: SerializedAppStateV2['data'];\n}\n\n// v4 is multiple groups of rows\nfunction state3to4(state: SerializedAppStateV3): SerializedAppStateV4 {\n  return {\n    version: 4,\n    data: {\n      settings: state.data.settings,\n      groups: [\n        {\n          name: 'Factory 1',\n          rows: state.data.rows,\n        },\n      ],\n    },\n  };\n}\n\n// v4 has multiple groups, each with multiple rows\ninterface SerializedGroupV4 {\n  name: string;\n  rows: SerializedRowV1[];\n}\ninterface SerializedAppStateV4 {\n  version: 4;\n  data: {\n    groups: SerializedGroupV4[];\n    settings: SerializedSettings;\n  };\n}\n\nfunction groupv4to5(group: SerializedGroupV4): SerializedGroupV5 {\n  return {\n    name: group.name,\n    rows: group.rows.map((r) => {\n      return [r[0], r[1], r[2].toString(), r[3], r[4], r[5]];\n    }),\n  };\n}\n\n// v5 has multiple groups, each with multiple rows\nfunction state4to5(state: SerializedAppStateV4): SerializedAppStateV5 {\n  return {\n    version: 5,\n    data: {\n      settings: state.data.settings,\n      groups: state.data.groups.map(groupv4to5),\n    },\n  };\n}\ntype SerializedRowV5 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  string, // num assembling machines as a rational\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedGroupV5 {\n  name: string;\n  rows: SerializedRowV5[];\n}\ninterface SerializedAppStateV5 {\n  version: 5;\n  data: {\n    groups: SerializedGroupV5[];\n    settings: SerializedSettings;\n  };\n}\n\ninterface SerializedAppStateOther {\n  version: 0;\n  data: unknown;\n}\n\ntype MultiSerializedAppState =\n  | SerializedAppStateOther\n  | SerializedAppStateV1\n  | SerializedAppStateV2\n  | SerializedAppStateV3\n  | SerializedAppStateV4\n  | SerializedAppStateV5;\n\n// Latest values\n// type SerializedGroup = SerializedGroupV5;\ntype SerializedRow = SerializedRowV5;\ntype SerializedAppState = SerializedAppStateV5;\n\ninterface SerializedSettings {\n  assemblerOverrides: {\n    [category: string]: string;\n  };\n}\n\nexport function setLocalStorageState(state: AppState) {\n  localStorage.setItem('appstate', JSON.stringify(serialize(state)));\n}\n\nexport function getLocalStorageState(gameData: game.GameData): AppState | null {\n  const statestr = localStorage.getItem('appstate');\n  if (!statestr) {\n    return null;\n  }\n  const stateobj: MultiSerializedAppState = JSON.parse(statestr);\n  if (stateobj.version === 1) {\n    (stateobj as any).version = 3;\n  }\n\n  return deserialize(gameData, stateobj);\n}\n\nexport function setUrlState(state: AppState) {\n  const serialized = serialize(state);\n  const version = serialized.version;\n  let str = JSON.stringify(serialized.data);\n  // compress\n  str = btoa(deflate(str, { to: 'string' }));\n\n  window.history.replaceState('', '', `#${version}-${str}`);\n}\n\nfunction serialize(state: AppState): SerializedAppState {\n  const groups = state.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map((row) => {\n        let machineName: string | null = row.machine.data.name;\n        const defaultMachine = getDefaultMachine(row.recipe, state);\n\n        if (defaultMachine.data.name === machineName) {\n          machineName = null;\n        }\n\n        const srow: SerializedRow = [\n          row.recipe.name,\n          machineName,\n          row.numMachines.toFraction(),\n          row.modules.map((m) => (m ? m.name : null)),\n          row.beaconModule ? row.beaconModule.name : undefined,\n          row.numBeacons,\n        ];\n        return srow;\n      }),\n    };\n  });\n\n  const settings = {\n    assemblerOverrides: mapValues(\n      state.settings.assemblerOverrides,\n      (a) => a.data.name\n    ),\n  };\n\n  return {\n    version: 5,\n    data: { groups, settings },\n  };\n}\n\nconst reStateUrl = /^#(\\d+)?(?:-)?(.+)$/;\n\nexport function getUrlState(gameData: game.GameData) {\n  const matches = reStateUrl.exec(document.location.hash);\n  if (!matches) {\n    return null;\n  }\n  const version = Number(matches[1] || 1);\n\n  let str = decodeURIComponent(matches[2]);\n  if (version > 2) {\n    str = inflate(atob(str), { to: 'string' });\n  }\n\n  let data = JSON.parse(str);\n\n  return deserialize(gameData, {\n    version: version as 0,\n    data,\n  });\n}\n\nfunction migrateSerializedState(\n  state: MultiSerializedAppState\n): SerializedAppState {\n  switch (state.version) {\n    case 1:\n      state = state1to2(state);\n    // fall through\n    case 2:\n      state = state2to3(state);\n    // fall through\n    case 3:\n      state = state3to4(state);\n    // fall through\n    case 4:\n      state = state4to5(state);\n    // fall through\n    case 5:\n      // the latest\n      break;\n    default:\n      throw new Error(`unknown state: ${state}`);\n  }\n\n  return state;\n}\n\nfunction deserialize(\n  gameData: game.GameData,\n  unmigrated: MultiSerializedAppState\n): AppState {\n  const migrated = migrateSerializedState(unmigrated).data;\n\n  const state: AppState = {\n    gameData: gameData,\n\n    settings: deserializeSettings(gameData, migrated.settings),\n    groups: [],\n\n    activeGroupIdx: 0,\n    recipeTarget: undefined,\n  };\n\n  state.groups = migrated.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map(\n        ([\n          recipeName,\n          machineName,\n          numMachines,\n          modules,\n          beaconModule,\n          numBeacons,\n        ]) => {\n          const recipe = gameData.recipeMap[recipeName];\n\n          const machine = machineName\n            ? gameData.entityMap[machineName]\n            : getDefaultMachine(recipe, state);\n\n          return {\n            recipe: recipe,\n            machine: machine,\n            numMachines: Rational.fromString(numMachines),\n            modules: modules.map((n) => (n ? gameData.moduleMap[n] : null)),\n            beaconModule: beaconModule\n              ? gameData.moduleMap[beaconModule]\n              : null,\n            numBeacons: numBeacons || 0,\n          };\n        }\n      ),\n    };\n  });\n\n  return state;\n}\n\nfunction deserializeSettings(\n  gameData: game.GameData,\n  serialized: SerializedSettings\n): AppSettingsData {\n  return {\n    assemblerOverrides: mapValues(\n      serialized.assemblerOverrides,\n      (name) => gameData.entityMap[name]\n    ),\n  };\n}\n","import * as game from './game';\n\ninterface SignalHandler<T> {\n  (arg: T): void;\n}\n\nexport class Signal<T> {\n  handlers: SignalHandler<T>[] = [];\n\n  addHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index === -1) {\n      this.handlers.push(handler);\n    }\n  }\n\n  removeHandler(handler: SignalHandler<T>) {\n    const index = this.handlers.indexOf(handler);\n    if (index !== -1) {\n      this.handlers.splice(index, 1);\n    }\n  }\n\n  dispatch = (arg: T) => {\n    for (let handler of this.handlers) {\n      handler(arg);\n    }\n  };\n}\n\nexport const addIngredientFilter = new Signal<game.Ingredient>();\nexport const addProductFilter = new Signal<game.Product>();\nexport const addRecipeRow = new Signal<game.Recipe>();\n","import * as React from 'react';\nimport Popper from 'popper.js';\n\ninterface DropdownHeader {\n  header: React.ReactNode;\n}\n\ninterface DropdownDivider {\n  divider: true;\n}\n\ninterface DropdownEntry<T> {\n  key: React.Key;\n  disabled?: boolean;\n  active?: boolean;\n  option: T;\n}\n\ntype DropdownOption<T> = DropdownHeader | DropdownDivider | DropdownEntry<T>;\n\ninterface Props<T> {\n  options: DropdownOption<T>[];\n  selected: T;\n  onSelect(selected: T): void;\n\n  renderOption(option: T): React.ReactNode;\n  renderSelected(option: T): React.ReactNode;\n}\ninterface State {\n  isOpen: boolean;\n}\n\nconst ESC_KEYCODE = 27;\n\nexport class Dropdown<T> extends React.PureComponent<Props<T>, State> {\n  buttonRef: React.RefObject<HTMLButtonElement> = React.createRef();\n\n  state: State = {\n    isOpen: false,\n  };\n\n  handleToggle = () => {\n    this.setState((state) => ({\n      ...state,\n      isOpen: !state.isOpen,\n    }));\n  };\n\n  handleSelect = (selected: T) => {\n    this.props.onSelect(selected);\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  handleWantClose = () => {\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  render() {\n    const canToggle = this.props.options.some((option) => {\n      return 'option' in option && !option.disabled;\n    });\n\n    const classes = ['btn', 'btn-secondary'];\n    if (canToggle) {\n      classes.push('dropdown-toggle');\n    } else {\n      classes.push('disabled');\n    }\n\n    let floater: React.ReactNode | null;\n    if (this.state.isOpen) {\n      floater = (\n        <DropdownMenu\n          parentRef={this.buttonRef}\n          options={this.props.options}\n          renderOption={this.props.renderOption}\n          onSelect={this.handleSelect}\n          onWantClose={this.handleWantClose}\n        />\n      );\n    }\n\n    return (\n      <>\n        <button\n          ref={this.buttonRef}\n          className={classes.join(' ')}\n          type=\"button\"\n          onClick={() => {\n            canToggle && this.handleToggle();\n          }}\n        >\n          {this.props.renderSelected(this.props.selected)}\n        </button>\n        {floater}\n      </>\n    );\n  }\n}\n\ninterface DropdownMenuProps<T> {\n  parentRef: React.RefObject<any>;\n  options: DropdownOption<T>[];\n  renderOption(option: T): React.ReactNode;\n  onSelect(selected: T): void;\n  onWantClose(): void;\n}\n\ninterface DropdownMenuState {\n  style: React.CSSProperties;\n}\n\nclass DropdownMenu<T> extends React.PureComponent<\n  DropdownMenuProps<T>,\n  DropdownMenuState\n> {\n  popperInstance: Popper | null = null;\n  menuRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  state: DropdownMenuState = {\n    style: {},\n  };\n\n  popperUpdate = (data: Popper.Data) => {\n    this.setState({\n      style: data.styles as React.CSSProperties,\n    });\n    return data;\n  };\n\n  handleBodyClick = (event: MouseEvent) => {\n    if (!this.menuRef.current) {\n      throw new Error(\n        'Click event without menu rendered. This should not happen.'\n      );\n    }\n    if (!event.target) {\n      throw new Error(\n        'Click event without click target. This should not happen.'\n      );\n    }\n    // TODO: why doesnt EventTarget satisfy \"Node\"\n    const target = event.target as any;\n    if (!this.menuRef.current.contains(target)) {\n      // Click was outside menu\n      this.props.onWantClose();\n    }\n  };\n\n  handleKeyEvent = (event: KeyboardEvent) => {\n    if (event.keyCode === ESC_KEYCODE) {\n      this.props.onWantClose();\n    }\n  };\n\n  componentDidMount() {\n    if (this.popperInstance) {\n      throw new Error('Component mounted twice?');\n    }\n\n    const referenceEl = this.props.parentRef.current;\n    if (!referenceEl) {\n      throw new Error('Cannot mount DropdownMenu without parentRef');\n    }\n\n    const menuEl = this.menuRef.current;\n    if (!menuEl) {\n      throw new Error('Cannot mount DropdownMenu without menuRef');\n    }\n\n    this.popperInstance = new Popper(referenceEl, menuEl, {\n      modifiers: {\n        applyStyle: { enabled: false },\n        updateStateWithStyle: {\n          enabled: true,\n          fn: this.popperUpdate,\n        },\n      },\n    });\n\n    document.body.addEventListener('click', this.handleBodyClick);\n    document.body.addEventListener('keyup', this.handleKeyEvent);\n  }\n\n  componentWillUnmount() {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n    document.body.removeEventListener('click', this.handleBodyClick);\n    document.body.removeEventListener('keyup', this.handleKeyEvent);\n  }\n\n  renderOptions = () => {\n    return this.props.options.map((option, i) => {\n      if ('header' in option) {\n        return (\n          <h6 className=\"dropdown-header\" key={'ddkey' + i}>\n            {option.header}\n          </h6>\n        );\n      }\n      if ('divider' in option) {\n        return <div className=\"dropdown-divider\" key={'ddkey' + i} />;\n      }\n\n      const classes = ['dropdown-item'];\n      option.active && classes.push('active');\n      option.disabled && classes.push('disabled');\n\n      return (\n        <button\n          key={option.key}\n          className={classes.join(' ')}\n          onClick={() => this.props.onSelect(option.option)}\n          type=\"button\"\n        >\n          {this.props.renderOption(option.option)}\n        </button>\n      );\n    });\n  };\n\n  render() {\n    return (\n      <div\n        className=\"dropdown-menu show\"\n        style={this.state.style}\n        ref={this.menuRef}\n      >\n        {this.renderOptions()}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Popper from 'popper.js';\n\ninterface Props {\n  relativeTo: React.RefObject<HTMLElement>;\n}\n\ninterface State {\n  showSelf: boolean;\n  style: React.CSSProperties;\n}\n\nexport class Tooltip extends React.PureComponent<Props, State> {\n  selfRef: React.RefObject<any>;\n  popperInstance: Popper | null;\n\n  constructor(props: Props) {\n    super(props);\n    this.selfRef = React.createRef();\n    this.popperInstance = null;\n    this.state = {\n      showSelf: false,\n      style: { zIndex: 1001 },\n    };\n  }\n\n  initPopper() {\n    if (this.popperInstance) {\n      return;\n    }\n\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    const selfEl = this.selfRef.current;\n    if (!selfEl) {\n      throw new Error('No self reference yet?');\n    }\n\n    this.popperInstance = new Popper(referenceEl, selfEl, {\n      placement: 'right',\n      modifiers: {\n        offset: {\n          enabled: true,\n          offset: '0, 20',\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'window',\n        },\n      },\n    });\n  }\n\n  cleanupPopper() {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n  }\n\n  componentDidUpdate(_: Props, prevState: State) {\n    if (prevState.showSelf !== this.state.showSelf) {\n      if (this.state.showSelf) {\n        this.initPopper();\n      } else {\n        this.cleanupPopper();\n      }\n    }\n  }\n\n  componentDidMount() {\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    referenceEl.addEventListener('mouseenter', this.handleMouseEnter);\n    referenceEl.addEventListener('mouseleave', this.handleMouseLeave);\n  }\n\n  handleMouseEnter = () => {\n    this.setState({\n      showSelf: true,\n    });\n  };\n\n  handleMouseLeave = () => {\n    this.setState({\n      showSelf: false,\n    });\n  };\n\n  componentWillUnmount() {\n    const referenceEl = this.props.relativeTo.current;\n    if (referenceEl) {\n      referenceEl.removeEventListener('mouseenter', this.handleMouseEnter);\n      referenceEl.removeEventListener('mouseleave', this.handleMouseLeave);\n    }\n  }\n\n  render() {\n    if (!this.state.showSelf) {\n      return null;\n    }\n\n    return ReactDOM.createPortal(\n      <div style={this.state.style} ref={this.selfRef}>\n        {this.props.children}\n      </div>,\n      document.body\n    );\n  }\n}\n","import * as React from 'react';\n\ninterface Props {\n  value: number;\n  onChange: (value: number) => void;\n  min?: number;\n}\n\ninterface State {\n  txtValue: string;\n}\n\nexport class IntegerInput extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      txtValue: props.value.toString(),\n    };\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    if (oldProps.value !== this.props.value) {\n      this.setState((state) => ({\n        txtValue:\n          Number(state.txtValue) === this.props.value\n            ? state.txtValue\n            : this.props.value.toString(),\n      }));\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const value = event.target.value;\n    this.setState({ txtValue: value }, () => {\n      if (!value.trim()) {\n        return;\n      }\n      const num = Number(value);\n      if (isNaN(num)) {\n        return;\n      }\n      if (!Number.isInteger(num)) {\n        return;\n      }\n\n      if (typeof this.props.min === 'number' && num < this.props.min) {\n        // TODO: Error\n        return;\n      }\n\n      this.props.onChange(num);\n    });\n  };\n\n  render() {\n    return (\n      <input\n        className=\"form-control\"\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"number\"\n        min={this.props.min}\n        step=\"1\"\n      />\n    );\n  }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nimport { Rational } from '../../rational';\n\ninterface Props {\n  value: Rational;\n  onChange: (value: Rational) => void;\n  positiveOnly?: boolean;\n}\n\ninterface State {\n  error: string | undefined;\n  txtValue: string;\n}\n\nexport class RationalInput extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      error: '',\n      txtValue: rationalToString(props.value),\n    };\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    if (!this.props.value.equal(oldProps.value)) {\n      let parsed: Rational;\n      try {\n        parsed = stringToRational(this.state.txtValue);\n      } catch (err) {\n        return;\n      }\n\n      if (!parsed.equal(this.props.value)) {\n        this.setState({\n          txtValue: rationalToString(this.props.value),\n        });\n      }\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const str = event.target.value;\n\n    let errmsg: string | undefined;\n    let parsed: Rational | undefined;\n\n    try {\n      parsed = stringToRational(str);\n    } catch (err) {\n      errmsg = err.message;\n    }\n\n    if (parsed && this.props.positiveOnly && parsed.isNegative()) {\n      parsed = undefined;\n      errmsg = 'Number must be positive';\n    }\n    this.setState({ txtValue: str, error: errmsg }, () => {\n      if (parsed) {\n        this.props.onChange(parsed);\n      }\n    });\n  };\n\n  render() {\n    return (\n      <input\n        className={classNames('form-control', {\n          'is-invalid': !!this.state.error,\n        })}\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"text\"\n      />\n    );\n  }\n}\n\nfunction stringToRational(str: string): Rational {\n  if (!str.trim()) {\n    throw new Error('Empty!');\n  }\n\n  const index = str.indexOf('/');\n  const lastIndex = str.lastIndexOf('/');\n  if (index !== lastIndex) {\n    throw new Error('Too many slashes');\n  }\n\n  return Rational.fromString(str);\n}\n\nfunction rationalToString(rational: Rational): string {\n  const dec = rational.toFloat().toString();\n  if (dec.length < 10) {\n    return dec;\n  }\n\n  return rational.toFraction();\n}\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport { Tooltip } from './generic';\n\nimport styles from './Icon.module.css';\n\ninterface Props {\n  obj: { icon_row: number; icon_col: number };\n\n  title?: string;\n  onClick?(event: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\n  style?: React.CSSProperties;\n  tooltip?: React.ReactNode;\n  text?: React.ReactNode;\n}\n\ninterface State {}\n\nexport class Icon extends React.PureComponent<Props, State> {\n  iconRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.iconRef = React.createRef();\n  }\n\n  render() {\n    const x = -this.props.obj.icon_col * 32;\n    const y = -this.props.obj.icon_row * 32;\n\n    const divStyle = {\n      display: 'inline-block',\n      backgroundPosition: `${x}px ${y}px`,\n      width: '32px',\n      height: '32px',\n      ...this.props.style,\n    };\n\n    let icon = (\n      <div\n        ref={this.iconRef}\n        onClick={this.props.onClick}\n        title={this.props.title}\n        className={classNames(styles.Icon, 'game-icon')}\n        style={divStyle}\n      >\n        &nbsp;\n      </div>\n    );\n\n    if (this.props.tooltip) {\n      icon = (\n        <>\n          {icon}\n          <Tooltip children={this.props.tooltip} relativeTo={this.iconRef} />\n        </>\n      );\n    }\n\n    if (this.props.text) {\n      icon = (\n        <div style={{ lineHeight: '32px' }}>\n          {icon}\n          <span style={{ marginLeft: '9px' }}>{this.props.text}</span>\n        </div>\n      );\n    }\n\n    return icon;\n  }\n}\n","import * as React from 'react';\nimport Card from 'react-bootstrap/Card';\n\nimport { format_joules, format_watts } from '../util';\nimport * as game from '../game';\n\ninterface Props {\n  obj: game.Ingredient | game.Product;\n}\n\nexport const IngredientCard: React.FC<Props> = (props) => {\n  const { obj } = props;\n\n  let extras: JSX.Element[] = [];\n\n  let fuel_value: number = 0;\n\n  if (obj instanceof game.FluidIngredient || obj instanceof game.FluidProduct) {\n    const { item } = obj;\n    fuel_value = item.raw.fuel_value;\n  } else {\n    if ('fuel_value' in obj.item.raw) {\n      fuel_value = obj.item.raw.fuel_value;\n    }\n  }\n\n  if (fuel_value) {\n    extras.push(\n      <>\n        <b>Fuel value</b>: {format_joules(fuel_value)}\n      </>\n    );\n\n    let totalValue = format_watts(obj.amount.mul(fuel_value).toFloat());\n    extras.push(\n      <>\n        <b>Total fuel value</b>: {totalValue}\n      </>\n    );\n  }\n\n  let body: React.ReactNode = '';\n  if (extras.length) {\n    body = (\n      <Card.Body>\n        {extras.map((extra, i) => (\n          <div key={i} children={extra} />\n        ))}\n      </Card.Body>\n    );\n  }\n\n  return (\n    <Card>\n      <Card.Header>\n        {obj.item.niceName()} ({obj.item.name})\n      </Card.Header>\n      {body}\n    </Card>\n  );\n};\n","import * as React from 'react';\n\nimport { Rational } from '../rational';\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\nimport { AppActions, withActions } from '../state';\n\ninterface Props {\n  actions: AppActions;\n  obj: game.Ingredient | game.Product;\n  showName?: boolean;\n}\n\nclass RawRecipeOutput extends React.PureComponent<Props, never> {\n  handleClick = (event: React.MouseEvent) => {\n    const { obj } = this.props;\n\n    if (event.shiftKey) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.props.actions.setRecipeTarget({\n        item: obj.item,\n        amount: obj.amount,\n      });\n      return;\n    }\n\n    if (obj instanceof game.BaseIngredient) {\n      if (obj.item.madeBy.length === 1) {\n        signal.addRecipeRow.dispatch(obj.item.madeBy[0]);\n      } else {\n        signal.addIngredientFilter.dispatch(obj);\n      }\n    } else {\n      if (obj.item.usedBy.length === 1) {\n        signal.addRecipeRow.dispatch(obj.item.usedBy[0]);\n      } else {\n        signal.addProductFilter.dispatch(obj);\n      }\n    }\n  };\n\n  render() {\n    const { obj, showName } = this.props;\n\n    let text = perSecond(obj.amount);\n    if (showName) {\n      text = (\n        <>\n          {obj.item.niceName()} -- {text}\n        </>\n      );\n    }\n\n    return (\n      <Icon\n        onClick={this.handleClick}\n        tooltip={<IngredientCard obj={obj} />}\n        obj={obj.item}\n        text={text}\n      />\n    );\n  }\n}\n\nfunction perSecond(rational: Rational): React.ReactNode {\n  const dec = rational.toDecimal().toString();\n  let amount: React.ReactNode;\n  if (dec.includes('.') && dec.length > 4) {\n    amount = <abbr title={rational.toFraction()}>{rational.toDecimal()}</abbr>;\n  } else {\n    amount = dec;\n  }\n  return <>{amount} / sec</>;\n}\n\nexport const RecipeOutput = withActions(RawRecipeOutput);\n","import * as React from 'react';\nimport * as game from '../game';\n\ninterface Props {\n  machine: game.AssemblingMachine;\n}\n\nexport const MachineCard = (props: Props) => {\n  return (\n    <div className=\"machine-card card\">\n      <div className=\"card-body\">\n        <b>{props.machine.niceName()}</b>\n        <br />\n        <b>Crafting Speed:</b> {props.machine.data.crafting_speed}\n        <br />\n        <b>Module Slots:</b> {props.machine.data.module_slots}\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { withGame } from '../state';\n\ninterface Props {\n  gameData: game.GameData;\n  recipe: game.Recipe;\n  onClick?(r: game.Recipe): void;\n}\n\nconst GameRecipeCard = (props: Props) => {\n  const handleClick = () => {\n    props.onClick && props.onClick(props.recipe);\n  };\n  const recipe = props.recipe;\n\n  const ingredients = recipe.ingredients.map((ingredient, i) => (\n    <Icon key={i} obj={ingredient.item} text={ingredient.niceName()} />\n  ));\n  const products = recipe.products.map((product, i) => (\n    <Icon key={i} obj={product.item} text={product.niceName()} />\n  ));\n\n  const madeIn = recipe.madeIn.map((machine, i) => (\n    <Icon\n      key={i}\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n    />\n  ));\n\n  return (\n    <div className=\"recipe-tooltip card\" onClick={handleClick}>\n      <div className=\"card-header\">\n        <Icon obj={recipe} text={recipe.niceName()} />\n      </div>\n      <div className=\"card-body\">\n        <Icon\n          obj={props.gameData.raw.sprites.extra['clock']}\n          text={recipe.crafting_time.toDecimal()}\n        />\n        <div style={{ float: 'left' }}>\n          Ingredients:\n          {ingredients}\n        </div>\n        <div style={{ display: 'inline-block' }}>\n          Products:\n          {products}\n        </div>\n        <div style={{ clear: 'both' }} />\n        <div style={{ lineHeight: '32px' }}>\n          Made In:\n          {madeIn}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const RecipeCard = withGame(GameRecipeCard);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { Dropdown } from './generic';\n\ntype Machine = game.AssemblingMachine;\n\ninterface MachinePickerProps {\n  machines: Machine[];\n  selected: Machine;\n  onChange(m: Machine): void;\n}\n\nconst renderSelected = (machine: Machine) => {\n  return (\n    <Icon obj={machine.data} tooltip={<MachineCard machine={machine} />} />\n  );\n};\n\nconst renderOption = (machine: Machine) => {\n  return (\n    <Icon\n      obj={machine.data}\n      tooltip={<MachineCard machine={machine} />}\n      text={machine.niceName()}\n    />\n  );\n};\n\nexport const MachinePicker = (props: MachinePickerProps) => {\n  const options = props.machines.map((machine) => ({\n    key: machine.data.name,\n    option: machine,\n    active: machine === props.selected,\n  }));\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n","import * as React from 'react';\n\nimport { Module } from '../game';\nimport { round2 } from '../util';\n\nconst niceName = {\n  consumption: 'Energy Consumption',\n  productivity: 'Productivity',\n  speed: 'Speed',\n  pollution: 'Pollution',\n};\n\nexport const ModuleCard = ({ module }: { module: Module }) => {\n  const bonuses = [];\n  for (let bonusName in module.raw.effect) {\n    const bonus = module.raw.effect[\n      bonusName as keyof typeof module.raw.effect\n    ]!.bonus;\n    bonuses.push(\n      <div key={bonusName}>\n        <b>\n          {niceName[bonusName as keyof typeof niceName]}:{' '}\n          {round2(bonus * 100, 2)}%\n        </b>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"module-card card\">\n      <div className=\"card-header\">\n        <b>{module.niceName()}</b>\n      </div>\n      <div className=\"card-body\">{bonuses}</div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport { GameData, Module, Recipe } from '../game';\n\nimport { Icon } from './Icon';\nimport { ModuleCard } from './ModuleCard';\nimport { Dropdown } from './generic';\nimport { withGame } from '../state';\n\ninterface ModulePickerProps {\n  gameData: GameData;\n  recipe: Recipe;\n  isBeacon?: boolean;\n  selected: Module | null;\n  onChange(m: Module | null): void;\n}\n\nconst GameModulePicker = (props: ModulePickerProps) => {\n  const icon = props.gameData.raw.sprites.extra.slot_icon_module;\n  const nomod = new Module({\n    type: 'module',\n    name: 'no_module',\n    localised_name: { en: 'No Module' },\n    category: 'speed',\n    effect: {},\n    limitation: [],\n    rocket_launch_products: [],\n\n    icon_row: icon.icon_row,\n    icon_col: icon.icon_col,\n\n    group: '',\n    subgroup: '',\n    order: '',\n  });\n\n  const renderSelected = (module: Module | null) => {\n    if (module) {\n      return <Icon obj={module} tooltip={<ModuleCard module={module} />} />;\n    } else {\n      return <Icon obj={nomod} />;\n    }\n  };\n\n  const renderOption = (module: Module | null) => {\n    if (module) {\n      return (\n        <Icon\n          obj={module}\n          tooltip={<ModuleCard module={module} />}\n          text={module.niceName()}\n        />\n      );\n    } else {\n      return <Icon obj={nomod} text={nomod.niceName()} />;\n    }\n  };\n\n  const options = props.gameData.modules\n    .filter((m) => {\n      // TODO: what is the actual logic for which modules are allowed in beacons?\n      if (props.isBeacon && m.effects.productivity.isPositive()) {\n        return false;\n      }\n      return m.canUseWith(props.recipe);\n    })\n    .map((m) => ({\n      key: m.name,\n      option: m as Module | null,\n      active: m === props.selected,\n    }));\n\n  options.unshift({\n    key: 'no_module',\n    option: null,\n    active: !props.selected,\n  });\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n\nexport const ModulePicker = withGame(GameModulePicker);\n","import * as game from './game';\n\nimport { clone } from './util';\n\nimport { Rational } from './rational';\n\nimport { RecipeRowData } from './state';\n\nexport class Totals {\n  products: game.Product[] = [];\n  ingredients: game.Ingredient[] = [];\n\n  addIngredient = (newIng: game.Ingredient) => {\n    for (let oldIng of this.ingredients) {\n      let match = newIng.type === oldIng.type && newIng.item === oldIng.item;\n      if (newIng.type === 'fluid' && oldIng.type === 'fluid') {\n        match =\n          match &&\n          newIng.maximum_temperature === oldIng.maximum_temperature &&\n          newIng.minimum_temperature === oldIng.minimum_temperature;\n      }\n\n      if (match) {\n        oldIng.amount = oldIng.amount.add(newIng.amount);\n        return;\n      }\n    }\n    this.ingredients.push(newIng);\n  };\n\n  addProduct = (newProd: game.Product) => {\n    for (let oldProd of this.products) {\n      let match =\n        newProd.type === oldProd.type && newProd.item === oldProd.item;\n      if (newProd.type === 'fluid' && oldProd.type === 'fluid') {\n        match = match && newProd.temperature === oldProd.temperature;\n      }\n\n      if (match) {\n        oldProd.amount = oldProd.amount.add(newProd.amount);\n        return;\n      }\n    }\n    this.products.push(newProd);\n  };\n\n  addRow(row: RecipeRowData) {\n    const effects = {\n      consumption: Rational.one,\n      pollution: Rational.one,\n      productivity: Rational.one,\n      speed: Rational.one,\n    };\n\n    for (let module of row.modules) {\n      if (!module) continue;\n      effects.consumption = effects.consumption.add(module.effects.consumption);\n      effects.pollution = effects.pollution.add(module.effects.pollution);\n      effects.productivity = effects.productivity.add(\n        module.effects.productivity\n      );\n      effects.speed = effects.speed.add(module.effects.speed);\n    }\n\n    if (row.beaconModule && row.numBeacons > 0) {\n      // TODO: export and use \"distribution_effectivity\" from beacon entities\n      // assume the common value of 0.5 for now\n\n      const be = row.beaconModule.effects;\n      const num = Rational.fromInts(row.numBeacons, 2);\n      effects.consumption = effects.consumption.add(be.consumption.mul(num));\n      effects.pollution = effects.pollution.add(be.pollution.mul(num));\n      effects.productivity = effects.productivity.add(be.productivity.mul(num));\n      effects.speed = effects.speed.add(be.speed.mul(num));\n    }\n\n    // Allowed -80% to de facto max of signed short int\n    effects.consumption = effects.consumption.clamp(0.2, 32767);\n    effects.pollution = effects.pollution.clamp(0.2, 32767);\n    effects.speed = effects.speed.clamp(0.2, 32767);\n\n    // Special minimum: -0%\n    effects.productivity = effects.productivity.clamp(1, 32767);\n\n    const ingredientMult = Rational.one\n      .mul(row.recipe.crafting_time.invert())\n      .mul(row.numMachines)\n      .mul(row.machine.data.crafting_speed)\n      .mul(effects.speed);\n\n    const productMult = ingredientMult.mul(effects.productivity);\n\n    row.recipe.ingredients\n      .map((ingredient) => {\n        ingredient = clone(ingredient);\n        ingredient.amount = ingredient.amount.mul(ingredientMult);\n        return ingredient;\n      })\n      .forEach(this.addIngredient);\n\n    row.recipe.products\n      .map((product) => {\n        product = clone(product);\n        product.amount = product.amount.mul(productMult);\n        return product;\n      })\n      .forEach(this.addProduct);\n  }\n\n  reduce() {\n    let ingredients = this.ingredients.map(clone);\n    let products = this.products.map(clone);\n\n    for (let product of products) {\n      for (let ingredient of ingredients) {\n        if (product.amount.isZero() || ingredient.amount.isZero()) {\n          continue;\n        }\n        if (!product.satisfies(ingredient)) {\n          continue;\n        }\n        if (product.amount.less(ingredient.amount)) {\n          // More ingredient than product\n          ingredient.amount = ingredient.amount.sub(product.amount);\n          product.amount = Rational.zero;\n        } else if (ingredient.amount.less(product.amount)) {\n          // More product than ingredient\n          product.amount = product.amount.sub(ingredient.amount);\n          ingredient.amount = Rational.zero;\n        } else {\n          ingredient.amount = Rational.zero;\n          product.amount = Rational.zero;\n        }\n      }\n    }\n\n    ingredients = ingredients.filter((i) => !i.amount.isZero());\n    products = products.filter((p) => !p.amount.isZero());\n\n    return { ingredients, products };\n  }\n}\n","import * as React from 'react';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport Button from 'react-bootstrap/Button';\n\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { Icon } from './Icon';\nimport { RecipeOutput } from './RecipeOutput';\nimport { RecipeCard } from './RecipeCard';\nimport { MachinePicker } from './MachinePicker';\nimport { ModulePicker } from './ModulePicker';\nimport { IntegerInput, RationalInput } from './generic';\n\nimport { Totals } from '../totals';\nimport { withBoth, RecipeRowData, AppActions, AppState } from '../state';\n\ninterface Props extends RecipeRowData {\n  index: number;\n  actions: AppActions;\n  state: AppState;\n}\n\nclass RawRecipeRow extends React.PureComponent<Props, never> {\n  handleRemoveClick = () => {\n    this.props.actions.removeRow(this.props.index);\n  };\n\n  handleMachineChange = (machine: game.AssemblingMachine) => {\n    this.applyChange({\n      machine: machine,\n      modules: this.props.modules\n        .filter((module) => module !== null)\n        .slice(0, machine.data.module_slots),\n    });\n  };\n\n  handleNumMachinesChange = (num: Rational) => {\n    this.applyChange({ numMachines: num });\n  };\n\n  handleNumBeaconsChange = (num: number) => {\n    this.applyChange({ numBeacons: num });\n  };\n\n  handleSetAllModules = () => {\n    this.applyChange({\n      modules: new Array(this.props.machine.data.module_slots).fill(\n        this.props.modules[0]\n      ),\n    });\n  };\n\n  handleSetModule = (index: number, module: game.Module | null) => {\n    const modules = this.props.modules.slice();\n    modules[index] = module;\n    this.applyChange({ modules: modules });\n  };\n\n  handleSetBeaconModule = (module: game.Module | null) => {\n    this.applyChange({ beaconModule: module });\n  };\n\n  handleInputGroupClick: React.MouseEventHandler<any> = (event) => {\n    const { recipeTarget } = this.props.state;\n    if (!event.shiftKey || !recipeTarget) {\n      return;\n    }\n    event.preventDefault();\n    event.stopPropagation();\n\n    const output = new Totals();\n    output.addRow({\n      ...this.props,\n      numMachines: Rational.one,\n    });\n\n    let current: game.Ingredient | game.Product | undefined;\n    current = output.ingredients.find((x) => {\n      return x.item.name === recipeTarget.item.name;\n    });\n\n    current =\n      current ||\n      output.products.find((x) => {\n        return x.item.name === recipeTarget.item.name;\n      });\n\n    if (!current) {\n      console.error(\n        `Could not find ${recipeTarget.item.name} in totals`,\n        output\n      );\n      return;\n    }\n\n    const newNum = recipeTarget.amount.div(current.amount);\n\n    this.applyChange({\n      numMachines: newNum,\n    });\n  };\n\n  applyChange(change: Partial<RecipeRowData>) {\n    this.props.actions.updateRow(this.props.index, change);\n  }\n\n  getOutput() {\n    const t = new Totals();\n    t.addRow(this.props);\n    return {\n      ingredients: t.ingredients,\n      products: t.products,\n    };\n  }\n\n  renderModules() {\n    const numSlots = this.props.machine.data.module_slots;\n\n    const slots = [];\n    for (let i = 0; i < numSlots; i++) {\n      const module = this.props.modules[i];\n      slots.push(\n        <ModulePicker\n          key={i}\n          recipe={this.props.recipe}\n          selected={module}\n          onChange={(m) => this.handleSetModule(i, m)}\n        />\n      );\n    }\n\n    if (numSlots > 1) {\n      slots.splice(\n        1,\n        0,\n        <button\n          onClick={this.handleSetAllModules}\n          key=\"applicator\"\n          className=\"btn\"\n        >\n          \n        </button>\n      );\n    }\n\n    return slots;\n  }\n\n  renderBeacons() {\n    return (\n      <div className=\"btn-toolbar\">\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">Beacon Modules</span>\n          </div>\n          <IntegerInput\n            value={this.props.numBeacons}\n            onChange={this.handleNumBeaconsChange}\n            min={0}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <ModulePicker\n              isBeacon={true}\n              recipe={this.props.recipe}\n              selected={this.props.beaconModule}\n              onChange={this.handleSetBeaconModule}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderMachines() {\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\" onClick={this.handleInputGroupClick}>\n          <RationalInput\n            value={this.props.numMachines}\n            onChange={this.handleNumMachinesChange}\n            positiveOnly={true}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={this.props.recipe.madeIn}\n              selected={this.props.machine}\n              onChange={this.handleMachineChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const recipe = this.props.recipe;\n    const output = this.getOutput();\n\n    const ingredients = output.ingredients.map((ingredient, i) => (\n      <div className=\"mb-1\" key={i}>\n        <RecipeOutput obj={ingredient} />\n      </div>\n    ));\n    const products = output.products.map((product, i) => (\n      <div className=\"mb-1\" key={i}>\n        <RecipeOutput obj={product} />\n      </div>\n    ));\n    return (\n      <Draggable draggableId={recipe.name} index={this.props.index}>\n        {(provided) => (\n          <div\n            className=\"recipe-row card mb-3\"\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n          >\n            <div className=\"card-header clearfix\" {...provided.dragHandleProps}>\n              <div className=\"float-left\">\n                <Icon\n                  obj={recipe}\n                  text={recipe.niceName()}\n                  tooltip={<RecipeCard recipe={recipe} />}\n                />\n              </div>\n              <div className=\"float-right\">\n                <Button\n                  variant=\"danger\"\n                  onClick={this.handleRemoveClick}\n                  size=\"sm\"\n                >\n                  Remove\n                </Button>\n              </div>\n            </div>\n            <div className=\"card-body clearfix\">\n              <div className=\"float-left\">\n                {this.renderMachines()}\n                <div className=\"mb-3 btn-group btn-icon-wrapper\">\n                  {this.renderModules()}\n                </div>\n                {this.renderBeacons()}\n              </div>\n\n              <div className=\"float-right\">\n                <div\n                  className=\"mr-3\"\n                  style={{\n                    display: 'inline-block',\n                    float: 'left',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Ingredients:</b>\n                  {ingredients}\n                </div>\n\n                <div\n                  className=\"mr-2\"\n                  style={{\n                    display: 'inline-block',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Products:</b>\n                  {products}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </Draggable>\n    );\n  }\n}\n\nexport const RecipeRow = withBoth(RawRecipeRow);\n","import * as React from 'react';\nimport Fuse from 'fuse.js';\nimport debounce from 'lodash/debounce';\n\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\nimport { RecipeCard } from './RecipeCard';\n\nimport styles from './RecipePicker.module.css';\n\ntype KeyTypes = 'niceName' | 'name';\n\nfunction getFn(recipe: game.Recipe, key: string) {\n  switch (key as KeyTypes) {\n    case 'niceName':\n      return recipe.niceName();\n    case 'name':\n      return recipe.name;\n  }\n}\n\nconst RE_ADVANCED = /((?:produces)|(?:consumes)):([a-z0-9-]+)/g;\n\ninterface Props {\n  recipes: game.Recipe[];\n  onPickRecipe(r: game.Recipe): void;\n}\n\ninterface State {\n  query: string;\n  matches: game.Recipe[];\n}\n\nexport class RecipePicker extends React.PureComponent<Props, State> {\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    query: '',\n    matches: [],\n  };\n\n  componentDidMount() {\n    signal.addIngredientFilter.addHandler(this.handleIngredientClick);\n    signal.addProductFilter.addHandler(this.handleProductClick);\n  }\n\n  componentWillUnmount() {\n    this.debCalculateMatches.cancel();\n    signal.addIngredientFilter.removeHandler(this.handleIngredientClick);\n    signal.addProductFilter.removeHandler(this.handleProductClick);\n  }\n\n  handleIngredientClick = (ingredient: game.Ingredient) => {\n    const term = `produces:${ingredient.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleProductClick = (product: game.Product) => {\n    const term = `consumes:${product.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleQueryInput = (event: React.FormEvent<HTMLInputElement>) => {\n    const target = event.target as HTMLInputElement;\n    this.setQuery(target.value);\n  };\n\n  handleRecipeClick = (recipe: game.Recipe) => {\n    this.props.onPickRecipe(recipe);\n    this.setQuery('');\n  };\n\n  setQuery = (query: string, callback?: () => void) => {\n    if (!query.trim()) {\n      this.debCalculateMatches.cancel();\n      this.setState(\n        {\n          query: '',\n          matches: [],\n        },\n        callback\n      );\n    } else {\n      this.setState({ query: query }, callback);\n      this.debCalculateMatches();\n    }\n  };\n\n  calculateMatches() {\n    let query = this.state.query.trim().toLowerCase();\n    if (!query) {\n      this.setState({ matches: [] });\n      return;\n    }\n\n    const conditions = {\n      consumes: [] as string[],\n      produces: [] as string[],\n    };\n\n    type ckey = keyof typeof conditions;\n\n    query = query\n      .replace(RE_ADVANCED, (_, key, value) => {\n        conditions[key as ckey].push(value);\n        return '';\n      })\n      .trim();\n\n    let recipes = this.props.recipes;\n    if (conditions.consumes.length || conditions.produces.length) {\n      recipes = recipes.filter((recipe) => {\n        for (let name of conditions.consumes) {\n          if (!recipe.ingredients.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        for (let name of conditions.produces) {\n          if (!recipe.products.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n\n    if (query) {\n      const fuse = new Fuse(recipes, {\n        shouldSort: true,\n        getFn: getFn,\n        keys: [\n          {\n            name: 'niceName',\n            weight: 0.7,\n          },\n          {\n            name: 'name',\n            weight: 0.2,\n          },\n        ],\n      });\n      recipes = fuse.search(query);\n    }\n    this.setState({ matches: recipes });\n  }\n\n  debCalculateMatches = debounce(this.calculateMatches.bind(this), 200);\n\n  renderMatches() {\n    if (!this.state.matches.length) {\n      return '';\n    }\n    let matches = this.state.matches;\n    if (matches.length > 100) {\n      matches = matches.slice(0, 100);\n    }\n    return (\n      <table className=\"table table-hover\">\n        <thead>\n          <tr>\n            <th>Recipe</th>\n            <th>Time</th>\n            <th>Ingredients</th>\n            <th>Products</th>\n          </tr>\n        </thead>\n        <tbody>\n          {matches.map((r) => (\n            <RecipeMatch\n              recipe={r}\n              key={r.name}\n              onClick={this.handleRecipeClick}\n            />\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  render() {\n    return (\n      <div className={styles.RecipePicker}>\n        <div>\n          <input\n            type=\"search\"\n            ref={this.inputRef}\n            className=\"editable-display form-control\"\n            placeholder=\"What do you want to build?\"\n            value={this.state.query}\n            onChange={this.handleQueryInput}\n          />\n        </div>\n        {this.renderMatches()}\n      </div>\n    );\n  }\n}\n\ninterface RecipeMatchProps {\n  recipe: game.Recipe;\n  onClick(recipe: game.Recipe): void;\n}\n\nclass RecipeMatch extends React.PureComponent<RecipeMatchProps, never> {\n  handleClickAdd = () => {\n    this.props.onClick(this.props.recipe);\n  };\n\n  render() {\n    const recipe = this.props.recipe;\n    const ingredients = recipe.ingredients.map((ing, i) => (\n      <Icon key={i} obj={ing.item} tooltip={<IngredientCard obj={ing} />} />\n    ));\n    const products = recipe.products.map((prod, i) => (\n      <Icon key={i} obj={prod.item} tooltip={<IngredientCard obj={prod} />} />\n    ));\n    return (\n      <tr onClick={this.handleClickAdd}>\n        <td className={styles.ResultName}>\n          <Icon\n            obj={recipe}\n            text={recipe.niceName()}\n            tooltip={<RecipeCard recipe={recipe} />}\n          />\n        </td>\n        <td>{recipe.crafting_time.toDecimal()}</td>\n        <td>{ingredients}</td>\n        <td>{products}</td>\n      </tr>\n    );\n  }\n}\n","import * as React from 'react';\nimport { RecipeOutput } from './RecipeOutput';\nimport { withGame, RecipeRowData } from '../state';\nimport { Totals } from '../totals';\nimport * as game from '../game';\n\nimport styles from './TotalCard.module.css';\n\ninterface Props {\n  gameData: game.GameData;\n  rows: RecipeRowData[];\n}\n\nfunction RawTotalCard(props: Props) {\n  const totals = new Totals();\n  for (let row of props.rows) {\n    totals.addRow(row);\n  }\n\n  const { ingredients, products } = totals.reduce();\n  if (!ingredients.length && !products.length) {\n    return <div />;\n  }\n\n  props.gameData.sortByItem(products, (p) => p.item);\n\n  return (\n    <div className={`card ${styles.TotalCard}`}>\n      <div className=\"card-header\">Combined Totals</div>\n      <div className=\"card-body\">\n        <div className=\"row\">\n          <div className=\"col\">\n            Ingredients:\n            {ingredients.map((ing, i) => (\n              <RecipeOutput key={i} obj={ing} showName />\n            ))}\n          </div>\n          <div className=\"col\">\n            Products:\n            {products.map((prod, i) => (\n              <RecipeOutput key={i} obj={prod} showName />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport const TotalCard = withGame(RawTotalCard);\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Nav from 'react-bootstrap/Nav';\nimport Col from 'react-bootstrap/Col';\n\nimport { RecipeGroup } from './RecipeGroup';\nimport { Settings } from './Settings';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport { assertNever } from '../util';\n\nimport styles from './App.module.css';\n\ninterface Props {\n  state: AppState;\n  actions: AppActions;\n}\n\ninterface State {\n  activePage: ActivePage;\n}\n\nenum ActivePage {\n  Factory = 'FACTORY',\n  Settings = 'SETTINGS',\n}\n\nclass RawApp extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      activePage: ActivePage.Factory,\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n    document.addEventListener('keyup', this.handleKeyUp);\n  }\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    document.removeEventListener('keyup', this.handleKeyUp);\n  }\n\n  handleKeyDown = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.add('shift-down');\n    }\n  };\n  handleKeyUp = (event: KeyboardEvent) => {\n    if (event.key === 'Shift') {\n      document.body.classList.remove('shift-down');\n    }\n  };\n\n  handleClickGroup = (i: number) => {\n    this.setState({\n      activePage: ActivePage.Factory,\n    });\n    this.props.actions.setActiveGroup(i);\n  };\n\n  handleClickAddGroup: React.MouseEventHandler<any> = (event) => {\n    event.preventDefault();\n    const defaultName = `Factory ${this.props.state.groups.length + 1}`;\n    const name = prompt('What do you want to name this group?', defaultName);\n    if (!name || !name.trim()) {\n      return;\n    }\n    this.props.actions.addGroup(name);\n  };\n\n  handleClickSettings = () => {\n    this.setState({\n      activePage: ActivePage.Settings,\n    });\n  };\n\n  renderNavbar() {\n    const settingsActive = this.state.activePage === ActivePage.Settings;\n\n    const activeKey = settingsActive\n      ? 'settings'\n      : this.props.state.activeGroupIdx;\n\n    const factoryPills = this.props.state.groups.map((group, i) => {\n      const active = activeKey === i;\n      return (\n        <Nav.Item onClick={() => this.handleClickGroup(i)} key={i}>\n          <Nav.Link active={active}>{group.name}</Nav.Link>\n        </Nav.Item>\n      );\n    });\n\n    return (\n      <>\n        <Nav className=\"flex-column\">\n          <Nav.Item>\n            <Nav.Link disabled>\n              <span role=\"img\" aria-label=\"Factory icon\">\n                \n              </span>{' '}\n              Factories\n            </Nav.Link>\n          </Nav.Item>\n          {factoryPills}\n          <Nav.Item>\n            <Nav.Link onClick={this.handleClickAddGroup}>\n              Add A Factory\n            </Nav.Link>\n          </Nav.Item>\n          <Nav.Item>\n            <Nav.Link\n              active={activeKey === 'settings'}\n              onClick={this.handleClickSettings}\n            >\n              <span role=\"img\" aria-label=\"Gear icon\">\n                \n              </span>{' '}\n              Settings\n            </Nav.Link>\n          </Nav.Item>\n        </Nav>\n      </>\n    );\n  }\n\n  renderFactory = () => {\n    const group = this.props.state.groups[this.props.state.activeGroupIdx];\n\n    return <RecipeGroup group={group} />;\n  };\n\n  renderSettings = () => {\n    return <Settings />;\n  };\n\n  render() {\n    if (!this.props.state.gameData.raw) {\n      return null;\n    }\n    let body: JSX.Element;\n    if (this.state.activePage === ActivePage.Factory) {\n      body = this.renderFactory();\n    } else if (this.state.activePage === ActivePage.Settings) {\n      body = this.renderSettings();\n    } else {\n      return assertNever(this.state.activePage);\n    }\n\n    return (\n      <Container fluid>\n        <Row>\n          <Col xs=\"2\" className={classNames('bg-primary', styles.Sidebar)}>\n            {this.renderNavbar()}\n          </Col>\n          <Col>{body}</Col>\n        </Row>\n      </Container>\n    );\n  }\n}\n\nexport const App = withBoth(RawApp);\n","import * as React from 'react';\nimport Button from 'react-bootstrap/Button';\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\nimport Dropdown from 'react-bootstrap/Dropdown';\n\nimport { DropResult, DragDropContext, Droppable } from 'react-beautiful-dnd';\n\nimport * as signal from '../signal';\nimport * as game from '../game';\nimport { Rational } from '../rational';\n\nimport { RecipeRow } from './RecipeRow';\nimport { RecipePicker } from './RecipePicker';\nimport { TotalCard } from './TotalCard';\n\nimport { RecipeGroupData, RecipeRowData } from '../state';\n\nimport { AppActions, AppState, withBoth } from '../state';\nimport * as su from '../stateutil';\n\nimport styles from './RecipeGroup.module.css';\n\ninterface Props {\n  group: RecipeGroupData;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawRecipeGroup extends React.PureComponent<Props, never> {\n  componentDidMount() {\n    signal.addRecipeRow.addHandler(this.handlePickRecipe);\n  }\n\n  componentWillUnmount() {\n    signal.addRecipeRow.removeHandler(this.handlePickRecipe);\n  }\n\n  handlePickRecipe = (recipe: game.Recipe) => {\n    this.props.actions.addRow({\n      recipe: recipe,\n      machine: su.getDefaultMachine(recipe, this.props.state),\n      numMachines: Rational.one,\n      modules: [],\n      beaconModule: null,\n      numBeacons: 0,\n    });\n  };\n\n  handleDragEnd = (result: DropResult) => {\n    if (!result.destination) {\n      return;\n    }\n    this.props.actions.moveRow(result.source.index, result.destination.index);\n  };\n\n  renderRow = (data: RecipeRowData, index: number) => {\n    return <RecipeRow key={data.recipe.name} index={index} {...data} />;\n  };\n\n  handleClickRename = () => {\n    const i = this.props.state.activeGroupIdx;\n    const name = prompt(\n      'Whatcha wanna call it now?',\n      this.props.state.groups[i].name\n    );\n    if (name) {\n      this.props.actions.renameGroup(i, name);\n    }\n  };\n\n  handleClickDelete = () => {\n    const i = this.props.state.activeGroupIdx;\n    const group = this.props.state.groups[i];\n    if (window.confirm(`Are you sure you want to delete ${group.name}`)) {\n      this.props.actions.removeGroup(i);\n    }\n  };\n\n  render() {\n    const gd = this.props.state.gameData;\n    const availableRecipes = gd.recipes.filter((recipe) => {\n      return !this.props.group.rows.some((row) => row.recipe === recipe);\n    });\n\n    return (\n      <div className={styles.RecipeGroup}>\n        <div className=\"clearfix\">\n          <h3 className=\"float-left\">{this.props.group.name}</h3>\n          <div className=\"float-right\">\n            <Dropdown as={ButtonGroup} size=\"sm\">\n              <Button variant=\"info\" onClick={this.handleClickRename}>\n                Rename\n              </Button>\n\n              <Dropdown.Toggle split variant=\"info\" id=\"button-split\" />\n\n              <Dropdown.Menu>\n                <Dropdown.Item onClick={this.handleClickDelete}>\n                  Delete\n                </Dropdown.Item>\n              </Dropdown.Menu>\n            </Dropdown>\n          </div>\n        </div>\n        <RecipePicker\n          recipes={availableRecipes}\n          onPickRecipe={this.handlePickRecipe}\n        />\n        <hr />\n\n        <DragDropContext onDragEnd={this.handleDragEnd}>\n          <Droppable droppableId={'eyy'}>\n            {(provided) => (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {this.props.group.rows.map(this.renderRow)}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        <hr />\n        <TotalCard rows={this.props.group.rows} />\n      </div>\n    );\n  }\n}\n\nexport const RecipeGroup = withBoth(RawRecipeGroup);\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { AppActions, AppState, withGame, withBoth } from '../state';\nimport { getDefaultMachine } from '../stateutil';\n\nimport { MachinePicker } from './MachinePicker';\n\ninterface RawSettingsProps {\n  gameData: game.GameData;\n}\n\nclass RawSettings extends React.PureComponent<RawSettingsProps, never> {\n  render() {\n    const categoryNames = Object.entries(this.props.gameData.categoryMap)\n      .filter((entry) => entry[1].length > 1)\n      .map((entry) => entry[0]);\n\n    categoryNames.sort((a, b) => a.localeCompare(b));\n\n    return (\n      <div>\n        <h3>Default Assemblers</h3>\n        {categoryNames.map((name) => (\n          <CategoryRow key={name} category={name} />\n        ))}\n      </div>\n    );\n  }\n}\n\ninterface CategoryRowProps {\n  category: string;\n  state: AppState;\n  actions: AppActions;\n}\n\nclass RawCategoryRow extends React.PureComponent<CategoryRowProps, never> {\n  handleChange = (machine: game.AssemblingMachine) => {\n    this.props.actions.updateDefaultMachine(this.props.category, machine);\n  };\n\n  render() {\n    const machines = this.props.state.gameData.categoryMap[this.props.category];\n    const selected = getDefaultMachine(this.props.category, this.props.state);\n    return (\n      <div className=\"btn-toolbar mb-3\" key={this.props.category}>\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">{this.props.category}</span>\n          </div>\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={machines}\n              selected={selected}\n              onChange={this.handleChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst CategoryRow = withBoth(RawCategoryRow);\n\nexport const Settings = withGame(RawSettings);\n","import React, { useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport * as game from '../game';\nimport { AppActions, withBoth, useDakpan } from '../state';\nimport * as serialization from '../serialization';\n\nimport { App } from './App';\n\ninterface Props {\n  actions: AppActions;\n}\ninterface State {\n  gameData: game.GameData | null;\n}\n\nclass RawAppLoader extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      gameData: null,\n    };\n  }\n  componentDidMount() {\n    this.load().catch((err) => {\n      this.setState(() => {\n        throw err;\n      });\n    });\n  }\n\n  async load() {\n    const response = await fetch('assets/seablock-17.json');\n    if (response.status !== 200) {\n      throw new Error(\n        `Could not load game data, got HTTP status ${response.status}`\n      );\n    }\n\n    let parsed;\n    try {\n      parsed = await response.json();\n    } catch (err) {\n      throw new Error(`Could not parse game data: ${err}`);\n    }\n\n    const gameData = new game.GameData(parsed);\n\n    this.props.actions.replaceState({ gameData });\n\n    const urlState = serialization.getUrlState(gameData);\n    if (urlState) {\n      // everything comes from url state\n      this.props.actions.replaceState(urlState);\n    } else {\n      // Load just settings\n      try {\n        const storageState = serialization.getLocalStorageState(gameData);\n        if (storageState) {\n          // everything comes from url state\n          this.props.actions.replaceState(storageState);\n        }\n      } catch (err) {\n        console.error('Failed to load local storage state', err);\n      }\n    }\n\n    this.setState({ gameData });\n  }\n\n  render() {\n    if (!this.state.gameData) {\n      return <h1>Loading...</h1>;\n    }\n    const sheet = `assets/sprite-sheet-${this.state.gameData.raw.sprites.hash}.png`;\n    const style = `\n        .game-icon {\n            background-image: url(${sheet});\n        }\n        `;\n    return (\n      <>\n        <StateWriter />\n        <Prefetch href={sheet} />\n        <style>{style}</style>\n        <App />\n      </>\n    );\n  }\n}\n\nconst StateWriter: React.FC = () => {\n  const [state] = useDakpan();\n\n  useEffect(() => {\n    serialization.setUrlState(state);\n    serialization.setLocalStorageState(state);\n  }, [state]);\n\n  return null;\n};\n\nconst Prefetch: React.FC<{ href: string }> = (props) => {\n  return ReactDOM.createPortal(\n    <link rel=\"prefetch\" href={props.href} />,\n    document.head\n  );\n};\n\nexport const AppLoader = withBoth(RawAppLoader);\n","import * as Sentry from '@sentry/browser';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n\nimport { ErrorCatcher } from './components/ErrorCatcher';\nimport { AppLoader } from './components/AppLoader';\nimport { StateProvider } from './state';\n\nimport './index.css';\n\nif (process.env.NODE_ENV === 'production') {\n  Sentry.init({\n    dsn: 'https://2ab99c1e02a448cbaa06595164416044@sentry.io/1385727',\n  });\n}\n\nReactDOM.render(\n  <ErrorCatcher>\n    <StateProvider>\n      <AppLoader />\n    </StateProvider>\n  </ErrorCatcher>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipePicker\":\"RecipePicker_RecipePicker__3sU3V\",\"ResultName\":\"RecipePicker_ResultName__jSE56\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"crashed\":\"ErrorCatcher_crashed__3tour\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Icon\":\"Icon_Icon__377W-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"TotalCard\":\"TotalCard_TotalCard__2ci0q\"};"],"sourceRoot":""}