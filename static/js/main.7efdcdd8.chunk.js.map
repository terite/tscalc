{"version":3,"sources":["components/Icon.module.css","components/RecipePicker.module.css","components/ErrorCatcher.module.css","components/RecipePart.module.css","components/RecipeRow.module.css","components/TotalCard.module.css","components/RecipeGroup.module.css","components/App.module.css","components/ToastPortal.module.css","components/ErrorCatcher.tsx","atoms.ts","util.ts","rational.ts","game.ts","stateutil.ts","base64.ts","serialization.ts","signal.ts","notifications.ts","actions.ts","totals.ts","components/generic/Dropdown.tsx","components/generic/Tooltip.tsx","components/generic/IntegerInput.tsx","components/generic/RationalInput.tsx","components/Icon.tsx","components/IngredientCard.tsx","components/RecipePart.tsx","components/MachineCard.tsx","components/RecipeCard.tsx","components/MachinePicker.tsx","components/ModuleCard.tsx","components/ModulePicker.tsx","components/RecipeRow.tsx","components/RecipePicker.tsx","components/TotalCard.tsx","components/RecipeGroup.tsx","components/Settings.tsx","components/App.tsx","components/AppLoader.tsx","usePromise.ts","components/GameDataLoader.tsx","components/Toast.tsx","components/ToastPortal.tsx","index.tsx"],"names":["module","exports","ErrorCatcher","state","crashMsg","undefined","nextProps","nextState","this","error","errorInfo","setState","componentStack","stack","join","className","styles","crashed","props","children","React","Component","gameDataAtom","atom","key","default","useGameData","gameData","useRecoilValue","Error","recipeTargetAtom","groupAtomsAtom","groupsState","selector","get","map","groupAtom","settingsAtom","assemblerOverrides","assert","condition","message","mapValues","obj","fn","ret","Object","entries","value","clone","orig","assign","create","getPrototypeOf","round2","num","places","mag","Math","pow","round","format_magnitude","amount","suffixes","i","length","format_joules","joules","debounce","ms","pendingId","debounced","args","clearTimeout","setTimeout","defineProperty","useRelativeTime","when","whenUnix","valueOf","nowUnix","Date","now","suffix","secDiff","floor","abs","minDiff","unit","changeTime","relativeTime","reltime","change","useState","setRenderInc","useEffect","tId","setInterval","r","clearInterval","num_gcd","a","b","num_divmod","Number","isSafeInteger","quotient","remainder","FLOAT_CONVERT_PRECISION","Rational","p","q","div","divmod","result","less","zero","sub","one","other","fromFloat","min","max","mul","toFraction","toString","maxDigits","roundingFactor","sign","x","isNegative","negate","add","integerPart","decimalPart","fraction","ten","equal","slice","isZero","parts","push","isInteger","lookups","str","sum","split","part","trim","index","indexOf","fromInts","oneThird","twoThirds","rounded","floored","BaseDisplayable","data","name","localisedName","iconCol","iconRow","localised_name","icon_col","icon_row","en","Item","d","group","subgroup","order","fuelValue","usedBy","madeBy","fuel_value","Module","type","limitedTo","effects","Set","limitation","speed","effect","bonus","productivity","consumption","pollution","recipe","size","has","Fluid","defaultTemperature","default_temperature","Ingredient","gd","item","getItem","toDecimal","niceName","FluidIngredient","minimumTemperature","maximumTemperature","getFluid","minimum_temperature","Infinity","maximum_temperature","range","Product","amount_min","amount_max","probability","ingredient","FluidProduct","temperature","temp","Recipe","category","ingredients","products","craftingTime","madeIn","energy_required","results","product","AssemblingMachine","craftingCategories","craftingSpeed","moduleSlots","crafting_categories","crafting_speed","module_slots","GameData","raw","itemMap","Map","fluids","fluidMap","modules","moduleMap","recipes","recipeMap","entityMap","categoryMap","groups","clockSprite","noModuleModule","spriteHash","activeMods","active_mods","sprites","hash","values","edata","entity","set","rawMiningDrill","rawMachine","resource_categories","mining_speed","ingredient_count","machine","items","rawItem","fluid","rawRecipe","resource","rawResource","minable","fluid_amount","required_fluid","mining_time","canBuildRecipe","some","isPositive","console","warn","entities","catMap","machines","createCategoryMap","extra","noModuleIcon","rocket_launch_products","groupOrder","subgroupOrder","subgroups","collection","keyFn","sort","ordersA","getItemOrder","ordersB","valA","valB","getDefaultMachine","input","settings","defaultMachine","game","base64abc","base64codes","getBase64Code","charCode","code","bytesToBase64","bytes","l","base64ToBytes","buffer","missingOctets","endsWith","n","Uint8Array","j","charCodeAt","subarray","TextEncoder","TextDecoder","groupv4to5","rows","STATEKEY","document","location","pathname","serialize","version","row","machineName","numMachines","m","beaconModule","numBeacons","reStateUrl","migrateSerializedState","state1to2","state2to3","state3to4","state4to5","deserialize","unmigrated","migrated","deserializeSettings","recipeName","getRecipe","getEntity","fromString","getModule","serialized","Signal","handlers","dispatch","arg","handler","splice","addIngredientFilter","addProductFilter","addRecipeRow","newNotification","groupId","useGroupAdd","setGroupAtoms","useSetRecoilState","useCallback","newAtom","atoms","Totals","addRow","newIngredient","oldIng","oldProd","satisfies","filter","newProduct","be","clamp","ingredientMult","invert","productMult","addIngredient","addProduct","Dropdown","buttonRef","isOpen","handleClick","e","getCanToggle","stopPropagation","handleSelect","selected","onSelect","handleWantClose","options","option","disabled","floater","classes","parentRef","renderOption","onWantClose","ref","onClick","renderSelected","DropdownMenu","popperInstance","menuRef","style","popperUpdate","handleBodyClick","event","target","Node","current","contains","handleKeyEvent","keyCode","renderOptions","header","active","referenceEl","menuEl","Popper","modifiers","applyStyle","enabled","updateStateWithStyle","body","addEventListener","disableEventListeners","removeEventListener","ontop","zIndex","Tooltip","selfRef","handleMouseEnter","showSelf","handleMouseLeave","oldProps","oldState","relativeTo","content","selfEl","placement","offset","preventOverflow","boundariesElement","_","prevState","initPopper","cleanupPopper","ReactDOM","IntegerInput","handleChange","errMsg","txtValue","NaN","isNaN","onChange","step","RationalInput","errmsg","parsed","stringToRational","err","positiveOnly","rationalToString","classNames","lastIndexOf","rational","dec","toFloat","toMixed","Icon","iconRef","createRef","y","divStyle","backgroundPosition","icon","title","tooltip","text","IconTextWrapper","IconText","PureComponent","IngredientCard","fuelValues","totalValue","RecipePart","showName","useRecoilState","recipeTarget","setRecipeTarget","shiftKey","preventDefault","signal","includes","perSecond","copySource","MachineCard","RecipeCard","MachinePicker","formatBonus","ModuleCard","ModulePicker","isBeacon","canUseWith","unshift","RawRecipeRow","handleRemoveRow","onRemoveRow","handleMachineChange","applyChange","handleNumMachinesChange","handleNumBeaconsChange","handleSetAllModules","Array","fill","handleSetModule","handleSetBeaconModule","handleInputGroupClick","output","find","newNum","onUpdateRow","t","numSlots","slots","role","getOutput","draggableId","provided","RecipeRow","innerRef","draggableProps","dragHandleProps","renderMachines","renderModules","renderBeacons","display","float","minWidth","getFn","path","RE_ADVANCED","RecipePicker","inputRef","query","matches","handleIngredientClick","term","setQuery","calculateMatches","scrollIntoView","handleProductClick","handleQueryInput","handleRecipeClick","onPickRecipe","callback","debCalculateMatches","cancel","bind","addHandler","removeHandler","toLowerCase","conditions","consumes","produces","replace","Fuse","shouldSort","keys","weight","search","placeholder","renderMatches","RecipeMatch","handleClickAdd","ing","prod","ResultName","TotalCard","totals","useMemo","sortByItem","RawRecipeGroup","handleDragEnd","destination","source","onMoveRow","renderRow","handleClickRename","prompt","onRenameGroup","handleClickClone","onCloneGroup","handleClickDelete","window","confirm","onRemoveGroup","onAddRow","availableRecipes","RecipeGroup","renderHeader","onDragEnd","droppableId","droppableProps","setGroup","addGroup","handleRenameGroup","newName","oldGroup","handleCloneGroup","handleRemoveGroup","handleMoveRow","oldIndex","newIndex","from","removed","handleAddRow","su","handleUpdateRow","Settings","setSettings","handleSetDefaultMachine","categoryNames","names","entry","localeCompare","onSetDefaultMachine","CategoryRow","MOD_INFO","base","SettingsActiveMods","url","nameNode","href","rel","RawApp","handleKeyDown","classList","handleKeyUp","remove","handleClickGroup","activePage","handleClickAddGroup","defaultName","onAddGroup","handleRemoveGroupAtom","changed","xy","onRemoveGroupAtom","handleClickSettings","settingsActive","factoryPills","aria-label","assertNever","Sidebar","renderNavbar","renderBody","App","handleAddGroup","RawAppLoader","loaded","_mounted","load","then","urlState","exec","decodeURIComponent","inflate","to","JSON","parse","serialization","bodyText","String","storageState","statestr","localStorage","setItem","removeItem","stateobj","previousState","getPreviousState","onSetPreviousState","sheet","process","StateWriter","initialRender","useRef","completeState","g","stringify","deflate","history","replaceState","Prefetch","head","AppLoader","handleSetPreviousState","defaultState","loadGameData","filename","fetch","response","status","json","GameDataLoader","child","setGameState","promiseFn","dependencies","promiseState","setPromiseState","cancelled","promise","reason","usePromise","Toast","onClose","aria-live","aria-atomic","data-dismiss","aria-hidden","nextKey","ToastPortal","toasts","handleNotification","notification","toastPortal","toast","handleClose","renderToast","getElementById"],"mappings":"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","file":"static/js/main.7efdcdd8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Icon\":\"Icon_Icon__2keyP\",\"IconTextWrapper\":\"Icon_IconTextWrapper__XAsrp\",\"IconText\":\"Icon_IconText__2-yWw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipePicker\":\"RecipePicker_RecipePicker__3n7VF\",\"ResultName\":\"RecipePicker_ResultName__3hgOC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"crashed\":\"ErrorCatcher_crashed__1kSin\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipePart\":\"RecipePart_RecipePart__1LoD1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipeRow\":\"RecipeRow_RecipeRow__2eZjL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"TotalCard\":\"TotalCard_TotalCard__Xlr9v\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"RecipeGroup\":\"RecipeGroup_RecipeGroup__3-Kbc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Sidebar\":\"App_Sidebar__qsXjW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ToastPortal\":\"ToastPortal_ToastPortal__hJYFr\"};","import React from 'react';\n\nimport styles from './ErrorCatcher.module.css';\n\ninterface Props {}\n\ninterface State {\n  crashMsg: string | undefined;\n}\n\nexport class ErrorCatcher extends React.Component<Props, State> {\n  state: State = {\n    crashMsg: undefined,\n  };\n\n  shouldComponentUpdate(nextProps: Props, nextState: State): boolean {\n    return nextState.crashMsg !== this.state.crashMsg;\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    // Catch errors in any components below and re-render with error message\n    this.setState({\n      crashMsg: [\n        'Component Stack:',\n        errorInfo.componentStack,\n        '',\n        error && error.stack,\n      ].join('\\n'),\n    });\n  }\n\n  render(): React.ReactNode {\n    if (this.state.crashMsg) {\n      return (\n        <div className={styles.crashed}>\n          <h1>Crashed!</h1>\n          <pre>{this.state.crashMsg}</pre>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","import { atom, selector, useRecoilValue, RecoilState } from 'recoil';\nimport type { AppSettingsData, RecipeGroupData } from './state';\nimport type { GameData, Fluid, Item } from './game';\nimport type { Rational } from './rational';\n\n//\n// GameData\n//\nexport const gameDataAtom = atom<GameData | null>({\n  key: 'gameData',\n\n  // set early by apploader\n  default: null,\n});\n\nexport const useGameData = (): GameData => {\n  const gameData = useRecoilValue(gameDataAtom);\n  if (!gameData) {\n    throw new Error('useGameData called without gameData available');\n  }\n  return gameData;\n};\n\n//\n// RecipeTarget\n//\nexport interface RecipeTarget {\n  item: Item | Fluid;\n  amount: Rational;\n}\n\nexport const recipeTargetAtom = atom<RecipeTarget | undefined>({\n  key: 'recipeTarget',\n  default: undefined,\n});\n\n//\n// Groups\n//\nexport type GroupAtom = RecoilState<RecipeGroupData>;\nexport const groupAtomsAtom = atom<GroupAtom[]>({\n  key: 'groupAtoms',\n  default: [],\n});\n\nexport const groupsState = selector<[RecipeGroupData, GroupAtom][]>({\n  key: 'groupsState',\n  get: ({ get }) => {\n    const groupAtoms = get(groupAtomsAtom);\n    return groupAtoms.map((groupAtom) => [get(groupAtom), groupAtom]);\n  },\n});\n\n//\n// Settings\n//\nexport const settingsAtom = atom<AppSettingsData>({\n  key: 'settings',\n  default: {\n    assemblerOverrides: {},\n  },\n});\n","import { useEffect, useState } from 'react';\n\nexport function assert(condition: any, message?: string): asserts condition {\n  if (!condition) {\n    throw new Error(message || 'Assertion failed');\n  }\n}\n\nexport function assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\nexport function mapValues<T, V>(\n  obj: { [s: string]: T },\n  fn: (v: T) => V\n): { [s: string]: V } {\n  let ret: { [key: string]: V } = {};\n  for (const [key, value] of Object.entries(obj)) {\n    ret[key] = fn(value);\n  }\n  return ret;\n}\n\nexport function clone<T>(orig: T): T {\n  return Object.assign(Object.create(Object.getPrototypeOf(orig)), orig);\n}\n\nexport function round2(num: number, places: number): number {\n  const mag = Math.pow(10, places);\n  return Math.round(num * mag) / mag;\n}\n\nexport function format_magnitude(amount: number, suffixes: string[]): string {\n  let i = 0;\n  for (; i < suffixes.length; i++) {\n    if (amount >= 1000) {\n      amount = amount / 1000;\n    } else {\n      break;\n    }\n  }\n\n  return `${round2(amount, 2)} ${suffixes[i]}`;\n}\n\nexport function format_watts(watts: number): string {\n  return format_magnitude(watts, ['W', 'kW', 'MW', 'GW', 'TW', 'PW']);\n}\n\nexport function format_joules(joules: number): string {\n  return format_magnitude(joules, ['J', 'kJ', 'MJ', 'GJ', 'TJ', 'PJ']);\n}\n\ninterface Func<T extends any[]> {\n  (...args: T): void;\n}\n\ninterface DebouncedFunc<T extends any[]> extends Func<T> {\n  cancel(): void;\n}\n\nexport function debounce<T extends any[]>(\n  fn: Func<T>,\n  ms: number\n): DebouncedFunc<T> {\n  let pendingId: number | undefined;\n\n  function debounced(...args: T): void {\n    if (pendingId !== undefined) {\n      clearTimeout(pendingId);\n    }\n    pendingId = setTimeout(() => {\n      pendingId = undefined;\n      fn(...args);\n    }, ms);\n  }\n\n  function cancel(): void {\n    if (pendingId !== undefined) {\n      clearTimeout(pendingId);\n      pendingId = undefined;\n    }\n  }\n\n  Object.defineProperty(debounced, 'cancel', {\n    value: cancel,\n  });\n\n  return debounced as DebouncedFunc<T>;\n}\n\nexport function sleep(ms: number): Promise<void> {\n  return new Promise((r) => setTimeout(r, ms));\n}\n\nexport function relativeTime(when: Date): [string, number] {\n  const whenUnix = when.valueOf();\n  const nowUnix = Date.now();\n  const suffix = nowUnix > whenUnix ? 'ago' : 'from now';\n\n  const secDiff = Math.floor(Math.abs(nowUnix - whenUnix) / 1000);\n  if (secDiff >= 60) {\n    const minDiff = Math.floor(secDiff / 60);\n    const unit = minDiff === 1 ? 'minute' : 'minutes';\n    const changeTime = (60 - (secDiff % 60)) * 1000;\n    return [`${minDiff} ${unit} ${suffix}`, changeTime];\n  } else {\n    const unit = secDiff === 1 ? 'second' : 'seconds';\n    return [`${secDiff} ${unit} ${suffix}`, 1000];\n  }\n}\n\nexport function useRelativeTime(when: Date): string {\n  const [reltime, change] = relativeTime(when);\n\n  const [renderInc, setRenderInc] = useState(0);\n  void renderInc;\n\n  useEffect(() => {\n    const tId = setInterval(() => {\n      // Force re-render?\n      setRenderInc((r) => r + 1);\n    }, change);\n\n    return () => {\n      clearInterval(tId);\n    };\n  }, [change]);\n\n  return reltime;\n}\n","import { assert } from './util';\n\nfunction num_gcd(a: number, b: number): number {\n  return !b ? a : num_gcd(b, a % b);\n}\n\nfunction num_divmod(\n  a: number,\n  b: number\n): {\n  quotient: number;\n  remainder: number;\n} {\n  assert(Number.isSafeInteger(a));\n  assert(Number.isSafeInteger(b));\n\n  return {\n    quotient: Math.floor(a / b),\n    remainder: a % b,\n  };\n}\n\nconst FLOAT_CONVERT_PRECISION = 10000;\n\nexport class Rational {\n  readonly p: number;\n  readonly q: number;\n\n  constructor(p: number, q: number) {\n    assert(\n      Number.isSafeInteger(p),\n      `Numerator must be a safe integer, got ${p}`\n    );\n    assert(\n      Number.isSafeInteger(q),\n      `Denominator must be a safe integer, got ${q}`\n    );\n    assert(q !== 0, 'Denominator must not be zero');\n\n    if (q < 0) {\n      p = -p;\n      q = -q;\n    }\n\n    if (p === 0) {\n      q = 1;\n    }\n\n    const div = num_gcd(p, q);\n    if (div > 1) {\n      p = p / div;\n      q = q / div;\n    }\n    this.p = p;\n    this.q = q;\n  }\n\n  //\n  // Operations returning Rational\n  //\n  floor(): Rational {\n    const divmod = num_divmod(this.p, this.q);\n    let result = new Rational(divmod.quotient, 1);\n    if (result.less(Rational.zero) && divmod.remainder !== 0) {\n      result = result.sub(Rational.one);\n    }\n    return result;\n  }\n\n  negate(): Rational {\n    return new Rational(-this.p, this.q);\n  }\n\n  invert(): Rational {\n    return new Rational(this.q, this.p);\n  }\n\n  add(other: Rational): Rational {\n    return new Rational(this.p * other.q + this.q * other.p, this.q * other.q);\n  }\n\n  sub(other: Rational): Rational {\n    return new Rational(this.p * other.q - this.q * other.p, this.q * other.q);\n  }\n\n  mul(other: Rational | number): Rational {\n    if (typeof other == 'number') {\n      other = Rational.fromFloat(other);\n    }\n    return new Rational(this.p * other.p, this.q * other.q);\n  }\n\n  div(other: Rational): Rational {\n    return new Rational(this.p * other.q, this.q * other.p);\n  }\n\n  clamp(min: Rational | number, max: Rational | number): Rational {\n    if (typeof min == 'number') {\n      min = Rational.fromFloat(min);\n    }\n    if (typeof max == 'number') {\n      max = Rational.fromFloat(max);\n    }\n\n    if (this.less(min)) return min;\n    if (max.less(this)) return max;\n    return this;\n  }\n\n  //\n  // Operations NOT returning Rational\n  //\n  divmod(other: Rational): { quotient: Rational; remainder: Rational } {\n    var quotient = this.div(other);\n    var div = quotient.floor();\n    var mod = this.sub(other.mul(div));\n    return { quotient: div, remainder: mod };\n  }\n\n  equal(other: Rational): boolean {\n    return this.p === other.p && this.q === other.q;\n  }\n\n  isNegative(): boolean {\n    return this.p < 0;\n  }\n  isPositive(): boolean {\n    return this.p > 0;\n  }\n\n  isOne(): boolean {\n    return this.p === 1;\n  }\n\n  isZero(): boolean {\n    return this.p === 0;\n  }\n\n  less(other: Rational): boolean {\n    return this.p * other.q < this.q * other.p;\n  }\n\n  toFloat(): number {\n    return this.p / this.q;\n  }\n\n  toString(): string {\n    return this.toFraction();\n  }\n\n  toFraction(): string {\n    if (this.q === 1) {\n      return this.p.toString();\n    }\n    return this.p.toString() + '/' + this.q.toString();\n  }\n\n  toDecimal(maxDigits?: number, roundingFactor?: Rational): string {\n    if (maxDigits == null) {\n      maxDigits = 3;\n    }\n    if (roundingFactor == null) {\n      roundingFactor = new Rational(5, 10 ** (maxDigits + 1));\n    }\n\n    let sign = '';\n    let x: Rational = this;\n    if (x.isNegative()) {\n      sign = '-';\n      x = x.negate();\n    }\n    x = x.add(roundingFactor);\n    let divmod = num_divmod(x.p, x.q);\n    var integerPart = divmod.quotient.toString();\n    var decimalPart = '';\n    var fraction = new Rational(divmod.remainder, x.q);\n    let ten = new Rational(10, 1);\n    while (maxDigits > 0 && !fraction.equal(roundingFactor)) {\n      fraction = fraction.mul(ten);\n      roundingFactor = roundingFactor.mul(ten);\n      let divmod = num_divmod(fraction.p, fraction.q);\n      decimalPart += divmod.quotient.toString();\n      fraction = new Rational(divmod.remainder, fraction.q);\n      maxDigits--;\n    }\n    if (fraction.equal(roundingFactor)) {\n      while (decimalPart[decimalPart.length - 1] === '0') {\n        decimalPart = decimalPart.slice(0, decimalPart.length - 1);\n      }\n    }\n    if (decimalPart !== '') {\n      return sign + integerPart + '.' + decimalPart;\n    }\n    return sign + integerPart;\n  }\n\n  toMixed(): string {\n    if (this.isZero()) {\n      return '0';\n    }\n\n    const { quotient, remainder } = this.divmod(Rational.one);\n\n    let parts: string[] = [];\n    if (!quotient.isZero()) {\n      parts.push(quotient.toFraction());\n    }\n    if (!remainder.isZero()) {\n      parts.push(remainder.toFraction());\n    }\n\n    return parts.join(' + ');\n  }\n\n  //\n  // Statics\n  //\n  static fromFloat(num: number): Rational {\n    if (Number.isInteger(num)) {\n      return new this(num, 1);\n    }\n\n    // Sufficient precision for our data?\n    const r = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n\n    const divmod = r.divmod(Rational.one);\n    for (const [key, value] of lookups) {\n      if (divmod.remainder.equal(key)) {\n        return divmod.quotient.add(value);\n      }\n    }\n\n    return r;\n  }\n  static fromInts(p: number, q: number): Rational {\n    return new this(p, q);\n  }\n\n  static fromString(str: string): Rational {\n    let sum = Rational.zero;\n\n    for (let part of str.split('+')) {\n      part = part.trim();\n      if (!part) continue;\n\n      const index = part.indexOf('/');\n      if (index === -1) {\n        sum = sum.add(Rational.fromFloat(Number(part)));\n      } else {\n        const p = Number(part.slice(0, index));\n        const q = Number(part.slice(index + 1));\n        sum = sum.add(Rational.fromInts(p, q));\n      }\n    }\n\n    return sum;\n  }\n\n  static zero = new Rational(0, 1);\n  static one = new Rational(1, 1);\n  static oneThird = new Rational(1, 3);\n  static twoThirds = new Rational(2, 3);\n}\n\nconst lookups: [Rational, Rational][] = [];\n\nfor (let q = 2; q < 100; q++) {\n  for (let p = 1; p < q; p++) {\n    const num = p / q;\n\n    // Is there a better way to quickly filter out non-repeating decimals?\n    if (num.toString().length < 10) {\n      continue;\n    }\n\n    // Support computer input, use proper rounding\n    const rounded = new Rational(\n      Math.round(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([rounded, Rational.fromInts(p, q)]);\n\n    // Support human input, who just leave off the end after a while\n    const floored = new Rational(\n      Math.floor(num * FLOAT_CONVERT_PRECISION),\n      FLOAT_CONVERT_PRECISION\n    );\n    lookups.push([floored, Rational.fromInts(p, q)]);\n  }\n}\n","import { Rational } from './rational';\nimport { assert } from './util';\n\nimport * as schema from './schema';\n\ninterface IBaseDisplayable {\n  name: string;\n  localised_name: schema.LocalisedName;\n  icon_col: number;\n  icon_row: number;\n}\n\nexport class BaseDisplayable {\n  readonly name: string;\n  readonly localisedName: schema.LocalisedName;\n  readonly iconCol: number;\n  readonly iconRow: number;\n\n  constructor(data: IBaseDisplayable) {\n    this.name = data.name;\n    this.localisedName = data.localised_name;\n    this.iconCol = data.icon_col;\n    this.iconRow = data.icon_row;\n  }\n\n  get niceName(): string {\n    return this.localisedName.en;\n  }\n}\n\nexport class Item extends BaseDisplayable {\n  readonly group: string;\n  readonly subgroup: string;\n  readonly order: string;\n  readonly fuelValue: number | null;\n\n  readonly usedBy: Recipe[] = [];\n  readonly madeBy: Recipe[] = [];\n\n  constructor(d: schema.Item) {\n    super(d);\n\n    this.group = d.group;\n    this.subgroup = d.subgroup;\n    this.order = d.order;\n    this.fuelValue = d.fuel_value ?? null;\n  }\n}\n\nexport class Module extends Item {\n  readonly type: 'module';\n  readonly limitedTo: Set<string>;\n  readonly effects: {\n    speed: Rational;\n    productivity: Rational;\n    consumption: Rational;\n    pollution: Rational;\n  };\n\n  constructor(d: schema.ModuleItem) {\n    super(d);\n    this.type = d.type;\n    this.limitedTo = new Set(d.limitation);\n\n    this.effects = {\n      speed: Rational.fromFloat((d.effect.speed || { bonus: 0 }).bonus),\n      productivity: Rational.fromFloat(\n        (d.effect.productivity || { bonus: 0 }).bonus\n      ),\n      consumption: Rational.fromFloat(\n        (d.effect.consumption || { bonus: 0 }).bonus\n      ),\n      pollution: Rational.fromFloat((d.effect.pollution || { bonus: 0 }).bonus),\n    };\n  }\n\n  canUseWith(recipe: Recipe): boolean {\n    if (this.limitedTo.size === 0) {\n      return true;\n    }\n\n    return this.limitedTo.has(recipe.name);\n  }\n}\n\nexport class Fluid extends Item {\n  readonly defaultTemperature: number;\n  readonly type: 'fluid' = 'fluid';\n\n  constructor(d: schema.FluidItem) {\n    super(d);\n    this.defaultTemperature = d.default_temperature;\n  }\n}\n\nexport class Ingredient {\n  readonly type: 'item' | 'fluid';\n  readonly name: string;\n  amount: Rational; // TODO: readonly\n  readonly item: Item;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    this.name = d.name;\n    this.amount = Rational.fromFloat(d.amount);\n    this.type = d.type ?? 'item';\n    this.item = gd.getItem(d.name);\n  }\n\n  get niceName(): string {\n    return `${this.amount.toDecimal()} × ${this.item.niceName}`;\n  }\n}\n\nexport class FluidIngredient extends Ingredient {\n  readonly type: 'fluid' = 'fluid';\n  readonly item: Fluid;\n  readonly minimumTemperature: number;\n  readonly maximumTemperature: number;\n\n  constructor(d: schema.Ingredient, gd: GameData) {\n    super(d, gd);\n    this.item = gd.getFluid(d.name);\n\n    this.minimumTemperature = d.minimum_temperature || -Infinity;\n    this.maximumTemperature = d.maximum_temperature || Infinity;\n\n    if (this.maximumTemperature >= 1.797e308) {\n      this.maximumTemperature = Infinity;\n    }\n    if (this.minimumTemperature <= -1.797e308) {\n      this.minimumTemperature = -Infinity;\n    }\n  }\n\n  get niceName(): string {\n    const min = this.minimumTemperature;\n    const max = this.maximumTemperature;\n    let range = '';\n    if (min !== -Infinity && max !== Infinity) {\n      range = ` (${min}° – ${max}°)`;\n    } else if (max !== Infinity) {\n      range = ` (≤ ${max}°)`;\n    } else if (min !== -Infinity) {\n      range = ` (≥ ${max}°)`;\n    }\n    return `${this.amount.toDecimal()} × ${this.item.niceName}${range}`;\n  }\n}\n\nexport class Product {\n  readonly name: string;\n  readonly item: Item;\n  amount: Rational;\n\n  constructor(d: schema.Product, gd: GameData) {\n    this.name = d.name;\n    this.item = gd.getItem(d.name);\n\n    let amount;\n    if ('amount' in d) {\n      amount = Rational.fromFloat(d.amount);\n    } else {\n      amount = Rational.fromInts(d.amount_min + d.amount_max, 2);\n    }\n\n    if (typeof d.probability == 'number') {\n      if (d.probability === 0) {\n        amount = Rational.zero;\n      } else if (d.probability !== 1) {\n        assert(d.probability > 0);\n        assert(d.probability < 1);\n        amount = amount.mul(Rational.fromFloat(d.probability));\n      }\n    }\n    this.amount = amount;\n  }\n\n  get niceName(): string {\n    return `${this.amount.toDecimal()} × ${this.item.niceName}`;\n  }\n\n  satisfies(ingredient: Ingredient): boolean {\n    return ingredient.item === this.item;\n  }\n}\n\nexport class FluidProduct extends Product {\n  readonly item: Fluid;\n  readonly temperature: number;\n\n  constructor(d: schema.Product, gd: GameData) {\n    super(d, gd);\n    this.item = gd.getFluid(d.name);\n    this.temperature = d.temperature || this.item.defaultTemperature;\n  }\n\n  get niceName(): string {\n    let temp = '';\n    if (this.temperature !== this.item.defaultTemperature) {\n      temp = ` (${this.temperature}°)`;\n    }\n    return `${this.amount.toDecimal()} × ${this.item.niceName}${temp}`;\n  }\n\n  satisfies(ingredient: Ingredient): boolean {\n    return (\n      ingredient.item === this.item &&\n      ingredient instanceof FluidIngredient &&\n      ingredient.maximumTemperature >= this.temperature &&\n      ingredient.minimumTemperature <= this.temperature\n    );\n  }\n}\n\nexport class Recipe extends BaseDisplayable {\n  readonly category: string;\n  readonly ingredients: Ingredient[];\n  readonly products: Product[];\n  readonly craftingTime: Rational;\n\n  readonly madeIn: AssemblingMachine[] = [];\n\n  constructor(d: schema.Recipe, gd: GameData) {\n    super(d);\n    this.category = d.category;\n    this.craftingTime = Rational.fromFloat(d.energy_required);\n\n    this.ingredients = d.ingredients.map((ingredient) => {\n      if (ingredient.type === 'fluid') {\n        return new FluidIngredient(ingredient, gd);\n      } else {\n        return new Ingredient(ingredient, gd);\n      }\n    });\n\n    this.products = d.results.map((result) => {\n      if (result.type === 'fluid') {\n        return new FluidProduct(result, gd);\n      } else {\n        return new Product(result, gd);\n      }\n    });\n  }\n\n  get niceName(): string {\n    if (this.products.length !== 1) {\n      return super.niceName;\n    }\n    const product = this.products[0];\n    assert(product, 'recipe has no products');\n    if (product.amount.equal(Rational.one)) {\n      return product.item.niceName;\n    } else {\n      return product.niceName;\n    }\n  }\n}\n\nexport abstract class BaseEntity extends BaseDisplayable {\n  // constructor exists to constrain type\n  // eslint-disable-next-line @typescript-eslint/no-useless-constructor\n  constructor(data: schema.BaseEntity) {\n    super(data);\n  }\n}\n\nexport class AssemblingMachine extends BaseEntity {\n  readonly craftingCategories: string[];\n  readonly craftingSpeed: number;\n  readonly moduleSlots: number;\n\n  constructor(data: schema.AssemblingMachine) {\n    super(data);\n    this.craftingCategories = data.crafting_categories;\n    this.craftingSpeed = data.crafting_speed;\n    this.moduleSlots = data.module_slots;\n  }\n\n  canBuildRecipe(recipe: Recipe): boolean {\n    // This does not (but should) account for entity fluid boxes\n    if (this.craftingCategories.indexOf(recipe.category) === -1) {\n      return false;\n    }\n\n    // ingredient_count seems to be item specific. this is disabled until\n    // I can figure out how many fluids a machine can support\n    // if (recipe.ingredients.length > this.data.ingredient_count) {\n    //     return false\n    // }\n    return true;\n  }\n}\n\nexport type Entity = AssemblingMachine;\n\ntype CategoryMap = { [category: string]: AssemblingMachine[] };\n\nconst createCategoryMap = (entities: Iterable<Entity>): CategoryMap => {\n  const catMap: CategoryMap = {};\n  for (const entity of entities) {\n    for (const category of entity.craftingCategories) {\n      const machines = catMap[category];\n      if (machines) {\n        machines.push(entity);\n      } else {\n        catMap[category] = [entity];\n      }\n    }\n  }\n  return catMap;\n};\n\nexport class GameData {\n  readonly itemMap = new Map<string, Item>();\n\n  readonly fluids: Fluid[] = [];\n  readonly fluidMap = new Map<string, Fluid>();\n\n  readonly modules: Module[] = [];\n  readonly moduleMap = new Map<string, Module>();\n\n  readonly recipes: Recipe[] = [];\n  readonly recipeMap = new Map<string, Recipe>();\n\n  readonly entityMap = new Map<string, Entity>();\n\n  readonly categoryMap: CategoryMap;\n  readonly groups: schema.Groups;\n\n  readonly clockSprite: BaseDisplayable;\n  readonly noModuleModule: Module;\n\n  readonly spriteHash: string;\n\n  readonly activeMods: Record<string, string>;\n\n  constructor(raw: schema.Root) {\n    this.activeMods = raw.active_mods;\n    this.spriteHash = raw.sprites.hash;\n\n    for (const edata of Object.values(raw['assembling-machine'])) {\n      const entity = new AssemblingMachine(edata);\n      this.entityMap.set(entity.name, entity);\n    }\n\n    for (const edata of Object.values(raw['furnace'])) {\n      const entity = new AssemblingMachine(edata);\n      this.entityMap.set(entity.name, entity);\n    }\n\n    for (const edata of Object.values(raw['rocket-silo'])) {\n      const entity = new AssemblingMachine(edata);\n      this.entityMap.set(entity.name, entity);\n    }\n\n    for (const rawMiningDrill of Object.values(raw['mining-drill'])) {\n      const rawMachine: schema.AssemblingMachine = {\n        ...rawMiningDrill,\n        crafting_categories: rawMiningDrill.resource_categories.map(\n          (r) => 'resource-' + r\n        ),\n        crafting_speed: rawMiningDrill.mining_speed,\n        ingredient_count: 1,\n      };\n      const machine = new AssemblingMachine(rawMachine);\n      this.entityMap.set(rawMachine.name, machine);\n    }\n\n    for (const rawItem of Object.values(raw.items)) {\n      if ('type' in rawItem && rawItem.type === 'fluid') {\n        const fluid = new Fluid(rawItem);\n        this.itemMap.set(fluid.name, fluid);\n        this.fluids.push(fluid);\n        this.fluidMap.set(fluid.name, fluid);\n      } else if ('type' in rawItem && rawItem.type === 'module') {\n        const item = new Module(rawItem);\n        this.itemMap.set(item.name, item);\n        this.modules.push(item);\n        this.moduleMap.set(item.name, item);\n      } else {\n        const item = new Item(rawItem);\n        this.itemMap.set(item.name, item);\n      }\n    }\n\n    const recipes: Recipe[] = [];\n\n    // Add real recipes\n    for (const rawRecipe of Object.values(raw.recipes)) {\n      recipes.push(new Recipe(rawRecipe, this));\n    }\n\n    // Add fake recipes for resources\n    for (const rawResource of Object.values(raw.resource)) {\n      const category = `resource-${rawResource.category}`;\n      const ingredients: schema.Ingredient[] = [];\n      const { fluid_amount, required_fluid } = rawResource.minable;\n      if (fluid_amount && required_fluid) {\n        ingredients.push({\n          name: required_fluid,\n          type: 'fluid',\n          // 10 in lua becomes 1 in game. not sure why\n          amount: fluid_amount / 10,\n        });\n      }\n      recipes.push(\n        new Recipe(\n          {\n            name: `resource-${rawResource.name}`,\n            localised_name: rawResource.localised_name,\n            category,\n            energy_required: rawResource.minable.mining_time,\n            group: category, // TODO: better group?\n            subgroup: category, // TODO: better subgroup?\n            icon_col: rawResource.icon_col,\n            icon_row: rawResource.icon_row,\n            ingredients,\n            results: rawResource.minable.results,\n            type: 'recipe',\n            order: 'A',\n          },\n          this\n        )\n      );\n    }\n\n    for (const recipe of recipes) {\n      for (const entity of this.entityMap.values()) {\n        if ('canBuildRecipe' in entity && entity.canBuildRecipe(recipe)) {\n          recipe.madeIn.push(entity);\n        }\n      }\n      if (!recipe.madeIn.length) {\n        // Filter to only recipes buildable by knonwn assembling machines\n        console.warn(`Ignoring uncraftable recipe: ${recipe.name}`);\n        continue;\n      }\n\n      const hasProducts = recipe.products.some((p) => p.amount.isPositive());\n      if (!hasProducts) {\n        continue;\n      }\n\n      for (const ingredient of recipe.ingredients) {\n        ingredient.item.usedBy.push(recipe);\n      }\n      for (const product of recipe.products) {\n        product.item.madeBy.push(recipe);\n      }\n      this.recipes.push(recipe);\n      this.recipeMap.set(recipe.name, recipe);\n    }\n\n    this.categoryMap = createCategoryMap(this.entityMap.values());\n    this.groups = raw.groups;\n\n    const clockSprite = raw.sprites.extra['clock'];\n    assert(clockSprite, 'missing clock sprite');\n    const noModuleIcon = raw.sprites.extra['slot_icon_module'];\n    assert(noModuleIcon, 'missing \"no icon\" sprite');\n\n    this.clockSprite = new BaseDisplayable({\n      ...clockSprite,\n      name: 'clock',\n      localised_name: { en: 'Clock' },\n    });\n\n    this.noModuleModule = new Module({\n      ...noModuleIcon,\n      type: 'module',\n      name: 'no_module',\n      localised_name: { en: 'No Module' },\n      category: 'speed',\n      effect: {},\n      limitation: [],\n      rocket_launch_products: [],\n\n      group: '',\n      subgroup: '',\n      order: '',\n    });\n  }\n\n  getEntity(name: string): Entity {\n    const entity = this.entityMap.get(name);\n    assert(entity, `no entity with name: ${name}`);\n    return entity;\n  }\n\n  getFluid(name: string): Fluid {\n    const fluid = this.fluidMap.get(name);\n    assert(fluid, `no fluid with name: ${name}`);\n    return fluid;\n  }\n\n  getItem(name: string): Item {\n    const item = this.itemMap.get(name);\n    assert(item, `no item with name: ${name}`);\n    return item;\n  }\n\n  getModule(name: string): Module {\n    const module = this.moduleMap.get(name);\n    assert(module, `no module with name: ${name}`);\n    return module;\n  }\n\n  getRecipe(name: string): Recipe {\n    const recipe = this.recipeMap.get(name);\n    assert(recipe, `no recipe with name: ${name}`);\n    return recipe;\n  }\n\n  getItemOrder(item: Item | Fluid): [string, string, string, string] {\n    let groupOrder = '';\n    let subgroupOrder = '';\n    const group = this.groups[item.group];\n    if (group) {\n      groupOrder = group.order;\n      subgroupOrder = group.subgroups[item.subgroup] || '';\n    }\n    return [groupOrder, subgroupOrder, item.order, item.name];\n  }\n\n  // Sort by\n  // 1. group\n  // 2. subgroup\n  // 3. item order string\n  // 4. item name\n  sortByItem<T>(collection: T[], keyFn: (obj: T) => Item | Fluid): void {\n    collection.sort((a: T, b: T) => {\n      const ordersA = this.getItemOrder(keyFn(a));\n      const ordersB = this.getItemOrder(keyFn(b));\n\n      for (const i in ordersA) {\n        const valA = ordersA[i]!;\n        const valB = ordersB[i]!;\n        if (valA > valB) {\n          return 1;\n        } else if (valA < valB) {\n          return -1;\n        }\n      }\n\n      return 0;\n    });\n  }\n}\n","import * as game from './game';\nimport { AppSettingsData } from './state';\nimport { assert } from './util';\n\nexport function getDefaultMachine(\n  input: game.Recipe | string,\n  settings: AppSettingsData,\n  gameData: game.GameData\n): game.AssemblingMachine {\n  const category = input instanceof game.Recipe ? input.category : input;\n\n  let defaultMachine: game.AssemblingMachine | undefined;\n  if (category in settings.assemblerOverrides) {\n    defaultMachine = settings.assemblerOverrides[category];\n  } else {\n    defaultMachine = gameData.categoryMap[category]![0];\n  }\n\n  assert(defaultMachine);\n\n  if (input instanceof game.Recipe) {\n    assert(input.madeIn.indexOf(defaultMachine) !== -1);\n  }\n\n  return defaultMachine;\n}\n","/*\nMIT License\n\nCopyright (c) 2020 Egor Nepomnyaschih\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n/*\n// FROM https://gist.github.com/enepomnyaschih/72c423f727d395eeaa09697058238727\n// This constant can also be computed with the following algorithm:\nconst base64abc = [],\n\tA = \"A\".charCodeAt(0),\n\ta = \"a\".charCodeAt(0),\n\tn = \"0\".charCodeAt(0);\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(A + i));\n}\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(a + i));\n}\nfor (let i = 0; i < 10; ++i) {\n\tbase64abc.push(String.fromCharCode(n + i));\n}\nbase64abc.push(\"+\");\nbase64abc.push(\"/\");\n*/\nconst base64abc = [\n\t\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\",\n\t\"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\",\n\t\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\",\n\t\"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\",\n\t\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"+\", \"/\"\n];\n\n/*\n// This constant can also be computed with the following algorithm:\nconst l = 256, base64codes = new Uint8Array(l);\nfor (let i = 0; i < l; ++i) {\n\tbase64codes[i] = 255; // invalid character\n}\nbase64abc.forEach((char, index) => {\n\tbase64codes[char.charCodeAt(0)] = index;\n});\nbase64codes[\"=\".charCodeAt(0)] = 0; // ignored anyway, so we just need to prevent an error\n*/\nconst base64codes = [\n\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 62, 255, 255, 255, 63,\n\t52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 255, 255, 255, 0, 255, 255,\n\t255, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,\n\t15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 255, 255, 255, 255, 255,\n\t255, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,\n\t41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51\n];\n\nfunction getBase64Code(charCode: number): number {\n\tconst code = base64codes[charCode];\n\tif (code === 255 || code === undefined) {\n\t\tthrow new Error(\"Unable to parse base64 string.\");\n\t}\n\treturn code;\n}\n\nexport function bytesToBase64(bytes: Uint8Array): string {\n\tlet result = '', i, l = bytes.length;\n\tfor (i = 2; i < l; i += 3) {\n\t\tresult += base64abc[bytes[i - 2]! >> 2];\n\t\tresult += base64abc[((bytes[i - 2]! & 0x03) << 4) | (bytes[i - 1]! >> 4)];\n\t\tresult += base64abc[((bytes[i - 1]! & 0x0F) << 2) | (bytes[i]! >> 6)];\n\t\tresult += base64abc[bytes[i]! & 0x3F];\n\t}\n\tif (i === l + 1) { // 1 octet yet to write\n\t\tresult += base64abc[bytes[i - 2]! >> 2];\n\t\tresult += base64abc[(bytes[i - 2]! & 0x03) << 4];\n\t\tresult += \"==\";\n\t}\n\tif (i === l) { // 2 octets yet to write\n\t\tresult += base64abc[bytes[i - 2]! >> 2];\n\t\tresult += base64abc[((bytes[i - 2]! & 0x03) << 4) | (bytes[i - 1]! >> 4)];\n\t\tresult += base64abc[(bytes[i - 1]! & 0x0F) << 2];\n\t\tresult += \"=\";\n\t}\n\treturn result;\n}\n\nexport function base64ToBytes(str: string): Uint8Array {\n\tif (str.length % 4 !== 0) {\n\t\tthrow new Error(\"Unable to parse base64 string.\");\n\t}\n\tconst index = str.indexOf(\"=\");\n\tif (index !== -1 && index < str.length - 2) {\n\t\tthrow new Error(\"Unable to parse base64 string.\");\n\t}\n\tlet missingOctets = str.endsWith(\"==\") ? 2 : str.endsWith(\"=\") ? 1 : 0,\n\t\tn = str.length,\n\t\tresult = new Uint8Array(3 * (n / 4)),\n\t\tbuffer;\n\tfor (let i = 0, j = 0; i < n; i += 4, j += 3) {\n\t\tbuffer =\n\t\t\tgetBase64Code(str.charCodeAt(i)) << 18 |\n\t\t\tgetBase64Code(str.charCodeAt(i + 1)) << 12 |\n\t\t\tgetBase64Code(str.charCodeAt(i + 2)) << 6 |\n\t\t\tgetBase64Code(str.charCodeAt(i + 3));\n\t\tresult[j] = buffer >> 16;\n\t\tresult[j + 1] = (buffer >> 8) & 0xFF;\n\t\tresult[j + 2] = buffer & 0xFF;\n\t}\n\treturn result.subarray(0, result.length - missingOctets);\n}\n\nconst defaultEncoder = new TextEncoder();\nexport function base64encode(str: string, encoder?: TextEncoder) {\n\treturn bytesToBase64((encoder || defaultEncoder).encode(str));\n}\n\nconst defaultDecoder = new TextDecoder();\nexport function base64decode(str: string, decoder?: TextDecoder) {\n\treturn (decoder || defaultDecoder).decode(base64ToBytes(str));\n}\n","/// <reference path=\"./types/pako.d.ts\" />\nimport * as game from './game';\nimport { Rational } from './rational';\nimport { CompleteState, AppSettingsData } from './state';\nimport { getDefaultMachine } from './stateutil';\nimport { mapValues } from './util';\n\nimport { inflate, deflate } from 'pako';\n\nimport { base64ToBytes, bytesToBase64 } from './base64';\n\ntype SerializedRowV1 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  number, // num assembling machines\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedAppStateV1 {\n  version: 1;\n  data: SerializedRowV1[];\n}\n\nfunction state1to2(state: SerializedAppStateV1): SerializedAppStateV2 {\n  return {\n    version: 2,\n    data: {\n      rows: state.data,\n      settings: {\n        assemblerOverrides: {},\n      },\n    },\n  };\n}\n\ninterface SerializedAppStateV2 {\n  version: 2;\n  data: {\n    rows: SerializedRowV1[];\n    settings: SerializedSettings;\n  };\n}\n\n// V3 = v2 but compressed\nfunction state2to3(state: SerializedAppStateV2): SerializedAppStateV3 {\n  return {\n    version: 3,\n    data: state.data,\n  };\n}\n\ninterface SerializedAppStateV3 {\n  version: 3;\n  data: SerializedAppStateV2['data'];\n}\n\n// v4 is multiple groups of rows\nfunction state3to4(state: SerializedAppStateV3): SerializedAppStateV4 {\n  return {\n    version: 4,\n    data: {\n      settings: state.data.settings,\n      groups: [\n        {\n          name: 'Factory 1',\n          rows: state.data.rows,\n        },\n      ],\n    },\n  };\n}\n\n// v4 has multiple groups, each with multiple rows\ninterface SerializedGroupV4 {\n  name: string;\n  rows: SerializedRowV1[];\n}\ninterface SerializedAppStateV4 {\n  version: 4;\n  data: {\n    groups: SerializedGroupV4[];\n    settings: SerializedSettings;\n  };\n}\n\nfunction groupv4to5(group: SerializedGroupV4): SerializedGroupV5 {\n  return {\n    name: group.name,\n    rows: group.rows.map((r) => {\n      return [r[0], r[1], r[2].toString(), r[3], r[4], r[5]];\n    }),\n  };\n}\n\n// v5 has multiple groups, each with multiple rows\nfunction state4to5(state: SerializedAppStateV4): SerializedAppStateV5 {\n  return {\n    version: 5,\n    data: {\n      settings: state.data.settings,\n      groups: state.data.groups.map(groupv4to5),\n    },\n  };\n}\ntype SerializedRowV5 = [\n  string, // recipe name, required\n  string | null, // assembling machine, null if default\n  string, // num assembling machines as a rational\n  (string | null)[], // modules,\n  string | undefined, // beacon module, if chosen\n  number // num beacon modules\n];\n\ninterface SerializedGroupV5 {\n  name: string;\n  rows: SerializedRowV5[];\n}\ninterface SerializedAppStateV5 {\n  version: 5;\n  data: {\n    groups: SerializedGroupV5[];\n    settings: SerializedSettings;\n  };\n}\n\ninterface SerializedAppStateOther {\n  version: 0;\n  data: unknown;\n}\n\ntype MultiSerializedAppState =\n  | SerializedAppStateOther\n  | SerializedAppStateV1\n  | SerializedAppStateV2\n  | SerializedAppStateV3\n  | SerializedAppStateV4\n  | SerializedAppStateV5;\n\n// Latest values\ntype SerializedRow = SerializedRowV5;\ntype SerializedAppState = SerializedAppStateV5;\n\ninterface SerializedSettings {\n  assemblerOverrides: {\n    [category: string]: string;\n  };\n}\n\nexport const STATEKEY = `tscalc-${document.location.pathname}`;\n\nexport function setLocalStorageState(\n  state: CompleteState,\n  gameData: game.GameData\n): void {\n  localStorage.setItem(STATEKEY, JSON.stringify(serialize(state, gameData)));\n}\n\nexport function getLocalStorageState(\n  gameData: game.GameData\n): CompleteState | null {\n  let statestr = localStorage.getItem(STATEKEY);\n  if (!statestr) {\n    statestr = localStorage.getItem('appstate');\n    if (statestr) {\n      // move to the new key\n      localStorage.setItem(STATEKEY, statestr);\n      localStorage.removeItem('appstate');\n    } else {\n      return null;\n    }\n  }\n  const stateobj: MultiSerializedAppState = JSON.parse(statestr);\n  if (stateobj.version === 1) {\n    (stateobj as any).version = 3;\n  }\n\n  return deserialize(gameData, stateobj);\n}\n\nexport function setUrlState(\n  state: CompleteState,\n  gameData: game.GameData\n): void {\n  const serialized = serialize(state, gameData);\n  const version = serialized.version;\n  let str = JSON.stringify(serialized.data);\n  // compress\n  str = bytesToBase64(deflate(str));\n\n  window.history.replaceState('', '', `#${version}-${str}`);\n}\n\nfunction serialize(\n  state: CompleteState,\n  gameData: game.GameData\n): SerializedAppState {\n  const groups = state.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map((row) => {\n        let machineName: string | null = row.machine.name;\n        const defaultMachine = getDefaultMachine(\n          row.recipe,\n          state.settings,\n          gameData\n        );\n\n        if (defaultMachine.name === machineName) {\n          machineName = null;\n        }\n\n        const srow: SerializedRow = [\n          row.recipe.name,\n          machineName,\n          row.numMachines.toFraction(),\n          row.modules.map((m) => (m ? m.name : null)),\n          row.beaconModule ? row.beaconModule.name : undefined,\n          row.numBeacons,\n        ];\n        return srow;\n      }),\n    };\n  });\n\n  const settings = {\n    assemblerOverrides: mapValues(\n      state.settings.assemblerOverrides,\n      (a) => a.name\n    ),\n  };\n\n  return {\n    version: 5,\n    data: { groups, settings },\n  };\n}\n\nconst reStateUrl = /^#(\\d+)?(?:-)?(.+)$/;\n\nexport function getUrlState(gameData: game.GameData): CompleteState | null {\n  const matches = reStateUrl.exec(document.location.hash);\n  if (!matches) {\n    return null;\n  }\n  const version = Number(matches[1] || 1);\n\n  let str = decodeURIComponent(matches[2]!);\n  if (version > 2) {\n    str = inflate(base64ToBytes(str), { to: 'string' });\n  }\n\n  let data = JSON.parse(str);\n\n  return deserialize(gameData, {\n    version: version as 0,\n    data,\n  });\n}\n\nfunction migrateSerializedState(\n  state: MultiSerializedAppState\n): SerializedAppState {\n  switch (state.version) {\n    case 1:\n      state = state1to2(state);\n    // fall through\n    case 2:\n      state = state2to3(state);\n    // fall through\n    case 3:\n      state = state3to4(state);\n    // fall through\n    case 4:\n      state = state4to5(state);\n    // fall through\n    case 5:\n      // the latest\n      break;\n    default:\n      throw new Error(`unknown state: ${state}`);\n  }\n\n  return state;\n}\n\nfunction deserialize(\n  gameData: game.GameData,\n  unmigrated: MultiSerializedAppState\n): CompleteState {\n  const migrated = migrateSerializedState(unmigrated).data;\n\n  const state: CompleteState = {\n    settings: deserializeSettings(gameData, migrated.settings),\n    groups: [],\n  };\n\n  state.groups = migrated.groups.map((group) => {\n    return {\n      name: group.name,\n      rows: group.rows.map(\n        ([\n          recipeName,\n          machineName,\n          numMachines,\n          modules,\n          beaconModule,\n          numBeacons,\n        ]) => {\n          const recipe = gameData.getRecipe(recipeName);\n\n          const machine = machineName\n            ? gameData.getEntity(machineName)\n            : getDefaultMachine(recipe, state.settings, gameData);\n\n          return {\n            recipe: recipe,\n            machine: machine,\n            numMachines: Rational.fromString(numMachines),\n            modules: modules.map((n) => (n ? gameData.getModule(n) : null)),\n            beaconModule: beaconModule\n              ? gameData.getModule(beaconModule)\n              : null,\n            numBeacons: numBeacons || 0,\n          };\n        }\n      ),\n    };\n  });\n\n  return state;\n}\n\nfunction deserializeSettings(\n  gameData: game.GameData,\n  serialized: SerializedSettings\n): AppSettingsData {\n  return {\n    assemblerOverrides: mapValues(serialized.assemblerOverrides, (name) =>\n      gameData.getEntity(name)\n    ),\n  };\n}\n","import * as game from './game';\n\ninterface SignalHandler<T> {\n  (arg: T): void;\n}\n\nexport class Signal<T> {\n  handlers: SignalHandler<T>[] = [];\n\n  addHandler(handler: SignalHandler<T>): void {\n    const index = this.handlers.indexOf(handler);\n    if (index === -1) {\n      this.handlers.push(handler);\n    }\n  }\n\n  removeHandler(handler: SignalHandler<T>): void {\n    const index = this.handlers.indexOf(handler);\n    if (index !== -1) {\n      this.handlers.splice(index, 1);\n    }\n  }\n\n  dispatch = (arg: T): void => {\n    for (const handler of this.handlers) {\n      handler(arg);\n    }\n  };\n}\n\nexport const addIngredientFilter = new Signal<game.Ingredient>();\nexport const addProductFilter = new Signal<game.Product>();\nexport const addRecipeRow = new Signal<game.Recipe>();\n","import { Signal } from './signal';\n\nexport interface Notification {\n  title: string;\n  when: Date;\n  body: React.ReactNode;\n}\n\nexport const newNotification = new Signal<Notification>();\n\nexport function notify(notification: Notification): void {\n  newNotification.dispatch(notification);\n}\n\nexport function error(body: Error | React.ReactNode): void {\n  let bodyText = body;\n  if (body instanceof Error && body.stack) {\n    bodyText = body.stack;\n  }\n\n  newNotification.dispatch({\n    title: 'Error!',\n    when: new Date(),\n    body: bodyText,\n  });\n}\n","import { useCallback } from 'react';\nimport { atom, useSetRecoilState } from 'recoil';\n\nimport { RecipeGroupData } from './state';\nimport { GroupAtom, groupAtomsAtom } from './atoms';\n\nlet groupId = 0;\n\nexport interface AddGroupAction {\n  (group: RecipeGroupData): GroupAtom;\n}\nexport const useGroupAdd = (): AddGroupAction => {\n  const setGroupAtoms = useSetRecoilState(groupAtomsAtom);\n\n  return useCallback(\n    function (group: RecipeGroupData): GroupAtom {\n      const newAtom: GroupAtom = atom<RecipeGroupData>({\n        key: `group-${++groupId}`,\n        default: group,\n      });\n\n      setGroupAtoms((atoms) => [...atoms, newAtom]);\n      return newAtom;\n    },\n    [setGroupAtoms]\n  );\n};\n","import * as game from './game';\n\nimport { clone } from './util';\n\nimport { Rational } from './rational';\n\nimport { RecipeRowData } from './state';\n\nexport class Totals {\n  ingredients: game.Ingredient[] = [];\n  products: game.Product[] = [];\n\n  constructor(rows?: RecipeRowData[]) {\n    if (rows && rows.length) {\n      for (const row of rows) {\n        this.addRow(row);\n      }\n    }\n  }\n\n  addIngredient(newIngredient: game.Ingredient): void {\n    for (const oldIng of this.ingredients) {\n      if (oldIng.name !== newIngredient.name) {\n        continue;\n      }\n      if (\n        newIngredient instanceof game.FluidIngredient &&\n        oldIng instanceof game.FluidIngredient\n      ) {\n        if (\n          newIngredient.maximumTemperature !== oldIng.maximumTemperature ||\n          newIngredient.minimumTemperature !== oldIng.minimumTemperature\n        ) {\n          continue;\n        }\n      }\n\n      oldIng.amount = oldIng.amount.add(newIngredient.amount);\n      return;\n    }\n\n    for (const oldProd of this.products) {\n      if (!oldProd.satisfies(newIngredient)) continue;\n      if (oldProd.amount.less(newIngredient.amount)) {\n        newIngredient.amount = newIngredient.amount.sub(oldProd.amount);\n        oldProd.amount = Rational.zero;\n        if (newIngredient.amount.isZero()) break;\n      } else {\n        oldProd.amount = oldProd.amount.sub(newIngredient.amount);\n        newIngredient.amount = Rational.zero;\n        break;\n      }\n    }\n\n    this.ingredients.push(newIngredient);\n    this.ingredients = this.ingredients.filter((p) => !p.amount.isZero());\n    this.products = this.products.filter((p) => !p.amount.isZero());\n  }\n\n  addProduct(newProduct: game.Product): void {\n    for (const oldProd of this.products) {\n      if (newProduct.name !== oldProd.name) continue;\n\n      if (\n        newProduct instanceof game.FluidProduct &&\n        oldProd instanceof game.FluidProduct\n      ) {\n        if (newProduct.temperature !== oldProd.temperature) {\n          continue;\n        }\n      }\n\n      oldProd.amount = oldProd.amount.add(newProduct.amount);\n      return;\n    }\n\n    for (const oldIng of this.ingredients) {\n      if (!newProduct.satisfies(oldIng)) continue;\n      if (newProduct.amount.less(oldIng.amount)) {\n        oldIng.amount = oldIng.amount.sub(newProduct.amount);\n        newProduct.amount = Rational.zero;\n        break;\n      } else {\n        newProduct.amount = newProduct.amount.sub(oldIng.amount);\n        oldIng.amount = Rational.zero;\n        if (newProduct.amount.isZero()) break;\n      }\n    }\n\n    this.products.push(newProduct);\n    this.ingredients = this.ingredients.filter((i) => !i.amount.isZero());\n    this.products = this.products.filter((i) => !i.amount.isZero());\n  }\n\n  addRow(row: RecipeRowData): void {\n    const effects = {\n      consumption: Rational.one,\n      pollution: Rational.one,\n      productivity: Rational.one,\n      speed: Rational.one,\n    };\n\n    for (const module of row.modules) {\n      if (!module) continue;\n      effects.consumption = effects.consumption.add(module.effects.consumption);\n      effects.pollution = effects.pollution.add(module.effects.pollution);\n      effects.productivity = effects.productivity.add(\n        module.effects.productivity\n      );\n      effects.speed = effects.speed.add(module.effects.speed);\n    }\n\n    if (row.beaconModule && row.numBeacons > 0) {\n      // assumes \"distribution_effectivity\" of 0.5 from default beacons\n      const be = row.beaconModule.effects;\n      const num = Rational.fromInts(row.numBeacons, 2);\n      effects.consumption = effects.consumption.add(be.consumption.mul(num));\n      effects.pollution = effects.pollution.add(be.pollution.mul(num));\n      effects.productivity = effects.productivity.add(be.productivity.mul(num));\n      effects.speed = effects.speed.add(be.speed.mul(num));\n    }\n\n    // Allowed -80% to de facto max of signed short int\n    effects.consumption = effects.consumption.clamp(0.2, 32767);\n    effects.pollution = effects.pollution.clamp(0.2, 32767);\n    effects.speed = effects.speed.clamp(0.2, 32767);\n\n    // Special minimum: -0%\n    effects.productivity = effects.productivity.clamp(1, 32767);\n\n    const ingredientMult = Rational.one\n      .mul(row.recipe.craftingTime.invert())\n      .mul(row.numMachines)\n      .mul(row.machine.craftingSpeed)\n      .mul(effects.speed);\n\n    const productMult = ingredientMult.mul(effects.productivity);\n\n    for (const ingredient of row.recipe.ingredients.map((ingredient) => {\n      ingredient = clone(ingredient);\n      ingredient.amount = ingredient.amount.mul(ingredientMult);\n      return ingredient;\n    })) {\n      this.addIngredient(ingredient);\n    }\n\n    for (const product of row.recipe.products.map((product) => {\n      product = clone(product);\n      product.amount = product.amount.mul(productMult);\n      return product;\n    })) {\n      this.addProduct(product);\n    }\n  }\n}\n","import * as React from 'react';\nimport Popper from 'popper.js';\n\nimport { assert } from '../../util';\n\ninterface DropdownHeader {\n  header: React.ReactNode;\n}\n\ninterface DropdownDivider {\n  divider: true;\n}\n\ninterface DropdownEntry<T> {\n  key: React.Key;\n  disabled?: boolean;\n  active?: boolean;\n  option: T;\n}\n\ntype DropdownOption<T> = DropdownHeader | DropdownDivider | DropdownEntry<T>;\n\ninterface Props<T> {\n  options: DropdownOption<T>[];\n  selected: T;\n  onSelect(selected: T): void;\n\n  renderOption(option: T): React.ReactNode;\n  renderSelected(option: T): React.ReactNode;\n}\ninterface State {\n  isOpen: boolean;\n}\n\nconst ESC_KEYCODE = 27;\n\nexport class Dropdown<T> extends React.PureComponent<Props<T>, State> {\n  buttonRef: React.RefObject<HTMLButtonElement> = React.createRef();\n\n  state: State = {\n    isOpen: false,\n  };\n\n  handleClick = (e: React.MouseEvent<HTMLButtonElement>): void => {\n    if (!this.getCanToggle()) {\n      return;\n    }\n\n    // Prevent the \"opening\" click from immediately closing the dropdown\n    e.stopPropagation();\n\n    this.setState((state) => ({\n      ...state,\n      isOpen: !state.isOpen,\n    }));\n  };\n\n  handleSelect = (selected: T): void => {\n    this.props.onSelect(selected);\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  handleWantClose = (): void => {\n    this.setState({\n      isOpen: false,\n    });\n  };\n\n  getCanToggle(): boolean {\n    for (const option of this.props.options) {\n      if ('option' in option && !option.disabled) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  render(): React.ReactNode {\n    const classes = ['btn', 'btn-secondary'];\n    if (this.getCanToggle()) {\n      classes.push('dropdown-toggle');\n    } else {\n      classes.push('disabled');\n    }\n\n    let floater: React.ReactNode | null;\n    if (this.state.isOpen) {\n      floater = (\n        <DropdownMenu\n          parentRef={this.buttonRef}\n          options={this.props.options}\n          renderOption={this.props.renderOption}\n          onSelect={this.handleSelect}\n          onWantClose={this.handleWantClose}\n        />\n      );\n    }\n\n    return (\n      <>\n        <button\n          ref={this.buttonRef}\n          className={classes.join(' ')}\n          type=\"button\"\n          onClick={this.handleClick}\n        >\n          {this.props.renderSelected(this.props.selected)}\n        </button>\n        {floater}\n      </>\n    );\n  }\n}\n\ninterface DropdownMenuProps<T> {\n  parentRef: React.RefObject<any>;\n  options: DropdownOption<T>[];\n  renderOption(option: T): React.ReactNode;\n  onSelect(selected: T): void;\n  onWantClose(): void;\n}\n\ninterface DropdownMenuState {\n  style: object;\n}\n\nclass DropdownMenu<T> extends React.PureComponent<\n  DropdownMenuProps<T>,\n  DropdownMenuState\n> {\n  popperInstance: Popper | null = null;\n  menuRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n  state: DropdownMenuState = {\n    style: {},\n  };\n\n  popperUpdate = (data: Popper.Data): Popper.Data => {\n    this.setState({\n      style: data.styles,\n    });\n    return data;\n  };\n\n  handleBodyClick = (event: MouseEvent): void => {\n    if (!(event.target instanceof Node)) {\n      console.warn('handleBodyClick called for non-node', event.target);\n      return;\n    }\n    assert(this.menuRef.current);\n\n    if (!this.menuRef.current.contains(event.target)) {\n      // Click was outside menu\n      this.props.onWantClose();\n    }\n  };\n\n  handleKeyEvent = (event: KeyboardEvent): void => {\n    if (event.keyCode === ESC_KEYCODE) {\n      this.props.onWantClose();\n    }\n  };\n\n  componentDidMount(): void {\n    if (this.popperInstance) {\n      throw new Error('Component mounted twice?');\n    }\n\n    const referenceEl = this.props.parentRef.current;\n    if (!referenceEl) {\n      throw new Error('Cannot mount DropdownMenu without parentRef');\n    }\n\n    const menuEl = this.menuRef.current;\n    if (!menuEl) {\n      throw new Error('Cannot mount DropdownMenu without menuRef');\n    }\n\n    this.popperInstance = new Popper(referenceEl, menuEl, {\n      modifiers: {\n        applyStyle: { enabled: false },\n        updateStateWithStyle: {\n          enabled: true,\n          fn: this.popperUpdate,\n        },\n      },\n    });\n\n    document.body.addEventListener('click', this.handleBodyClick);\n    document.body.addEventListener('keyup', this.handleKeyEvent);\n  }\n\n  componentWillUnmount(): void {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n    document.body.removeEventListener('click', this.handleBodyClick);\n    document.body.removeEventListener('keyup', this.handleKeyEvent);\n  }\n\n  renderOptions = (): React.ReactNode => {\n    return this.props.options.map((option, i) => {\n      if ('header' in option) {\n        return (\n          <h6 className=\"dropdown-header\" key={'ddkey' + i}>\n            {option.header}\n          </h6>\n        );\n      }\n      if ('divider' in option) {\n        return <div className=\"dropdown-divider\" key={'ddkey' + i} />;\n      }\n\n      const classes = ['dropdown-item'];\n      option.active && classes.push('active');\n      option.disabled && classes.push('disabled');\n\n      return (\n        <button\n          key={option.key}\n          className={classes.join(' ')}\n          onClick={() => this.props.onSelect(option.option)}\n          type=\"button\"\n        >\n          {this.props.renderOption(option.option)}\n        </button>\n      );\n    });\n  };\n\n  render(): React.ReactNode {\n    return (\n      <div\n        className=\"dropdown-menu show\"\n        style={this.state.style}\n        ref={this.menuRef}\n      >\n        {this.renderOptions()}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Popper from 'popper.js';\n\ninterface Props {\n  relativeTo: React.RefObject<HTMLElement>;\n  content: () => React.ReactNode;\n}\n\ninterface State {\n  showSelf: boolean;\n}\n\nconst ontop: React.CSSProperties = { zIndex: 1001 };\n\nexport class Tooltip extends React.Component<Props, State> {\n  selfRef: React.RefObject<any>;\n  popperInstance: Popper | null;\n\n  constructor(props: Props) {\n    super(props);\n    this.selfRef = React.createRef();\n    this.popperInstance = null;\n    this.state = {\n      showSelf: false,\n    };\n  }\n\n  shouldComponentUpdate(oldProps: Props, oldState: State): boolean {\n    // universal props\n    if (\n      this.props.relativeTo !== oldProps.relativeTo ||\n      this.state.showSelf !== oldState.showSelf\n    ) {\n      return true;\n    }\n\n    // Only re-render due to props.content changes if we're displaying that content\n    return this.state.showSelf && this.props.content !== oldProps.content;\n  }\n\n  initPopper(): void {\n    if (this.popperInstance) {\n      return;\n    }\n\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    const selfEl = this.selfRef.current;\n    if (!selfEl) {\n      throw new Error('No self reference yet?');\n    }\n\n    this.popperInstance = new Popper(referenceEl, selfEl, {\n      placement: 'right',\n      modifiers: {\n        offset: {\n          enabled: true,\n          offset: '0, 20',\n        },\n        preventOverflow: {\n          enabled: true,\n          boundariesElement: 'window',\n        },\n      },\n    });\n  }\n\n  cleanupPopper(): void {\n    if (this.popperInstance) {\n      this.popperInstance.disableEventListeners();\n      this.popperInstance = null;\n    }\n  }\n\n  componentDidUpdate(_: Props, prevState: State): void {\n    if (prevState.showSelf !== this.state.showSelf) {\n      if (this.state.showSelf) {\n        this.initPopper();\n      } else {\n        this.cleanupPopper();\n      }\n    }\n  }\n\n  componentDidMount(): void {\n    const referenceEl = this.props.relativeTo.current;\n    if (!referenceEl) {\n      throw new Error('Invalid relativeTo');\n    }\n\n    referenceEl.addEventListener('mouseenter', this.handleMouseEnter);\n    referenceEl.addEventListener('mouseleave', this.handleMouseLeave);\n  }\n\n  handleMouseEnter = (): void => {\n    this.setState({\n      showSelf: true,\n    });\n  };\n\n  handleMouseLeave = (): void => {\n    this.setState({\n      showSelf: false,\n    });\n  };\n\n  componentWillUnmount(): void {\n    const referenceEl = this.props.relativeTo.current;\n    if (referenceEl) {\n      referenceEl.removeEventListener('mouseenter', this.handleMouseEnter);\n      referenceEl.removeEventListener('mouseleave', this.handleMouseLeave);\n    }\n  }\n\n  render(): React.ReactNode {\n    if (!this.state.showSelf) {\n      return null;\n    }\n\n    return ReactDOM.createPortal(\n      <div style={ontop} ref={this.selfRef}>\n        {this.props.content()}\n      </div>,\n      document.body\n    );\n  }\n}\n","import * as React from 'react';\n\ninterface Props {\n  value: number;\n  onChange: (value: number) => void;\n  min?: number;\n}\n\ninterface State {\n  txtValue: string;\n  errMsg: string | undefined;\n}\n\nexport class IntegerInput extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      txtValue: props.value.toString(),\n      errMsg: undefined,\n    };\n  }\n\n  shouldComponentUpdate(nextProps: Props, nextState: State): boolean {\n    // props.onChange is not used in rendering\n    return (\n      this.props.value !== nextProps.value ||\n      this.props.min !== nextProps.min ||\n      this.state.txtValue !== nextState.txtValue ||\n      this.state.errMsg !== nextState.errMsg\n    );\n  }\n\n  componentDidUpdate(oldProps: Props): void {\n    if (oldProps.value !== this.props.value) {\n      this.setState((state) => ({\n        txtValue:\n          Number(state.txtValue) === this.props.value\n            ? state.txtValue\n            : this.props.value.toString(),\n      }));\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n    const txtValue = event.target.value;\n    let errMsg: string | undefined;\n\n    const value = txtValue.trim() ? Number(txtValue) : NaN;\n    if (Number.isNaN(value)) {\n      errMsg = 'Improperly formatted number';\n    } else if (!Number.isInteger(value)) {\n      errMsg = 'Must be an integer';\n    } else if (typeof this.props.min === 'number' && value < this.props.min) {\n      errMsg =\n        this.props.min === 0\n          ? 'Must be positive'\n          : `Must be greater than ${this.props.min}`;\n    }\n\n    this.setState({ txtValue, errMsg }, () => {\n      if (typeof value === 'number' && !errMsg) {\n        this.props.onChange(value);\n      }\n    });\n  };\n\n  render(): React.ReactNode {\n    let className = 'form-control';\n    if (!!this.state.errMsg) {\n      className += ' is-invalid';\n    }\n\n    return (\n      <input\n        className={className}\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"number\"\n        min={this.props.min}\n        step=\"1\"\n      />\n    );\n  }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nimport { Rational } from '../../rational';\n\ninterface Props {\n  value: Rational;\n  onChange: (value: Rational) => void;\n  positiveOnly?: boolean;\n}\n\ninterface State {\n  error: string | undefined;\n  txtValue: string;\n}\n\nexport class RationalInput extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      error: undefined,\n      txtValue: rationalToString(props.value),\n    };\n  }\n\n  componentDidUpdate(oldProps: Props): void {\n    if (!this.props.value.equal(oldProps.value)) {\n      let parsed: Rational;\n      try {\n        parsed = stringToRational(this.state.txtValue);\n      } catch (err) {\n        return;\n      }\n\n      if (!parsed.equal(this.props.value)) {\n        this.setState({\n          txtValue: rationalToString(this.props.value),\n        });\n      }\n    }\n  }\n\n  handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n    const str = event.target.value;\n\n    let errmsg: string | undefined;\n    let parsed: Rational | undefined;\n\n    try {\n      parsed = stringToRational(str);\n    } catch (err) {\n      errmsg = err.message;\n    }\n\n    if (parsed && this.props.positiveOnly && parsed.isNegative()) {\n      parsed = undefined;\n      errmsg = 'Number must be positive';\n    }\n    this.setState({ txtValue: str, error: errmsg }, () => {\n      if (parsed) {\n        this.props.onChange(parsed);\n      }\n    });\n  };\n\n  render(): React.ReactNode {\n    return (\n      <input\n        className={classNames('form-control', {\n          'is-invalid': !!this.state.error,\n        })}\n        value={this.state.txtValue}\n        onChange={this.handleChange}\n        type=\"text\"\n      />\n    );\n  }\n}\n\nfunction stringToRational(str: string): Rational {\n  if (!str.trim()) {\n    throw new Error('Empty!');\n  }\n\n  const index = str.indexOf('/');\n  const lastIndex = str.lastIndexOf('/');\n  if (index !== lastIndex) {\n    throw new Error('Too many slashes');\n  }\n\n  return Rational.fromString(str);\n}\n\nfunction rationalToString(rational: Rational): string {\n  const dec = rational.toFloat().toString();\n  if (dec.length < 10) {\n    return dec;\n  }\n\n  return rational.toMixed();\n}\n","import React from 'react';\nimport classNames from 'classnames';\n\nimport { BaseDisplayable } from '../game';\nimport { Tooltip } from './generic';\n\nimport styles from './Icon.module.css';\n\ninterface Props {\n  obj: BaseDisplayable;\n\n  className?: string;\n  title?: string;\n  onClick?(event: React.MouseEvent<HTMLDivElement, MouseEvent>): void;\n  tooltip?: () => React.ReactNode;\n  text?: React.ReactNode;\n}\n\ninterface State {}\n\nexport class Icon extends React.PureComponent<Props, State> {\n  iconRef = React.createRef<HTMLDivElement>();\n\n  render(): React.ReactNode {\n    const x = -this.props.obj.iconCol * 32;\n    const y = -this.props.obj.iconRow * 32;\n\n    const divStyle: React.CSSProperties = {\n      backgroundPosition: `${x}px ${y}px`,\n    };\n\n    let icon = (\n      <div\n        ref={this.iconRef}\n        onClick={this.props.onClick}\n        title={this.props.title}\n        className={classNames(styles.Icon, 'game-icon', this.props.className)}\n        style={divStyle}\n      >\n        &nbsp;\n      </div>\n    );\n\n    if (this.props.tooltip) {\n      icon = (\n        <>\n          {icon}\n          <Tooltip content={this.props.tooltip} relativeTo={this.iconRef} />\n        </>\n      );\n    }\n\n    if (this.props.text) {\n      icon = (\n        <div className={styles.IconTextWrapper}>\n          {icon}\n          <span className={styles.IconText}>{this.props.text}</span>\n        </div>\n      );\n    }\n\n    return icon;\n  }\n}\n","import * as React from 'react';\n\nimport { format_joules } from '../util';\nimport * as game from '../game';\n\ninterface Props {\n  obj: game.Ingredient | game.Product;\n}\n\nexport const IngredientCard: React.FC<Props> = ({ obj }) => {\n  let fuelValues: React.ReactNode;\n  if (obj.item.fuelValue) {\n    const totalValue = format_joules(\n      obj.amount.mul(obj.item.fuelValue).toFloat()\n    );\n    fuelValues = (\n      <div className=\"list-group-item\">\n        <div>\n          <b>Fuel value</b>: {format_joules(obj.item.fuelValue)}\n        </div>\n        <div>\n          <b>Total fuel value</b>: {totalValue}\n        </div>\n      </div>\n    );\n  }\n\n  let madeBy: React.ReactNode;\n  if (obj.item.madeBy.length === 1) {\n    madeBy = <div className=\"list-group-item\">Made by 1 recipe</div>;\n  } else {\n    madeBy = (\n      <div className=\"list-group-item\">\n        Made by {obj.item.madeBy.length} recipes\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"card\">\n      <div className=\"card-header\">\n        {obj.niceName} ({obj.item.name})\n      </div>\n      <div className=\"list-group list-group-flush\">\n        {fuelValues}\n        {madeBy}\n      </div>\n    </div>\n  );\n};\n","import React, { useCallback } from 'react';\nimport { useRecoilState } from 'recoil';\n\nimport { Rational } from '../rational';\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\n\nimport { recipeTargetAtom } from '../atoms';\n\nimport styles from './RecipePart.module.css';\n\ninterface Props {\n  obj: game.Ingredient | game.Product;\n  showName?: boolean;\n}\n\nexport const RecipePart: React.FC<Props> = ({ obj, showName }) => {\n  const [recipeTarget, setRecipeTarget] = useRecoilState(recipeTargetAtom);\n\n  const handleClick = useCallback(\n    (event: React.MouseEvent): void => {\n      if (event.shiftKey) {\n        event.preventDefault();\n        event.stopPropagation();\n        setRecipeTarget({\n          item: obj.item,\n          amount: obj.amount,\n        });\n        return;\n      }\n\n      if (obj instanceof game.Ingredient) {\n        if (obj.item.madeBy.length === 1) {\n          signal.addRecipeRow.dispatch(obj.item.madeBy[0]!);\n        } else {\n          signal.addIngredientFilter.dispatch(obj);\n        }\n      } else {\n        if (obj.item.usedBy.length === 1) {\n          signal.addRecipeRow.dispatch(obj.item.usedBy[0]!);\n        } else {\n          signal.addProductFilter.dispatch(obj);\n        }\n      }\n    },\n    [obj, setRecipeTarget]\n  );\n\n  let text = perSecond(obj.amount);\n  if (showName) {\n    text = (\n      <>\n        {obj.item.niceName} — {text}\n      </>\n    );\n  }\n\n  const isTarget =\n    recipeTarget &&\n    recipeTarget.item === obj.item &&\n    recipeTarget.amount.equal(obj.amount);\n  const copySource = isTarget ? 'copy-source' : '';\n\n  return (\n    <Icon\n      className={`${styles.RecipePart} ${copySource}`}\n      onClick={handleClick}\n      tooltip={() => <IngredientCard obj={obj} />}\n      obj={obj.item}\n      text={text}\n    />\n  );\n};\n\nfunction perSecond(rational: Rational): React.ReactNode {\n  const dec = rational.toDecimal().toString();\n  let amount: React.ReactNode;\n  if (dec.includes('.') && dec.length > 4) {\n    amount = <abbr title={rational.toFraction()}>{rational.toDecimal()}</abbr>;\n  } else {\n    amount = dec;\n  }\n  return <>{amount} / sec</>;\n}\n","import * as React from 'react';\nimport * as game from '../game';\n\ninterface Props {\n  machine: game.AssemblingMachine;\n}\n\nexport const MachineCard: React.FC<Props> = (props) => {\n  return (\n    <div className=\"machine-card card\">\n      <div className=\"card-body\">\n        <b>{props.machine.niceName}</b>\n        <br />\n        <b>Crafting Speed:</b> {props.machine.craftingSpeed}\n        <br />\n        <b>Module Slots:</b> {props.machine.moduleSlots}\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport * as game from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { useGameData } from '../atoms';\n\ninterface Props {\n  recipe: game.Recipe;\n  onClick?(r: game.Recipe): void;\n}\n\nexport const RecipeCard: React.FC<Props> = ({ recipe, onClick }) => {\n  const gameData = useGameData();\n\n  const handleClick = (): void => {\n    onClick && onClick(recipe);\n  };\n\n  const ingredients = recipe.ingredients.map((ingredient) => (\n    <Icon\n      key={ingredient.name}\n      obj={ingredient.item}\n      text={ingredient.niceName}\n    />\n  ));\n  const products = recipe.products.map((product) => (\n    <Icon key={product.name} obj={product.item} text={product.niceName} />\n  ));\n\n  const madeIn = recipe.madeIn.map((machine) => (\n    <Icon\n      key={machine.name}\n      obj={machine}\n      tooltip={() => <MachineCard machine={machine} />}\n    />\n  ));\n\n  return (\n    <div className=\"recipe-tooltip card\" onClick={handleClick}>\n      <div className=\"card-header\">\n        <Icon obj={recipe} text={`${recipe.niceName} (Recipe)`} />\n      </div>\n      <ul className=\"list-group list-group-flush\">\n        <li className=\"list-group-item\">\n          <b>Ingredients:</b>\n          {ingredients}\n          <Icon\n            obj={gameData.clockSprite}\n            text={\n              <span>\n                <b>{recipe.craftingTime.toDecimal()} s</b> Crafting time\n              </span>\n            }\n          />\n        </li>\n        <li className=\"list-group-item\">\n          <b>Products:</b>\n          {products}\n        </li>\n        <li className=\"list-group-item\">\n          <b>Made In:</b>\n          <br />\n          {madeIn}\n        </li>\n      </ul>\n    </div>\n  );\n};\n","import React from 'react';\n\nimport { AssemblingMachine } from '../game';\n\nimport { Icon } from './Icon';\nimport { MachineCard } from './MachineCard';\nimport { Dropdown } from './generic';\n\ninterface MachinePickerProps {\n  machines: AssemblingMachine[];\n  selected: AssemblingMachine;\n  onChange(m: AssemblingMachine): void;\n}\n\nconst renderSelected = (machine: AssemblingMachine): React.ReactNode => {\n  return (\n    <Icon obj={machine} tooltip={() => <MachineCard machine={machine} />} />\n  );\n};\n\nconst renderOption = (machine: AssemblingMachine): React.ReactNode => {\n  return (\n    <Icon\n      obj={machine}\n      tooltip={() => <MachineCard machine={machine} />}\n      text={machine.niceName}\n    />\n  );\n};\n\nexport const MachinePicker: React.FC<MachinePickerProps> = (props) => {\n  const options = props.machines.map((machine) => ({\n    key: machine.name,\n    option: machine,\n    active: machine === props.selected,\n  }));\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n","import React from 'react';\n\nimport type { Rational } from '../rational';\nimport type { Module } from '../game';\nimport { round2 } from '../util';\n\ninterface Props {\n  module: Module;\n}\n\nfunction formatBonus(name: string, bonus: Rational): React.ReactNode {\n  if (bonus.isZero()) return null;\n  return (\n    <div>\n      <b>\n        {name} {round2(bonus.toFloat() * 100, 2)}%\n      </b>\n    </div>\n  );\n}\n\nexport const ModuleCard: React.FC<Props> = ({ module }) => {\n  return (\n    <div className=\"module-card card\">\n      <div className=\"card-header\">\n        <b>{module.niceName}</b>\n      </div>\n      <div className=\"card-body\">\n        {formatBonus('Speed', module.effects.speed)}\n        {formatBonus('Productivity', module.effects.productivity)}\n        {formatBonus('Energy Consumption', module.effects.consumption)}\n        {formatBonus('Pollution', module.effects.pollution)}\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\n\nimport type { Module, Recipe } from '../game';\n\nimport { Icon } from './Icon';\nimport { ModuleCard } from './ModuleCard';\nimport { Dropdown } from './generic';\nimport { useGameData } from '../atoms';\n\ninterface ModulePickerProps {\n  recipe: Recipe;\n  isBeacon?: boolean;\n  selected: Module | null;\n  onChange(m: Module | null): void;\n}\n\nexport const ModulePicker: React.FC<ModulePickerProps> = (props) => {\n  const gameData = useGameData();\n  const renderSelected = (module: Module | null): React.ReactNode => {\n    if (module) {\n      return (\n        <Icon obj={module} tooltip={() => <ModuleCard module={module} />} />\n      );\n    } else {\n      return <Icon obj={gameData.noModuleModule} />;\n    }\n  };\n\n  const renderOption = (module: Module | null): React.ReactNode => {\n    if (module) {\n      return (\n        <Icon\n          obj={module}\n          tooltip={() => <ModuleCard module={module} />}\n          text={module.niceName}\n        />\n      );\n    } else {\n      return (\n        <Icon\n          obj={gameData.noModuleModule}\n          text={gameData.noModuleModule.niceName}\n        />\n      );\n    }\n  };\n\n  const options = gameData.modules\n    .filter((m) => {\n      // TODO: what is the actual logic for which modules are allowed in beacons?\n      if (props.isBeacon && m.effects.productivity.isPositive()) {\n        return false;\n      }\n      return m.canUseWith(props.recipe);\n    })\n    .map((m) => ({\n      key: m.name,\n      option: m as Module | null,\n      active: m === props.selected,\n    }));\n\n  options.unshift({\n    key: 'no_module',\n    option: null,\n    active: !props.selected,\n  });\n\n  return (\n    <Dropdown\n      options={options}\n      selected={props.selected}\n      onSelect={props.onChange}\n      renderOption={renderOption}\n      renderSelected={renderSelected}\n    />\n  );\n};\n","import React from 'react';\nimport { useRecoilValue } from 'recoil';\nimport { Draggable } from 'react-beautiful-dnd';\n\nimport * as game from '../game';\nimport { Rational } from '../rational';\nimport { Totals } from '../totals';\nimport { RecipeRowData } from '../state';\nimport { recipeTargetAtom, RecipeTarget } from '../atoms';\n\nimport { Icon } from './Icon';\nimport { RecipePart } from './RecipePart';\nimport { RecipeCard } from './RecipeCard';\nimport { MachinePicker } from './MachinePicker';\nimport { ModulePicker } from './ModulePicker';\nimport { IntegerInput, RationalInput } from './generic';\n\nimport styles from './RecipeRow.module.css';\n\ninterface Props {\n  index: number;\n  recipeTarget: RecipeTarget | undefined;\n  data: RecipeRowData;\n\n  onUpdateRow(row: RecipeRowData): void;\n  onRemoveRow(recipe: game.Recipe): void;\n}\n\nclass RawRecipeRow extends React.PureComponent<Props, never> {\n  handleRemoveRow = (): void => {\n    this.props.onRemoveRow(this.props.data.recipe);\n  };\n\n  handleMachineChange = (machine: game.AssemblingMachine): void => {\n    this.applyChange({\n      machine: machine,\n      modules: this.props.data.modules\n        .filter((module) => module !== null)\n        .slice(0, machine.moduleSlots),\n    });\n  };\n\n  handleNumMachinesChange = (num: Rational): void => {\n    this.applyChange({ numMachines: num });\n  };\n\n  handleNumBeaconsChange = (num: number): void => {\n    this.applyChange({ numBeacons: num });\n  };\n\n  handleSetAllModules = (): void => {\n    this.applyChange({\n      modules: new Array(this.props.data.machine.moduleSlots).fill(\n        this.props.data.modules[0]\n      ),\n    });\n  };\n\n  handleSetModule = (index: number, module: game.Module | null): void => {\n    const modules = this.props.data.modules.slice();\n    modules[index] = module;\n    this.applyChange({ modules: modules });\n  };\n\n  handleSetBeaconModule = (module: game.Module | null): void => {\n    this.applyChange({ beaconModule: module });\n  };\n\n  handleInputGroupClick: React.MouseEventHandler<any> = (event): void => {\n    const { recipeTarget } = this.props;\n    if (!event.shiftKey || !recipeTarget) {\n      return;\n    }\n    event.preventDefault();\n    event.stopPropagation();\n\n    const output = new Totals();\n    output.addRow({\n      ...this.props.data,\n      numMachines: Rational.one,\n    });\n\n    let current: game.Ingredient | game.Product | undefined;\n    current = output.ingredients.find((x) => {\n      return x.item.name === recipeTarget.item.name;\n    });\n\n    current =\n      current ||\n      output.products.find((x) => {\n        return x.item.name === recipeTarget.item.name;\n      });\n\n    if (!current) {\n      console.error(\n        `Could not find ${recipeTarget.item.name} in totals`,\n        output\n      );\n      return;\n    }\n\n    const newNum = recipeTarget.amount.div(current.amount);\n\n    this.applyChange({\n      numMachines: newNum,\n    });\n  };\n\n  applyChange(change: Partial<RecipeRowData>): void {\n    this.props.onUpdateRow({\n      ...this.props.data,\n      ...change,\n    });\n  }\n\n  getOutput(): Totals {\n    const t = new Totals();\n    t.addRow(this.props.data);\n    return t;\n  }\n\n  renderModules(): React.ReactNode {\n    const numSlots = this.props.data.machine.moduleSlots;\n\n    const slots = [];\n    for (let i = 0; i < numSlots; i++) {\n      const module = this.props.data.modules[i] || null;\n      slots.push(\n        <ModulePicker\n          key={i}\n          recipe={this.props.data.recipe}\n          selected={module}\n          onChange={(m) => this.handleSetModule(i, m)}\n        />\n      );\n    }\n\n    if (numSlots > 1) {\n      slots.splice(\n        1,\n        0,\n        <button\n          onClick={this.handleSetAllModules}\n          key=\"applicator\"\n          className=\"btn\"\n        >\n          →\n        </button>\n      );\n    }\n\n    if (slots.length > 0) {\n      return (\n        <div className=\"mb-3 btn-group btn-icon-wrapper\" role=\"group\">\n          {slots}\n        </div>\n      );\n    } else {\n      return undefined;\n    }\n  }\n\n  renderBeacons(): React.ReactNode {\n    return (\n      <div className=\"btn-toolbar\">\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">Beacon Modules</span>\n          </div>\n          <IntegerInput\n            value={this.props.data.numBeacons}\n            onChange={this.handleNumBeaconsChange}\n            min={0}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <ModulePicker\n              isBeacon={true}\n              recipe={this.props.data.recipe}\n              selected={this.props.data.beaconModule}\n              onChange={this.handleSetBeaconModule}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderMachines(): React.ReactNode {\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\" onClick={this.handleInputGroupClick}>\n          <RationalInput\n            value={this.props.data.numMachines}\n            onChange={this.handleNumMachinesChange}\n            positiveOnly={true}\n          />\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={this.props.data.recipe.madeIn}\n              selected={this.props.data.machine}\n              onChange={this.handleMachineChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render(): React.ReactNode {\n    const recipe = this.props.data.recipe;\n    const output = this.getOutput();\n\n    const ingredients = output.ingredients.map((ingredient) => (\n      <div className=\"mb-1\" key={ingredient.name}>\n        <RecipePart obj={ingredient} />\n      </div>\n    ));\n    const products = output.products.map((product) => (\n      <div className=\"mb-1\" key={product.name}>\n        <RecipePart obj={product} />\n      </div>\n    ));\n    return (\n      <Draggable draggableId={recipe.name} index={this.props.index}>\n        {(provided) => (\n          <div\n            className={`${styles.RecipeRow} recipe-row card mb-3`}\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n          >\n            <div className=\"card-header clearfix\" {...provided.dragHandleProps}>\n              <div className=\"float-left\">\n                <Icon\n                  obj={recipe}\n                  text={recipe.niceName}\n                  tooltip={() => <RecipeCard recipe={recipe} />}\n                />\n              </div>\n              <div className=\"float-right\">\n                <button\n                  className=\"btn btn-danger btn-sm\"\n                  onClick={this.handleRemoveRow}\n                >\n                  Remove\n                </button>\n              </div>\n            </div>\n            <div className=\"card-body clearfix\">\n              <div className=\"float-left\">\n                {this.renderMachines()}\n                {this.renderModules()}\n                {this.renderBeacons()}\n              </div>\n\n              <div className=\"float-right\">\n                <div\n                  className=\"mr-3\"\n                  style={{\n                    display: 'inline-block',\n                    float: 'left',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Ingredients:</b>\n                  {ingredients}\n                </div>\n\n                <div\n                  className=\"mr-2\"\n                  style={{\n                    display: 'inline-block',\n                    minWidth: '150px',\n                  }}\n                >\n                  <b>Products:</b>\n                  {products}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </Draggable>\n    );\n  }\n}\n\nexport const RecipeRow: React.FC<{\n  index: number;\n  data: RecipeRowData;\n  onUpdateRow(data: RecipeRowData): void;\n  onRemoveRow(recipe: game.Recipe): void;\n}> = ({ index, data, onRemoveRow, onUpdateRow }) => {\n  const recipeTarget = useRecoilValue(recipeTargetAtom);\n\n  return (\n    <RawRecipeRow\n      index={index}\n      data={data}\n      recipeTarget={recipeTarget}\n      onUpdateRow={onUpdateRow}\n      onRemoveRow={onRemoveRow}\n    />\n  );\n};\n","import * as React from 'react';\nimport Fuse from 'fuse.js';\nimport classNames from 'classnames';\n\nimport { debounce } from '../util';\n\nimport * as game from '../game';\nimport * as signal from '../signal';\n\nimport { Icon } from './Icon';\nimport { IngredientCard } from './IngredientCard';\nimport { RecipeCard } from './RecipeCard';\n\nimport styles from './RecipePicker.module.css';\n\nconst getFn: Fuse.FuseGetFunction<game.Recipe> = (obj, path) => {\n  if (typeof path === 'string') {\n    throw new Error(`path unexpectedly string: ${path}`);\n  }\n  if (path.length !== 1) {\n    throw new Error(`path unexpectedly long/short: ${path}`);\n  }\n  switch (path[0]) {\n    case 'niceName':\n      return obj.niceName;\n    case 'name':\n      return obj.name;\n    default:\n      throw new Error(`Unsupported path: ${path}`);\n  }\n};\n\nconst RE_ADVANCED = /((?:produces)|(?:consumes)):([a-z0-9-]+)/g;\n\ninterface Props {\n  className?: string;\n  recipes: game.Recipe[];\n  onPickRecipe(r: game.Recipe): void;\n}\n\ninterface State {\n  query: string;\n  matches: game.Recipe[];\n}\n\nexport class RecipePicker extends React.PureComponent<Props, State> {\n  inputRef = React.createRef<HTMLInputElement>();\n\n  state: State = {\n    query: '',\n    matches: [],\n  };\n\n  componentDidMount(): void {\n    signal.addIngredientFilter.addHandler(this.handleIngredientClick);\n    signal.addProductFilter.addHandler(this.handleProductClick);\n  }\n\n  componentWillUnmount(): void {\n    this.debCalculateMatches.cancel();\n    signal.addIngredientFilter.removeHandler(this.handleIngredientClick);\n    signal.addProductFilter.removeHandler(this.handleProductClick);\n  }\n\n  handleIngredientClick = (ingredient: game.Ingredient): void => {\n    const term = `produces:${ingredient.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleProductClick = (product: game.Product): void => {\n    const term = `consumes:${product.name}`;\n    if (!this.state.query.includes(term)) {\n      this.setQuery(`${this.state.query} ${term}`, () => {\n        this.calculateMatches();\n      });\n      this.inputRef.current?.scrollIntoView();\n    }\n  };\n\n  handleQueryInput = (event: React.FormEvent<HTMLInputElement>): void => {\n    const target = event.target as HTMLInputElement;\n    this.setQuery(target.value);\n  };\n\n  handleRecipeClick = (recipe: game.Recipe): void => {\n    this.props.onPickRecipe(recipe);\n    this.setQuery('');\n  };\n\n  setQuery = (query: string, callback?: () => void): void => {\n    if (!query.trim()) {\n      this.debCalculateMatches.cancel();\n      this.setState(\n        {\n          query: '',\n          matches: [],\n        },\n        callback\n      );\n    } else {\n      this.setState({ query: query }, callback);\n      this.debCalculateMatches();\n    }\n  };\n\n  calculateMatches(): void {\n    let query = this.state.query.trim().toLowerCase();\n    if (!query) {\n      this.setState({ matches: [] });\n      return;\n    }\n\n    const conditions = {\n      consumes: [] as string[],\n      produces: [] as string[],\n    };\n\n    type ckey = keyof typeof conditions;\n\n    query = query\n      .replace(RE_ADVANCED, (_, key, value) => {\n        conditions[key as ckey].push(value);\n        return '';\n      })\n      .trim();\n\n    let recipes = this.props.recipes;\n    if (conditions.consumes.length || conditions.produces.length) {\n      recipes = recipes.filter((recipe) => {\n        for (const name of conditions.consumes) {\n          if (!recipe.ingredients.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        for (const name of conditions.produces) {\n          if (!recipe.products.some((i) => i.name === name)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n\n    if (query) {\n      const fuse = new Fuse(recipes, {\n        shouldSort: true,\n        getFn: getFn,\n        keys: [\n          {\n            name: 'niceName',\n            weight: 0.7,\n          },\n          {\n            name: 'name',\n            weight: 0.2,\n          },\n        ],\n      });\n      const results = fuse.search(query);\n      recipes = results.map((r) => r.item);\n    }\n    this.setState({ matches: recipes });\n  }\n\n  debCalculateMatches = debounce(this.calculateMatches.bind(this), 200);\n\n  renderMatches(): React.ReactNode {\n    if (!this.state.matches.length) {\n      return '';\n    }\n    let matches = this.state.matches;\n    if (matches.length > 100) {\n      matches = matches.slice(0, 100);\n    }\n    return (\n      <table className=\"table table-hover\">\n        <thead>\n          <tr>\n            <th>Recipe</th>\n            <th>Time</th>\n            <th>Ingredients</th>\n            <th>Products</th>\n          </tr>\n        </thead>\n        <tbody>\n          {matches.map((r) => (\n            <RecipeMatch\n              recipe={r}\n              key={r.name}\n              onClick={this.handleRecipeClick}\n            />\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n\n  render(): React.ReactNode {\n    return (\n      <div className={classNames(styles.RecipePicker, this.props.className)}>\n        <div>\n          <input\n            type=\"search\"\n            ref={this.inputRef}\n            className=\"editable-display form-control\"\n            placeholder=\"What do you want to build?\"\n            value={this.state.query}\n            onChange={this.handleQueryInput}\n          />\n        </div>\n        {this.renderMatches()}\n      </div>\n    );\n  }\n}\n\ninterface RecipeMatchProps {\n  recipe: game.Recipe;\n  onClick(recipe: game.Recipe): void;\n}\n\nclass RecipeMatch extends React.PureComponent<RecipeMatchProps, never> {\n  handleClickAdd = (): void => {\n    this.props.onClick(this.props.recipe);\n  };\n\n  render(): React.ReactNode {\n    const recipe = this.props.recipe;\n    const ingredients = recipe.ingredients.map((ing) => (\n      <Icon\n        key={ing.name}\n        obj={ing.item}\n        tooltip={() => <IngredientCard obj={ing} />}\n      />\n    ));\n    const products = recipe.products.map((prod) => (\n      <Icon\n        key={prod.name}\n        obj={prod.item}\n        tooltip={() => <IngredientCard obj={prod} />}\n      />\n    ));\n    return (\n      <tr onClick={this.handleClickAdd}>\n        <td className={styles.ResultName}>\n          <Icon\n            obj={recipe}\n            text={recipe.niceName}\n            tooltip={() => <RecipeCard recipe={recipe} />}\n          />\n        </td>\n        <td>{recipe.craftingTime.toDecimal()}</td>\n        <td>{ingredients}</td>\n        <td>{products}</td>\n      </tr>\n    );\n  }\n}\n","import React, { useMemo } from 'react';\nimport { RecipePart } from './RecipePart';\nimport { RecipeRowData } from '../state';\nimport { useGameData } from '../atoms';\nimport { Totals } from '../totals';\n\nimport styles from './TotalCard.module.css';\n\ninterface Props {\n  rows: RecipeRowData[];\n}\n\nexport const TotalCard: React.FC<Props> = ({ rows }) => {\n  const gameData = useGameData();\n\n  const totals: Totals = useMemo(() => {\n    const t = new Totals(rows);\n    gameData.sortByItem(t.ingredients, (p) => p.item);\n    gameData.sortByItem(t.products, (p) => p.item);\n    return t;\n  }, [gameData, rows]);\n\n  if (!totals.ingredients.length && !totals.products.length) {\n    return <div />;\n  }\n\n  return (\n    <div className={`card ${styles.TotalCard}`}>\n      <div className=\"card-header\">Combined Totals</div>\n      <div className=\"card-body\">\n        <div className=\"row\">\n          <div className=\"col\">\n            Ingredients:\n            {totals.ingredients.map((ing) => (\n              <RecipePart key={ing.name} obj={ing} showName />\n            ))}\n          </div>\n          <div className=\"col\">\n            Products:\n            {totals.products.map((prod) => (\n              <RecipePart key={prod.name} obj={prod} showName />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React, { useCallback } from 'react';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport { DropResult, DragDropContext, Droppable } from 'react-beautiful-dnd';\n\nimport * as signal from '../signal';\nimport * as game from '../game';\nimport * as su from '../stateutil';\nimport { Rational } from '../rational';\nimport { settingsAtom, useGameData, GroupAtom } from '../atoms';\nimport { assert } from '../util';\nimport { useGroupAdd } from '../actions';\nimport { RecipeGroupData, RecipeRowData } from '../state';\n\nimport { RecipeRow } from './RecipeRow';\nimport { RecipePicker } from './RecipePicker';\nimport { TotalCard } from './TotalCard';\n\nimport styles from './RecipeGroup.module.css';\n\ninterface Props {\n  group: RecipeGroupData;\n  gameData: game.GameData;\n\n  onRenameGroup(newName: string): void;\n  onCloneGroup(newName: string): void;\n  onRemoveGroup(): void;\n\n  onAddRow(recipe: game.Recipe): void;\n  onMoveRow(oldIndex: number, newIndex: number): void;\n  onUpdateRow(data: RecipeRowData): void;\n  onRemoveRow(recipe: game.Recipe): void;\n}\n\nclass RawRecipeGroup extends React.PureComponent<Props, never> {\n  componentDidMount(): void {\n    signal.addRecipeRow.addHandler(this.props.onAddRow);\n  }\n\n  componentDidUpdate(oldProps: Props, oldState: never): void {\n    if (this.props.onAddRow !== oldProps.onAddRow) {\n      signal.addRecipeRow.removeHandler(oldProps.onAddRow);\n      signal.addRecipeRow.addHandler(this.props.onAddRow);\n    }\n  }\n\n  componentWillUnmount(): void {\n    signal.addRecipeRow.removeHandler(this.props.onAddRow);\n  }\n\n  handleDragEnd = (result: DropResult): void => {\n    if (!result.destination) {\n      return;\n    }\n    if (result.source.index !== result.destination.index) {\n      this.props.onMoveRow(result.source.index, result.destination.index);\n    }\n  };\n\n  renderRow = (data: RecipeRowData, index: number): React.ReactNode => {\n    return (\n      <RecipeRow\n        key={data.recipe.name}\n        index={index}\n        data={data}\n        onUpdateRow={this.props.onUpdateRow}\n        onRemoveRow={this.props.onRemoveRow}\n      />\n    );\n  };\n\n  handleClickRename = (): void => {\n    const name = prompt('Whatcha wanna call it now?', this.props.group.name);\n    if (name) {\n      this.props.onRenameGroup(name);\n    }\n  };\n\n  handleClickClone = (): void => {\n    const name = prompt(\n      'Whatcha wanna call it now?',\n      `${this.props.group.name} (Clone)`\n    );\n    if (name) {\n      this.props.onCloneGroup(name);\n    }\n  };\n\n  handleClickDelete = (): void => {\n    if (this.props.group.rows.length) {\n      if (\n        !window.confirm(\n          `Are you sure you want to delete ${this.props.group.name}`\n        )\n      ) {\n        return;\n      }\n    }\n    this.props.onRemoveGroup();\n  };\n\n  renderHeader(): React.ReactNode {\n    return (\n      <div className=\"row align-items-end\">\n        <div className=\"col\">\n          <h3 className=\"mb-0\">🏭 {this.props.group.name}</h3>\n        </div>\n        <div className=\"col text-right\">\n          <div className=\"btn-group btn-group-sm\">\n            <button\n              className=\"btn btn-primary\"\n              onClick={this.handleClickRename}\n            >\n              Rename\n            </button>\n            <button className=\"btn btn-primary\" onClick={this.handleClickClone}>\n              Clone\n            </button>\n            <button className=\"btn btn-danger\" onClick={this.handleClickDelete}>\n              Delete\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render(): React.ReactNode {\n    const gd = this.props.gameData;\n    const availableRecipes = gd.recipes.filter((recipe) => {\n      return !this.props.group.rows.some((row) => row.recipe === recipe);\n    });\n\n    return (\n      <div className={styles.RecipeGroup}>\n        {this.renderHeader()}\n\n        <hr />\n\n        <RecipePicker\n          className=\"mb-3\"\n          recipes={availableRecipes}\n          onPickRecipe={this.props.onAddRow}\n        />\n\n        <DragDropContext onDragEnd={this.handleDragEnd}>\n          <Droppable droppableId={'eyy'}>\n            {(provided) => (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {this.props.group.rows.map(this.renderRow)}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        <hr />\n        <TotalCard rows={this.props.group.rows} />\n      </div>\n    );\n  }\n}\n\ninterface RecipeGroupProps {\n  groupAtom: GroupAtom;\n  onRemoveGroup(groupAtom: GroupAtom): void;\n}\nexport const RecipeGroup: React.FC<RecipeGroupProps> = ({\n  groupAtom,\n  onRemoveGroup,\n}) => {\n  const [group, setGroup] = useRecoilState(groupAtom);\n  const settings = useRecoilValue(settingsAtom);\n  const gameData = useGameData();\n  const addGroup = useGroupAdd();\n\n  const handleRenameGroup = useCallback(\n    (newName: string) => {\n      setGroup((oldGroup) => ({\n        ...oldGroup,\n        name: newName,\n      }));\n    },\n    [setGroup]\n  );\n\n  const handleCloneGroup = useCallback(\n    (newName: string) => {\n      addGroup({\n        ...group,\n        name: newName,\n      });\n    },\n    [addGroup, group]\n  );\n\n  const handleRemoveGroup = useCallback(() => {\n    onRemoveGroup(groupAtom);\n  }, [onRemoveGroup, groupAtom]);\n\n  const handleMoveRow = useCallback(\n    (oldIndex: number, newIndex: number) => {\n      const rows = Array.from(group.rows);\n      const [removed] = rows.splice(oldIndex, 1);\n      assert(removed, `Nothing at old index: ${oldIndex}`);\n      rows.splice(newIndex, 0, removed);\n\n      setGroup((oldGroup) => ({\n        ...oldGroup,\n        rows,\n      }));\n    },\n    [group, setGroup]\n  );\n\n  const handleAddRow = useCallback(\n    (recipe: game.Recipe) => {\n      setGroup((group) => {\n        // only allow one instance of a recipe per group\n        if (group.rows.find((row) => row.recipe.name === recipe.name)) {\n          return group;\n        }\n\n        return {\n          ...group,\n          rows: [\n            ...group.rows,\n            {\n              recipe: recipe,\n              machine: su.getDefaultMachine(recipe, settings, gameData),\n              numMachines: Rational.one,\n              modules: [],\n              beaconModule: null,\n              numBeacons: 0,\n            },\n          ],\n        };\n      });\n    },\n    [settings, gameData, setGroup]\n  );\n\n  const handleUpdateRow = useCallback(\n    (data: RecipeRowData) => {\n      setGroup((group) => ({\n        ...group,\n        rows: group.rows.map((r) => (r.recipe === data.recipe ? data : r)),\n      }));\n    },\n    [setGroup]\n  );\n\n  const handleRemoveRow = useCallback(\n    (recipe: game.Recipe) => {\n      setGroup((group) => ({\n        ...group,\n        rows: group.rows.filter((r) => r.recipe !== recipe),\n      }));\n    },\n    [setGroup]\n  );\n\n  return (\n    <RawRecipeGroup\n      group={group}\n      gameData={gameData}\n      onRenameGroup={handleRenameGroup}\n      onCloneGroup={handleCloneGroup}\n      onRemoveGroup={handleRemoveGroup}\n      onAddRow={handleAddRow}\n      onMoveRow={handleMoveRow}\n      onUpdateRow={handleUpdateRow}\n      onRemoveRow={handleRemoveRow}\n    />\n  );\n};\n","import React, { useCallback, useMemo } from 'react';\nimport { useRecoilState } from 'recoil';\n\nimport * as game from '../game';\n\nimport { settingsAtom, useGameData } from '../atoms';\nimport { AppSettingsData } from '../state';\nimport { getDefaultMachine } from '../stateutil';\n\nimport { MachinePicker } from './MachinePicker';\n\nexport const Settings: React.FC<{}> = () => {\n  const gameData = useGameData();\n  const [settings, setSettings] = useRecoilState(settingsAtom);\n\n  const handleSetDefaultMachine = useCallback(\n    (category: string, machine: game.AssemblingMachine) => {\n      setSettings((settings) => ({\n        ...settings,\n        assemblerOverrides: {\n          ...settings.assemblerOverrides,\n          [category]: machine,\n        },\n      }));\n    },\n    [setSettings]\n  );\n\n  const categoryNames: string[] = useMemo(() => {\n    const names = Object.entries(gameData.categoryMap)\n      .filter((entry) => entry[1].length > 1)\n      .map((entry) => entry[0]);\n\n    names.sort((a, b) => a.localeCompare(b));\n    return names;\n  }, [gameData]);\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col\">\n          <h3>Default Assemblers</h3>\n          {categoryNames.map((name) => (\n            <CategoryRow\n              gameData={gameData}\n              settings={settings}\n              key={name}\n              category={name}\n              onSetDefaultMachine={handleSetDefaultMachine}\n            />\n          ))}\n        </div>\n        <div className=\"col\">\n          <h3>Active mods</h3>\n          <SettingsActiveMods gameData={gameData} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\ninterface CategoryRowProps {\n  category: string;\n  gameData: game.GameData;\n  settings: AppSettingsData;\n  onSetDefaultMachine(category: string, machine: game.AssemblingMachine): void;\n}\n\nclass CategoryRow extends React.PureComponent<CategoryRowProps, never> {\n  handleChange = (machine: game.AssemblingMachine): void => {\n    this.props.onSetDefaultMachine(this.props.category, machine);\n  };\n\n  render(): React.ReactNode {\n    const machines = this.props.gameData.categoryMap[this.props.category] || [];\n    const selected = getDefaultMachine(\n      this.props.category,\n      this.props.settings,\n      this.props.gameData\n    );\n    return (\n      <div className=\"btn-toolbar mb-3\">\n        <div className=\"input-group\">\n          <div className=\"input-group-prepend\">\n            <span className=\"input-group-text\">{this.props.category}</span>\n          </div>\n          <div className=\"input-group-append btn-icon-wrapper\">\n            <MachinePicker\n              machines={machines}\n              selected={selected}\n              onChange={this.handleChange}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst MOD_INFO: Record<string, string> = {\n  base: 'Data for the base \"factorio\" game',\n  'factorio-data-dumper':\n    'A fake mod that exports data about other installed mods.',\n};\n\nconst SettingsActiveMods: React.FC<{ gameData: game.GameData }> = ({\n  gameData,\n}) => {\n  const children: React.ReactNode[] = [];\n  for (const [name, version] of Object.entries(gameData.activeMods)) {\n    const url = 'https://mods.factorio.com/mod/' + name;\n    let nameNode: React.ReactNode;\n    if (MOD_INFO[name] !== undefined) {\n      nameNode = (\n        <>\n          <b>{name}</b>\n          <span title={MOD_INFO[name]}> 🛈</span>\n        </>\n      );\n    } else {\n      nameNode = (\n        <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">\n          <b>{name}</b>\n        </a>\n      );\n    }\n    children.push(\n      <li key={name}>\n        {nameNode} &ndash; version {version}\n      </li>\n    );\n  }\n  return <ul>{children}</ul>;\n};\n","import React, { useCallback } from 'react';\nimport classNames from 'classnames';\nimport { useRecoilValue, useSetRecoilState, RecoilState } from 'recoil';\n\nimport { RecipeGroup } from './RecipeGroup';\nimport { Settings } from './Settings';\n\nimport { useGroupAdd, AddGroupAction } from '../actions';\nimport { groupAtomsAtom, groupsState, GroupAtom } from '../atoms';\nimport { RecipeGroupData } from '../state';\nimport { GameData } from '../game';\nimport { assert, assertNever } from '../util';\n\nimport styles from './App.module.css';\n\ninterface Props {\n  gameData: GameData;\n  groups: [RecipeGroupData, GroupAtom][];\n  onAddGroup: AddGroupAction;\n  onRemoveGroupAtom(groupAtom: GroupAtom): void;\n}\n\ninterface State {\n  activePage: 'settings' | GroupAtom;\n}\n\nclass RawApp extends React.PureComponent<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    let activePage: State['activePage'] = 'settings';\n    for (const x of this.props.groups) {\n      activePage = x[1];\n      break;\n    }\n\n    this.state = { activePage };\n  }\n\n  componentDidMount(): void {\n    document.addEventListener('keydown', this.handleKeyDown);\n    document.addEventListener('keyup', this.handleKeyUp);\n  }\n  componentWillUnmount(): void {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    document.removeEventListener('keyup', this.handleKeyUp);\n  }\n\n  handleKeyDown = (event: KeyboardEvent): void => {\n    if (event.key === 'Shift') {\n      document.body.classList.add('shift-down');\n    }\n  };\n  handleKeyUp = (event: KeyboardEvent): void => {\n    if (event.key === 'Shift') {\n      document.body.classList.remove('shift-down');\n    }\n  };\n\n  handleClickGroup = (groupAtom: GroupAtom): void => {\n    this.setState({\n      activePage: groupAtom,\n    });\n  };\n\n  handleClickAddGroup = (event: React.MouseEvent<HTMLButtonElement>): void => {\n    event.preventDefault();\n    const defaultName = `Factory ${this.props.groups.length + 1}`;\n    const name = prompt('What do you want to name this group?', defaultName);\n    if (!name || !name.trim()) {\n      return;\n    }\n\n    const newAtom = this.props.onAddGroup({ name, rows: [] });\n    this.setState({ activePage: newAtom });\n  };\n\n  handleRemoveGroupAtom = (groupAtom: GroupAtom): void => {\n    if (this.state.activePage === groupAtom) {\n      let changed = false;\n      for (const xy of this.props.groups) {\n        if (xy[1] !== groupAtom) {\n          this.setState({\n            activePage: xy[1],\n          });\n          changed = true;\n          break;\n        }\n      }\n      if (!changed) {\n        this.setState({\n          activePage: 'settings',\n        });\n      }\n    }\n    this.props.onRemoveGroupAtom(groupAtom);\n  };\n\n  handleClickSettings = (): void => {\n    this.setState({\n      activePage: 'settings',\n    });\n  };\n\n  renderNavbar(): React.ReactNode {\n    const settingsActive = this.state.activePage === 'settings';\n\n    const factoryPills = this.props.groups.map(([group, groupAtom], i) => {\n      const active = this.state.activePage === groupAtom;\n      return (\n        <button\n          key={i}\n          type=\"button\"\n          className={`list-group-item list-group-item-action ${\n            active ? 'active' : ''\n          }`}\n          onClick={() => this.handleClickGroup(groupAtom)}\n        >\n          {group.name}\n        </button>\n      );\n    });\n\n    return (\n      <>\n        <ul className=\"list-group mt-3\">\n          <li className=\"list-group-item\">\n            <span role=\"img\" aria-label=\"Factory icon\">\n              🏭\n            </span>{' '}\n            Factories\n          </li>\n\n          {factoryPills}\n\n          <button\n            type=\"button\"\n            className=\"list-group-item list-group-item-action\"\n            onClick={this.handleClickAddGroup}\n          >\n            <span role=\"img\" aria-label=\"Factory icon\">\n              ＋\n            </span>{' '}\n            Add a Factory\n          </button>\n        </ul>\n\n        <ul className=\"list-group mt-3\">\n          <button\n            type=\"button\"\n            className={`list-group-item list-group-item-action ${\n              settingsActive ? 'active' : ''\n            }`}\n            onClick={this.handleClickSettings}\n          >\n            <span role=\"img\" aria-label=\"Gear icon\">\n              ⚙️\n            </span>{' '}\n            Settings\n          </button>\n        </ul>\n      </>\n    );\n  }\n\n  renderBody(): React.ReactNode {\n    if (this.state.activePage === 'settings') {\n      return <Settings />;\n    } else if (this.state.activePage) {\n      return (\n        <RecipeGroup\n          groupAtom={this.state.activePage}\n          onRemoveGroup={this.handleRemoveGroupAtom}\n        />\n      );\n    } else {\n      return assertNever(this.state.activePage);\n    }\n  }\n\n  render(): React.ReactNode {\n    assert(this.props.gameData, 'falsy gameData, should never happen');\n\n    return (\n      <>\n        <div className=\"container-fluid\">\n          <div className=\"row\">\n            <div className={classNames('col col-2 bg-primary', styles.Sidebar)}>\n              {this.renderNavbar()}\n            </div>\n            <div className=\"col pt-3\">{this.renderBody()}</div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport const App: React.FC<{\n  gameData: GameData;\n}> = ({ gameData }) => {\n  const groups = useRecoilValue(groupsState);\n\n  const setGroupAtoms = useSetRecoilState(groupAtomsAtom);\n\n  const handleAddGroup = useGroupAdd();\n\n  const handleRemoveGroupAtom = useCallback(\n    (groupAtom: RecoilState<RecipeGroupData>) => {\n      setGroupAtoms((atoms) => atoms.filter((a) => a !== groupAtom));\n    },\n    [setGroupAtoms]\n  );\n\n  return (\n    <RawApp\n      gameData={gameData}\n      groups={groups}\n      onAddGroup={handleAddGroup}\n      onRemoveGroupAtom={handleRemoveGroupAtom}\n    />\n  );\n};\n","import React, { useCallback, useEffect, useRef } from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { atom, useRecoilValue, useSetRecoilState } from 'recoil';\n\nimport * as game from '../game';\nimport { groupsState, groupAtomsAtom, settingsAtom } from '../atoms';\nimport { CompleteState, RecipeGroupData } from '../state';\nimport * as serialization from '../serialization';\n\nimport { error } from '../notifications';\n\nimport { App } from './App';\n\ninterface RawAppLoaderProps {\n  gameData: game.GameData;\n  onSetPreviousState(state: CompleteState): void;\n}\n\ninterface State {\n  loaded: boolean;\n}\n\nclass RawAppLoader extends React.PureComponent<RawAppLoaderProps, State> {\n  state: State = {\n    loaded: false,\n  };\n\n  _mounted: boolean = false;\n\n  componentDidMount(): void {\n    this._mounted = true;\n    this.load().then(\n      () => {\n        if (this._mounted) this.setState({ loaded: true });\n      },\n      (err) => {\n        if (this._mounted)\n          this.setState(() => {\n            throw err;\n          });\n      }\n    );\n  }\n\n  componentWillUnmount(): void {\n    this._mounted = false;\n  }\n\n  getPreviousState(): CompleteState | undefined {\n    let urlState: CompleteState | null = null;\n    try {\n      urlState = serialization.getUrlState(this.props.gameData);\n    } catch (err: unknown) {\n      error(\n        <>\n          <b>Error loading from URL</b>\n          <br />\n          <pre>{String(err)}</pre>\n        </>\n      );\n      console.error('error loading from url', err);\n    }\n    if (urlState) return urlState;\n\n    try {\n      const storageState = serialization.getLocalStorageState(\n        this.props.gameData\n      );\n      if (storageState) return storageState;\n    } catch (err: unknown) {\n      console.error('Failed to load local storage state', err);\n    }\n  }\n\n  async load(): Promise<void> {\n    const previousState = this.getPreviousState();\n    if (previousState) this.props.onSetPreviousState(previousState);\n  }\n\n  render(): React.ReactNode {\n    if (!this.state.loaded) {\n      return <h1>Loading...</h1>;\n    }\n    const sheet = `${process.env.PUBLIC_URL}/assets/sprite-sheet-${this.props.gameData.spriteHash}.png`;\n    const style = `\n        .game-icon {\n            background-image: url(${sheet});\n        }\n        `;\n    return (\n      <>\n        <StateWriter gameData={this.props.gameData} />\n        <Prefetch href={sheet} />\n        <style>{style}</style>\n        <App gameData={this.props.gameData} />\n      </>\n    );\n  }\n}\n\nconst StateWriter: React.FC<{ gameData: game.GameData }> = ({ gameData }) => {\n  const groups = useRecoilValue(groupsState);\n  const settings = useRecoilValue(settingsAtom);\n  const initialRender = useRef(true);\n\n  useEffect(() => {\n    // don't waste time re-writing state from the initial render\n    if (initialRender.current) {\n      initialRender.current = false;\n      return;\n    }\n    const completeState: CompleteState = {\n      groups: groups.map((g) => g[0]),\n      settings: settings,\n    };\n    serialization.setUrlState(completeState, gameData);\n    serialization.setLocalStorageState(completeState, gameData);\n  }, [gameData, groups, settings]);\n\n  return null;\n};\n\nconst Prefetch: React.FC<{ href: string }> = (props) => {\n  return ReactDOM.createPortal(\n    <link rel=\"prefetch\" href={props.href} />,\n    document.head\n  );\n};\n\ninterface AppLoaderProps {\n  gameData: game.GameData;\n}\n\nexport const AppLoader: React.FC<AppLoaderProps> = ({ gameData }) => {\n  const setGroupAtoms = useSetRecoilState(groupAtomsAtom);\n  const setSettings = useSetRecoilState(settingsAtom);\n\n  const handleSetPreviousState = useCallback(\n    (state: CompleteState) => {\n      let i = 0;\n      setGroupAtoms(\n        state.groups.map((group) => {\n          return atom<RecipeGroupData>({\n            key: `group-${Date.now()}-${i++}`,\n            default: group,\n          });\n        })\n      );\n      setSettings(state.settings);\n    },\n    [setGroupAtoms, setSettings]\n  );\n\n  return (\n    <RawAppLoader\n      gameData={gameData}\n      onSetPreviousState={handleSetPreviousState}\n    />\n  );\n};\n","import { useEffect, useState } from 'react';\n\ntype PromiseState<T> =\n  | Readonly<[undefined, undefined, 'pending']>\n  | Readonly<[T, undefined, 'resolved']>\n  | Readonly<[undefined, unknown, 'rejected']>;\n\nconst defaultState = [undefined, undefined, 'pending'] as const;\n\nexport function usePromise<T>(\n  promiseFn: () => Promise<T>,\n  dependencies: unknown[]\n): PromiseState<T> {\n  const [promiseState, setPromiseState] = useState<PromiseState<T>>(\n    defaultState\n  );\n\n  useEffect(\n    () => {\n      let cancelled = false;\n      const promise = promiseFn();\n      setPromiseState(defaultState);\n\n      promise.then(\n        (value) => {\n          if (!cancelled) setPromiseState([value, undefined, 'resolved']);\n        },\n        (reason) => {\n          if (!cancelled) setPromiseState([undefined, reason, 'rejected']);\n        }\n      );\n\n      return () => {\n        cancelled = true;\n      };\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    dependencies\n  );\n\n  return promiseState;\n}\n","import React from 'react';\nimport { useRecoilState } from 'recoil';\n\nimport { gameDataAtom } from '../atoms';\nimport { usePromise } from '../usePromise';\n\nimport { GameData } from '../game';\n\ninterface Props {\n  child(gameData: GameData): React.ReactElement;\n}\n\nconst datasets = {\n  'kras-18': 'Krastorio2 for 1.0.0',\n  'seablock-17': 'Seablock for 0.17',\n  'space-ex': 'Space Exploration',\n} as const;\n\nasync function loadGameData(\n  filename: keyof typeof datasets\n): Promise<GameData> {\n  const response = await fetch(\n    `${process.env.PUBLIC_URL}/assets/${filename}.json`\n  );\n\n  if (response.status !== 200) {\n    throw new Error(\n      `Could not load game data, got HTTP status ${response.status}`\n    );\n  }\n\n  let parsed;\n  try {\n    parsed = await response.json();\n  } catch (err) {\n    throw new Error(`Could not parse game data: ${err}`);\n  }\n  const gameData = new GameData(parsed);\n  return gameData;\n}\n\nexport const GameDataLoader: React.FC<Props> = ({ child }) => {\n  const setGameState = useRecoilState(gameDataAtom)[1];\n\n  const [gameData, error, status] = usePromise<GameData | null>(async () => {\n    const gameData = await loadGameData('space-ex');\n    setGameState(gameData);\n    return gameData;\n  }, []);\n\n  if (status === 'pending') {\n    return <h3>Loading game data...</h3>;\n  } else if (status === 'rejected') {\n    return (\n      <div>\n        <h3>Error loading game data!</h3>\n        <pre>{String(error)}</pre>\n      </div>\n    );\n  } else if (gameData) {\n    return child(gameData);\n  } else {\n    throw new Error('Somehow missing gamedata');\n  }\n};\n\nexport default GameDataLoader;\n","import React, { useEffect } from 'react';\n\nimport { useRelativeTime } from '../util';\n\ninterface Props {\n  title: string;\n  when: Date;\n  onClose(): void;\n}\n\nconst AUTOHIDE_DELAY = 5000;\n\nexport const Toast: React.FC<Props> = ({ title, when, onClose, children }) => {\n  useEffect(() => {\n    const tId = setTimeout(() => {\n      onClose();\n    }, AUTOHIDE_DELAY);\n\n    return () => {\n      clearTimeout(tId);\n    };\n  }, [title, when, onClose, children]);\n\n  const reltime = useRelativeTime(when);\n\n  return (\n    <div\n      className=\"toast fade show\"\n      role=\"alert\"\n      aria-live=\"assertive\"\n      aria-atomic=\"true\"\n    >\n      <div className=\"toast-header\">\n        <strong className=\"mr-auto\">{title}</strong>\n        <small>{reltime}</small>\n        <button\n          type=\"button\"\n          className=\"ml-2 mb-1 close\"\n          data-dismiss=\"toast\"\n          aria-label=\"Close\"\n          onClick={onClose}\n        >\n          <span aria-hidden=\"true\">&times;</span>\n        </button>\n      </div>\n      <div className=\"toast-body\">{children}</div>\n    </div>\n  );\n};\n","import React from 'react';\n\nimport { newNotification, Notification } from '../notifications';\n\nimport { Toast } from './Toast';\n\nimport styles from './ToastPortal.module.css';\n\ninterface ShownToast extends Notification {\n  key: number;\n  handleClose(): void;\n}\n\ninterface Props {}\n\ninterface State {\n  toasts: ShownToast[];\n}\n\nlet nextKey = 0;\n\nexport class ToastPortal extends React.Component<Props, State> {\n  state: State = {\n    toasts: [],\n  };\n\n  componentDidMount(): void {\n    newNotification.addHandler(this.handleNotification);\n  }\n\n  componentWillUnmount(): void {\n    newNotification.removeHandler(this.handleNotification);\n  }\n\n  handleNotification = (notification: Notification): void => {\n    const toastPortal = this;\n    const toast: ShownToast = {\n      ...notification,\n      key: nextKey++,\n      handleClose() {\n        toastPortal.setState(\n          (state): State => {\n            return {\n              ...state,\n              toasts: state.toasts.filter((n) => n.key !== toast.key),\n            };\n          }\n        );\n      },\n    };\n    this.setState(\n      (state): State => {\n        return {\n          ...state,\n          toasts: [...state.toasts, toast],\n        };\n      }\n    );\n  };\n\n  renderToast = (toast: ShownToast): React.ReactNode => {\n    return (\n      <Toast\n        key={toast.key}\n        title={toast.title}\n        when={toast.when}\n        onClose={toast.handleClose}\n      >\n        {toast.body}\n      </Toast>\n    );\n  };\n\n  render(): React.ReactNode {\n    return (\n      <div aria-live=\"polite\" aria-atomic=\"true\" className={styles.ToastPortal}>\n        {this.state.toasts.map(this.renderToast)}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { RecoilRoot } from 'recoil';\n\nimport { ErrorCatcher } from './components/ErrorCatcher';\nimport { AppLoader } from './components/AppLoader';\nimport { GameDataLoader } from './components/GameDataLoader';\nimport { ToastPortal } from './components/ToastPortal';\n\nimport './index.css';\n\nReactDOM.render(\n  <ErrorCatcher>\n    <RecoilRoot>\n      <GameDataLoader child={(gameData) => <AppLoader gameData={gameData} />} />\n      <ToastPortal />\n    </RecoilRoot>\n  </ErrorCatcher>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}