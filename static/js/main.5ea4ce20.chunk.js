(this.webpackJsonptscalc=this.webpackJsonptscalc||[]).push([[0],{28:function(e,t,n){e.exports={Icon:"Icon_Icon__377W-",IconTextWrapper:"Icon_IconTextWrapper__Nb7R3",IconText:"Icon_IconText__KjO-g"}},33:function(e,t,n){e.exports={RecipePicker:"RecipePicker_RecipePicker__3sU3V",ResultName:"RecipePicker_ResultName__jSE56"}},41:function(e,t,n){e.exports={crashed:"ErrorCatcher_crashed__3tour"}},42:function(e,t,n){e.exports={RecipePart:"RecipePart_RecipePart__3J39l"}},43:function(e,t,n){e.exports={RecipeRow:"RecipeRow_RecipeRow__3swT4"}},47:function(e,t,n){e.exports={TotalCard:"TotalCard_TotalCard__2ci0q"}},48:function(e,t,n){e.exports={RecipeGroup:"RecipeGroup_RecipeGroup__3MC_F"}},49:function(e,t,n){e.exports={Sidebar:"App_Sidebar__3POeR"}},72:function(e,t,n){},73:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),i=n(8),c=n(1),u=n(5),s=n(6),l=n(7),m=n(41),p=n.n(m),d=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={crashMsg:void 0},e}return Object(u.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return t.crashMsg!==this.state.crashMsg}},{key:"componentDidCatch",value:function(e,t){this.setState({crashMsg:["Component Stack:",t.componentStack,"",e&&e.stack].join("\n")})}},{key:"render",value:function(){return this.state.crashMsg?r.a.createElement("div",{className:p.a.crashed},r.a.createElement("h1",null,"Crashed!"),r.a.createElement("pre",null,this.state.crashMsg)):this.props.children}}]),n}(r.a.Component),f=n(9),h=n.n(f),v=n(18),b=Object(i.b)({key:"gameData",default:null}),g=function(){var e=Object(i.e)(b);if(!e)throw new Error("useGameData called without gameData available");return e},y=Object(i.b)({key:"recipeTarget",default:void 0}),O=Object(i.b)({key:"groupAtoms",default:[]}),j=Object(i.c)({key:"groupsState",get:function(e){var t=e.get;return t(O).map((function(e){return[t(e),e]}))}}),w=Object(i.b)({key:"settings",default:{assemblerOverrides:{}}}),E=n(3),k=n(4);function C(e,t){if(!e)throw new Error(t||"Assertion failed")}function N(e,t){for(var n={},a=0,r=Object.entries(e);a<r.length;a++){var o=Object(E.a)(r[a],2),i=o[0],c=o[1];n[i]=t(c)}return n}function M(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)}function R(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function S(e,t){for(var n=0;n<t.length&&e>=1e3;n++)e/=1e3;return"".concat(R(e,2)," ").concat(t[n])}function x(e,t){var n;function a(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];void 0!==n&&clearTimeout(n),n=setTimeout((function(){n=void 0,e.apply(void 0,r)}),t)}return Object.defineProperty(a,"cancel",{value:function(){void 0!==n&&(clearTimeout(n),n=void 0)}}),a}function I(e,t){return t?I(t,e%t):e}function P(e,t){return C(Number.isSafeInteger(e)),C(Number.isSafeInteger(t)),{quotient:Math.floor(e/t),remainder:e%t}}var T=1e4,_=function(){function e(t,n){Object(c.a)(this,e),this.p=void 0,this.q=void 0,C(Number.isSafeInteger(t),"Numerator must be a safe integer, got ".concat(t)),C(Number.isSafeInteger(n),"Denominator must be a safe integer, got ".concat(n)),C(0!==n,"Denominator must not be zero"),n<0&&(t=-t,n=-n),0===t&&(n=1);var a=I(t,n);a>1&&(t/=a,n/=a),this.p=t,this.q=n}return Object(u.a)(e,[{key:"floor",value:function(){var t=P(this.p,this.q),n=new e(t.quotient,1);return n.less(e.zero)&&0!==t.remainder&&(n=n.sub(e.one)),n}},{key:"negate",value:function(){return new e(-this.p,this.q)}},{key:"invert",value:function(){return new e(this.q,this.p)}},{key:"add",value:function(t){return new e(this.p*t.q+this.q*t.p,this.q*t.q)}},{key:"sub",value:function(t){return new e(this.p*t.q-this.q*t.p,this.q*t.q)}},{key:"mul",value:function(t){return"number"==typeof t&&(t=e.fromFloat(t)),new e(this.p*t.p,this.q*t.q)}},{key:"div",value:function(t){return new e(this.p*t.q,this.q*t.p)}},{key:"clamp",value:function(t,n){return"number"==typeof t&&(t=e.fromFloat(t)),"number"==typeof n&&(n=e.fromFloat(n)),this.less(t)?t:n.less(this)?n:this}},{key:"divmod",value:function(e){var t=this.div(e).floor();return{quotient:t,remainder:this.sub(e.mul(t))}}},{key:"equal",value:function(e){return this.p===e.p&&this.q===e.q}},{key:"isNegative",value:function(){return this.p<0}},{key:"isPositive",value:function(){return this.p>0}},{key:"isOne",value:function(){return 1===this.p}},{key:"isZero",value:function(){return 0===this.p}},{key:"less",value:function(e){return this.p*e.q<this.q*e.p}},{key:"toFloat",value:function(){return this.p/this.q}},{key:"toString",value:function(){return this.toFraction()}},{key:"toFraction",value:function(){return 1===this.q?this.p.toString():this.p.toString()+"/"+this.q.toString()}},{key:"toDecimal",value:function(t,n){null==t&&(t=3),null==n&&(n=new e(5,Math.pow(10,t+1)));var a="",r=this;r.isNegative()&&(a="-",r=r.negate());for(var o=P((r=r.add(n)).p,r.q),i=o.quotient.toString(),c="",u=new e(o.remainder,r.q),s=new e(10,1);t>0&&!u.equal(n);){u=u.mul(s),n=n.mul(s);var l=P(u.p,u.q);c+=l.quotient.toString(),u=new e(l.remainder,u.q),t--}if(u.equal(n))for(;"0"===c[c.length-1];)c=c.slice(0,c.length-1);return""!==c?a+i+"."+c:a+i}},{key:"toMixed",value:function(){if(this.isZero())return"0";var t=this.divmod(e.one),n=t.quotient,a=t.remainder,r=[];return n.isZero()||r.push(n.toFraction()),a.isZero()||r.push(a.toFraction()),r.join(" + ")}}],[{key:"fromFloat",value:function(t){if(Number.isInteger(t))return new this(t,1);var n,a=new e(Math.round(t*T),T),r=a.divmod(e.one),o=Object(k.a)(D);try{for(o.s();!(n=o.n()).done;){var i=Object(E.a)(n.value,2),c=i[0],u=i[1];if(r.remainder.equal(c))return r.quotient.add(u)}}catch(s){o.e(s)}finally{o.f()}return a}},{key:"fromInts",value:function(e,t){return new this(e,t)}},{key:"fromString",value:function(t){var n,a=e.zero,r=Object(k.a)(t.split("+"));try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o=o.trim()){var i=o.indexOf("/");if(-1===i)a=a.add(e.fromFloat(Number(o)));else{var c=Number(o.slice(0,i)),u=Number(o.slice(i+1));a=a.add(e.fromInts(c,u))}}}}catch(s){r.e(s)}finally{r.f()}return a}}]),e}();_.zero=new _(0,1),_.one=new _(1,1),_.oneThird=new _(1,3),_.twoThirds=new _(2,3);for(var D=[],q=2;q<100;q++)for(var A=1;A<q;A++){var F=A/q;if(!(F.toString().length<10)){var B=new _(Math.round(F*T),T);D.push([B,_.fromInts(A,q)]);var G=new _(Math.floor(F*T),T);D.push([G,_.fromInts(A,q)])}}var W=n(2),U=n(51),L=n(14),V=function(){function e(t){Object(c.a)(this,e),this.name=void 0,this.localisedName=void 0,this.iconCol=void 0,this.iconRow=void 0,this.name=t.name,this.localisedName=t.localised_name,this.iconCol=t.icon_col,this.iconRow=t.icon_row}return Object(u.a)(e,[{key:"niceName",get:function(){return this.localisedName.en}}]),e}(),H=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a,r;return Object(c.a)(this,n),(r=t.call(this,e)).group=void 0,r.subgroup=void 0,r.order=void 0,r.fuelValue=void 0,r.usedBy=[],r.madeBy=[],r.group=e.group,r.subgroup=e.subgroup,r.order=e.order,r.fuelValue=null!==(a=e.fuel_value)&&void 0!==a?a:null,r}return n}(V),J=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).type=void 0,a.limitedTo=void 0,a.effects=void 0,a.type=e.type,a.limitedTo=new Set(e.limitation),a.effects={speed:_.fromFloat((e.effect.speed||{bonus:0}).bonus),productivity:_.fromFloat((e.effect.productivity||{bonus:0}).bonus),consumption:_.fromFloat((e.effect.consumption||{bonus:0}).bonus),pollution:_.fromFloat((e.effect.pollution||{bonus:0}).bonus)},a}return Object(u.a)(n,[{key:"canUseWith",value:function(e){return 0===this.limitedTo.size||this.limitedTo.has(e.name)}}]),n}(H),z=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).defaultTemperature=void 0,a.type="fluid",a.defaultTemperature=e.default_temperature,a}return n}(H),K=function(){function e(t,n){var a;Object(c.a)(this,e),this.type=void 0,this.name=void 0,this.amount=void 0,this.item=void 0,this.name=t.name,this.amount=_.fromFloat(t.amount),this.type=null!==(a=t.type)&&void 0!==a?a:"item",this.item=n.getItem(t.name)}return Object(u.a)(e,[{key:"niceName",get:function(){return"".concat(this.amount.toDecimal()," \xd7 ").concat(this.item.niceName)}}]),e}(),Z=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e,a){var r;return Object(c.a)(this,n),(r=t.call(this,e,a)).type="fluid",r.item=void 0,r.minimumTemperature=void 0,r.maximumTemperature=void 0,r.item=a.getFluid(e.name),r.minimumTemperature=e.minimum_temperature||-1/0,r.maximumTemperature=e.maximum_temperature||1/0,r.maximumTemperature>=1797e305&&(r.maximumTemperature=1/0),r.minimumTemperature<=-1797e305&&(r.minimumTemperature=-1/0),r}return Object(u.a)(n,[{key:"niceName",get:function(){var e=this.minimumTemperature,t=this.maximumTemperature,n="";return e!==-1/0&&t!==1/0?n=" (".concat(e,"\xb0 \u2013 ").concat(t,"\xb0)"):t!==1/0?n=" (\u2264 ".concat(t,"\xb0)"):e!==-1/0&&(n=" (\u2265 ".concat(t,"\xb0)")),"".concat(this.amount.toDecimal()," \xd7 ").concat(this.item.niceName).concat(n)}}]),n}(K),Q=function(){function e(t,n){var a;Object(c.a)(this,e),this.name=void 0,this.item=void 0,this.amount=void 0,this.name=t.name,this.item=n.getItem(t.name),a="amount"in t?_.fromFloat(t.amount):_.fromInts(t.amount_min+t.amount_max,2),"number"==typeof t.probability&&(0===t.probability?a=_.zero:1!==t.probability&&(C(t.probability>0),C(t.probability<1),a=a.mul(_.fromFloat(t.probability)))),this.amount=a}return Object(u.a)(e,[{key:"satisfies",value:function(e){return e.item===this.item}},{key:"niceName",get:function(){return"".concat(this.amount.toDecimal()," \xd7 ").concat(this.item.niceName)}}]),e}(),$=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e,a){var r;return Object(c.a)(this,n),(r=t.call(this,e,a)).item=void 0,r.temperature=void 0,r.item=a.getFluid(e.name),r.temperature=e.temperature||r.item.defaultTemperature,r}return Object(u.a)(n,[{key:"satisfies",value:function(e){return e.item===this.item&&e instanceof Z&&e.maximumTemperature>=this.temperature&&e.minimumTemperature<=this.temperature}},{key:"niceName",get:function(){var e="";return this.temperature!==this.item.defaultTemperature&&(e=" (".concat(this.temperature,"\xb0)")),"".concat(this.amount.toDecimal()," \xd7 ").concat(this.item.niceName).concat(e)}}]),n}(Q),X=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e,a){var r;return Object(c.a)(this,n),(r=t.call(this,e)).category=void 0,r.ingredients=void 0,r.products=void 0,r.craftingTime=void 0,r.madeIn=[],r.category=e.category,r.craftingTime=_.fromFloat(e.energy_required),r.ingredients=e.ingredients.map((function(e){return"fluid"===e.type?new Z(e,a):new K(e,a)})),r.products=e.results.map((function(e){return"fluid"===e.type?new $(e,a):new Q(e,a)})),r}return Object(u.a)(n,[{key:"niceName",get:function(){if(1!==this.products.length)return Object(U.a)(Object(L.a)(n.prototype),"niceName",this);var e=this.products[0];return C(e,"recipe has no products"),e.amount.equal(_.one)?e.item.niceName:e.niceName}}]),n}(V),Y=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).craftingCategories=void 0,a.craftingSpeed=void 0,a.moduleSlots=void 0,a.craftingCategories=e.crafting_categories,a.craftingSpeed=e.crafting_speed,a.moduleSlots=e.module_slots,a}return Object(u.a)(n,[{key:"canBuildRecipe",value:function(e){return-1!==this.craftingCategories.indexOf(e.category)}}]),n}(function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){return Object(c.a)(this,n),t.call(this,e)}return n}(V)),ee=function(){function e(t){Object(c.a)(this,e),this.itemMap=new Map,this.fluids=[],this.fluidMap=new Map,this.modules=[],this.moduleMap=new Map,this.recipes=[],this.recipeMap=new Map,this.entityMap=new Map,this.categoryMap=void 0,this.groups=void 0,this.clockSprite=void 0,this.noModuleModule=void 0,this.spriteHash=void 0,this.spriteHash=t.sprites.hash;for(var n=0,a=Object.values(t["assembling-machine"]);n<a.length;n++){var r=a[n],o=new Y(r);this.entityMap.set(o.name,o)}for(var i=0,u=Object.values(t.furnace);i<u.length;i++){var s=u[i],l=new Y(s);this.entityMap.set(l.name,l)}for(var m=0,p=Object.values(t["rocket-silo"]);m<p.length;m++){var d=p[m],f=new Y(d);this.entityMap.set(f.name,f)}for(var h=0,v=Object.values(t["mining-drill"]);h<v.length;h++){var b=v[h],g=Object(W.a)(Object(W.a)({},b),{},{crafting_categories:b.resource_categories.map((function(e){return"resource-"+e})),crafting_speed:b.mining_speed,ingredient_count:1}),y=new Y(g);this.entityMap.set(g.name,y)}for(var O=0,j=Object.values(t.items);O<j.length;O++){var w=j[O];if("type"in w&&"fluid"===w.type){var E=new z(w);this.itemMap.set(E.name,E),this.fluids.push(E),this.fluidMap.set(E.name,E)}else if("type"in w&&"module"===w.type){var N=new J(w);this.itemMap.set(N.name,N),this.modules.push(N),this.moduleMap.set(N.name,N)}else{var M=new H(w);this.itemMap.set(M.name,M)}}for(var R=[],S=0,x=Object.values(t.recipes);S<x.length;S++){var I=x[S];R.push(new X(I,this))}for(var P=0,T=Object.values(t.resource);P<T.length;P++){var _=T[P],D="resource-".concat(_.category),q=[],A=_.minable,F=A.fluid_amount,B=A.required_fluid;F&&B&&q.push({name:B,type:"fluid",amount:F/10}),R.push(new X({name:"resource-".concat(_.name),localised_name:_.localised_name,category:D,energy_required:_.minable.mining_time,group:D,subgroup:D,icon_col:_.icon_col,icon_row:_.icon_row,ingredients:q,results:_.minable.results,type:"recipe",order:"A"},this))}for(var G=0,U=R;G<U.length;G++){var L,K=U[G],Z=Object(k.a)(this.entityMap.values());try{for(Z.s();!(L=Z.n()).done;){var Q=L.value;"canBuildRecipe"in Q&&Q.canBuildRecipe(K)&&K.madeIn.push(Q)}}catch(oe){Z.e(oe)}finally{Z.f()}if(K.madeIn.length){if(K.products.some((function(e){return e.amount.isPositive()}))){var $,ee=Object(k.a)(K.ingredients);try{for(ee.s();!($=ee.n()).done;){$.value.item.usedBy.push(K)}}catch(oe){ee.e(oe)}finally{ee.f()}var te,ne=Object(k.a)(K.products);try{for(ne.s();!(te=ne.n()).done;){te.value.item.madeBy.push(K)}}catch(oe){ne.e(oe)}finally{ne.f()}this.recipes.push(K),this.recipeMap.set(K.name,K)}}else console.warn("Ignoring uncraftable recipe: ".concat(K.name))}this.categoryMap=function(e){var t,n={},a=Object(k.a)(e);try{for(a.s();!(t=a.n()).done;){var r,o=t.value,i=Object(k.a)(o.craftingCategories);try{for(i.s();!(r=i.n()).done;){var c=r.value,u=n[c];u?u.push(o):n[c]=[o]}}catch(oe){i.e(oe)}finally{i.f()}}}catch(oe){a.e(oe)}finally{a.f()}return n}(this.entityMap.values()),this.groups=t.groups;var ae=t.sprites.extra.clock;C(ae,"missing clock sprite");var re=t.sprites.extra.slot_icon_module;C(re,'missing "no icon" sprite'),this.clockSprite=new V(Object(W.a)(Object(W.a)({},ae),{},{name:"clock",localised_name:{en:"Clock"}})),this.noModuleModule=new J(Object(W.a)(Object(W.a)({},re),{},{type:"module",name:"no_module",localised_name:{en:"No Module"},category:"speed",effect:{},limitation:[],rocket_launch_products:[],group:"",subgroup:"",order:""}))}return Object(u.a)(e,[{key:"getEntity",value:function(e){var t=this.entityMap.get(e);return C(t,"no entity with name: ".concat(e)),t}},{key:"getFluid",value:function(e){var t=this.fluidMap.get(e);return C(t,"no fluid with name: ".concat(e)),t}},{key:"getItem",value:function(e){var t=this.itemMap.get(e);return C(t,"no item with name: ".concat(e)),t}},{key:"getModule",value:function(e){var t=this.moduleMap.get(e);return C(t,"no module with name: ".concat(e)),t}},{key:"getRecipe",value:function(e){var t=this.recipeMap.get(e);return C(t,"no recipe with name: ".concat(e)),t}},{key:"getItemOrder",value:function(e){var t="",n="",a=this.groups[e.group];return a&&(t=a.order,n=a.subgroups[e.subgroup]||""),[t,n,e.order,e.name]}},{key:"sortByItem",value:function(e,t){var n=this;e.sort((function(e,a){var r=n.getItemOrder(t(e)),o=n.getItemOrder(t(a));for(var i in r){var c=r[i],u=o[i];if(c>u)return 1;if(c<u)return-1}return 0}))}}]),e}();function te(e,t,n){var a,r=e instanceof X?e.category:e;return C(a=r in t.assemblerOverrides?t.assemblerOverrides[r]:n.categoryMap[r][0]),e instanceof X&&C(-1!==e.madeIn.indexOf(a)),a}var ne=n(30);function ae(e){return{name:e.name,rows:e.rows.map((function(e){return[e[0],e[1],e[2].toString(),e[3],e[4],e[5]]}))}}function re(e,t){return{version:5,data:{groups:e.groups.map((function(n){return{name:n.name,rows:n.rows.map((function(n){var a=n.machine.name;return te(n.recipe,e.settings,t).name===a&&(a=null),[n.recipe.name,a,n.numMachines.toFraction(),n.modules.map((function(e){return e?e.name:null})),n.beaconModule?n.beaconModule.name:void 0,n.numBeacons]}))}})),settings:{assemblerOverrides:N(e.settings.assemblerOverrides,(function(e){return e.name}))}}}}var oe=/^#(\d+)?(?:-)?(.+)$/;function ie(e){switch(e.version){case 1:e=function(e){return{version:2,data:{rows:e.data,settings:{assemblerOverrides:{}}}}}(e);case 2:e=function(e){return{version:3,data:e.data}}(e);case 3:e=function(e){return{version:4,data:{settings:e.data.settings,groups:[{name:"Factory 1",rows:e.data.rows}]}}}(e);case 4:e=function(e){return{version:5,data:{settings:e.data.settings,groups:e.data.groups.map(ae)}}}(e);case 5:break;default:throw new Error("unknown state: ".concat(e))}return e}function ce(e,t){var n=ie(t).data,a={settings:ue(e,n.settings),groups:[]};return a.groups=n.groups.map((function(t){return{name:t.name,rows:t.rows.map((function(t){var n=Object(E.a)(t,6),r=n[0],o=n[1],i=n[2],c=n[3],u=n[4],s=n[5],l=e.getRecipe(r);return{recipe:l,machine:o?e.getEntity(o):te(l,a.settings,e),numMachines:_.fromString(i),modules:c.map((function(t){return t?e.getModule(t):null})),beaconModule:u?e.getModule(u):null,numBeacons:s||0}}))}})),a}function ue(e,t){return{assemblerOverrides:N(t.assemblerOverrides,(function(t){return e.getEntity(t)}))}}var se=n(20),le=n.n(se),me=n(10),pe=n(22),de=function(){function e(){var t=this;Object(c.a)(this,e),this.handlers=[],this.dispatch=function(e){var n,a=Object(k.a)(t.handlers);try{for(a.s();!(n=a.n()).done;){(0,n.value)(e)}}catch(r){a.e(r)}finally{a.f()}}}return Object(u.a)(e,[{key:"addHandler",value:function(e){-1===this.handlers.indexOf(e)&&this.handlers.push(e)}},{key:"removeHandler",value:function(e){var t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)}}]),e}(),fe=new de,he=new de,ve=new de,be=function(){function e(t){if(Object(c.a)(this,e),this.ingredients=[],this.products=[],t&&t.length){var n,a=Object(k.a)(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;this.addRow(r)}}catch(o){a.e(o)}finally{a.f()}}}return Object(u.a)(e,[{key:"addIngredient",value:function(e){var t,n=Object(k.a)(this.ingredients);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.name===e.name&&(!(e instanceof Z&&a instanceof Z)||e.maximumTemperature===a.maximumTemperature&&e.minimumTemperature===a.minimumTemperature))return void(a.amount=a.amount.add(e.amount))}}catch(c){n.e(c)}finally{n.f()}var r,o=Object(k.a)(this.products);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(i.satisfies(e)){if(!i.amount.less(e.amount)){i.amount=i.amount.sub(e.amount),e.amount=_.zero;break}if(e.amount=e.amount.sub(i.amount),i.amount=_.zero,e.amount.isZero())break}}}catch(c){o.e(c)}finally{o.f()}this.ingredients.push(e),this.ingredients=this.ingredients.filter((function(e){return!e.amount.isZero()})),this.products=this.products.filter((function(e){return!e.amount.isZero()}))}},{key:"addProduct",value:function(e){var t,n=Object(k.a)(this.products);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(e.name===a.name&&!(e instanceof $&&a instanceof $&&e.temperature!==a.temperature))return void(a.amount=a.amount.add(e.amount))}}catch(c){n.e(c)}finally{n.f()}var r,o=Object(k.a)(this.ingredients);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(e.satisfies(i)){if(e.amount.less(i.amount)){i.amount=i.amount.sub(e.amount),e.amount=_.zero;break}if(e.amount=e.amount.sub(i.amount),i.amount=_.zero,e.amount.isZero())break}}}catch(c){o.e(c)}finally{o.f()}this.products.push(e),this.ingredients=this.ingredients.filter((function(e){return!e.amount.isZero()})),this.products=this.products.filter((function(e){return!e.amount.isZero()}))}},{key:"addRow",value:function(e){var t,n={consumption:_.one,pollution:_.one,productivity:_.one,speed:_.one},a=Object(k.a)(e.modules);try{for(a.s();!(t=a.n()).done;){var r=t.value;r&&(n.consumption=n.consumption.add(r.effects.consumption),n.pollution=n.pollution.add(r.effects.pollution),n.productivity=n.productivity.add(r.effects.productivity),n.speed=n.speed.add(r.effects.speed))}}catch(h){a.e(h)}finally{a.f()}if(e.beaconModule&&e.numBeacons>0){var o=e.beaconModule.effects,i=_.fromInts(e.numBeacons,2);n.consumption=n.consumption.add(o.consumption.mul(i)),n.pollution=n.pollution.add(o.pollution.mul(i)),n.productivity=n.productivity.add(o.productivity.mul(i)),n.speed=n.speed.add(o.speed.mul(i))}n.consumption=n.consumption.clamp(.2,32767),n.pollution=n.pollution.clamp(.2,32767),n.speed=n.speed.clamp(.2,32767),n.productivity=n.productivity.clamp(1,32767);var c,u=_.one.mul(e.recipe.craftingTime.invert()).mul(e.numMachines).mul(e.machine.craftingSpeed).mul(n.speed),s=u.mul(n.productivity),l=Object(k.a)(e.recipe.ingredients.map((function(e){return(e=M(e)).amount=e.amount.mul(u),e})));try{for(l.s();!(c=l.n()).done;){var m=c.value;this.addIngredient(m)}}catch(h){l.e(h)}finally{l.f()}var p,d=Object(k.a)(e.recipe.products.map((function(e){return(e=M(e)).amount=e.amount.mul(s),e})));try{for(d.s();!(p=d.n()).done;){var f=p.value;this.addProduct(f)}}catch(h){d.e(h)}finally{d.f()}}}]),e}(),ge=n(27),ye=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).buttonRef=a.createRef(),e.state={isOpen:!1},e.handleClick=function(t){e.getCanToggle()&&(t.stopPropagation(),e.setState((function(e){return Object(W.a)(Object(W.a)({},e),{},{isOpen:!e.isOpen})})))},e.handleSelect=function(t){e.props.onSelect(t),e.setState({isOpen:!1})},e.handleWantClose=function(){e.setState({isOpen:!1})},e}return Object(u.a)(n,[{key:"getCanToggle",value:function(){var e,t=Object(k.a)(this.props.options);try{for(t.s();!(e=t.n()).done;){var n=e.value;if("option"in n&&!n.disabled)return!0}}catch(a){t.e(a)}finally{t.f()}return!1}},{key:"render",value:function(){var e,t=["btn","btn-secondary"];return this.getCanToggle()?t.push("dropdown-toggle"):t.push("disabled"),this.state.isOpen&&(e=a.createElement(Oe,{parentRef:this.buttonRef,options:this.props.options,renderOption:this.props.renderOption,onSelect:this.handleSelect,onWantClose:this.handleWantClose})),a.createElement(a.Fragment,null,a.createElement("button",{ref:this.buttonRef,className:t.join(" "),type:"button",onClick:this.handleClick},this.props.renderSelected(this.props.selected)),e)}}]),n}(a.PureComponent),Oe=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).popperInstance=null,e.menuRef=a.createRef(),e.state={style:{}},e.popperUpdate=function(t){return e.setState({style:t.styles}),t},e.handleBodyClick=function(t){if(!e.menuRef.current)throw new Error("Click event without menu rendered. This should not happen.");if(!t.target)throw new Error("Click event without click target. This should not happen.");var n=t.target;e.menuRef.current.contains(n)||e.props.onWantClose()},e.handleKeyEvent=function(t){27===t.keyCode&&e.props.onWantClose()},e.renderOptions=function(){return e.props.options.map((function(t,n){if("header"in t)return a.createElement("h6",{className:"dropdown-header",key:"ddkey"+n},t.header);if("divider"in t)return a.createElement("div",{className:"dropdown-divider",key:"ddkey"+n});var r=["dropdown-item"];return t.active&&r.push("active"),t.disabled&&r.push("disabled"),a.createElement("button",{key:t.key,className:r.join(" "),onClick:function(){return e.props.onSelect(t.option)},type:"button"},e.props.renderOption(t.option))}))},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){if(this.popperInstance)throw new Error("Component mounted twice?");var e=this.props.parentRef.current;if(!e)throw new Error("Cannot mount DropdownMenu without parentRef");var t=this.menuRef.current;if(!t)throw new Error("Cannot mount DropdownMenu without menuRef");this.popperInstance=new ge.a(e,t,{modifiers:{applyStyle:{enabled:!1},updateStateWithStyle:{enabled:!0,fn:this.popperUpdate}}}),document.body.addEventListener("click",this.handleBodyClick),document.body.addEventListener("keyup",this.handleKeyEvent)}},{key:"componentWillUnmount",value:function(){this.popperInstance&&(this.popperInstance.disableEventListeners(),this.popperInstance=null),document.body.removeEventListener("click",this.handleBodyClick),document.body.removeEventListener("keyup",this.handleKeyEvent)}},{key:"render",value:function(){return a.createElement("div",{className:"dropdown-menu show",style:this.state.style,ref:this.menuRef},this.renderOptions())}}]),n}(a.PureComponent),je={zIndex:1001},we=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).selfRef=void 0,r.popperInstance=void 0,r.handleMouseEnter=function(){r.setState({showSelf:!0})},r.handleMouseLeave=function(){r.setState({showSelf:!1})},r.selfRef=a.createRef(),r.popperInstance=null,r.state={showSelf:!1},r}return Object(u.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.relativeTo!==e.relativeTo||this.state.showSelf!==t.showSelf||this.state.showSelf&&this.props.content!==e.content}},{key:"initPopper",value:function(){if(!this.popperInstance){var e=this.props.relativeTo.current;if(!e)throw new Error("Invalid relativeTo");var t=this.selfRef.current;if(!t)throw new Error("No self reference yet?");this.popperInstance=new ge.a(e,t,{placement:"right",modifiers:{offset:{enabled:!0,offset:"0, 20"},preventOverflow:{enabled:!0,boundariesElement:"window"}}})}}},{key:"cleanupPopper",value:function(){this.popperInstance&&(this.popperInstance.disableEventListeners(),this.popperInstance=null)}},{key:"componentDidUpdate",value:function(e,t){t.showSelf!==this.state.showSelf&&(this.state.showSelf?this.initPopper():this.cleanupPopper())}},{key:"componentDidMount",value:function(){var e=this.props.relativeTo.current;if(!e)throw new Error("Invalid relativeTo");e.addEventListener("mouseenter",this.handleMouseEnter),e.addEventListener("mouseleave",this.handleMouseLeave)}},{key:"componentWillUnmount",value:function(){var e=this.props.relativeTo.current;e&&(e.removeEventListener("mouseenter",this.handleMouseEnter),e.removeEventListener("mouseleave",this.handleMouseLeave))}},{key:"render",value:function(){return this.state.showSelf?o.createPortal(a.createElement("div",{style:je,ref:this.selfRef},this.props.content()),document.body):null}}]),n}(a.Component),Ee=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.value;a.setState({txtValue:t},(function(){if(t.trim()){var e=Number(t);isNaN(e)||Number.isInteger(e)&&("number"===typeof a.props.min&&e<a.props.min||a.props.onChange(e))}}))},a.state={txtValue:e.value.toString()},a}return Object(u.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this;e.value!==this.props.value&&this.setState((function(e){return{txtValue:Number(e.txtValue)===t.props.value?e.txtValue:t.props.value.toString()}}))}},{key:"render",value:function(){return a.createElement("input",{className:"form-control",value:this.state.txtValue,onChange:this.handleChange,type:"number",min:this.props.min,step:"1"})}}]),n}(a.PureComponent),ke=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t,n,r=e.target.value;try{n=Ce(r)}catch(o){t=o.message}n&&a.props.positiveOnly&&n.isNegative()&&(n=void 0,t="Number must be positive"),a.setState({txtValue:r,error:t},(function(){n&&a.props.onChange(n)}))},a.state={error:"",txtValue:Ne(e.value)},a}return Object(u.a)(n,[{key:"componentDidUpdate",value:function(e){if(!this.props.value.equal(e.value)){var t;try{t=Ce(this.state.txtValue)}catch(n){return}t.equal(this.props.value)||this.setState({txtValue:Ne(this.props.value)})}}},{key:"render",value:function(){return a.createElement("input",{className:le()("form-control",{"is-invalid":!!this.state.error}),value:this.state.txtValue,onChange:this.handleChange,type:"text"})}}]),n}(a.PureComponent);function Ce(e){if(!e.trim())throw new Error("Empty!");if(e.indexOf("/")!==e.lastIndexOf("/"))throw new Error("Too many slashes");return _.fromString(e)}function Ne(e){var t=e.toFloat().toString();return t.length<10?t:e.toMixed()}var Me=n(28),Re=n.n(Me),Se=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).iconRef=r.a.createRef(),e}return Object(u.a)(n,[{key:"render",value:function(){var e=32*-this.props.obj.iconCol,t=32*-this.props.obj.iconRow,n={backgroundPosition:"".concat(e,"px ").concat(t,"px")},a=r.a.createElement("div",{ref:this.iconRef,onClick:this.props.onClick,title:this.props.title,className:le()(Re.a.Icon,"game-icon",this.props.className),style:n},"\xa0");return this.props.tooltip&&(a=r.a.createElement(r.a.Fragment,null,a,r.a.createElement(we,{content:this.props.tooltip,relativeTo:this.iconRef}))),this.props.text&&(a=r.a.createElement("div",{className:Re.a.IconTextWrapper},a,r.a.createElement("span",{className:Re.a.IconText},this.props.text))),a}}]),n}(r.a.PureComponent),xe=function(e){var t,n=e.obj;if(n.item.fuelValue){var r=S(n.amount.mul(n.item.fuelValue).toFloat(),["W","kW","MW","GW","TW","PW"]);t=a.createElement("div",{className:"card-body"},a.createElement("div",null,a.createElement("b",null,"Fuel value"),": ",S(n.item.fuelValue,["J","kJ","MJ","GJ","TJ","PJ"])),a.createElement("div",null,a.createElement("b",null,"Total fuel value"),": ",r))}return a.createElement("div",{className:"card"},a.createElement("div",{className:"card-header"},n.item.niceName," (",n.item.name,")"),t)},Ie=n(42),Pe=n.n(Ie),Te=function(e){var t=e.obj,n=e.showName,o=Object(i.d)(y),c=Object(E.a)(o,2),u=c[0],s=c[1],l=Object(a.useCallback)((function(e){if(e.shiftKey)return e.preventDefault(),e.stopPropagation(),void s({item:t.item,amount:t.amount});t instanceof K?1===t.item.madeBy.length?ve.dispatch(t.item.madeBy[0]):fe.dispatch(t):1===t.item.usedBy.length?ve.dispatch(t.item.usedBy[0]):he.dispatch(t)}),[t,s]),m=function(e){var t,n=e.toDecimal().toString();t=n.includes(".")&&n.length>4?r.a.createElement("abbr",{title:e.toFraction()},e.toDecimal()):n;return r.a.createElement(r.a.Fragment,null,t," / sec")}(t.amount);n&&(m=r.a.createElement(r.a.Fragment,null,t.item.niceName," -- ",m));var p=u&&u.item===t.item&&u.amount.equal(t.amount)?"copy-source":"";return r.a.createElement(Se,{className:"".concat(Pe.a.RecipePart," ").concat(p),onClick:l,tooltip:function(){return r.a.createElement(xe,{obj:t})},obj:t.item,text:m})};var _e=function(e){return a.createElement("div",{className:"machine-card card"},a.createElement("div",{className:"card-body"},a.createElement("b",null,e.machine.niceName),a.createElement("br",null),a.createElement("b",null,"Crafting Speed:")," ",e.machine.craftingSpeed,a.createElement("br",null),a.createElement("b",null,"Module Slots:")," ",e.machine.moduleSlots))},De=function(e){var t=e.recipe,n=e.onClick,r=g(),o=t.ingredients.map((function(e){return a.createElement(Se,{key:e.name,obj:e.item,text:e.niceName})})),i=t.products.map((function(e){return a.createElement(Se,{key:e.name,obj:e.item,text:e.niceName})})),c=t.madeIn.map((function(e){return a.createElement(Se,{key:e.name,obj:e,tooltip:function(){return a.createElement(_e,{machine:e})}})}));return a.createElement("div",{className:"recipe-tooltip card",onClick:function(){n&&n(t)}},a.createElement("div",{className:"card-header"},a.createElement(Se,{obj:t,text:"".concat(t.niceName," (Recipe)")})),a.createElement("ul",{className:"list-group list-group-flush"},a.createElement("li",{className:"list-group-item"},a.createElement("b",null,"Ingredients:"),o,a.createElement(Se,{obj:r.clockSprite,text:a.createElement("span",null,a.createElement("b",null,t.craftingTime.toDecimal()," s")," Crafting time")})),a.createElement("li",{className:"list-group-item"},a.createElement("b",null,"Products:"),i),a.createElement("li",{className:"list-group-item"},a.createElement("b",null,"Made In:"),a.createElement("br",null),c)))},qe=function(e){return r.a.createElement(Se,{obj:e,tooltip:function(){return r.a.createElement(_e,{machine:e})}})},Ae=function(e){return r.a.createElement(Se,{obj:e,tooltip:function(){return r.a.createElement(_e,{machine:e})},text:e.niceName})},Fe=function(e){var t=e.machines.map((function(t){return{key:t.name,option:t,active:t===e.selected}}));return r.a.createElement(ye,{options:t,selected:e.selected,onSelect:e.onChange,renderOption:Ae,renderSelected:qe})};function Be(e,t){return t.isZero()?null:r.a.createElement("div",null,r.a.createElement("b",null,e," ",R(100*t.toFloat(),2),"%"))}var Ge=function(e){var t=e.module;return r.a.createElement("div",{className:"module-card card"},r.a.createElement("div",{className:"card-header"},r.a.createElement("b",null,t.niceName)),r.a.createElement("div",{className:"card-body"},Be("Speed",t.effects.speed),Be("Productivity",t.effects.productivity),Be("Energy Consumption",t.effects.consumption),Be("Pollution",t.effects.pollution)))},We=function(e){var t=g(),n=t.modules.filter((function(t){return(!e.isBeacon||!t.effects.productivity.isPositive())&&t.canUseWith(e.recipe)})).map((function(t){return{key:t.name,option:t,active:t===e.selected}}));return n.unshift({key:"no_module",option:null,active:!e.selected}),a.createElement(ye,{options:n,selected:e.selected,onSelect:e.onChange,renderOption:function(e){return e?a.createElement(Se,{obj:e,tooltip:function(){return a.createElement(Ge,{module:e})},text:e.niceName}):a.createElement(Se,{obj:t.noModuleModule,text:t.noModuleModule.niceName})},renderSelected:function(e){return e?a.createElement(Se,{obj:e,tooltip:function(){return a.createElement(Ge,{module:e})}}):a.createElement(Se,{obj:t.noModuleModule})}})},Ue=n(43),Le=n.n(Ue),Ve=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleRemoveRow=function(){e.props.onRemoveRow(e.props.data.recipe)},e.handleMachineChange=function(t){e.applyChange({machine:t,modules:e.props.data.modules.filter((function(e){return null!==e})).slice(0,t.moduleSlots)})},e.handleNumMachinesChange=function(t){e.applyChange({numMachines:t})},e.handleNumBeaconsChange=function(t){e.applyChange({numBeacons:t})},e.handleSetAllModules=function(){e.applyChange({modules:new Array(e.props.data.machine.moduleSlots).fill(e.props.data.modules[0])})},e.handleSetModule=function(t,n){var a=e.props.data.modules.slice();a[t]=n,e.applyChange({modules:a})},e.handleSetBeaconModule=function(t){e.applyChange({beaconModule:t})},e.handleInputGroupClick=function(t){var n=e.props.recipeTarget;if(t.shiftKey&&n){t.preventDefault(),t.stopPropagation();var a,r=new be;if(r.addRow(Object(W.a)(Object(W.a)({},e.props.data),{},{numMachines:_.one})),a=(a=r.ingredients.find((function(e){return e.item.name===n.item.name})))||r.products.find((function(e){return e.item.name===n.item.name}))){var o=n.amount.div(a.amount);e.applyChange({numMachines:o})}else console.error("Could not find ".concat(n.item.name," in totals"),r)}},e}return Object(u.a)(n,[{key:"applyChange",value:function(e){this.props.onUpdateRow(Object(W.a)(Object(W.a)({},this.props.data),e))}},{key:"getOutput",value:function(){var e=new be;return e.addRow(this.props.data),e}},{key:"renderModules",value:function(){for(var e=this,t=this.props.data.machine.moduleSlots,n=[],a=function(t){var a=e.props.data.modules[t]||null;n.push(r.a.createElement(We,{key:t,recipe:e.props.data.recipe,selected:a,onChange:function(n){return e.handleSetModule(t,n)}}))},o=0;o<t;o++)a(o);return t>1&&n.splice(1,0,r.a.createElement("button",{onClick:this.handleSetAllModules,key:"applicator",className:"btn"},"\u2192")),n}},{key:"renderBeacons",value:function(){return r.a.createElement("div",{className:"btn-toolbar"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"Beacon Modules")),r.a.createElement(Ee,{value:this.props.data.numBeacons,onChange:this.handleNumBeaconsChange,min:0}),r.a.createElement("div",{className:"input-group-append btn-icon-wrapper"},r.a.createElement(We,{isBeacon:!0,recipe:this.props.data.recipe,selected:this.props.data.beaconModule,onChange:this.handleSetBeaconModule}))))}},{key:"renderMachines",value:function(){return r.a.createElement("div",{className:"btn-toolbar mb-3"},r.a.createElement("div",{className:"input-group",onClick:this.handleInputGroupClick},r.a.createElement(ke,{value:this.props.data.numMachines,onChange:this.handleNumMachinesChange,positiveOnly:!0}),r.a.createElement("div",{className:"input-group-append btn-icon-wrapper"},r.a.createElement(Fe,{machines:this.props.data.recipe.madeIn,selected:this.props.data.machine,onChange:this.handleMachineChange}))))}},{key:"render",value:function(){var e=this,t=this.props.data.recipe,n=this.getOutput(),a=n.ingredients.map((function(e){return r.a.createElement("div",{className:"mb-1",key:e.name},r.a.createElement(Te,{obj:e}))})),o=n.products.map((function(e){return r.a.createElement("div",{className:"mb-1",key:e.name},r.a.createElement(Te,{obj:e}))}));return r.a.createElement(pe.b,{draggableId:t.name,index:this.props.index},(function(n){return r.a.createElement("div",Object.assign({className:"".concat(Le.a.RecipeRow," recipe-row card mb-3"),ref:n.innerRef},n.draggableProps),r.a.createElement("div",Object.assign({className:"card-header clearfix"},n.dragHandleProps),r.a.createElement("div",{className:"float-left"},r.a.createElement(Se,{obj:t,text:t.niceName,tooltip:function(){return r.a.createElement(De,{recipe:t})}})),r.a.createElement("div",{className:"float-right"},r.a.createElement("button",{className:"btn btn-danger btn-sm",onClick:e.handleRemoveRow},"Remove"))),r.a.createElement("div",{className:"card-body clearfix"},r.a.createElement("div",{className:"float-left"},e.renderMachines(),r.a.createElement("div",{className:"mb-3 btn-group btn-icon-wrapper",role:"group"},e.renderModules()),e.renderBeacons()),r.a.createElement("div",{className:"float-right"},r.a.createElement("div",{className:"mr-3",style:{display:"inline-block",float:"left",minWidth:"150px"}},r.a.createElement("b",null,"Ingredients:"),a),r.a.createElement("div",{className:"mr-2",style:{display:"inline-block",minWidth:"150px"}},r.a.createElement("b",null,"Products:"),o))))}))}}]),n}(r.a.PureComponent),He=function(e){var t=e.index,n=e.data,a=e.onRemoveRow,o=e.onUpdateRow,c=Object(i.e)(y);return r.a.createElement(Ve,{index:t,data:n,recipeTarget:c,onUpdateRow:o,onRemoveRow:a})},Je=n(17),ze=n(46),Ke=n(33),Ze=n.n(Ke),Qe=function(e,t){if("string"===typeof t)throw new Error("path unexpectedly string: ".concat(t));if(1!==t.length)throw new Error("path unexpectedly long/short: ".concat(t));switch(t[0]){case"niceName":return e.niceName;case"name":return e.name;default:throw new Error("Unsupported path: ".concat(t))}},$e=/((?:produces)|(?:consumes)):([a-z0-9-]+)/g,Xe=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).inputRef=a.createRef(),e.state={query:"",matches:[]},e.handleIngredientClick=function(t){var n,a="produces:".concat(t.name);e.state.query.includes(a)||(e.setQuery("".concat(e.state.query," ").concat(a),(function(){e.calculateMatches()})),null===(n=e.inputRef.current)||void 0===n||n.scrollIntoView())},e.handleProductClick=function(t){var n,a="consumes:".concat(t.name);e.state.query.includes(a)||(e.setQuery("".concat(e.state.query," ").concat(a),(function(){e.calculateMatches()})),null===(n=e.inputRef.current)||void 0===n||n.scrollIntoView())},e.handleQueryInput=function(t){var n=t.target;e.setQuery(n.value)},e.handleRecipeClick=function(t){e.props.onPickRecipe(t),e.setQuery("")},e.setQuery=function(t,n){t.trim()?(e.setState({query:t},n),e.debCalculateMatches()):(e.debCalculateMatches.cancel(),e.setState({query:"",matches:[]},n))},e.debCalculateMatches=x(e.calculateMatches.bind(Object(Je.a)(e)),200),e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){fe.addHandler(this.handleIngredientClick),he.addHandler(this.handleProductClick)}},{key:"componentWillUnmount",value:function(){this.debCalculateMatches.cancel(),fe.removeHandler(this.handleIngredientClick),he.removeHandler(this.handleProductClick)}},{key:"calculateMatches",value:function(){var e=this.state.query.trim().toLowerCase();if(e){var t={consumes:[],produces:[]};e=e.replace($e,(function(e,n,a){return t[n].push(a),""})).trim();var n=this.props.recipes;if((t.consumes.length||t.produces.length)&&(n=n.filter((function(e){var n,a=Object(k.a)(t.consumes);try{var r=function(){var t=n.value;if(!e.ingredients.some((function(e){return e.name===t})))return{v:!1}};for(a.s();!(n=a.n()).done;){var o=r();if("object"===typeof o)return o.v}}catch(l){a.e(l)}finally{a.f()}var i,c=Object(k.a)(t.produces);try{var u=function(){var t=i.value;if(!e.products.some((function(e){return e.name===t})))return{v:!1}};for(c.s();!(i=c.n()).done;){var s=u();if("object"===typeof s)return s.v}}catch(l){c.e(l)}finally{c.f()}return!0}))),e)n=new ze.a(n,{shouldSort:!0,getFn:Qe,keys:[{name:"niceName",weight:.7},{name:"name",weight:.2}]}).search(e).map((function(e){return e.item}));this.setState({matches:n})}else this.setState({matches:[]})}},{key:"renderMatches",value:function(){var e=this;if(!this.state.matches.length)return"";var t=this.state.matches;return t.length>100&&(t=t.slice(0,100)),a.createElement("table",{className:"table table-hover"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Recipe"),a.createElement("th",null,"Time"),a.createElement("th",null,"Ingredients"),a.createElement("th",null,"Products"))),a.createElement("tbody",null,t.map((function(t){return a.createElement(Ye,{recipe:t,key:t.name,onClick:e.handleRecipeClick})}))))}},{key:"render",value:function(){return a.createElement("div",{className:Ze.a.RecipePicker},a.createElement("div",null,a.createElement("input",{type:"search",ref:this.inputRef,className:"editable-display form-control",placeholder:"What do you want to build?",value:this.state.query,onChange:this.handleQueryInput})),this.renderMatches())}}]),n}(a.PureComponent),Ye=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleClickAdd=function(){e.props.onClick(e.props.recipe)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.recipe,t=e.ingredients.map((function(e){return a.createElement(Se,{key:e.name,obj:e.item,tooltip:function(){return a.createElement(xe,{obj:e})}})})),n=e.products.map((function(e){return a.createElement(Se,{key:e.name,obj:e.item,tooltip:function(){return a.createElement(xe,{obj:e})}})}));return a.createElement("tr",{onClick:this.handleClickAdd},a.createElement("td",{className:Ze.a.ResultName},a.createElement(Se,{obj:e,text:e.niceName,tooltip:function(){return a.createElement(De,{recipe:e})}})),a.createElement("td",null,e.craftingTime.toDecimal()),a.createElement("td",null,t),a.createElement("td",null,n))}}]),n}(a.PureComponent),et=n(47),tt=n.n(et),nt=function(e){var t=e.rows,n=g(),o=Object(a.useMemo)((function(){var e=new be(t);return n.sortByItem(e.ingredients,(function(e){return e.item})),n.sortByItem(e.products,(function(e){return e.item})),e}),[n,t]);return o.ingredients.length||o.products.length?r.a.createElement("div",{className:"card ".concat(tt.a.TotalCard)},r.a.createElement("div",{className:"card-header"},"Combined Totals"),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},"Ingredients:",o.ingredients.map((function(e){return r.a.createElement(Te,{key:e.name,obj:e,showName:!0})}))),r.a.createElement("div",{className:"col"},"Products:",o.products.map((function(e){return r.a.createElement(Te,{key:e.name,obj:e,showName:!0})})))))):r.a.createElement("div",null)},at=n(48),rt=n.n(at),ot=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleDragEnd=function(t){t.destination&&t.source.index!==t.destination.index&&e.props.onMoveRow(t.source.index,t.destination.index)},e.renderRow=function(t,n){return r.a.createElement(He,{key:t.recipe.name,index:n,data:t,onUpdateRow:e.props.onUpdateRow,onRemoveRow:e.props.onRemoveRow})},e.handleClickRename=function(){var t=prompt("Whatcha wanna call it now?",e.props.group.name);t&&e.props.onRenameGroup(t)},e.handleClickClone=function(){var t=prompt("Whatcha wanna call it now?",e.props.group.name);t&&e.props.onCloneGroup(t)},e.handleClickDelete=function(){e.props.group.rows.length&&!window.confirm("Are you sure you want to delete ".concat(e.props.group.name))||e.props.onRemoveGroup()},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){ve.addHandler(this.props.onAddRow)}},{key:"componentDidUpdate",value:function(e,t){this.props.onAddRow!==e.onAddRow&&(ve.removeHandler(e.onAddRow),ve.addHandler(this.props.onAddRow))}},{key:"componentWillUnmount",value:function(){ve.removeHandler(this.props.onAddRow)}},{key:"render",value:function(){var e=this,t=this.props.gameData.recipes.filter((function(t){return!e.props.group.rows.some((function(e){return e.recipe===t}))}));return r.a.createElement("div",{className:rt.a.RecipeGroup},r.a.createElement("div",{className:"clearfix"},r.a.createElement("h3",{className:"float-left"},this.props.group.name),r.a.createElement("div",{className:"float-right"},r.a.createElement("div",{className:"button-group"},r.a.createElement("button",{className:"btn btn-info",onClick:this.handleClickRename},"Rename"),r.a.createElement("button",{className:"btn btn-info",onClick:this.handleClickClone},"Clone"),r.a.createElement("button",{className:"btn btn-danger",onClick:this.handleClickDelete},"Delete")))),r.a.createElement(Xe,{recipes:t,onPickRecipe:this.props.onAddRow}),r.a.createElement("hr",null),r.a.createElement(pe.a,{onDragEnd:this.handleDragEnd},r.a.createElement(pe.c,{droppableId:"eyy"},(function(t){return r.a.createElement("div",Object.assign({ref:t.innerRef},t.droppableProps),e.props.group.rows.map(e.renderRow),t.placeholder)}))),r.a.createElement("hr",null),r.a.createElement(nt,{rows:this.props.group.rows}))}}]),n}(r.a.PureComponent),it=function(e){var t=e.groupAtom,n=e.onRemoveGroup,o=Object(i.d)(t),c=Object(E.a)(o,2),u=c[0],s=c[1],l=Object(i.e)(w),m=g(),p=Object(a.useCallback)((function(e){s((function(t){return Object(W.a)(Object(W.a)({},t),{},{name:e})}))}),[s]),d=Object(a.useCallback)((function(e){alert("TODO: handleCloneGroup")}),[]),f=Object(a.useCallback)((function(){n(t)}),[n,t]),h=Object(a.useCallback)((function(e,t){var n=Array.from(u.rows),a=n.splice(e,1),r=Object(E.a)(a,1)[0];C(r,"Nothing at old index: ".concat(e)),n.splice(t,0,r),s((function(e){return Object(W.a)(Object(W.a)({},e),{},{rows:n})}))}),[u,s]),v=Object(a.useCallback)((function(e){s((function(t){return t.rows.find((function(t){return t.recipe.name===e.name}))?t:Object(W.a)(Object(W.a)({},t),{},{rows:[].concat(Object(me.a)(t.rows),[{recipe:e,machine:te(e,l,m),numMachines:_.one,modules:[],beaconModule:null,numBeacons:0}])})}))}),[l,m,s]),b=Object(a.useCallback)((function(e){s((function(t){return Object(W.a)(Object(W.a)({},t),{},{rows:t.rows.map((function(t){return t.recipe===e.recipe?e:t}))})}))}),[s]),y=Object(a.useCallback)((function(e){s((function(t){return Object(W.a)(Object(W.a)({},t),{},{rows:t.rows.filter((function(t){return t.recipe!==e}))})}))}),[s]);return r.a.createElement(ot,{group:u,gameData:m,onRenameGroup:p,onCloneGroup:d,onRemoveGroup:f,onAddRow:v,onMoveRow:h,onUpdateRow:b,onRemoveRow:y})},ct=n(12),ut=function(){var e=g(),t=Object(i.d)(w),n=Object(E.a)(t,2),o=n[0],c=n[1],u=Object(a.useCallback)((function(e,t){c((function(n){return Object(W.a)(Object(W.a)({},n),{},{assemblerOverrides:Object(W.a)(Object(W.a)({},n.assemblerOverrides),{},Object(ct.a)({},e,t))})}))}),[c]),s=Object(a.useMemo)((function(){var t=Object.entries(e.categoryMap).filter((function(e){return e[1].length>1})).map((function(e){return e[0]}));return t.sort((function(e,t){return e.localeCompare(t)})),t}),[e]);return r.a.createElement("div",null,r.a.createElement("h3",null,"Default Assemblers"),s.map((function(t){return r.a.createElement(st,{gameData:e,settings:o,key:t,category:t,onSetDefaultMachine:u})})))},st=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){e.props.onSetDefaultMachine(e.props.category,t)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.gameData.categoryMap[this.props.category]||[],t=te(this.props.category,this.props.settings,this.props.gameData);return r.a.createElement("div",{className:"btn-toolbar mb-3"},r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},this.props.category)),r.a.createElement("div",{className:"input-group-append btn-icon-wrapper"},r.a.createElement(Fe,{machines:e,selected:t,onChange:this.handleChange}))))}}]),n}(r.a.PureComponent),lt=0,mt=n(49),pt=n.n(mt),dt=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={activePage:"settings"},e.handleKeyDown=function(e){"Shift"===e.key&&document.body.classList.add("shift-down")},e.handleKeyUp=function(e){"Shift"===e.key&&document.body.classList.remove("shift-down")},e.handleClickGroup=function(t){e.setState({activePage:t})},e.handleClickAddGroup=function(t){t.preventDefault();var n="Factory ".concat(e.props.groups.length+1),a=prompt("What do you want to name this group?",n);a&&a.trim()&&e.props.onAddGroup({name:a,rows:[]})},e.handleRemoveGroupAtom=function(t){if(e.state.activePage===t){var n,a=Object(k.a)(e.props.groups);try{for(a.s();!(n=a.n()).done;){var r=n.value;r[1]!==t&&e.setState({activePage:r[1]})}}catch(o){a.e(o)}finally{a.f()}}e.props.onRemoveGroupAtom(t)},e.handleClickSettings=function(){e.setState({activePage:"settings"})},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}},{key:"renderNavbar",value:function(){var e=this,t="settings"===this.state.activePage,n=this.props.groups.map((function(t,n){var a=Object(E.a)(t,2),o=a[0],i=a[1],c=e.state.activePage===i;return r.a.createElement("button",{key:n,type:"button",className:"list-group-item list-group-item-action ".concat(c?"active":""),onClick:function(){return e.handleClickGroup(i)}},o.name)}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"list-group mt-3"},r.a.createElement("li",{className:"list-group-item"},r.a.createElement("span",{role:"img","aria-label":"Factory icon"},"\ud83c\udfed")," ","Factories"),n,r.a.createElement("button",{type:"button",className:"list-group-item list-group-item-action",onClick:this.handleClickAddGroup},r.a.createElement("span",{role:"img","aria-label":"Factory icon"},"\uff0b")," ","Add a Factory")),r.a.createElement("ul",{className:"list-group mt-3"},r.a.createElement("button",{type:"button",className:"list-group-item list-group-item-action ".concat(t?"active":""),onClick:this.handleClickSettings},r.a.createElement("span",{role:"img","aria-label":"Gear icon"},"\u2699\ufe0f")," ","Settings")))}},{key:"renderBody",value:function(){return"settings"===this.state.activePage?r.a.createElement(ut,null):this.state.activePage?r.a.createElement(it,{groupAtom:this.state.activePage,onRemoveGroup:this.handleRemoveGroupAtom}):function(e){throw new Error("Unexpected object: "+e)}(this.state.activePage)}},{key:"render",value:function(){return C(this.props.gameData,"falsy gameData, should never happen"),r.a.createElement("div",{className:"container-fluid"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:le()("col col-2 bg-primary",pt.a.Sidebar)},this.renderNavbar()),r.a.createElement("div",{className:"col pt-3"},this.renderBody())))}}]),n}(r.a.PureComponent),ft=function(e){var t=e.gameData,n=Object(i.e)(j),o=Object(i.f)(O),c=function(){var e=Object(i.f)(O);return Object(a.useCallback)((function(t){e((function(e){return[].concat(Object(me.a)(e),[Object(i.b)({key:"group-".concat(++lt),default:t})])}))}),[e])}(),u=Object(a.useCallback)((function(e){o((function(t){return t.filter((function(t){return t!==e}))}))}),[o]);return r.a.createElement(dt,{gameData:t,groups:n,onAddGroup:c,onRemoveGroupAtom:u})},ht=function(e){Object(s.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={loaded:!1},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.load().then((function(){e.setState({loaded:!0})}),(function(t){e.setState((function(){throw t}))}))}},{key:"getPreviousState",value:function(){var e=function(e){var t=oe.exec(document.location.hash);if(!t)return null;var n=Number(t[1]||1),a=decodeURIComponent(t[2]);return n>2&&(a=Object(ne.inflate)(atob(a),{to:"string"})),ce(e,{version:n,data:JSON.parse(a)})}(this.props.gameData);if(e)return e;try{var t=function(e){var t=localStorage.getItem("appstate");if(!t)return null;var n=JSON.parse(t);return 1===n.version&&(n.version=3),ce(e,n)}(this.props.gameData);if(t)return t}catch(n){console.error("Failed to load local storage state",n)}}},{key:"load",value:function(){var e=Object(v.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getPreviousState()){e.next=3;break}return e.abrupt("return");case 3:this.props.onSetPreviousState(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){if(!this.state.loaded)return r.a.createElement("h1",null,"Loading...");var e="".concat("/tscalc","/assets/sprite-sheet-").concat(this.props.gameData.spriteHash,".png"),t="\n        .game-icon {\n            background-image: url(".concat(e,");\n        }\n        ");return r.a.createElement(r.a.Fragment,null,r.a.createElement(vt,{gameData:this.props.gameData}),r.a.createElement(bt,{href:e}),r.a.createElement("style",null,t),r.a.createElement(ft,{gameData:this.props.gameData}))}}]),n}(r.a.PureComponent),vt=function(e){var t=e.gameData,n=Object(i.e)(j),r=Object(i.e)(w),o=Object(a.useRef)(!0);return Object(a.useEffect)((function(){if(o.current)o.current=!1;else{var e={groups:n.map((function(e){return e[0]})),settings:r};!function(e,t){var n=re(e,t),a=n.version,r=JSON.stringify(n.data);r=btoa(Object(ne.deflate)(r,{to:"string"})),window.history.replaceState("","","#".concat(a,"-").concat(r))}(e,t),function(e,t){localStorage.setItem("appstate",JSON.stringify(re(e,t)))}(e,t)}}),[t,n,r]),null},bt=function(e){return o.createPortal(r.a.createElement("link",{rel:"prefetch",href:e.href}),document.head)},gt=function(e){var t=e.gameData,n=Object(i.f)(O),o=Object(i.f)(w),c=Object(a.useCallback)((function(e){var t=0;n(e.groups.map((function(e){return Object(i.b)({key:"group-".concat(Date.now(),"-").concat(t++),default:e})}))),o(e.settings)}),[n,o]);return r.a.createElement(ht,{gameData:t,onSetPreviousState:c})},yt=n(50),Ot=n.n(yt);function jt(e){return wt.apply(this,arguments)}function wt(){return(wt=Object(v.a)(h.a.mark((function e(t){var n,a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/tscalc","/assets/").concat(t,".json"));case 2:if(200===(n=e.sent).status){e.next=5;break}throw new Error("Could not load game data, got HTTP status ".concat(n.status));case 5:return e.prev=5,e.next=8,n.json();case 8:a=e.sent,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),new Error("Could not parse game data: ".concat(e.t0));case 14:return r=new ee(a),e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}var Et=function(e){var t=e.child,n=Object(i.d)(b)[1],a=Ot()(Object(v.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt("kras-18");case 2:return t=e.sent,n(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),[]),o=Object(E.a)(a,3),c=o[0],u=o[1],s=o[2];if("pending"===s)return r.a.createElement("h3",null,"Loading game data...");if("rejected"===s)return r.a.createElement("div",null,r.a.createElement("h3",null,"Error loading game data!"),r.a.createElement("pre",null,String(u)));if(c)return t(c);throw new Error("Somehow missing gamedata")};n(72);o.render(a.createElement(d,null,a.createElement(i.a,null,a.createElement(Et,{child:function(e){return a.createElement(gt,{gameData:e})}}))),document.getElementById("root"))}},[[73,1,2]]]);
//# sourceMappingURL=main.5ea4ce20.chunk.js.map